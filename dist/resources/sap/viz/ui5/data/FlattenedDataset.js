/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/viz/library","sap/ui/model/ChangeReason","./Dataset","./DimensionDefinition","./MeasureDefinition","./CVOMDatasetAdaptor","sap/viz/ui5/controls/common/utils/Constants","sap/base/Log","sap/ui/thirdparty/jquery"],function(t,e,i,a,n,s,o,r,jQuery){"use strict";var d=i.extend("sap.viz.ui5.data.FlattenedDataset",{metadata:{library:"sap.viz",designtime:"sap/viz/designtime/FlattenedDataset.designtime",properties:{context:{type:"any",multiple:false,singularName:"context"}},aggregations:{dimensions:{type:"sap.viz.ui5.data.DimensionDefinition",defaultClass:a,multiple:true,singularName:"dimension"},measures:{type:"sap.viz.ui5.data.MeasureDefinition",defaultClass:n,multiple:true,singularName:"measure"},data:{type:"sap.ui.core.Element",multiple:true,singularName:"data",bindable:"bindable"}},events:{dataChange:{},dataRefresh:{},dataError:{}}}});d.getMetadata().getAllAggregations()["data"]._doesNotRequireFactory=true;d.prototype.init=function(){this._oCVOMDatasetAdaptor=new s;this._iStartIndex=-1;this._iLength=-1;this._bReady=true;this._bInitializeBinding=true};d.prototype._bindAggregation=function(){this._bInitializeBinding=true;this._bUpdateAnalyticalInfo=false;i.prototype._bindAggregation.apply(this,arguments);this._bInitializeBinding=false;var t=this.getBinding("data");if(t){t.attachDataReceived(this._dataReceivedListener,this)}};d.prototype._dataReceivedListener=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}if(t.getParameter("data")===undefined){this._bDataReceiveError=true;this.fireEvent("dataError")}};d.prototype.refreshData=function(t){this._bDataReceiveError=false;this._bReady=false;if(this._bInitializeBinding){var e=this.getBinding("data");if(e&&e.getTotalSize&&e.isRelative()){this._bUpdateAnalyticalInfo=true}}var i={reason:t};if(!this._bInitializeBinding&&this._bUpdateAnalyticalInfo&&t==="refresh"){i.updateAnalyticalInfo=true}this.fireEvent("dataRefresh",i);this._getDataContexts()};d.prototype.updateData=function(t){var e=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var i=e&&this.getBinding("data").getModel()instanceof e;if(!this._bInitializeBinding||!i){this._bDataReceiveError=false;this._bReady=true;this.fireEvent("dataChange",{reason:t});this.invalidate()}};jQuery.each("add get indexOf insert remove removeAll".split(" "),function(t,e){var i="FlattenedDataset manages the 'data' aggregation only via data binding. The method '"+e+"Data' therefore cannot be used programmatically!";d.prototype[e+"Data"]=function(){r.error(i)}});d.prototype.getVIZFlatDataset=function(){return this._getCVOMDataset(o.DATASET_TYPES.FLATTABLEDATASET)};d.prototype.getVIZCrossDataset=function(){return this._getCVOMDataset(o.DATASET_TYPES.CROSSTABLEDATASET)};d.prototype.getVIZDataset=function(){return this._getCVOMDataset(o.DATASET_TYPES.LEGACYCROSSTABLEDATASET)};d.prototype._getCVOMDataset=function(t){var e=this._getDataContexts()&&this._getDataContexts().filter(function(t){return!!t});return this._oCVOMDatasetAdaptor.getDataset({type:t,dataContexts:e,dimensions:this.getDimensions(),measures:this.getMeasures(),additionalInfo:this._info||this._defaultSelectionInfo,contexts:this.getContext(),pagingOption:this._oPagingOption})};d.prototype.invalidate=function(t){if(this._oCVOMDatasetAdaptor){this._oCVOMDatasetAdaptor.invalidate()}i.prototype.invalidate.apply(this,arguments)};d.prototype.setDefaultSelection=function(t){this._defaultSelectionInfo={type:"defaultSelection",value:t}};d.prototype.info=function(t){if(t instanceof Array){this._info=t}};d.prototype.findContext=function(t){if(this._oCVOMDatasetAdaptor){return this._oCVOMDatasetAdaptor.findContext(t)}};d.prototype.setPagingOption=function(t){this._oPagingOption=t};d.prototype.getRenderedPageNo=function(){if(this._oCVOMDatasetAdaptor){return this._oCVOMDatasetAdaptor.getRenderedPageNo()}};d.prototype.setRange=function(t,e){this._iStartIndex=t;this._iLength=e};d.prototype.getRange=function(t,e){return{iStartIndex:this._iStartIndex,iLength:this._iLength}};d.prototype.isReady=function(){if(this._bDataReceiveError){return true}return this._bReady};d.prototype._getDataContexts=function(){var t=this._iStartIndex,e=this._iLength,i=this.getBinding("data"),a=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(!i){return null}var n;if(t==-1){n=this.getBindingInfo("data");t=n&&n.startIndex!==undefined?n.startIndex:0}var s=!this._oPagingOption;if(e==-1){n=n||this.getBindingInfo("data");if(n&&n.length!==undefined){e=n.length;s=false}else{e=i.getTotalSize?i.getTotalSize():i.getLength();var o=sap.ui.require("sap/ui/model/odata/v2/ODataModel");if(s&&e===-1&&o&&i.getModel()instanceof o){e=undefined}}}if(this._bDataReceiveError){return[]}else if(a&&i.getModel()instanceof a){return s?i.getContexts(t,e,Infinity):i.getContexts(t,e)}else{return i.getContexts(t,e)}};return d});
//# sourceMappingURL=FlattenedDataset.js.map