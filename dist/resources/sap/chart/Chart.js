/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/i18n/Formatting","sap/base/i18n/ResourceBundle","sap/chart/library","sap/viz/ui5/controls/VizFrame","sap/viz/ui5/controls/common/BaseControl","sap/viz/ui5/data/Dataset","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/chart/data/Dimension","sap/chart/data/TimeDimension","sap/chart/data/HierarchyDimension","sap/chart/data/Measure","sap/ui/model/analytics/ODataModelAdapter","sap/chart/utils/RoleFitter","sap/chart/utils/ChartUtils","sap/chart/utils/ChartTypeAdapterUtils","sap/chart/utils/DateFormatUtil","sap/chart/utils/DataSourceUtils","sap/chart/utils/SelectionAPIUtils","sap/chart/utils/MeasureSemanticsUtils","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/analytics/odata4analytics","sap/ui/Device","sap/chart/TimeUnitType","sap/chart/coloring/Colorings","sap/chart/ChartLog","sap/chart/pagination/PagingController","sap/ui/core/LocaleData","sap/ui/core/Control","sap/ui/core/BusyIndicatorUtils","sap/ui/core/theming/Parameters","sap/chart/SeriesColorTracker","sap/viz/ui5/format/ChartFormatter","sap/chart/utils/ValueAxisScaleUtils","sap/chart/AutoScaleMode","sap/chart/ScaleBehavior","sap/viz/ui5/utils/CommonUtil","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,i,r,a,s,n,o,l,h,u,c,d,g,p,f,m,y,v,_,S,b,D,C,P,V,z,F,A,x,T,M,k,N,B,O,I,E,U,R,w,j,jQuery){"use strict";var L=i.SelectionBehavior,H=i.SelectionMode;var q=a.extend("sap.chart.Chart",{metadata:{library:"sap.chart",designtime:"sap/chart/designtime/Chart.designtime",properties:{chartType:{type:"string",defaultValue:"bar"},uiConfig:{type:"object",group:"Misc"},visibleDimensions:{type:"string[]",defaultValue:[]},inResultDimensions:{type:"string[]",defaultValue:[]},visibleMeasures:{type:"string[]",defaultValue:[]},vizProperties:{type:"object",group:"Misc"},vizScales:{type:"object[]",group:"Misc"},isAnalytical:{type:"boolean"},selectionBehavior:{type:"sap.chart.SelectionBehavior",defaultValue:L.DataPoint},selectionMode:{type:"sap.chart.SelectionMode",defaultValue:H.Multi},enablePagination:{type:"boolean",defaultValue:false},enableStableColor:{type:"boolean",defaultValue:false},enableScalingFactor:{type:"boolean",defaultValue:false},customMessages:{type:"object",defaultValue:null},colorings:{type:"object",defaultValue:null},activeColoring:{type:"object",defaultValue:null},valueAxisScale:{type:"object",defaultValue:null},hideSharedInformation:{type:"boolean",defaultValue:true}},aggregations:{data:{type:"sap.ui.core.Element",multiple:true,bindable:"bindable"},_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},dimensions:{type:"sap.chart.data.Dimension",multiple:true},measures:{type:"sap.chart.data.Measure",multiple:true}},events:{drilledDown:{parameters:{dimensions:{type:"string[]"}}},drilledUp:{parameters:{dimensions:{type:"string[]"}}},renderComplete:{},selectData:{},deselectData:{},valueAxisFixedScaleTurnedOff:{},drillStackChanged:{}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t).style("width",t.getWidth()).style("height",t.getHeight()).openEnd().renderControl(t.getAggregation("_vizFrame")).close("div")}}});q.getMetadata().getAggregation("data")._doesNotRequireFactory=true;function $(e){return e.indexOf("%")!==-1?"100%":e}q.prototype.setHeight=function(e){this.setProperty("height",e);var t=this._getVizFrame();if(t){t.setHeight($(this.getProperty("height")))}return this};q.prototype.setWidth=function(e){this.setProperty("width",e);var t=this._getVizFrame();if(t){t.setWidth($(this.getProperty("width")))}return this};q.prototype.setChartType=function(e,t){this.setProperty("chartType",e,t);this._sAdapteredChartType=e;this._bIsPagingChartType=f.CONFIG.pagingChartTypes.indexOf(e)>-1;if(this._isEnablePaging()){this._getPagingController().init(false)}else{var i=this._getDataset();if(i){i.setPagingOption(null);i.setRange(-1,-1)}}this._invalidateBy({source:this,keys:{vizFrame:true}});this._bNeedToApplyDefaultProperties=true;return this};q.prototype.setColorings=function(e){this.setProperty("colorings",e);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this};q.prototype.setActiveColoring=function(e){this.setProperty("activeColoring",e);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this};q.prototype.setValueAxisScale=function(e){this._bEnbableValueAxisScale=true;this.setProperty("valueAxisScale",e);if(this._oValueScaleSetting&&this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff){this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff=false;this._oValueScaleSetting.resetValueAxisScale=true}this._invalidateBy({source:this,keys:{vizFrame:true}});return this};q.prototype._setValueAxisScale=function(){var e=this.getValueAxisScale(),t=!this._rendered&&!!e,i=!(this._mNeedToUpdate["binding"]&&this._oValueScaleSetting)&&this._bEnbableValueAxisScale;if(t||i){if(!this._bEnbableValueAxisScale){this._bEnbableValueAxisScale=true}this._oValueScaleSetting=E.getValueAxisScaleSetting(this.getChartType(),e,this.getMeasures(),this.getVisibleMeasures())}};q.prototype._getValueAxisScaleSetting=function(){return this._bEnbableValueAxisScale?this._oValueScaleSetting||{}:{}};q.prototype._validateValueScaleOnDimChange=function(e,t){if(t&&this._oValueScaleSetting){var i=this.getValueAxisScale();if(i&&i.scaleBehavior===R.FixedScale){var r=[];e.forEach(function(e){var i=t.indexOf(e);if(i<0){r.push(e)}else{t.splice(i,1)}});r=r.concat(t);if(r.length>0){var a=false,s=this.getChartType();if(f.isStackedLikeChart(s)){a=true;r.forEach(function(e){if(e._getFixedRole()!=="series"){a=false}})}if(!a){this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff=true;i.scaleBehavior=R.AutoScale;this.setProperty("valueAxisScale",i);this.fireValueAxisFixedScaleTurnedOff();if(this._oValueScaleSetting.resetValueAxisScale){i=this.getValueAxisScale();this.setProperty("valueAxisScale",i)}this._oValueScaleSetting=E.getValueAxisScaleSetting(s,i,this.getMeasures(),this.getVisibleMeasures())}}else{this._oValueScaleSetting=E.getValueAxisScaleSetting(this.getChartType(),i,this.getMeasures(),this.getVisibleMeasures())}}}};q.prototype.removeDimension=function(e){var t=this._getVisibleDimensions()||[];var i;if(this.getIsAnalytical()===false&&e&&e.getName()){i=t.indexOf(e.getName());if(i!==-1){j.error('Data source does not support aggregation. The method "removeDimension" therefore cannot be used!');return}}var r=this.removeAggregation("dimensions",e);if(r){i=t.indexOf(r.getName());if(i!==-1){t.splice(i,1);this.setVisibleDimensions(t)}var a=this.getInResultDimensions()||[];i=a.indexOf(r.getName());if(i!==-1){a.splice(i,1);this.setInResultDimensions(a)}}return r};q.prototype.removeAllDimensions=function(){var e;if(this.getIsAnalytical()===false){j.error('Data source does not support aggregation. The method "removeAllDimensions" therefore cannot be used!')}else{e=this.removeAllAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([])}return e};q.prototype.destroyDimensions=function(){var e;if(this.getIsAnalytical()===false){j.error('Data source does not support aggregation. The method "destroyDimensions" therefore cannot be used!')}else{e=this.destroyAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([])}return e};q.prototype.removeMeasure=function(e){var t=this.removeAggregation("measures",e);if(t){var i=this._getVisibleMeasures()||[],r=i.indexOf(t.getName());if(r!==-1){i.splice(r,1);this.setVisibleMeasures(i)}}return t};q.prototype.removeAllMeasures=function(){var e=this.removeAllAggregation("measures");this.setVisibleMeasures([]);return e};q.prototype.destroyMeasures=function(){var e=this.destroyAggregation("measures");this.setVisibleMeasures([]);return e};q.prototype._getVisibleDimensions=function(e){var t=this._getDrillStateTop();var i=t?t.dimensions:this.getProperty("visibleDimensions");return e?this._normalizeDorM(i,true):i};q.prototype.getVisibleDimensions=function(){var e=this._getVisibleDimensions();return this._aFeeds?e.filter(function(e){return this._aFeeds._unused.indexOf(e)===-1},this):e};q.prototype._getVisibleMeasures=function(e){var t=this._getDrillStateTop();var i=t?t.measures:this.getProperty("visibleMeasures");return e?this._normalizeDorM(i):i};q.prototype.getVisibleMeasures=function(){var e=this._getVisibleMeasures();return this._aFeeds?e.filter(function(e){return this._aFeeds._unused.indexOf(e)===-1},this):e};q.prototype.setVisibleDimensions=function(e,t){var i=this._dimensionSanityCheck({visible:e});this.setProperty("visibleDimensions",e,t);this.setProperty("inResultDimensions",i.inResult,t);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this};q.prototype.setInResultDimensions=function(e,t){var i=this._dimensionSanityCheck({inResult:e});this.setProperty("inResultDimensions",e,t);this.setProperty("visibleDimensions",i.visible,t);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this};q.prototype.setVisibleMeasures=function(e,t){this.setProperty("visibleMeasures",e,t);var i=this._drillStateStack||[];if(!this._bIsInitialized){this._createDrillStack()}else{i.forEach(function(e){e.measures=this.getProperty("visibleMeasures")}.bind(this))}this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this};q.prototype.setEnableStableColor=function(e){e=!!e;if(this.getProperty("enableStableColor")!==e){this.setProperty("enableStableColor",e);this._invalidateBy({source:this,keys:{vizFrame:true}})}return this};q.prototype.setEnablePagination=function(e,t){if(!this._bIsInitialized){this.setProperty("enablePagination",e,t);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}})}return this};q.prototype._dimensionSanityCheck=function(e){var t=e.visible||this.getVisibleDimensions()||[],i=e.inResult||this.getInResultDimensions()||[];var r=[].concat(t).concat(i).reduce(function(e,r){var a=t.indexOf(r)!==-1,s=i.indexOf(r)!==-1;if(a&&s){e.common[r]=true}else if(a){e.visible[r]=true}else if(s){e.inResult[r]=true}return e},{visible:{},inResult:{},common:{}});r.visible=Object.keys(r.visible);r.inResult=Object.keys(r.inResult);r.common=Object.keys(r.common);return r};q.prototype._prepareFeeds=function(){if(!this._aFeeds){var e=this._normalizeDorM(this._getVisibleDimensions(),true),t=this._normalizeDorM(this._getVisibleMeasures(),false),i=this._normalizeDorM(this.getInResultDimensions(),true),r;this._sAdapteredChartType=this.getEnablePagination()?this.getChartType():m.adaptChartType(this.getChartType(),e);var a=this._getVisibleMeasures();r=this._normalizeDorM(this.getMeasures().filter(function(e){return a.indexOf(e.getName())===-1}),false);var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var n=s&&this.getModel()instanceof s;this._aFeeds=p.fit(this._sAdapteredChartType,e,t,i,this._enableSemanticPattern(),r,n);if((!this._aFeeds._valid||this._aFeeds._unused.length)&&this._sAdapteredChartType!==this.getChartType()){this._sAdapteredChartType=this.getChartType();this._aFeeds=p.fit(this._sAdapteredChartType,e,t,i,this._enableSemanticPattern())}if(this._sAdapteredChartType!==this.getChartType()){this._bNeedToApplyDefaultProperties=true}}return this._aFeeds};q.prototype._normalizeDorM=function(e,t){var i=t?this.getDimensions():this.getMeasures(),r=i.reduce(function(e,t){e[t.getName()]=t;return e},{}),a=t?h:d;var s=e.reduce(function(e,t){var i;if(typeof t==="string"){i=t}else if(t instanceof a){i=t.getName()}else{e.errors.push(t)}if(r[i]){e.normalized.push(r[i])}else{e.errors.push(t)}return e},{normalized:[],errors:[]});var n=s.normalized;if(s.errors.length>0){n.errors=s.errors}return n};q.prototype._redundantsFromSelection=function(){var e=this._getVizFrame().vizSelection();if(!e||e.length===0){return{measureNames:{}}}var t=this._getContinuesSemanticTuples();var i=e.reduce(function(e,i){var r=[];for(var a in t){if(t.hasOwnProperty(a)){var s=t[a];if(i.data[a]){r.push(i.data[s.timeAxis]<s.projectedValueStartTime?s.projected:s.actual)}else{r.push(s.actual);r.push(s.projected)}}}jQuery.each(i.data,function(t,i){if(!(r.length>0&&r.indexOf(t)>-1)){if(!e[t]){e[t]=[]}if(e[t].indexOf(i)===-1){e[t].push(i)}}});return e},{});var r=!this.getHideSharedInformation()?{}:this._getVisibleDimensions().reduce(function(e,t){var r=i[t];if(r.length===1){e[t]=r[0]}return e},{});r.measureNames=this._getVisibleMeasures().reduce(function(e,t){if(!i[t]){e[t]=true}return e},{});return r};q.prototype._deriveFilterFromSelection=function(){var e=this._getVisibleDimensions();var t=this;var i=this._getVizFrame().vizSelection();if(this.getSelectionBehavior().toUpperCase()===L.Category){i=i.category}else if(this.getSelectionBehavior().toUpperCase()===L.Series){i=i.series}var r=false;var a=i.map(function(i){var a=e.reduce(function(e,a){var s=t.getDimensionByName(a);var n;n=i.data[a];if(n!=null){if(f.CONFIG.timeChartTypes.indexOf(t._sAdapteredChartType)>-1&&s instanceof u){var o=y.getInstance(s.getTimeUnit());if(o){var l=o.format.bind(o);n=l(new Date(i.data[a]))}}var h=new D({path:a,operator:C.EQ,value1:n});if(s instanceof c){e.hierarchyFilters.push(h);r=true}else{e.filters.push(h)}e.signature.push(a+"="+i.data[a])}return e},{filters:[],hierarchyFilters:[],signature:[]});a.signature=a.signature.join(";");return a});var s=a.reduce(function(e,t){if(!e[t.signature]&&t.filters.length+t.hierarchyFilters.length>0){e[t.signature]={filters:t.filters.length?new D(t.filters,true):null,hierarchyFilters:t.hierarchyFilters.length?new D(t.hierarchyFilters,true):null}}return e},{});var n=Object.keys(s).map(function(e){return{filters:s[e].filters,hierarchyFilters:s[e].hierarchyFilters}});if(n.length>1){if(r){return{hierarchyFilters:new D(n.map(function(e){return e.hierarchyFilters}),false)}}else{return{filters:new D(n.map(function(e){return e.filters}),false)}}}else if(n.length===1){return{filters:n[0].filters,hierarchyFilters:n[0].hierarchyFilters}}else{return{filters:null,hierarchyFilters:null}}};function G(){var e=this.getSelectionBehavior();var t=this._getVisibleDimensions().concat(this.getInResultDimensions()).filter(function(t){var i=this.getDimensionByName(t);if(e.toUpperCase()===L.Category){return i._getFixedRole()==="category"||i._getFixedRole()==="category2"}else if(e.toUpperCase()===L.Series){return i._getFixedRole()==="series"}return true}.bind(this));var i=t.some(function(e){var t=this.getDimensionByName(e);return t instanceof c}.bind(this));var r;if(e.toUpperCase()===L.Category){r=this.getSelectedCategories().categories}else if(e.toUpperCase()===L.Series){r=this.getSelectedSeries().series}else{r=this.getSelectedDataPoints().dataPoints}if(i&&Object.keys(t).length>1&&r.length>1){return false}return true}q.prototype._checkDrilldownValid=function(e){if(this._bEmptyData){j.error("Drill down not possible, because there is already no data available!");return false}var t=this.getInResultDimensions();var i=this._getVisibleDimensions().concat(t).reduce(function(e,t){e[t]=true;return e},{});if(!G.call(this)){j.error("Drill down not possible, because multiple selections on hierarchy/regular mixed dimension is not supported in backend service!");return false}function r(e,i){var r=true;if(i[e.getName()]){if(!(e instanceof c)){j.error("Drill down not possible, because one of the given dimensions is already drilled down!");r=false}else{if(t.indexOf(e.getName())>-1){j.error("Drill down not possible, because one of the given dimensions is inResult!");r=false}}}return r}for(var a=0;a<e.length;++a){if(!r(e[a],i)){return false}}var s=e.reduce(function(e,t){e[t.getName()]=t;return e},{});var n=this;function o(e){if(Array.isArray(e.aFilters)){return e.aFilters.some(o)}else{return!r(n.getDimensionByName(e.sPath),s)}}var l=this._getDrillStateTop();if(l&&l.filter&&o(l.filter)){return false}return true};q.prototype._createDrillStack=function(){this._drillStateStack=W.call(this);var e=this.getProperty("visibleDimensions")||[];this._aUnavailableDims=e.filter(function(e){return!this.getDimensionByName(e)}.bind(this));if(this._aUnavailableDims.length){this._invalidateBy({source:this,keys:{drillStack:true}})}else{this.fireDrillStackChanged(this.getDrillStack())}};q.prototype._updateDrillStack=function(){var e=this._aUnavailableDims.some(function(e){return this.getDimensionByName(e)instanceof c}.bind(this));if(e){this._drillStateStack=W.call(this)}this._aUnavailableDims=[];this.fireDrillStackChanged(this.getDrillStack())};function W(){var e=this.getProperty("visibleDimensions")||[],t=this.getProperty("visibleMeasures")||[],i=[{dimensions:[],measures:t,filter:undefined,nonHierarchyFilters:undefined,hierarchyFilters:undefined,hierarchylevel:{}}],r=[];var a={};for(var s=0;s<e.length;s++){var n=e[s];r.push(n);var o=this.getDimensionByName(n);if(o&&o instanceof c){a[n]=o.getLevel()}i.push({dimensions:r.slice(),measures:t,filter:undefined,nonHierarchyFilters:undefined,hierarchyFilters:undefined,hierarchylevel:jQuery.extend(true,{},a)})}return i}q.prototype._invalidateBy=function(e){var t=e.source;var i=this._oCandidateColoringSetting?this._oCandidateColoringSetting.additionalDimensions||[]:[];if(t===this){jQuery.each(e.keys||{},function(e,t){this._markForUpdate(e,t)}.bind(this))}else if(t instanceof d&&this._getVisibleMeasures().indexOf(t.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(e.property==="unitBinding"||this.getColorings()&&(e.property==="semantics"||e.property==="semanticallyRelatedMeasures")){this._markForUpdate("binding",true)}}else if(t instanceof h&&this._getVisibleDimensions().concat(i).indexOf(t.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(t.getDisplayText()&&(e.property==="textProperty"||e.property==="displayText")){this._markForUpdate("binding",true)}else if(e.property==="level"&&this.getProperty("visibleDimensions").indexOf(t.getName())>-1){this._createDrillStack();this._markForUpdate("binding",true)}}else if(t instanceof h&&this.getProperty("inResultDimensions").indexOf(t.getName())>-1){if(e.property==="level"){this._markForUpdate("dataSet",true);this._markForUpdate("binding",true);this._markForUpdate("vizFrame",true)}}this.invalidate(e)};q.prototype._handleNonAnalyticalFeeding=function(){var e=this;var t=this.getInResultDimensions();var i=this._getVisibleDimensions(),r=this.getDimensions().map(function(e){return e.getName()});var a=[];r.forEach(function(t){if(e.getDimensionByName(t)){var i=e.getDimensionByName(t).getTextProperty();if(i){a.push(i)}}});var s=i.concat(r.filter(function(e){return i.indexOf(e)<0})).filter(function(e){return a.indexOf(e)<0&&t.indexOf(e)<0});this.setProperty("visibleDimensions",s);this._createDrillStack()};q.prototype._markForUpdate=function(e,t){if(!this._mNeedToUpdate){this._mNeedToUpdate={}}this._mNeedToUpdate[e]=t;var i=this._updaters.onInvalidate[e];if(i){i.call(this)}};q.prototype._updaters=function(){return{onInvalidate:{vizFrame:function(){this._aFeeds=null;this._bColoringParsed=null},checkBinding:function(){this._bColoringParsed=null},binding:function(){this._bColoringParsed=null},loopData:function(){this._bColoringParsed=null}},checkBinding:function(){var e=this._getCandidateColoringSetting();var t=e.additionalDimensions;var i=e.additionalMeasures;if(t&&t.length||i&&i.length){this._mNeedToUpdate["binding"]=true}},drillStack:function(){this._updateDrillStack()},dataSet:function(){this._getDataset().invalidate()},binding:function(){var e=this._getDataset().getBinding("data"),t=this.getInResultDimensions();if(!e){return}var i=this._getVisibleDimensions(true).concat(this._normalizeDorM(t,true));var r=this._getVisibleMeasures(true);this._oMeasureRangePromise=v.updateModel(this.getIsAnalytical())(this,i,r);var a=this._getDrillStateTop();if(i.length>0||r.length>0){this._getVizFrame()._readyToRender(false);this.setBusy(true)}this._bFilterCalledByChart=true;e.filter(a&&a.filter?a.filter:undefined,P.Control);var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(s&&this.getModel()instanceof s){if(e._bSuspendCalledByChart){e._bSuspendCalledByChart=false;e.getRootBinding().resume()}}if(this._bEnbableValueAxisScale){this._validateValueScaleOnDimChange(i,this._aDimensions)}this._aDimensions=i},vizFrame:function(){var e=this,t=this._getDataset(),i=this._getVizFrame();var r=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(this._mNeedToUpdate["binding"]){var a=this._getDataset().getBinding("data");if(r&&this.getModel()instanceof r){var s=a.getRootBinding();if(s&&!s.isSuspended()){s.suspend();a._bSuspendCalledByChart=true}}if(this._isEnablePaging()){this._getPagingController().reset();this._oColoringStatus={}}else{this._getDataset().setPagingOption(null)}}else{this._markForUpdate("loopData",true)}if(this.getEnableStableColor()){this._oColorTracker.add(i._runtimeScales());i._runtimeScales(this._oColorTracker.get(),true)}else{this._resetRuntimeScale()}var n=this._isEnablePaging()?this._getPagingController().getMeasureRange():{};t.removeAllAggregation("dimensions",true);t.removeAllAggregation("measures",true);i.removeAllAggregation("feeds",true);if(this.getIsAnalytical()===false){this._handleNonAnalyticalFeeding()}var h={};try{h=this._prepareFeeds();h._def.dim.forEach(function(e){t.addAggregation("dimensions",e,true)},this);h._def.msr.forEach(function(i){if(i){var r=n[i.getIdentity()];if(r){i.setRange([r.min,r.max])}if(!e.getDimensionByName(i.getUnit())){i.setUnit(null)}t.addAggregation("measures",i,true)}},this);h.forEach(function(e){i.addFeed(e)})}catch(e){}this._semanticTuples=h._semanticTuples;var u=this._getCandidateColoringSetting();var c=h._context||[];var d=u.additionalMeasures||[];var g=u.additionalDimensions||[];var p=r&&this.getModel()instanceof r;d.forEach(function(e){c.push({id:e,showInTooltip:false});var i=new l({name:e,identity:e,value:"{"+e+"}"});if(p){i.setBindingContext(null)}t.addMeasure(i)});g.forEach(function(e){c.push({id:e,showInTooltip:false});var i=new o({name:e,identity:e,value:"{"+e+"}"});if(p){i.setBindingContext(null)}t.addDimension(i)});t.setContext(c);i.invalidate();t.invalidate();i.setVizType(this._reset100DonutChartType(this._sAdapteredChartType));i._setCustomMessages(this.getCustomMessages());this._setValueAxisScale();if(!this._mNeedToUpdate["loopData"]){this._setEffectiveScales();i.setVizProperties(this._getEffectiveProperties())}},loopData:function(){var e=this._getVizFrame();try{this._prepareData()}catch(e){if(e instanceof x){e.display()}else{throw e}}var t=this._getEffectiveProperties();this._usingDisplayNameForSemantics(t);e.setVizProperties(t);this._setEffectiveScales()}}}();q.prototype._getDrillStateTop=function(){return this._drillStateStack?this._drillStateStack[this._drillStateStack.length-1]:null};q.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame")};q.prototype._getDataset=function(){var e=this._getVizFrame();return e?e.getDataset():null};q.prototype._prepareData=function(){var e=this._getContexts();if(e){this._bEmptyData=e.length?false:true;var t=this._getCandidateColoringSetting().contextHandler;var i=[];if(t){i.push(t);try{this._loopContext(i)}catch(e){if(e instanceof x){e.display();this._oCandidateColoringSetting={}}else{throw e}}}this._oSemanticVizSettings=S.getSemanticVizSettings(this._sAdapteredChartType,this._semanticTuples,this._oCandidateColoringSetting,this._enableSemanticPattern(),this._bDataPointStyleSetByUser,this._bLegendSetByUser)}};q.prototype._getContexts=function(){return this._getDataset()._getDataContexts()};q.prototype._loopContext=function(e){var t=this._getContexts();if(t.length>0&&!t.dataRequested){var i=this;t.forEach(function(t){e.forEach(function(e){e.call(i,t)})})}};q.prototype._filterHandler=function(){if(!this._bFilterCalledByChart){this._bFilterCalledByCustomer=true;this._bColoringParsed=false}this._bFilterCalledByChart=false};q.prototype._dataRefreshListener=function(e){if(e.getParameters().reason==="filter"){this._filterHandler()}if(this.getIsAnalytical()&&e.getParameters().updateAnalyticalInfo){v.updateModel(true)(this)}};q.prototype._bindingChangeListener=function(e){var t=this._getVizFrame();if(e.getParameters().reason==="filter"){this._filterHandler()}if(this.getEnableStableColor()){this._oColorTracker.add(t._runtimeScales());t._runtimeScales(this._oColorTracker.get(),true)}t.invalidate();this.setBusy(false);if(this._isEnablePaging()){this._getPagingController().bindingChanged()}else{t._readyToRender(true)}try{this._prepareData()}catch(e){if(e instanceof x){e.display()}}var i=this._getEffectiveProperties();this._usingDisplayNameForSemantics(i);t.setVizProperties(i);this._setEffectiveScales();this._bFilterCalledByChart=false;this._bFilterCalledByCustomer=false};q.prototype._resetRuntimeScale=function(){this._oColorTracker.clear();this._getVizFrame()._runtimeScales(this._oColorTracker.get(),true)};q.prototype._hasUserSemanticProps=function(){var e=this.getProperty("vizProperties");if(e&&e.plotArea){if(e.plotArea.dataPointStyle||e.plotArea.seriesStyle){return true}}return false};q.prototype._enableSemanticColoring=function(){var e=true;if(this._sAdapteredChartType==="heatmap"){var t=this.getProperty("vizScales")||[];var i=t.filter(function(e){return e.feed==="color"})[0];if(i){e=false}}else{if(this._hasUserSemanticProps()){e=false}}return e};q.prototype._enableSemanticPattern=function(){return!this._hasUserSemanticProps()&&f.CONFIG.nonSemanticPatternChartType.indexOf(this._sAdapteredChartType)===-1};q.prototype._hasSemanticPattern=function(){return this._enableSemanticPattern()&&S.hasSemanticRelation(this._semanticTuples)};q.prototype._getContinuesSemanticTuples=function(){var e={};if(this._hasSemanticPattern()){e=this._semanticTuples.reduce(function(e,t){if(t.semanticMsrName){e[t.semanticMsrName]=t}return e},{})}return e};q.prototype._getContinuesSemanticMap=function(){var e=[];if(this._hasSemanticPattern()){e=this._semanticTuples.filter(function(e){return e.projectedValueStartTime})}return e};q.prototype._getInternalVisibleMeasures=function(){var e=this._getVisibleMeasures();if(this._hasSemanticPattern()){e=e.concat(this._getContinuesSemanticMap().map(function(e){return e.semanticMsrName}))}return e};q.prototype._buildSelectedDataPoints=function(e,t){var i=this._getInternalVisibleMeasures(),r=this._getVisibleDimensions().concat(this.getInResultDimensions()),a=this._getEffectiveContinuesDataPoints(t);return _.buildSelectionVizCtx(i,r,e,a)};q.prototype._getEffectiveContinuesSeries=function(e){var t=e.slice(),i=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var r=t.map(function(e){return e.measures});i.forEach(function(e){if(r.indexOf(e.actual)>-1||r.indexOf(e.projected)>-1){t=t.filter(function(t){return t.measures!==e.actual&&t.measures!==e.projected});if(r.indexOf(e.actual)>-1&&r.indexOf(e.projected)>-1){t.push({measures:e.semanticMsrName})}}})}return t};q.prototype._getEffectiveContinuesDataPoints=function(e){var t=e.slice(),i=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var r,a,s,n;for(var o=0;o<t.length;o++){s=t[o].measures;for(var l=0;l<i.length;l++){n=i[l];r=s.indexOf(n.actual);if(r>-1){s.splice(r,1)}a=s.indexOf(n.projected);if(a>-1){s.splice(a,1)}if(r>-1||a>-1){s.push(n.semanticMsrName)}}}}return t};q.prototype._buildSelectEventData=function(e){if(e&&e.length>0&&this._hasSemanticPattern()){var t,i;var r=this._getContinuesSemanticMap();for(var a=0;a<e.length;a++){t=jQuery.extend(true,{},e[a].data);for(var s=0;s<r.length;s++){i=r[s];if(t.measureNames===i.semanticMsrName){if(t[i.timeAxis]<i.projectedValueStartTime){t.measureNames=i.actual;delete t[i.projected];delete t[i.semanticMsrName]}else{t.measureNames=i.projected;delete t[i.actual];delete t[i.semanticMsrName]}}else{if(t[i.actual]&&t.measureNames!==i.actual){delete t[i.actual]}if(t[i.projected]&&t.measureNames!==i.projected){delete t[i.projected]}}}e[a].data=t}}};q.prototype.addData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "addData" therefore cannot be used programmatically!')};q.prototype.destroyData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "destroyData" therefore cannot be used programmatically!')};q.prototype.getData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "getData" therefore cannot be used programmatically!')};q.prototype.indexOfData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "indexOfData" therefore cannot be used programmatically!')};q.prototype.insertData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "insertData" therefore cannot be used programmatically!')};q.prototype.removeData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "removeData" therefore cannot be used programmatically!')};q.prototype.removeAllData=function(){j.error('Chart manages the "data" aggregation only via data binding. The method "removeAllData" therefore cannot be used programmatically!')};q.prototype._createOData4SAPAnalyticsModel=function(e){var t=null;try{t=new V.Model(new V.Model.ReferenceByModel(e))}catch(e){return undefined}return t};q.prototype.getIsAnalytical=function(){return this.getProperty("isAnalytical")};q.prototype.setIsAnalytical=function(e,t){if(this._bIsInitialized){j.error('The proeprty isAnalytical will programmatically set according to data source. The method "setIsAnalytical" therefore cannot be used!')}else{this.setProperty("isAnalytical",e,t)}return this};q.prototype._setIsAnalyticalProperty=function(e,t){var i=e.findQueryResultByName(v.getEntitySet(this.getIsAnalytical())(t))!==undefined;if(this.getIsAnalytical()!==i){this.setProperty("isAnalytical",i)}};q.prototype.bindAggregation=function(e,t){if(e==="data"){this._oBindingInfo=jQuery.extend(true,{},t);var i=this.getModel(t.model);var r;if(i){var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var n=sap.ui.require("sap/ui/model/json/JSONModel");if(n&&i instanceof n){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false)}}else if(s&&i instanceof s){this.setProperty("isAnalytical",true);if(t){t.parameters=jQuery.extend(true,{$count:t.length!=undefined||this._isEnablePaging()},t.parameters)}}else{r=this._createOData4SAPAnalyticsModel(i);this._setIsAnalyticalProperty(r,t);if(this.getIsAnalytical()){var o=sap.ui.require("sap/ui/model/odata/v2/ODataModel");if(t){var l=true;if(t.length!=undefined||this._isEnablePaging()||o&&i instanceof o){l=false}t.parameters=jQuery.extend(true,{analyticalInfo:[],useBatchRequests:true,provideGrandTotals:false,reloadSingleUnitMeasures:true,noPaging:l},t.parameters)}g.apply(i);if(r){i.setAnalyticalExtensions(r)}}}}}return a.prototype.bindAggregation.apply(this,arguments)};q.prototype._bindAggregation=function(e,t){if(e==="data"){var i=this.getModel(t.model);var r;if(i){var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");var n=sap.ui.require("sap/ui/model/json/JSONModel");if(n&&i instanceof n){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false)}this._deriveColumns(i,t)}else if(s&&i instanceof s){this.setProperty("isAnalytical",true);if(t){t.parameters=jQuery.extend(true,{$count:t.length!=undefined||this._isEnablePaging()},t.parameters)}}else{r=this._createOData4SAPAnalyticsModel(i);this._setIsAnalyticalProperty(r,t);if(this.getIsAnalytical()){var o=sap.ui.require("sap/ui/model/odata/v2/ODataModel");if(t){var l=true;if(t.length!=undefined||this._isEnablePaging()||o&&i instanceof o){l=false}t.parameters=jQuery.extend(true,{analyticalInfo:[],useBatchRequests:true,provideGrandTotals:false,reloadSingleUnitMeasures:true,noPaging:l},t.parameters)}g.apply(i);if(r){i.setAnalyticalExtensions(r)}}this._deriveColumns(i,t)}}var h=this._getDataset();h.bindAggregation("data",t);var u=h.getBinding("data");if(u&&i){var s=sap.ui.require("sap/ui/model/odata/v4/ODataModel");if(s&&i instanceof s){u._bSuspendCalledByChart=false}}this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}})}else{a.prototype._bindAggregation.apply(this,arguments)}};q.prototype._dataErrorListener=function(e){var t=this._getVizFrame();if(t){t._readyToRender(true);t.invalidate();this.setBusy(false)}};q.prototype.unbindAggregation=function(e,t){var i=false;if(e==="data"){var r=this._getDataset();if(r){var s=r.getBinding("data");if(s){delete s._bSuspendCalledByChart}r.unbindAggregation.apply(r,arguments)}t=true;i=!this.bHasAnalyticalInfo&&this.aContexts===undefined&&this._getDataset&&this._getDataset()===null&&this.mBindingInfos&&this.mBindingInfos[e]&&this.mBindingInfos[e].binding&&this.mBindingInfos[e].binding.bIsBeingDestroyed}if(!i){return a.prototype.unbindAggregation.apply(this,[e,t])}};q.prototype.unbindData=function(){if(!this.getIsAnalytical()){this.removeAllAggregation("dimensions");this.removeAllAggregation("measures");this.setProperty("visibleDimensions",[]);this.setProperty("inResultDimensions",[]);this.setProperty("visibleMeasures",[]);this._createDrillStack()}this.unbindAggregation("data")};q.prototype._deriveColumns=function(e,t){var i=this.getAggregation("dimensions");var r=this.getAggregation("measures");if((i===null||i.length===0)&&(r===null||r.length===0)){var a=v.deriveColumns(this.getIsAnalytical())(e,t);a.dimensions.forEach(this.addDimension.bind(this));a.measures.forEach(this.addMeasure.bind(this))}};q.prototype.onBeforeRendering=function(){this._bIsInitialized=true;a.prototype.onBeforeRendering.apply(this,arguments);var e=["onInvalidate","drillStack","dataSet","vizFrame","checkBinding","binding","loopData"];e.forEach(function(e){if(this._mNeedToUpdate[e]){this._updaters[e].call(this)}}.bind(this));jQuery.each(this._mNeedToUpdate,function(e){this._mNeedToUpdate[e]=false}.bind(this))};q.prototype.onAfterRendering=function(){this._showLoading(this._bLoading);this._rendered=true};q.prototype.onlocalizationChanged=function(){this._invalidateBy({source:this,keys:{vizFrame:true}})};q.prototype.exit=function(){this._getDataset().unbindAggregation("data",true);this._oColorTracker.clear();a.prototype.exit.apply(this,arguments);var e=this._getVizFrame();if(this._delegateEventHandlers){this._delegateEventHandlers.forEach(function(t){e["detach"+t.name](t.handler,this);delete t.handler},this);delete this._delegateEventHandlers}e.detachRenderComplete(this._vizFrameRenderCompleteHandler,this);e.detachEvent("_zoomDetected",K.bind(this),this);e.detachEvent("_selectionDetails",X.bind(this),this)};q.prototype.applySettings=function(){this._mNeedToUpdate={};k.prototype.applySettings.apply(this,arguments);var e=new n;e.attachEvent("dataChange",{},this._bindingChangeListener,this);e.attachEvent("dataRefresh",{},this._dataRefreshListener,this);e.attachEvent("dataError",{},this._dataErrorListener,this);var t=jQuery.extend(true,{},{applicationSet:"fiori"},this.getUiConfig());this.setUiConfig(t);this._bNeedToApplyDefaultProperties=true;this._oSemanticVizSettings={};var i=new r({width:$(this.getWidth()),height:$(this.getHeight()),vizType:this.getChartType(),uiConfig:this.getUiConfig(),vizProperties:jQuery.extend(true,{title:{visible:false}},this._getEffectiveProperties())});i.setDataset(e);i.attachRenderComplete(null,this._updateLoadingIndicator.bind(this));i.attachEvent("_zoomDetected",K.bind(this));i.attachEvent("renderFail",null,function(e){var t=this._getPagingController();if(t._sLoadingTimer){clearTimeout(t._sLoadingTimer);t._sLoadingTimer=null}this._showLoading(false)},this);this._rendered=false;i._readyToRender(false);this.setAggregation("_vizFrame",i);this._delegateEvents();this._sAdapteredChartType=this.getChartType();this._oCandidateColoringSetting={};this._oColoringStatus={};this._oColorTracker=new O;if(this._isEnablePaging()){this._getPagingController()}};q.prototype.setCustomMessages=function(e){this.setProperty("customMessages",e);var t=this._getVizFrame();if(t){t._setCustomMessages(e)}return this};q.prototype.getZoomInfo=function(){return this._getZoomInfo()};q.prototype._getZoomInfo=function(){var e=this._getVizFrame();if(e){return e._getZoomInfo()}};q.prototype.resetLayout=function(){this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,vizFrame:true,dataSet:true}});return this};q.prototype.setSelectedDataPoints=function(e){if(this.getSelectionMode()!==H.None){var t=this.getBinding("data"),i=this._getVizFrame();if(!t||!i||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this}i.vizSelection([],{clearSelection:true});i.vizSelection(this._buildSelectedDataPoints(t,e),{selectionMode:this.getSelectionMode()})}return this};q.prototype.addSelectedDataPoints=function(e){if(this.getSelectionMode()!==H.None){var t=this.getBinding("data"),i=this._getVizFrame();if(!t||!i||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this}i.vizSelection(this._buildSelectedDataPoints(t,e),{selectionMode:H.Multi})}return this};q.prototype.getSelectedDataPoints=function(){var e=this._getVizFrame();if(!e||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return{count:0,dataPoints:[]}}var t=this._getContinuesSemanticTuples();var i=this._getVisibleMeasures(),r=this._getDataset(),a=e.vizSelection()||[],s={};for(var n=0,o=a.length;n<o;n++){var l=a[n],h=l.data._context_row_number;if(!s[h]){s[h]={index:h,measures:[],context:r.findContext({_context_row_number:h})}}l.measures=_.filterVisibleMsr(l.data,i);if(!jQuery.isEmptyObject(t)){_.filterSemMsr(t,i,l)}s[h].measures=s[h].measures.concat(l.measures);if(l.unit){s[h].unit=jQuery.extend(true,s[h].unit,l.unit)}if(l.dataName){s[h].dataName=jQuery.extend(true,s[h].dataName,l.dataName)}}return{count:a.length,dataPoints:Object.keys(s).map(function(e){return s[e]})}};q.prototype.removeSelectedDataPoints=function(e){if(this.getSelectionMode()!==H.None){var t=this.getBinding("data"),i=this._getVizFrame();if(!i||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this}var r=this._buildSelectedDataPoints(t,e);i.vizSelection(r,{deselection:true})}return this};q.prototype.setSelectedCategories=function(e){if(this.getSelectionMode()!==H.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!=="CATEGORY"){return this}t.vizSelection([],{clearSelection:true});t.vizSelection(e.map(_.toVizCSCtx),{selectionMode:this.getSelectionMode()})}return this};q.prototype.addSelectedCategories=function(e){if(this.getSelectionMode()!==H.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==L.Category){return this}t.vizSelection(e.map(_.toVizCSCtx),{selectionMode:H.Multi})}return this};q.prototype.removeSelectedCategories=function(e){if(this.getSelectionMode()!==H.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==L.Category){return this}t.vizSelection(e.map(_.toVizCSCtx),{deselection:true})}return this};q.prototype.getSelectedCategories=function(){var e=this._getVizFrame(),t=this.getSelectionBehavior().toUpperCase();if(!e||t!==L.Category){return{count:0,categories:[]}}else{var i=e.vizSelection()||[];return{count:i.length,categories:(i.category||[]).map(_.fromVizCSCtx)}}};q.prototype.setSelectedSeries=function(e){if(this.getSelectionMode()!==H.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==L.Series){return this}t.vizSelection([],{clearSelection:true});var r=this._getEffectiveContinuesSeries(e);t.vizSelection(r.map(_.toVizCSCtx),{selectionMode:this.getSelectionMode()})}return this};q.prototype.addSelectedSeries=function(e){if(this.getSelectionMode()!==H.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==L.Series){return this}var r=this._getEffectiveContinuesSeries(e);t.vizSelection(r.map(_.toVizCSCtx),{selectionMode:H.Multi})}return this};q.prototype.removeSelectedSeries=function(e){if(this.getSelectionMode()!==H.None){var t=this._getVizFrame(),i=this.getSelectionBehavior().toUpperCase();if(!t||i!==L.Series){return this}var r=this._getEffectiveContinuesSeries(e);t.vizSelection(r.map(_.toVizCSCtx),{deselection:true})}return this};q.prototype.getSelectedSeries=function(){var e=this._getVizFrame(),t=this.getSelectionBehavior().toUpperCase();if(!e||t!==L.Series){return{count:0,series:[]}}else{var i=e.vizSelection()||[],r=(i.series||[]).map(_.fromVizCSCtx),a=[],s=this._getContinuesSemanticTuples();r=r.filter(function(e){var t=true;if(e&&e.measures){var i=s[e.measures];if(i&&i.semanticMsrName===e.measures){a.push({measures:i.actual});a.push({measures:i.projected});t=false}}return t});r=r.concat(a);return{count:i.length,series:r}}};function Z(e){var t=e.filter(function(e){return e});if(t.length===0){return null}else if(t.length===1){return t[0]}else{return new D(t,true)}}q.prototype.drillDown=function(e){if(this.getIsAnalytical()===false){j.error('Data source does not support drillDown/drillUp. The method "drillDown" therefore cannot be used!');return}if(e&&!(e instanceof Array)){e=[e]}var t=this._normalizeDorM(e,true);if(t.length===0){return}if(!this._checkDrilldownValid(t)){return}var i=this._getDrillStateTop(),r=this._redundantsFromSelection(),a=this._deriveFilterFromSelection();var s,n,o;if(a){s=Z([a.filters,i.nonHierarchyFilters]);n=a.hierarchyFilters||i.hierarchyFilters;o=Z([s,n])||undefined}var l=jQuery.extend(true,{},i.hierarchylevel);t.forEach(function(e){if(e instanceof c){if(l[e.getName()]==null){l[e.getName()]=e.getLevel()}else{l[e.getName()]+=1}}});var h=i.dimensions.slice().filter(function(e){return!r[e]});h=h.concat(t.filter(function(e){return h.indexOf(e.getName())===-1}).map(function(e){return e.getName()}));this._drillStateStack.push({dimensions:h,measures:i.measures.filter(function(e){return!r.measureNames[e]}),filter:o,hierarchylevel:l,nonHierarchyFilters:s,hierarchyFilters:n,redundant:r});if(this._aUnavailableDims.length===0){this.fireDrillStackChanged(this.getDrillStack())}var u=t.map(function(e){return e.getName()});this.fireDrilledDown({dimensions:u});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}})};q.prototype.drillUp=function(e){if(this.getIsAnalytical()===false){j.error('Data source does not support drillDown/drillUp. The method "drillUp" therefore cannot be used!');return}if(arguments.length===0){e=this._drillStateStack.length-2}var t=this._drillStateStack[e];if(t&&e!=this._drillStateStack.length-1){var i=this._drillStateStack.pop();this._drillStateStack.splice(e+1);if(this._aUnavailableDims.length===0){this.fireDrillStackChanged(this.getDrillStack())}this.fireDrilledUp({dimensions:i.dimensions.filter(function(e){return t.dimensions.indexOf(e)===-1})});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}})}};q.prototype.getDrillStack=function(){if(this.getIsAnalytical()===false){j.error('Data source does not support drillDown/drillUp. The method "getDrillStack" therefore cannot be used!');return}return jQuery.map(this._drillStateStack||[],function(e,t){return{dimension:e.dimensions.slice(),measure:e.measures.slice(),filter:e.filter,hierarchylevel:jQuery.extend(true,{},e.hierarchylevel)}})};q.prototype.setUiConfig=function(e){this.setProperty("uiConfig",e);if(this._getVizFrame()){this._getVizFrame().setUiConfig(e)}return this};var J=function(){var e=["interaction.selectability.mode","interaction.selectability.behavior"];function t(e,t){var i=e,r;r=t.reduce(function(e,t){if(i.hasOwnProperty(t)){e.push({parent:i,val:i[t],key:t});i=i[t]}return e},[]);if(r.length!==t.length){return}var a=r.pop();delete a.parent[a.key];while(r.length>0){a=r.pop();if(Object.keys(a.val).length>0){return}else{delete a.parent[a.key]}}}function i(i,r){var a=jQuery.extend(true,{},i);e.forEach(function(e){delete a[e];t(a,e.split("."))});return a}return{sanitize:i,modify:function(e,t,i){var r=t.split("."),a=e;while(r.length>1&&a.hasOwnProperty(r[0])){a=a[r.shift()]}var s=r[0];if(r.length===1&&a.hasOwnProperty(s)){a[s]=i(a[s])}}}}();q.prototype.setVizProperties=function(e){e=J.sanitize(e);var t=function(e,i){for(var r in i){var a=i[r];if(a!==undefined){if(!jQuery.isPlainObject(a)){e[r]=a}else{var s=e[r];if(!s||!jQuery.isPlainObject(s)){s=e[r]={}}t(s,a)}}}};var i=function(i,r){i=i||{};t(i,e);return i};e=i(jQuery.extend(true,{title:{visible:false}},this.getProperty("vizProperties")),e);this.setProperty("vizProperties",e);if(e.plotArea&&e.plotArea.dataPointStyle){this._bDataPointStyleSetByUser=true;this._invalidateBy({source:this,keys:{vizFrame:true,loopData:true}})}if(e.legend&&e.legend.title){this._bLegendSetByUser=true}if(this._getVizFrame()){this._getVizFrame().setVizProperties(this._getEffectiveProperties())}return this};q.prototype.getVizProperties=function(){var e=this._getVizFrame();var t=J.sanitize(e?e.getVizProperties():this.getProperty("vizProperties"));function i(e){var t=sap.viz.api.env.Format.numericFormatter();if(!t||typeof t.stripUnit!=="function"){return e}if(typeof e==="string"||e instanceof String){return t.stripUnit(e)}else if(e&&typeof e==="object"){jQuery.each(e,function(i,r){e[i]=t.stripUnit(r)});return e}else{return e}}J.modify(t,"plotArea.dataLabel.formatString",i);J.modify(t,"tooltip.formatString",i);return t};q.prototype.setVizScales=function(e){this.setProperty("vizScales",e);this._aVizValueScales=e.filter(function(e){return e.feed==="valueAxis"||e.feed==="valueAxis2"||e.feed==="actualValues"});if(this._aVizValueScales&&this._aVizValueScales.length>0){this._bEnbableValueAxisScale=false}if(this._getVizFrame()){this._getVizFrame().setVizScales(e)}return this};q.prototype.getVizScales=function(){var e=this._getVizFrame();return e?e.getVizScales():this.getProperty("vizScales")};q.prototype.getVizUid=function(){return this._getVizFrame().getVizUid()};q.prototype.zoom=function(e){this._getVizFrame().zoom(e)};var Y=["selectData","deselectData"];q.prototype._delegateEvents=function(){if(this._delegateEventHandlers){return}var e=this._getVizFrame();this._delegateEventHandlers=Y.map(function(t){var i=t.charAt(0).toUpperCase()+t.slice(1);var r=function(e){var i=e.getParameters();this._buildSelectEventData(i.data);delete i.id;this.fireEvent(t,i)};r=r.bind(this);e["attach"+i](null,r);return{name:i,handler:r}},this);this._vizFrameRenderCompleteHandler=Q.bind(this);e.attachRenderComplete(null,this._vizFrameRenderCompleteHandler);e.attachEvent("_selectionDetails",X.bind(this))};q.getChartTypes=i.api.getChartTypes;q.prototype.getAvailableChartTypes=function(){var e=this._getVisibleDimensions(true),t=this._getVisibleMeasures(true);return f.CONFIG.chartTypes.reduce(function(i,r){var a=p.compatible(r,e,t);if(a.compatible){i.available.push({chart:r})}else{var s={};if(a.error.missing.dim){s.Dimension=a.error.missing.dim}if(a.error.missing.time){s.DateTimeDimension=a.error.missing.time}if(a.error.missing.msr){s.Measure=a.error.missing.msr}i.unavailable.push({chart:r,error:s})}return i},{available:[],unavailable:[]})};q.prototype._getDynamicScaleProp=function(){return{general:{enableScalingFactor:this.getEnableScalingFactor()}}};q.prototype._getEffectiveProperties=function(){var e={};if(this._bNeedToApplyDefaultProperties){e=jQuery.extend(true,e,this._getDefaultVizProperties());this._bNeedToApplyDefaultProperties=false}var t=this.getChartType();e=jQuery.extend(true,e,this._get100DonutProperty(t),this._oSemanticVizSettings.properties||{},this.getProperty("vizProperties"),this._getHostedVizProperties(),this._getPagingVizProperties(),this._getTimeProperties(),this._getValueAxisScaleSetting().property||{},this._getDynamicScaleProp(),S.getSemanticSettingsForCombination(this._semanticTuples,t));return e};q.prototype._get100DonutProperty=function(e){return{tooltip:{bodyMeasureValue:{type:e.indexOf("100_")===0?"percentage":"value"}}}};q.prototype._reset100DonutChartType=function(e){return e.indexOf("donut")>-1?"donut":e};q.prototype._setEffectiveScales=function(){var e=this._getVizFrame(),t=this.getProperty("vizScales"),i=this._getValueAxisScaleSetting(),r=(t||[]).filter(function(e){return e.feed==="color"});var a=w.extendScales(t,i.scale||[],this._oSemanticVizSettings.scales||[]);if(this._oSemanticVizSettings.replaceColorScales&&r.length===0){e.setVizScales(a,{replace:true})}else{e.setVizScales(a)}};q.prototype._usingDisplayNameForSemantics=function(e){var t=function(e){if(typeof e==="undefined"||e===null){return false}return true};if(e.plotArea&&e.plotArea.dataPointStyle&&e.plotArea.dataPointStyle.rules){var i=this._getContexts();if(i.length>0&&!i.hasOwnProperty("dataRequested")){var r=this.getVisibleDimensions(),a=e.plotArea.dataPointStyle.rules;for(var s=0;s<a.length;s++){var n=a[s].dataContext;if(n&&n.length!==0){var o=Object.keys(n);if(!t(a[s].displayName)&&o.length===1){var l=o[0];if(n[l].hasOwnProperty("equal")&&r.indexOf(l)!==-1){var h=this.getDimensionByName(l).getTextProperty();for(var u=0;u<i.length;u++){if(i[u].getProperty(l)===n[l].equal){var c=i[u].getProperty(h);if(!t(h)||!t(c)||typeof c==="object"||this.getDimensionByName(l).getDisplayText()===false){a[s].displayName=n[l].equal;break}else{a[s].displayName=c;break}}}}}}}}}};q.prototype._getCandidateColoringSetting=function(){if(!this._bColoringParsed&&this._semanticTuples){if(this._enableSemanticColoring()){this._bColoringParsed=true;this._oCandidateColoringSetting={};var e={},i=this.getColorings(),r=this.getActiveColoring();e.aMsr=this._normalizeDorM(this.getVisibleMeasures());var a=this._getDrillStateTop();var s=[],n;if(a.redundant){var s=Object.keys(a.redundant).filter(function(e){return e!=="measureNames"})}n=this._normalizeDorM(this.getVisibleDimensions().concat(s),true);e.aDim=n;e.aInResultDim=this._normalizeDorM(this.getInResultDimensions(),true);e.allMsr=this.getMeasures().map(function(e){return e.getName()});e.allDim=this.getDimensions().map(function(e){return e.getName()});if(i){try{const a=t.create({bundleName:"sap.chart.messages.messagebundle"});var o={bFiltered:this._bFilterCalledByCustomer};this._oCandidateColoringSetting=A.getCandidateSetting(i,r,this._semanticTuples,e,this._oColoringStatus||{},this._sAdapteredChartType||this.getChartType(),a,o)}catch(e){if(e instanceof x){e.display()}else{throw e}}}}else{this._oCandidateColoringSetting={}}}return this._oCandidateColoringSetting};q.prototype._hostedVizProperties={selectionMode:{prop:"interaction.selectability.mode"},selectionBehavior:{prop:"interaction.selectability.behavior"}};q.prototype._getHostedVizProperties=function(){return Object.keys(this._hostedVizProperties).reduce(function(e,t){var i=this._hostedVizProperties[t].prop.split(".").reverse().reduce(function(e,t){var i={};i[t]=e;return i},this.getProperty(t));return jQuery.extend(true,e,i)}.bind(this),{})};q.prototype._getDefaultVizProperties=function(){var e=this._sAdapteredChartType||this.getChartType();var t=e.indexOf("100_")===0;var i=e==="pie"||e.indexOf("donut")>-1;e="info/"+this._reset100DonutChartType(e);var r={interaction:{extraEventInfo:true}};return jQuery.extend(true,r,n({},e,["valueAxis.label.formatString","valueAxis2.label.formatString"],t?"":I.DefaultPattern.SHORTFLOAT),n({},e,["legend.formatString","sizeLegend.formatString"],I.DefaultPattern.SHORTFLOAT_MFD2),n({},e,["plotArea.dataLabel.formatString"],i?"":I.DefaultPattern.SHORTFLOAT_MFD2),n({},e,["tooltip.formatString"],t?"":I.DefaultPattern.STANDARDFLOAT));function a(e,t,i){if(t.length===0){return i}e=e||{};var r=e[t[0]];e[t[0]]=a(r,t.slice(1),i);return e}function s(e,t){if(e==null||t.length===0){return e}var i=e[t[0]];if(i&&i.children){return s(i.children,t.slice(1))}return i}function n(e,t,i,r){var n=sap.viz.api.metadata.Viz.get(t);if(n){var o=n.properties;i.forEach(function(t){t=t.split(".");var i=s(o,t);if(i&&i.hasOwnProperty("defaultValue")){a(e,t,r)}})}return e}};q.prototype._getPagingVizProperties=function(){if(this._isEnablePaging()){var e={interaction:{zoom:{enablement:false},selectability:{mode:"NONE"}},plotArea:{isFixedDataPointSize:true}};return e}else{return{}}};q.prototype._getTimeProperties=function(){var t=["year","month","day"];var i=null;var r=this;var a=this.getVisibleDimensions().filter(function(e){var t=r.getDimensionByName(e);return t instanceof u&&t._getFixedRole()==="category"})[0];var s="ISO";var n,o,l;if(a){var h=this.getDimensionByName(a);switch(h.getTimeUnit()){case F.yearmonthday:t=["year","month","day"];break;case F.yearquarter:t=["year","quarter"];break;case F.yearmonth:t=["year","month"];break;case F.yearweek:t=["year","week"];var c=e.getLanguageTag(),d=M.getInstance(c),l=c.region;n=d.getMinimalDaysInFirstWeek();o=d.getFirstDayOfWeek();o=o===0?7:o;s="Gregorian";break;case F.fiscalyear:t=["fiscal_year"];break;case F.fiscalyearperiod:t=["fiscal_period","fiscal_year"];break;default:}i=h.getFiscalYearPeriodCount()}var g=this.getProperty("vizProperties");if(g&&g.timeAxis){var p=g.timeAxis;if(p.levels){t=p.levels}if(p.fiscal&&p.fiscal.periodNumbers){i=p.fiscal.periodNumbers}}return{timeAxis:{levels:t,fiscal:{periodNumbers:i},levelConfig:{week:{type:s,minDays:n,firstDayOfWeek:o,region:l}}}}};q.prototype.setSelectionMode=function(e){this.setProperty("selectionMode",e);var t=this._getVizFrame();if(t){t.setVizProperties({interaction:{selectability:{mode:e}}})}return this};q.prototype.getSelectionMode=function(){var e=this._getVizFrame();if(e){return e.getVizProperties().interaction.selectability.mode}else{return this.getProperty("selectionMode")}};q.prototype.setSelectionBehavior=function(e){this.setProperty("selectionBehavior",e);var t=this._getVizFrame();if(t){t.setVizProperties({interaction:{selectability:{behavior:e}}})}return this};q.prototype.setEnableScalingFactor=function(e){this.setProperty("enableScalingFactor",e);this._invalidateBy({source:this,keys:{vizFrame:true}});return this};q.prototype.getScalingFactor=function(){var e=this._getVizFrame();if(e){var t=e._states()["dynamicScale"];if(t){var i=null;var r=["primaryValues","secondaryValues"];var a=[t.valueAxis,t.valueAxis2];for(var s=0;s<r.length;s++){var n=a[s];if(n&&(n.symbol||n.unit)){i=i||{};var o=r[s];i[o]={scalingFactor:n.symbol};if(n.unit){i[o]["unit"]=n.unit}}}return i}}return null};q.prototype.getSelectionBehavior=function(){var e=this._getVizFrame();if(e){return e.getVizProperties().interaction.selectability.behavior}else{return this.getProperty("selectionBehavior")}};q.prototype.getDimensionByName=function(e){return this.getDimensions().filter(function(t){return t.getName()===e})[0]};q.prototype.getMeasureByName=function(e){return this.getMeasures().filter(function(t){return t.getName()===e})[0]};q.prototype.getTimeDimensions=function(){return this.getDimensions().filter(function(e){return e instanceof u})};q.prototype._isEnablePaging=function(){this._bMobile=z.system.tablet&&!z.system.desktop||z.system.phone;var e=this.getModel();var t=sap.ui.require("sap/ui/model/json/JSONModel");var i=!(t&&e instanceof t)&&this.getEnablePagination()&&this._bIsPagingChartType&&!this._bMobile;return i};function Q(e){var t=e.getParameters();delete t.id;if(this._isEnablePaging()){this._getPagingController().vizFrameRenderCompleted()}this.fireEvent("renderComplete",t)}function K(e){var t=e.getParameters();delete t.id;this.fireEvent("_zoomDetected",t)}function X(e){var t=e.getParameters();delete t.id;var i=this._getDataset();t.data.forEach(function(e){e.context=i.findContext({_context_row_number:e.data._context_row_number})});this.fireEvent("_selectionDetails",t)}q.prototype._showLoading=function(e){var t=this.$();if(!t){return}if(!e){if(this._$loadingIndicator){this._$loadingIndicator.remove()}}else{if(!this._$loadingIndicator){this._$loadingIndicator=this._createLoadingIndicator()}this._updateLoadingIndicator();t.append(this._$loadingIndicator)}this._bLoading=e};q.prototype._createLoadingIndicator=function(){var e=jQuery(N.getElement());var t=jQuery("<p>").attr("class","loading-text").text("Loading");t.css({position:"absolute",transform:"translateY(-3em)",width:"100%","text-align":"center"});t.insertBefore(e.children()[0]);e.css({opacity:1});return e};q.prototype._updateLoadingIndicator=function(){var e=this.$();if(!e||!this._$loadingIndicator){return}var t=this._sAdapteredChartType,i=t==="bar"||t.indexOf("horizontal")!==-1;var r=e.find(".v-plot-bound"),a=e.offset(),s={top:a.top,left:a.left,width:e.width(),height:e.height()};if(r.length){var n=r.offset(),o=r[0].getBoundingClientRect();s.top=n.top-1;s.left=n.left;s.width=o.width+1;if(i){s.height=Math.ceil(o.height+1)}else{s.height=Math.floor(o.height+1)}}this._$loadingIndicator.css(s);var l=this._$loadingIndicator.find(".loading-text");l.css({top:s.height/2,"font-weight":B.get("sapUiChartTitleFontWeight"),"font-size":B.get("sapUiChartMainTitleFontSize"),color:B.get("sapUiChartMainTitleFontSize")});this._$loadingIndicator.css({"background-color":B.get("sapUiExtraLightBG")})};q.prototype._getRequiredDimensions=function(){var e=this._getVisibleDimensions(),t=this.getInResultDimensions();return this._normalizeDorM(e.concat(t),true)};q.prototype._getRequiredMeasures=function(){return this._getVisibleMeasures(true)};q.prototype.exportToSVGString=function(e){var t='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"/>',i=this._getVizFrame();if(i){t=i.exportToSVGString(e)}return t};q.prototype._getPagingController=function(){if(!this._pagingController){this._pagingController=new T(this)}return this._pagingController};return q});
//# sourceMappingURL=Chart.js.map