/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/enums/ProcessingStrategy","sap/ui/mdc/condition/FilterOperatorUtil","./SelectionController","sap/ui/mdc/p13n/P13nBuilder","sap/base/Log","sap/base/util/merge","sap/base/util/deepEqual"],function(t,e,n,o,i,r,a){"use strict";const s=n.extend("sap.ui.mdc.p13n.subcontroller.FilterController",{constructor:function(){n.apply(this,arguments);this._bResetEnabled=true}});s.prototype.getStateKey=function(){return"filter"};s.prototype.getUISettings=function(){return{title:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("filter.PERSONALIZATION_DIALOG_TITLE"),tabText:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("p13nDialog.TAB_Filter"),afterClose:function(t){const e=t.getSource();if(e){const t=e.getContent()[0];if(t.isA("sap.m.p13n.Container")){t.removeView("Filter")}else{e.removeAllContent()}}e.destroy()}}};s.prototype.getCurrentState=function(){return this.getAdaptationControl().getCurrentState()[this.getStateKey()]};s.prototype.getChangeOperations=function(){return{add:"addCondition",remove:"removeCondition"}};s.prototype.getBeforeApply=function(){const t=this.getAdaptationControl().getInbuiltFilter();const e=t?t.createConditionChanges():Promise.resolve([]);return e};s.prototype.getFilterControl=function(){return this.getAdaptationControl().isA("sap.ui.mdc.IFilter")?this.getAdaptationControl():this.getAdaptationControl()._oP13nFilter};s.prototype.sanityCheck=function(t){s.checkConditionOperatorSanity(t);return t};s.checkConditionOperatorSanity=function(t){for(const n in t){const o=t[n];for(let r=0;r<o.length;r++){const a=o[r];const s=a.operator;if(!e.getOperator(s)){o.splice(r,1);if(t[n].length==0){delete t[n]}i.warning("The provided conditions for field '"+n+"' contain unsupported operators - these conditions will be neglected.")}}}};s.prototype._getPresenceAttribute=function(t){return"active"};s.prototype.initAdaptationUI=function(t,e){const n=this.mixInfoAndState(t);return this.getAdaptationControl().retrieveInbuiltFilter().then(function(t){t.setP13nData(n);t.setLiveMode(false);t.setProperty("_useFixedWidth",false);t.getTitle=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("filter.PERSONALIZATION_DIALOG_TITLE")};this._oAdaptationFB=t;return t.createFilterFields().then(function(){this._oPanel=t;return t}.bind(this))}.bind(this))};s.prototype.update=function(t){if(this._oPanel){const e=this.mixInfoAndState(t);this._oPanel.setP13nData(e);const n=this.getAdaptationControl();const o=n&&n.getInbuiltFilter();if(o){o.createFilterFields()}}};s.prototype.getDelta=function(e){if(e.applyAbsolute===t.FullReplace){Object.keys(e.existingState).forEach(function(t){if(!e.changedState.hasOwnProperty(t)){e.changedState[t]=[]}})}return c(e)};const c=function(t){let e=[];const n=t.changedState;const o=t.existingState;const r=t.control;const a=t.hasOwnProperty("applyAbsolute")?t.applyAbsolute:true;const s=t.propertyInfo;for(const t in n){const c=l(s,t);if(!c&&r.isA("sap.ui.mdc.Control")&&r.isPropertyHelperFinal()){i.warning("property '"+t+"' not supported");continue}const u=p(t,n[t],o[t],r,a);e=e.concat(u)}return e};const l=function(t,e){return t.some(function(t){let n=t.name===e||e=="$search";n=n?n:t.path===e;return n})};const u=function(t,e,n,o){delete o.filtered;const i={selectorElement:e,changeSpecificData:{changeType:t,content:{name:n,condition:o}}};return i};const p=function(t,n,o,i,s){let c;const l=[];const p=r([],n);const f=o?r([],o):[];if(a(n,f)){return l}const d=function(t,n){let o;do{o=false;for(let i=0;i<t.length;i++){const r=t[i];const a=e.indexOfCondition(r,n);if(a>-1){t.splice(i,1);if(s){n.splice(a,1)}o=true;break}}}while(o)};d(n,f);if(n.length>0||f.length>0){f.forEach(function(n){const o=e.indexOfCondition(n,p);const r=o>-1&&p[o].filtered===false;if(s||r){c=u("removeCondition",i,t,n);l.push(c)}});n.forEach(function(e){if(s||(!e.hasOwnProperty("filtered")||e.filtered!==false)){c=u("addCondition",i,t,e);l.push(c)}})}return l};s.prototype.model2State=function(){const t={},e=this.getCurrentState();this.getP13nData().items.forEach(function(n){if(n.active&&Object.keys(e).includes(n.name)){t[n.name]=e[n.name]}});return t};s.prototype.mixInfoAndState=function(t){const e=this.getCurrentState()||{};const n=this.prepareAdaptationData(t,function(t,n){const o=e[t.name];t.active=o&&o.length>0?true:false;return!(n.filterable===false)});o.sortP13nData({visible:"active",position:undefined},n.items);return n};s.prototype.changesToState=function(t,e,n){const o={};t.forEach(function(t){const e=r({},t.changeSpecificData.content);const n=e.name;if(!o[n]){o[n]=[]}if(t.changeSpecificData.changeType===this.getChangeOperations()["remove"]){e.condition.filtered=false}o[n].push(e.condition)}.bind(this));return o};return s});
//# sourceMappingURL=FilterController.js.map