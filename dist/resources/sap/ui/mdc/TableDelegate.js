/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./AggregationBaseDelegate","./util/loadModules","sap/m/plugins/PluginBase","sap/ui/model/Sorter","sap/ui/core/library","sap/ui/core/Core","sap/ui/mdc/enums/TableP13nMode","sap/ui/mdc/enums/TableType","sap/ui/mdc/util/FilterUtil"],function(e,t,n,r,o,i,l,s,a){"use strict";const u=Object.assign({},e);u.updateBindingInfo=function(e,t){t.parameters={};t.sorter=[];if(e._oMessageFilter){t.filters=[e._oMessageFilter]}else{t.filters=this.getFilters(e)}const n=this.getGroupSorter(e);if(n){t.sorter.push(n)}const r=this.getSorters(e);t.sorter=t.sorter.concat(t.sorter.length===1?r.filter(function(e){return e.sPath!==t.sorter[0].sPath}):r)};u.getFilters=function(e){const t=e.isFilteringEnabled();let n=[],r=[];if(t){const t=e.getConditions()||{};const r=e.getPropertyHelper().getProperties();const o=a.getFilterInfo(e,t,r).filters;n=o?[o]:[]}const o=i.byId(e.getFilter());if(o){const t=o.getConditions()||{};const n=e.getPropertyHelper().getProperties();const i=a.getFilterInfo(e,t,n).filters;r=i?[i]:[]}return n.concat(r)};u.getGroupSorter=function(e){const t=e._getGroupedProperties()[0];if(!t||!e._isOfType(s.ResponsiveTable)){return undefined}const n=e._getSortedProperties().find(function(e){return e.name===t.name});const o=e.getPropertyHelper().getProperty(t.name).path;const i=n?n.descending:false;if(!e._mFormatGroupHeaderInfo||e._mFormatGroupHeaderInfo.propertyName!==t.name){e._mFormatGroupHeaderInfo={propertyName:t.name,formatter:function(n){return this.formatGroupHeader(e,n,t.name)}.bind(this)}}return new r(o,i,e._mFormatGroupHeaderInfo.formatter)};u.getSorters=function(e){const t=e._getSortedProperties();const n=e.getPropertyHelper();const o=[];t.forEach(function(e){if(n.hasProperty(e.name)){const t=n.getProperty(e.name).path;o.push(new r(t,e.descending))}});return o};u.updateBinding=function(e,t,n,r){this.rebind(e,t)};u.formatGroupHeader=function(e,t,n){const r=e.getPropertyHelper().getProperty(n);const o=r.textProperty;const l=i.getLibraryResourceBundle("sap.ui.mdc");let s="table.ROW_GROUP_TITLE";const a=[r.label,t.getProperty(r.path,true)];if(o){s="table.ROW_GROUP_TITLE_FULL";a.push(t.getProperty(o.path,true))}return l.getText(s,a)};u.validateState=function(t,n,r){if(r=="Filter"&&t._oMessageFilter){const e=i.getLibraryResourceBundle("sap.ui.mdc");return{validation:o.MessageType.Information,message:e.getText("table.PERSONALIZATION_DIALOG_FILTER_MESSAGESTRIP")}}return e.validateState.apply(this,arguments)};u.rebind=function(e,t){e._getType().bindRows(t)};u.getFilterDelegate=function(){return{addItem:function(e,t){return Promise.resolve(null)},addCondition:function(e,t,n){return Promise.resolve()},removeCondition:function(e,t,n){return Promise.resolve()}}};u.fetchExportCapabilities=function(e){return Promise.resolve({XLSX:{}})};u.expandAll=function(e){throw Error("Unsupported operation: TableDelegate does not support #expandAll")};u.collapseAll=function(e){throw Error("Unsupported operation: TableDelegate does not support #collapseAll")};u.initializeContent=function(e){return this.initializeSelection(e)};u.initializeSelection=function(e){if(e._isOfType(s.Table,true)){return c(e)}else if(e._isOfType(s.ResponsiveTable)){return p(e)}else{return Promise.resolve()}};function c(e){const n={Single:"Single",SingleMaster:"Single",Multi:"MultiToggle"};return t("sap/ui/table/plugins/MultiSelectionPlugin").then(function(t){const r=t[0];if(e.isDestroyed()){return Promise.reject("Destroyed")}e._oTable.addDependent(new r({limit:"{$sap.ui.mdc.Table#type>/selectionLimit}",enableNotification:true,showHeaderSelector:"{$sap.ui.mdc.Table#type>/showHeaderSelector}",selectionMode:{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return n[e]}},enabled:{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return e in n}},selectionChange:function(t){e._onSelectionChange({selectAll:t.getParameter("selectAll")})}}))})}function p(e){const t={Single:"SingleSelectLeft",SingleMaster:"SingleSelectMaster",Multi:"MultiSelect"};const n={Default:"SelectAll",ClearAll:"ClearAll"};e._oTable.bindProperty("mode",{path:"$sap.ui.mdc.Table>/selectionMode",formatter:function(e){return t[e]}});e._oTable.bindProperty("multiSelectMode",{path:"$sap.ui.mdc.Table>/multiSelectMode",formatter:function(e){return n[e]||"SelectAll"}});e._oTable.attachSelectionChange(function(t){e._onSelectionChange({selectAll:t.getParameter("selectAll")})});return Promise.resolve()}u.getSelectedContexts=function(e){if(!e._oTable){return[]}if(e._isOfType(s.Table,true)){const t=e._oTable;const r=n.getPlugin(t,"sap.ui.table.plugins.MultiSelectionPlugin");if(!r){return[]}return r.getSelectedIndices().map(function(e){return t.getContextByIndex(e)},this)}if(e._isOfType(s.ResponsiveTable)){return e._oTable.getSelectedContexts()}return[]};function f(e,t){const n=t.map(function(e){return e.getPath()});e._oTable.removeSelections(true);e._oTable.setSelectedContextPaths(n);e._oTable.getItems().forEach(function(e){const t=e.getBindingContextPath();if(t&&n.indexOf(t)>-1){e.setSelected(true)}})}u.setSelectedContexts=function(e,t){if(e._isOfType(s.ResponsiveTable)){f(e,t)}else{throw Error("Unsupported operation: TableDelegate does not support #setSelectedContexts for the given TableType")}};u.clearSelection=function(e){if(!e._oTable){return}if(e._isOfType(s.Table,true)){const t=n.getPlugin(e._oTable,"sap.ui.table.plugins.SelectionPlugin");if(t){t.clearSelection()}}if(e._isOfType(s.ResponsiveTable)){e._oTable.removeSelections(true)}};u.getSupportedFeatures=function(e){return{export:true,expandAll:false,collapseAll:false}};u.getSupportedP13nModes=function(e){const t=[l.Column,l.Sort,l.Filter];if(e._isOfType(s.ResponsiveTable)){t.push(l.Group)}return t};return u});
//# sourceMappingURL=TableDelegate.js.map