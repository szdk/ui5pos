/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/m/VariantManagement","sap/ui/core/Control","sap/ui/core/library","sap/ui/model/base/ManagedObjectModel","sap/base/Log"],function(t,e,r,a,i){"use strict";var o=r.TitleLevel;var n=e.extend("sap.ui.comp.smartvariants.SmartVariantManagementBase",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartvariants/SmartVariantManagementBase.designtime",properties:{enabled:{type:"boolean",group:"Misc",defaultValue:true},defaultVariantKey:{type:"string",group:"Misc",defaultValue:null},selectionKey:{type:"string",group:"Misc",defaultValue:null},showCreateTile:{type:"boolean",group:"Misc",defaultValue:false},showExecuteOnSelection:{type:"boolean",group:"Misc",defaultValue:false},showShare:{type:"boolean",group:"Misc",defaultValue:false},showSetAsDefault:{type:"boolean",group:"Misc",defaultValue:true},standardItemText:{type:"string",group:"Misc",defaultValue:null},useFavorites:{type:"boolean",group:"Misc",defaultValue:false},inErrorState:{type:"boolean",group:"Misc",defaultValue:false},variantCreationByUserAllowed:{type:"boolean",group:"Misc",defaultValue:true},standardItemAuthor:{type:"string",group:"Misc",defaultValue:"SAP"},displayTextForExecuteOnSelectionForStandardVariant:{type:"string",group:"Misc",defaultValue:""},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:o.Auto},titleStyle:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:o.Auto},initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}},events:{save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},exe:{type:"boolean"},def:{type:"boolean"},global:{type:"boolean"}}},manage:{parameters:{renamed:{type:"object[]"},deleted:{type:"string[]"},exe:{type:"object[]"},def:{type:"string"}}},select:{parameters:{key:{type:"string"}}}},defaultAggregation:"variantItems",aggregations:{_embeddedVM:{type:"sap.m.VariantManagement",multiple:false,visibility:"hidden"},variantItems:{type:"sap.ui.comp.variants.VariantItem",multiple:true,forwarding:{getter:"_getEmbeddedVM",aggregation:"items"}}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("max-width",e.getMaxWidth());t.openEnd();t.renderControl(e._oVM);t.close("div")}}});n.prototype.init=function(){e.prototype.init.apply(this);this.STANDARDVARIANTKEY="*standard*";this.addStyleClass("sapUiCompVarMngmt");this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._oVM=new t(this.getId()+"-vm");this.setAggregation("_embeddedVM",this._oVM,true);this.setStandardVariantKey(this.STANDARDVARIANTKEY);this._oManagedObjectModel=new a(this);this.setModel(this._oManagedObjectModel,"$compSmartVariants");this._oVM.attachManage(this._fireManage,this);this._oVM.attachSave(this._fireSave,this);this._oVM.attachSelect(this._fireSelect,this);this._oVM.attachCancel(this._fireCancel,this);this._oVM.attachManageCancel(this._fireManageCancel,this);this.setDefaultVariantKey(this.getStandardVariantKey());this.setPopoverTitle(this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"));this._bindProperties()};n.prototype._bindProperties=function(t){this._oVM.bindProperty("defaultKey",{path:"/defaultVariantKey",model:"$compSmartVariants"});this._oVM.bindProperty("creationAllowed",{path:"/variantCreationByUserAllowed",model:"$compSmartVariants"});this._oVM.bindProperty("selectedKey",{path:"/selectionKey",model:"$compSmartVariants"});this._oVM.bindProperty("supportPublic",{path:"/showShare",model:"$compSmartVariants"});this._oVM.bindProperty("supportDefault",{path:"/showSetAsDefault",model:"$compSmartVariants"});this._oVM.bindProperty("supportApplyAutomatically",{path:"/showExecuteOnSelection",model:"$compSmartVariants"});this._oVM.bindProperty("supportFavorites",{path:"/useFavorites",model:"$compSmartVariants"});this._oVM.bindProperty("level",{path:"/headerLevel",model:"$compSmartVariants"});this._oVM.bindProperty("titleStyle",{path:"/titleStyle",model:"$compSmartVariants"})};n.prototype._getEmbeddedVM=function(){return this._oVM};n.prototype.setDisplayTextForExecuteOnSelectionForStandardVariant=function(t){this.setProperty("displayTextForExecuteOnSelectionForStandardVariant",t);this._oVM.setDisplayTextForExecuteOnSelectionForStandardVariant(t);return this};n.prototype.setShowAsText=function(t){this._oVM.setShowAsText(t);return this};n.prototype.getShowAsText=function(){return this._oVM.getShowAsText()};n.prototype.setShowCreateTile=function(t){this.setProperty("showCreateTile",t);this._oVM._setShowCreateTile(t);return this};n.prototype.getShowCreateTile=function(){return this._oVM._getShowCreateTile()};n.prototype._assignUser=function(t,e){var r=this._oVM.getItemByKey(t);if(r){r.setAuthor(e)}};n.prototype.setSelectionKey=function(t){this.setProperty("selectionKey",t);return this};n.prototype.setInitialSelectionKey=function(t){return this.setSelectionKey(t)};n.prototype.getInitialSelectionKey=function(){return this.getSelectionKey()};n.prototype.currentVariantGetModified=function(){return this.getModified()};n.prototype.currentVariantSetModified=function(t){this.setModified(t)};n.prototype._getIdxSorted=function(t){var e=this.getVariantItems();var r=t.toUpperCase();var a=e.findIndex(function(t,e){if(e>0){if(t.getTitle().toUpperCase()>r){return true}}return false});return a>-1?a:e.length};n.prototype._reorderList=function(t){var e=this.getItemByKey(t);if(e){this.removeVariantItem(e);var r=this._getIdxSorted(e.getTitle());this.insertVariantItem(e,r)}};n.prototype._getInternalVM=function(){return this.getAggregation("_embeddedVM")};n.prototype.getItemByKey=function(t){var e=this.getVariantItems();for(var r=0;r<e.length;r++){if(t==e[r].getKey()){return e[r]}}return null};n.prototype._determineStandardVariantName=function(){var t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD");if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY&&this.getStandardItemText()){t=this.getStandardItemText()}return t};n.prototype.setStandardVariantKey=function(t){this._oVM.setStandardVariantKey(t)};n.prototype.getStandardVariantKey=function(){return this._oVM.getStandardVariantKey()};n.prototype.getOverflowToolbarConfig=function(){return{canOverflow:false,invalidationEvents:["save","manage","select"]}};n.prototype._prepareSaveAsKeyUserData=function(t){try{this._getContentAsync().then(function(e){var r={default:t.def,executeOnSelection:t.execute,type:this._getPersoControllerType(),text:t.name,contexts:t.contexts,content:e};this._fGetDataForKeyUser(r);this._cleanUpSaveForKeyUser()}.bind(this))}catch(t){i.error("'_prepareSaveAsKeyUserData' throws an exception:"+t.message);this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};n.prototype._fireCancel=function(t){if(this._fGetDataForKeyUser){this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};n.prototype._fireManageCancel=function(t){if(this._fGetDataForKeyUser){this._fGetDataForKeyUser();this._cleanUpManageViewsForKeyUser()}};n.prototype._fireSelect=function(t){if(!this._fGetDataForKeyUser){this.setModified(false)}this.fireSelect(t.getParameters())};n.prototype._fireSave=function(t){var e=t.getParameters();if(this._fGetDataForKeyUser){this._prepareSaveAsKeyUserData(e);return}if(e.hasOwnProperty("execute")){e.exe=e.execute}if(e.hasOwnProperty("public")){e.global=e.public}this.fireSave(e)};n.prototype._prepareManageKeyUserData=function(t){var e={};var r=false;if(t.hasOwnProperty("def")){var a=t.def;if(a!==this._oVM._sOriginalDefaultKey){e.default=a}}if(t.hasOwnProperty("deleted")){t.deleted.forEach(function(t){if(!e[t]){e[t]={}}e[t].deleted=true;if(this.getSelectionKey()===t){r=true}}.bind(this))}if(t.hasOwnProperty("exe")){t.exe.forEach(function(t){if(!e[t.key]){e[t.key]={}}e[t.key].executeOnSelection=t.exe})}if(t.hasOwnProperty("fav")){t.fav.forEach(function(t){if(!e[t.key]){e[t.key]={}}e[t.key].favorite=t.visible})}if(t.hasOwnProperty("renamed")){t.renamed.forEach(function(t){if(!e[t.key]){e[t.key]={}}e[t.key].name=t.name})}if(t.hasOwnProperty("contexts")){t.contexts.forEach(function(t){if(!e[t.key]){e[t.key]={}}e[t.key].contexts=t.contexts})}if(r){this.activateVariant(this.getStandardVariantKey())}this._fGetDataForKeyUser(e);this._cleanUpManageViewsForKeyUser()};n.prototype._fireManage=function(t){var e=t.getParameters();if(this._fGetDataForKeyUser){this._prepareManageKeyUserData(e)}else{this.fireManage(e)}};n.prototype.getFocusDomRef=function(){if(this._oVM){return this._oVM.oVariantPopoverTrigger.getFocusDomRef()}return null};n.prototype.getManageDialog=function(){if(this._oVM){return this._oVM.oManagementDialog}return null};n.prototype.getVariants=function(){return this._oVM.getItems()};n.prototype.getTitle=function(){return this._oVM.getTitle()};n.prototype.setPopoverTitle=function(t){return this._oVM.setPopoverTitle(t)};n.prototype.setEditable=function(t){this.setProperty("editable",t);return this._oVM.setShowFooter(t)};n.prototype.setShowExecuteOnSelection=function(t){this.setProperty("showExecuteOnSelection",t);this._oVM.setSupportApplyAutomatically(t);return this};n.prototype.setShowSetAsDefault=function(t){this.setProperty("showSetAsDefault",t);this._oVM.setSupportDefault(t);return this};n.prototype.setDisplayTextForExecuteOnSelectionForStandardVariant=function(t){this.setProperty("displayTextForExecuteOnSelectionForStandardVariant",t);this._oVM.setDisplayTextForExecuteOnSelectionForStandardVariant(t);return this};n.prototype.setInErrorState=function(t){var e=this._oVM.getTitle();if(t&&e&&!e.getText()){e.setText(this._determineStandardVariantName())}this.setProperty("inErrorState",t);this._oVM.setInErrorState(t);return this};n.prototype.getInErrorState=function(){return this._oVM.getInErrorState()};n.prototype._updateLayerSpecificInformations=function(){this.getVariants().forEach(function(t){var e=this._getVariantById(t.getKey());if(e){t.setRemove(e.isDeleteEnabled(this._sLayer));t.setRename(e.isRenameEnabled(this._sLayer))}}.bind(this))};n.prototype.setEditable=function(t){this._oVM.setProperty("showFooter",t);return this};n.prototype.setCurrentVariantKey=function(t){this._oVM.setSelectedKey(t)};n.prototype.getCurrentVariantKey=function(){return this._oVM.getSelectedKey()};n.prototype.getModified=function(){return this._oVM.getModified()};n.prototype.setModified=function(t){this._oVM.setModified(t)};n.prototype.refreshTitle=function(){this._oVM.refreshTitle()};n.prototype.registerApplyAutomaticallyOnStandardVariant=function(t){this._fRegisteredApplyAutomaticallyOnStandardVariant=t;return this};n.prototype.getApplyAutomaticallyOnVariant=function(t){var e=t.executeOnSelect;if(this._fRegisteredApplyAutomaticallyOnStandardVariant&&this.getDisplayTextForExecuteOnSelectionForStandardVariant()&&t.key===this._oVM.getStandardVariantKey()){try{e=this._fRegisteredApplyAutomaticallyOnStandardVariant(t)}catch(t){i.error("callback for determination of apply automatically on standard variant failed")}}return e};n.prototype.getPersonalizableControlPersistencyKey=function(){if(this.isPageVariant()){return this.getPersistencyKey()}var t=this._getAllPersonalizableControls();if(t&&t.length===1){return this._getControlPersKey(t[0])}return null};n.prototype.addVariant=function(t,e){this._createVariantItem(t);if(e){this.setDefaultVariantId(t.getVariantId())}};n.prototype.removeVariant=function(t){if(t.variantId){var e=this.getItemByKey(t.variantId);if(e){this.removeVariantItem(e);e.destroy()}delete this._mVariants[t.variantId]}if(t.previousVariantId){this.activateVariant(t.previousVariantId)}if(t.previousDefault){this.setDefaultVariantId(t.previousDefault)}};n.prototype.removeWeakVariant=function(t){if(t.variantId){var e=this.getItemByKey(t.variantId);if(e){this.removeVariantItem(e);e.destroy()}delete this._mVariants[t.variantId]}if(t.previousVariantId){this.setInitialSelectionKey(t.previousVariantId)}if(t.previousDirtyFlag){this.setModified(t.previousDirtyFlag)}if(t.previousDefault){this.setDefaultVariantId(t.previousDefault)}};n.prototype.updateVariant=function(t){var e;if(t){e=this.getItemByKey(t.getVariantId());if(e){e.setExecuteOnSelection(t.getExecuteOnSelection());e.setExecuteOnSelect(t.getExecuteOnSelection());e._setOriginalExecuteOnSelect(t.getExecuteOnSelection());e.setFavorite(t.getFavorite());e._setOriginalFavorite(t.getFavorite());e.setTitle(t.getText("variantName"));e._setOriginalTitle(t.getText("variantName"));e.setText(t.getText("variantName"));if(t.getContexts){e.setContexts(t.getContexts());e._setOriginalContexts(t.getContexts())}}}};n.prototype.activateVariant=function(t){this.setCurrentVariantKey(t);this.setModified(false);this.fireSelect({key:t})};n.prototype.getAllVariants=function(){var t=this._oVM.getItems();if(!t||t.length<1){return[]}var e=[];t.forEach(function(t){if(t.getVisible()){e.push(this._getVariantById(t.getKey()))}}.bind(this));return e};n.prototype.getDefaultVariantId=function(){return this.getDefaultVariantKey()};n.prototype.setDefaultVariantId=function(t){this.setDefaultVariantKey(t)};n.prototype.getPresentVariantId=function(){return this.getCurrentVariantId()?this.getCurrentVariantId():this.STANDARDVARIANTKEY};n.prototype.getPresentVariantText=function(){return this._oVM.getSelectedVariantText(this.getPresentVariantId())};n.prototype.getPresentVariantContent=function(){return this._getContentAsync()};n.prototype._getPersoController=function(){return this._oPersoControl};n.prototype._getPersoControllerType=function(){if(this.isPageVariant()){return"page"}var t=this._getAllPersonalizableControls();if(t&&t.length===1){return t[0].type}return null};n.prototype._getViewByName=function(t){var e,r=t.trim();var a=this.getVariants();for(var i=0;i<a.length;i++){e=a[i].getText().trim();if(e===r){return a[i]}}return null};n.prototype.getViewIdByName=function(t){var e=this._getViewByName(t);return e?e.getKey():null};n.prototype._isDuplicateSaveAs=function(t){var e=t.trim();if(!e){return true}var r=this._determineStandardVariantName();if(r===e){return true}return this._getViewByName(e)?true:false};n.prototype.isNameDuplicate=function(t){var e=t.trim();return this._isDuplicateSaveAs(e)};n.prototype.isNameTooLong=function(e){var r=e.trim();return r.length>t.MAX_NAME_LEN};n.prototype.setStandardItemText=function(t){this.setProperty("standardItemText",t);return this};n.prototype._executeOnSelectForStandardVariantByXML=function(t){this.bExecuteOnSelectForStandardViaXML=t};n.prototype.getExecuteOnSelectForStandardVariant=function(){var t=false;var e=this.getItemByKey(this.getStandardVariantKey());if(e){t=e.getExecuteOnSelect()}return t||this.bExecuteOnSelectForStandardViaXML};n.prototype._reapplyExecuteOnSelectForStandardVariantItem=function(t){var e=this.getStandardVariantKey();if(this._oVM){var r=this._oVM.getItemByKey(e);if(r){r.setExecuteOnSelect(t);r._setOriginalExecuteOnSelect(t)}}};n.prototype.openManageViewsDialogForKeyUser=function(t,e,r){this._sLayer=t.layer;this._fGetDataForKeyUser=e;this._updateLayerSpecificInformations();var a=true;if(r){a=false}this._oVM.openManagementDialog(a,t.rtaStyleClass,t.contextSharingComponentContainer)};n.prototype.openSaveAsDialogForKeyUser=function(t,e,r){this._fGetDataForKeyUser=e;this._oVM.openSaveAsDialog(t,r)};n.prototype._cleanUpSaveForKeyUser=function(){if(this._oRolesComponentContainer){this.oSaveDialog.removeContent(this._oRolesComponentContainer)}this._cleanUpKeyUser()};n.prototype._destroyManageDialog=function(){if(this._oVM){this._oVM.destroyManageDialog()}};n.prototype._cleanUpManageViewsForKeyUser=function(){this._destroyManageDialog();this._cleanUpKeyUser()};n.prototype._cleanUpKeyUser=function(){this.setShowShare(this._bShowShare);this._fGetDataForKeyUser=null;this._sLayer=null;this._oRolesComponentContainer=null};n.prototype._getContentAsync=function(){return Promise.resolve(this._fetchContentAsync())};n.prototype._checkUpdate=function(){this._oVM.getModel("$mVariants").checkUpdate(true)};n.prototype.enteringDesignMode=function(){this.setDesignTimeMode(true)};n.prototype.leavingDesignMode=function(){this.setDesignTimeMode(false)};n.prototype.setDesignTimeMode=function(t){this._oVM.setDesignMode(t);return this._oVM.setShowFooter(!t)};n.prototype.exit=function(){this._oVM.detachManage(this._fireManage,this);this._oVM.detachSelect(this._fireSelect,this);this._oVM.detachSave(this._fireSave,this);this._oVM.detachCancel(this._fireCancel,this);this._oVM.detachManageCancel(this._fireManageCancel,this);if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();this._oManagedObjectModel=undefined}e.prototype.exit.apply(this,arguments);this._oVM=undefined;this._fRegisteredApplyAutomaticallyOnStandardVariant=null;this.oResourceBundle=undefined};return n});
//# sourceMappingURL=SmartVariantManagementBase.js.map