/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/date/UI5Date","sap/ui/thirdparty/jquery","sap/ui/comp/config/condition/Type","sap/ui/Device","sap/ui/core/library","sap/ui/comp/library","sap/m/library","sap/m/Input","sap/m/Text","sap/ui/core/ListItem","sap/m/Label","sap/ui/core/date/UniversalDate","sap/ui/core/format/DateFormat","sap/ui/comp/config/condition/NullableInteger","sap/base/Log","sap/ui/core/date/UniversalDateUtils","sap/m/DynamicDateRange","sap/m/DynamicDateUtil","sap/m/DynamicDateFormat","sap/m/DynamicDateOption","sap/m/DynamicDateValueHelpUIType","sap/m/StandardDynamicDateOption","sap/ui/comp/util/DateTimeUtil","sap/ui/dom/jquery/cursorPos"],function(e,jQuery,t,a,n,i,r,o,s,l,u,p,g,f,T,d,c,v,y,E,h,D,m){"use strict";var I=n.ValueState,A=Object.keys(r.StandardDynamicDateRangeKeys).concat(["LAST2WEEKS","LAST3WEEKS","LAST4WEEKS","LAST5WEEKS","NEXT2WEEKS","NEXT3WEEKS","NEXT4WEEKS","NEXT5WEEKS"]);var S=t.extend("sap.ui.comp.config.condition.DateRangeType",{constructor:function(e,a,n){t.apply(this,[e,a,n]);this.oDateFormat=a&&a._oDateFormatSettings?a._oDateFormatSettings:{UTC:true};this._bIgnoreTime=false;this._maxIntValue=1e4;this.bMandatory=this.oFieldMetadata?this.oFieldMetadata.isMandatory:false;var r=this.oFieldMetadata&&this.oFieldMetadata.name,o=a&&a._oAdditionalConfiguration&&a._oAdditionalConfiguration.getControlConfigurationByKey(e)||r&&a._oAdditionalConfiguration.getControlConfigurationByKey(r);this._bSingleFilterRestriction=n&&n.filterRestriction===i.smartfilterbar.FilterType.single&&(a._bUseDateRangeType||o&&(o.conditionType===this.getName()||typeof o.conditionType==="object"&&o.conditionType.module===this.getName()));this._bDTOffset=n&&n.filterRestriction===i.smartfilterbar.FilterType.interval&&n.type==="Edm.DateTimeOffset";this._customSemanticOperation=null}});S.prototype.applySettings=function(e){t.prototype.applySettings.apply(this,arguments);if(e&&e.ignoreTime){this._bIgnoreTime=e.ignoreTime}};S.setStartTime=function(e){e=S.toUniversalDate(e);return d.resetStartTime(e)};S.setEndTime=function(e,t){e=S.toUniversalDate(e);if(!t){return d.resetEndTime(e)}else{return d.resetStartTime(e)}};S.toUniversalDate=function(t){if(t instanceof Date){return p.getInstance(t)}if(!t){return p.getInstance()}if(!(t instanceof p)){return S.toUniversalDate(e.getInstance(t))}return t};S.getWeekStartDate=function(e){return d.getWeekStartDate(e)};S.getMonthStartDate=function(e){return d.getMonthStartDate(e)};S.getQuarterStartDate=function(e){return d.getQuarterStartDate(e)};S.getYearStartDate=function(e){return d.getYearStartDate(e)};S.getDateRange=function(e,t,a,n,i){if(a===true){n=true;a=null}if(!a){a=new p}else{a=new p(a)}if(n){switch(t){case"DAY":break;case"WEEK":a=d.getWeekStartDate(a);break;case"MONTH":a=d.getMonthStartDate(a);break;case"QUARTER":a=d.getQuarterStartDate(a);break;case"YEAR":a=d.getYearStartDate(a);break}}if(!i&&e>0){if(e!==0&&!isNaN(e)){var r=-1;switch(t){case"DAY":a.setDate(a.getDate()+r);break;case"WEEK":a.setDate(a.getDate()+r*7);break;case"MONTH":a.setMonth(a.getMonth()+r);break;case"QUARTER":a.setMonth(a.getMonth()+r*3);break;case"YEAR":a.setFullYear(a.getFullYear()+r);break}}}return d.getRange(e,t,a,false)};S.getTextField=function(e,a){var n=t._createStableId(e,"text");if(a){return new s(n,{text:"{path: '$smartEntityFilter>value1', type:'sap.ui.model.type.Date', formatOptions:"+JSON.stringify({style:e.oDateFormat.style,pattern:e.oDateFormat.pattern})+"} - {path: '$smartEntityFilter>value2', type:'sap.ui.model.type.Date', formatOptions:"+JSON.stringify({style:e.oDateFormat.style,pattern:e.oDateFormat.pattern})+"}"})}else{return new s(n,{text:{path:"$smartEntityFilter>value1",type:"sap.ui.model.type.Date",formatOptions:{style:e.oDateFormat.style,pattern:e.oDateFormat.pattern}}})}};S.getIntField=function(e){return new o(t._createStableId(e,"field"),{value:{path:"$smartEntityFilter>value1",type:new f({},{minimum:0,maximum:e._maxIntValue})},textAlign:"End",width:"100%"})};S.getIntFromToField=function(e,a,n){var i=new u({text:t.getTranslatedText("CONDITION_DATERANGETYPE_DATERANGE_LABELFROM")});i.addStyleClass("sapUiCompFilterBarCTPaddingTop");a.push(i);var r=e._createIntFromToControl(e,"fieldFrom","value1");i.setLabelFor(r);a.push(r);i=new u({text:t.getTranslatedText("CONDITION_DATERANGETYPE_DATERANGE_LABELTO")});i.addStyleClass("sapUiCompFilterBarCTPaddingTop");a.push(i);var o=e._createIntFromToControl(e,"fieldTo","value2");i.setLabelFor(o);a.push(o);e._setIntControlBinding(r,n,"value1");e._setIntControlBinding(o,n,"value2")};S.ControlFactory=function(e,a,n){if(n.type==="range"){var i=S.getTextField(e,n.display!=="start");i.addStyleClass("sapUiCompFilterBarCTPaddingTop");a.push(i);return}if(n.type==="int"){var i=S.getIntField(e);a.push(i);if(n.descriptionTextKeys){i.setFieldWidth("auto");i.bindProperty("description",{path:"$smartEntityFilter>value1",type:"sap.ui.model.type.Integer",formatter:function(){var e=n.descriptionTextKeys[0];var a=n.descriptionTextKeys[1];if(this.getBinding("description").getValue()===1){return t.getTranslatedText(e)}else{return t.getTranslatedText(a||e)}}})}}if(n.type==="[int,int]"){S.getIntFromToField(e,a,n)}};S._defaultOnChangeHandler=function(e,t){if(e.toLowerCase()===this.languageText.toLowerCase()){t.oModel.setProperty("/condition/operation",this.key);t.oModel.setProperty("inputstate","NONE",t.getContext());if(this.category.indexOf("FIXED")!==0){t.oModel.setProperty("inputstate","ERROR",t.getContext())}return true}return false};S._IntOnChangeHandler=function(e,t){if(this.basicLanguageText.indexOf("{0}")>=0){var a=new RegExp(this.basicLanguageText.replace("+","\\+").replace("{0}","([a-zA-Z0-9_]+)")+"$","i");if(e.match(a)){var e=e.match(a)[1];if(e){var n=parseInt(e);if(!isNaN(n)&&n<=t._maxIntValue){t.oModel.setProperty("/condition/operation",this.key);t.oModel.setProperty("/condition/value1",n);t.oModel.setProperty("inputstate","NONE",t.getContext())}else{t.oModel.setProperty("inputstate","ERROR",t.getContext())}return true}}}return false};S._DefaultFilterSuggestItem=function(e,t,a){var n=false;if(this.languageText.toLowerCase().startsWith(e.toLowerCase())){n=true}else{var i=this.languageText.split(" ");for(var r=0;r<i.length;r++){var o=i[r];if(o.toLowerCase().startsWith(e.toLowerCase())){n=true}}}t.setAdditionalText(this.textValue);t.setText(this.languageText);return n};S._HideFilterSuggestItem=function(e,t,a){return false};S._IntFilterSuggestItem=function(e,a,n){if(!this.basicLanguageText){this.basicLanguageText=n.basicLanguageText}if(!this.basicLanguageText){this.basicLanguageText=this.languageText||t.getTranslatedText(this.textKey)}var i=this.basicLanguageText.indexOf("{0}");var r;var o;if(i>=0){r=this.basicLanguageText.slice(0,i).trim();o=this.basicLanguageText.slice(i+3).trim()}var s=e.split(" ");if(s.length<1||s.length>3){return false}var l=false;var u;var p=function(e){return!!e.match(/(^[0-9]+$)/)&&parseInt(e)>=0};if(r.toLowerCase().startsWith(s[0].toLowerCase())){if(s[1]){if(p(s[1])){u=s[1];if(s[2]){if(o.toLowerCase().startsWith(s[2].toLowerCase())){l=true}}else{l=true}}}else{l=true}}else if(p(s[0])&&s.length<3){u=s[0];if(s[1]){if(o.toLowerCase().startsWith(s[1].toLowerCase())){l=true}}else{l=true}}else if(o.toLowerCase().startsWith(s[0].toLowerCase())&&s.length==1){l=true}if(l&&u){var g;switch(this.category){case"DYNAMIC.DATE.INT":g="DAY";break;case"DYNAMIC.WEEK.INT":g="WEEK";break;case"DYNAMIC.MONTH.INT":g="MONTH";break;case"DYNAMIC.QUARTER.INT":g="QUARTER";break;case"DYNAMIC.YEAR.INT":g="YEAR";break;default:g="DAY";break}var f=parseInt(u),T=true;if(!n._maxIntValue){n._maxIntValue=n.getControls(n.key)[0].getBindingInfo("value").type.oConstraints.maximum}if(f>n._maxIntValue){l=false}if(this.key.startsWith("LAST")){f=f*-1;T=false}var d;if(this.getDateRange){var c=this.getDateRange({operation:this.key,value1:f});d=[c.value1,c.value2]}else{d=S.getDateRange(f,g,true,T,T)}var v=n._getDateFormatter(true);if(Math.abs(f)===1&&this.singulareBasicLanguageText){a.setText(this.singulareBasicLanguageText);if(g!=="DAY"){a.setAdditionalText(v.format(d[0])+" - "+v.format(d[1]))}else{a.setAdditionalText(v.format(d[0]))}}else{a.setText(n._fillNumberToText(this.basicLanguageText,u));a.setAdditionalText(v.format(d[0])+" - "+v.format(d[1]))}a._value1=parseInt(u)}else{a.setAdditionalText(null);a.setText(this.languageText);a._value1=null}return l};S._DefaultOnItemSelected=function(e,t,a){a.oModel.setProperty("/condition/operation",this.key);if("value1"in this){a.oModel.setProperty("/condition/value1",t._value1)}if("value2"in this){a.oModel.setProperty("/condition/value2",t._value2)}a.oModel.setProperty("inputstate","NONE",a.getContext());a._bSuggestItemSelected=true};S._IntOnItemSelected=function(e,t,a){var n=t._value1;a.oModel.setProperty("/condition/operation",this.key);a.oModel.setProperty("/condition/value1",n);a.oModel.setProperty("inputstate","NONE",a.getContext());a._bSuggestItemSelected=true};S.getFixedRangeOperation=function(e,t,a,n,i,r){return Object.assign({textKey:t,filterSuggestItem:i||S._DefaultFilterSuggestItem,onItemSelected:S._DefaultOnItemSelected,getControls:S.ControlFactory},S._getFixedRangeOperation(e,a,n,r))};S._getFixedRangeOperation=function(e,t,a,n){return{key:e,category:t,order:n||100,defaultValues:a||null,type:"range",display:"range"}};S.createSingleIntRangeOperation=function(e,t,a,n,i,r,o,s){return Object.assign({textKey:t,singularTextKey:a,zeroNumberTextKey:s,descriptionTextKeys:r,onChange:S._IntOnChangeHandler,filterSuggestItem:S._IntFilterSuggestItem,onItemSelected:S._IntOnItemSelected,getControls:S.ControlFactory},S._createSingleIntRangeOperation(e,n,i,o))};S._createSingleIntRangeOperation=function(e,t,a,n){return{key:e,category:t,order:n,defaultValues:[a],value1:null,type:"int",_getInitialValues:function(e){return[e.value1,e.value2]}}};S.Operations={DATERANGE:{key:"DATERANGE",category:"DYNAMIC.DATERANGE",order:2,defaultOperation:true,defaultValues:[null,null],value1:null,value2:null},DATE:{key:"DATE",category:"DYNAMIC.DATE",order:0,defaultValues:[null],value1:null},FROM:{key:"FROM",category:"DYNAMIC.DATE",order:0,defaultValues:[null],value1:null},TO:{key:"TO",category:"DYNAMIC.DATE",order:1,defaultValues:[null],value1:null},LASTDAYS:S._createSingleIntRangeOperation("LASTDAYS","DYNAMIC.DATE.INT",1,4),LASTWEEKS:S._createSingleIntRangeOperation("LASTWEEKS","DYNAMIC.WEEK.INT",1,8),LASTMONTHS:{key:"LASTMONTHS",category:"DYNAMIC.MONTH.INT",order:14,defaultValues:[1],value1:null,type:"int"},LASTQUARTERS:{key:"LASTQUARTERS",category:"DYNAMIC.QUARTER.INT",order:19,defaultValues:[1],value1:null,type:"int"},LASTYEARS:{key:"LASTYEARS",category:"DYNAMIC.YEAR.INT",order:28,defaultValues:[1],value1:null,type:"int"},NEXTDAYS:{key:"NEXTDAYS",category:"DYNAMIC.DATE.INT",order:5,defaultValues:[1],value1:null,type:"int"},NEXTWEEKS:{key:"NEXTWEEKS",category:"DYNAMIC.WEEK.INT",order:10,defaultValues:[1],value1:null,type:"int"},NEXTMONTHS:{key:"NEXTMONTHS",category:"DYNAMIC.MONTH.INT",order:16,defaultValues:[1],value1:null,type:"int"},NEXTQUARTERS:{key:"NEXTQUARTERS",category:"DYNAMIC.QUARTER.INT",order:21,defaultValues:[1],value1:null,type:"int"},NEXTYEARS:{key:"NEXTYEARS",category:"DYNAMIC.YEAR.INT",order:30,defaultValues:[1],value1:null,type:"int"},SPECIFICMONTH:{key:"SPECIFICMONTH",category:"DYNAMIC.MONTH",order:11,defaultValues:function(){var e=new p;return[e.getMonth()]},value1:null},YESTERDAY:{key:"YESTERDAY",category:"FIXED.DATE",order:3.1,defaultValues:function(){return d.ranges.yesterday()},type:"range",display:"start"},TODAY:{key:"TODAY",category:"FIXED.DATE",order:3,defaultValues:function(){return d.ranges.today()},type:"range",display:"start"},TOMORROW:{key:"TOMORROW",category:"FIXED.DATE",order:3.2,defaultValues:function(){var e=d.ranges.tomorrow();return e},type:"range",display:"start"},THISWEEK:S._getFixedRangeOperation("THISWEEK","FIXED.WEEK",function(){return d.ranges.currentWeek()},6),LASTWEEK:S._getFixedRangeOperation("LASTWEEK","FIXED.WEEK",function(){return d.ranges.lastWeek()},7),LAST2WEEKS:S._getFixedRangeOperation("LAST2WEEKS","FIXED.WEEK",function(){return d.ranges.lastWeeks(-2)},-1),LAST3WEEKS:S._getFixedRangeOperation("LAST3WEEKS","FIXED.WEEK",function(){return d.ranges.lastWeeks(-3)},-1),LAST4WEEKS:S._getFixedRangeOperation("LAST4WEEKS","FIXED.WEEK",function(){return d.ranges.lastWeeks(-4)},-1),LAST5WEEKS:S._getFixedRangeOperation("LAST5WEEKS","FIXED.WEEK",function(){return d.ranges.lastWeeks(-5)},-1),NEXTWEEK:S._getFixedRangeOperation("NEXTWEEK","FIXED.WEEK",function(){return d.ranges.nextWeek()},9),NEXT2WEEKS:S._getFixedRangeOperation("NEXT2WEEKS","FIXED.WEEK",function(){return d.ranges.nextWeeks(2)},-1),NEXT3WEEKS:S._getFixedRangeOperation("NEXT3WEEKS","FIXED.WEEK",function(){return d.ranges.nextWeeks(3)},-1),NEXT4WEEKS:S._getFixedRangeOperation("NEXT4WEEKS","FIXED.WEEK",function(){return d.ranges.nextWeeks(4)},-1),NEXT5WEEKS:S._getFixedRangeOperation("NEXT5WEEKS","FIXED.WEEK",function(){return d.ranges.nextWeeks(5)},-1),THISMONTH:S._getFixedRangeOperation("THISMONTH","FIXED.MONTH",function(){return d.ranges.currentMonth()},12),LASTMONTH:S._getFixedRangeOperation("LASTMONTH","FIXED.MONTH",function(){return d.ranges.lastMonth()},13),NEXTMONTH:S._getFixedRangeOperation("NEXTMONTH","FIXED.MONTH",function(){return d.ranges.nextMonth()},15),THISQUARTER:S._getFixedRangeOperation("THISQUARTER","FIXED.QUARTER",function(){return d.ranges.currentQuarter()},17),LASTQUARTER:S._getFixedRangeOperation("LASTQUARTER","FIXED.QUARTER",function(){return d.ranges.lastQuarter()},18),NEXTQUARTER:S._getFixedRangeOperation("NEXTQUARTER","FIXED.QUARTER",function(){return d.ranges.nextQuarter()},20),YEARTODATE:S._getFixedRangeOperation("YEARTODATE","FIXED.YEAR",function(){return d.ranges.yearToDate()},31),THISYEAR:S._getFixedRangeOperation("THISYEAR","FIXED.YEAR",function(){return d.ranges.currentYear()},26),LASTYEAR:S._getFixedRangeOperation("LASTYEAR","FIXED.YEAR",function(){return d.ranges.lastYear()},27),NEXTYEAR:S._getFixedRangeOperation("NEXTYEAR","FIXED.YEAR",function(){return d.ranges.nextYear()},29),QUARTER1:S._getFixedRangeOperation("QUARTER1","FIXED.QUARTER",function(){return d.ranges.quarter(1)},22),QUARTER2:S._getFixedRangeOperation("QUARTER2","FIXED.QUARTER",function(){return d.ranges.quarter(2)},23),QUARTER3:S._getFixedRangeOperation("QUARTER3","FIXED.QUARTER",function(){return d.ranges.quarter(3)},24),QUARTER4:S._getFixedRangeOperation("QUARTER4","FIXED.QUARTER",function(){return d.ranges.quarter(4)},25),TODAYFROMTO:{key:"TODAYFROMTO",category:"DYNAMIC.DATE.INT",order:3.3,defaultValues:[1,1],type:"[int,int]",display:"int",value1:null,value2:null}};S.SingleOperations={DATE:Object.assign({},S.Operations.DATE,{defaultOperation:true}),YESTERDAY:S.Operations.YESTERDAY,TODAY:S.Operations.TODAY,TOMORROW:S.Operations.TOMORROW,FIRSTDAYWEEK:{key:"FIRSTDAYWEEK",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"FIRSTDAYWEEK",values:[]})}},LASTDAYWEEK:{key:"LASTDAYWEEK",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"LASTDAYWEEK",values:[]})}},FIRSTDAYMONTH:{key:"FIRSTDAYMONTH",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"FIRSTDAYMONTH",values:[]})}},LASTDAYMONTH:{key:"LASTDAYMONTH",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"LASTDAYMONTH",values:[]})}},FIRSTDAYQUARTER:{key:"FIRSTDAYQUARTER",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"FIRSTDAYQUARTER",values:[]})}},LASTDAYQUARTER:{key:"LASTDAYQUARTER",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"LASTDAYQUARTER",values:[]})}},FIRSTDAYYEAR:{key:"FIRSTDAYYEAR",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"FIRSTDAYYEAR",values:[]})}},LASTDAYYEAR:{key:"LASTDAYYEAR",category:"FIXED.DATE",type:"range",display:"start",defaultValues:function(){return(new D).toDates({operator:"LASTDAYYEAR",values:[]})}}};S.NewDynamicDateRangeOperations={DATETOYEAR:{key:"DATETOYEAR",category:"FIXED.YEAR",type:"range",display:"range",defaultValues:function(){return(new D).toDates({operator:"DATETOYEAR",values:[]})}}};S.DTOffsetOperations=Object.assign({NEXTMINUTES:{key:"NEXTMINUTES",category:"DYNAMIC.MINUTE.INT",type:"int",value1:null,defaultValues:[null]},NEXTHOURS:{key:"NEXTHOURS",category:"DYNAMIC.HOUR.INT",type:"int",value1:null,defaultValues:[null]},LASTMINUTES:{key:"LASTMINUTES",category:"DYNAMIC.MINUTE.INT",type:"int",value1:null,defaultValues:[null]},LASTHOURS:{key:"LASTHOURS",category:"DYNAMIC.HOUR.INT",type:"int",value1:null,defaultValues:[null]}},S.Operations,S.NewDynamicDateRangeOperations,{DATERANGE:Object.assign({},S.Operations.DATERANGE,{defaultOperation:false}),DATETIME:{key:"DATETIME",category:"DYNAMIC.DATETIME",type:"range",display:"range",value1:null,defaultValues:[null]},DATETIMERANGE:{key:"DATETIMERANGE",category:"DYNAMIC.DATETIMERANGE",type:"range",display:"range",defaultOperation:true,value1:null,value2:null,defaultValues:[null,null]}});S.prototype.getControls=function(e){var t=[];if(!e){return}if(!e.getControls){e.getControls=S.ControlFactory}e.getControls(this,t,e);return t};S.prototype.setIgnoreTime=function(e){this._bIgnoreTime=e};t.prototype.getIgnoreTime=function(e){return this._bIgnoreTime};S.prototype.getDefaultValues=function(e){if(!e){return[]}var t=e.defaultValues||[];if(typeof t==="function"){t=e.defaultValues()}var a=this.getCondition(),n=t[0]||null,i=t[1]||null;if(e.key==="DATERANGE"&&a&&a.value1&&a.value2&&(a.value1 instanceof Date&&a.value2 instanceof Date||a.value1.oDate&&a.value2.oDate)){n=a.value1.oDate||a.value1;i=a.value2.oDate||a.value2}else{if(n instanceof Date){n=new p(n)}if(i instanceof Date){i=new p(i)}}return[n,i]};S.prototype.getOperations=function(){if(this._bSingleFilterRestriction){return this.getSingleOperations()}if(this._bDTOffset){return this.getDTOffsetOperations()}var e=[];var t=Object.assign({},S.Operations,S.NewDynamicDateRangeOperations);for(var a in t){var n=t[a];if(this._filterOperation(n)){e.push(n)}}return e};S.prototype.getSingleOperations=function(){var e=[];for(var t in S.SingleOperations){var a=S.SingleOperations[t];if(this._filterOperation(a)){e.push(a)}}return e};S.prototype.getDTOffsetOperations=function(){var e=[];for(var t in S.DTOffsetOperations){var a=S.DTOffsetOperations[t];if(this._filterOperation(a)){e.push(a)}}return e};S.prototype._updateOperation=function(e){t.prototype._updateOperation.apply(this,[e]);if(e.languageText&&!e.basicLanguageText){e.basicLanguageText=e.languageText;if(!e.singulareBasicLanguageText&&e.singularTextKey){e.singulareBasicLanguageText=this.getTranslatedText(e.singularTextKey)}if(!e.zeroNumberLanguageText&&e.zeroNumberTextKey){e.zeroNumberLanguageText=this.getTranslatedText(e.zeroNumberTextKey)}e.languageText=this._fillNumberToText(e.languageText)}if(e.display){var a=this.getDefaultValues(e);var n=this._getDateFormatter(false);if(e.display==="start"&&a[0]!==null){e.textValue=n.format(a[0].oDate)}else if(e.display==="range"&&a&&a[0]&&a[1]){e.textValue=n.format(a[0].oDate)+" - "+n.format(a[1].oDate)}}e.suggestText=e.languageText};S.prototype.isValidCondition=function(){var e=this.getCondition(),t=this.getOperation(e.operation);if(t&&e&&e.key&&e.operation){if("value1"in t&&"value2"in t){return"value1"in e&&e.value1!==null&&"value2"in e&&e.value2!==null}else if("value1"in t){return"value1"in e&&e.value1!==null}else if("value2"in t){return"value2"in e&&e.value2!==null}else if(!("value1"in t)&&!("value2"in t)){return true}}return false};S.prototype.hasSemanticDate=function(e){var t=this.getOperations();if(e.ranges[0].semantic&&e.ranges[0].semantic.operation){var a=0;for(a=0;a<t.length;a++){if(t[a].key.indexOf(e.ranges[0].semantic.operation)!==-1){return true}}return false}};S.prototype.hasCustomSemanticDate=function(e){return e.ranges[0]&&e.ranges[0].semantic&&e.ranges[0].semantic.operation&&e.ranges[0].semantic.operation!==this.getDefaultOperation().key};S.prototype.providerDataUpdated=function(e,t){};S.prototype.initialize=function(a){t.prototype.initialize.apply(this,[a]);this.oModel.suspend();var n=Object.assign({},a,true),i,r;var o=(new p).getCalendarType();if(!a.conditionTypeInfo){if(a.ranges&&a.ranges.length==1){var s;if(this.hasSemanticDate(a)&&!this._bSingleFilterRestriction){s=a.ranges[0].semantic.operation;if(a.ranges[0].semantic.value1||a.ranges[0].semantic.value1==0){i=a.ranges[0].semantic.value1}if(a.ranges[0].semantic.value2||a.ranges[0].semantic.value2==0){r=a.ranges[0].semantic.value2}if(this.getDefaultOperation().key===s){var l=this.getOperation(s),u=l&&l._getInitialValues?l._getInitialValues(a):null;if(!u){u=this.getDefaultValues(l)}if(u[0]&&u[0].oDate&&u[0].oDate.toISOString()!==a.ranges[0].value1||u[1]&&u[1].oDate&&u[1].oDate.toISOString()!==a.ranges[0].value2){s="DATERANGE"}}}else if(this.hasSemanticDate(a)&&this._bSingleFilterRestriction){s=a.ranges[0].semantic.operation;if(a.ranges[0].semantic.value1||a.ranges[0].semantic.value1==0){i=a.ranges[0].semantic.value1}a.ranges[0].value2=null;if(a.ranges[0].semantic.value2||a.ranges[0].semantic.value2==0){r=null}if(this.getDefaultOperation().key===s){var l=this.getOperation(s),u=l&&l._getInitialValues?l._getInitialValues(a):null;if(!u){u=this.getDefaultValues(l)}if(u[0]&&u[0].oDate&&u[0].oDate.toISOString()!==a.ranges[0].value1||u[1]&&u[1].oDate&&u[1].oDate.toISOString()!==a.ranges[0].value2){s="DATE"}if(u[0]&&u[0].oDate&&u[0].oDate.toISOString()===i){i=a.ranges[0].value1?a.ranges[0].value1:a.ranges[0].semantic.value1}}}else if(this.hasCustomSemanticDate(a)){this._customSemanticOperation=a.ranges[0].semantic.operation;if(this._bSingleFilterRestriction){s="DATE"}else{s="DATERANGE"}}else if(this._bSingleFilterRestriction){s="DATE"}else{s="DATERANGE"}if(a.ranges[0].operation==="GE"){s="FROM"}if(a.ranges[0].operation==="LE"){s="TO"}a.conditionTypeInfo={name:this.getName(),data:{key:this.sFieldName,operation:s,value1:i||i==0?i:a.ranges[0].value1,value2:r||r==0?r:a.ranges[0].value2,calendarType:o}}}else{var l=this.getDefaultOperation(),g=l?l.key:"";if(a.value1){var f=a.value1}if(a.value2){var c=a.value2}a.conditionTypeInfo={name:this.getName(),data:{key:this.sFieldName,operation:g,calendarType:o}};if(f){a.conditionTypeInfo.data.value1=f}if(c){a.conditionTypeInfo.data.value2=c}else if(a.conditionTypeInfo.data.operation==="DATERANGE"){a.conditionTypeInfo.data.operation="DATE"}}}if(a.conditionTypeInfo){a=a.conditionTypeInfo}if(a.name&&a.data){if(a.name!==this.getName()){T.debug("ConditionType "+this.getName()+" tries to deserialize data from "+a.name)}a=a.data}if(!a.operation){return}if(this.getOperation(a.operation)&&this.getOperation(a.operation).order<0){var v=["LAST2WEEKS","LAST3WEEKS","LAST4WEEKS","LAST5WEEKS"].indexOf(a.operation);if(v>=0){a.operation="LASTWEEKS";a.value1=v+2}v=["NEXT2WEEKS","NEXT3WEEKS","NEXT4WEEKS","NEXT5WEEKS"].indexOf(a.operation);if(v>=0){a.operation="NEXTWEEKS";a.value1=v+2}}var y=this.getOperation(a.operation);if(!y){if(this.getAsync()){this.setPending(true);var E=this,h=function(e){if(e.getParameter("pending")===false){E.oFilterProvider.detachPendingChange(h);E.initialize(n)}};this.oFilterProvider.attachPendingChange(h);this.oModel.resume();return}}var D;if(o!==a.calendarType&&(a.calendarType==="Islamic"||o==="Islamic")&&a.operation==="SPECIFICMONTH"){a.operation="DATERANGE";var m=parseInt(a.value1),I=p.getInstance(e.getInstance(),a.calendarType);I.setMonth(m);I=d.getMonthStartDate(I);D=d.getRange(0,"MONTH",I);a.value1=D[0].oDate.toISOString();a.value2=D[1].oDate.toISOString()}var A=this.getConditionContext().getObject();A.operation=a.operation;A.key=a.key;A.value1=null;A.value2=null;var S,R=this.oFieldMetadata&&this.oFieldMetadata.ui5Type;if(R&&R.isA("sap.ui.model.odata.type.String")){S=this.oFilterProvider._getType(Object.assign({},this.oFieldMetadata,{isCalendarDate:true,ui5Type:null}));R=S}if(a.operation==="DATERANGE"){if(typeof a.value1==="string"){if(this.oFieldMetadata&&this.oFieldMetadata.type==="Edm.String"){a.value1=R.formatValue(a.value1)}else{a.value1=a.value1===""?null:new p(a.value1).oDate}}if(typeof a.value2==="string"){if(this.oFieldMetadata&&this.oFieldMetadata.type==="Edm.String"){a.value2=R.formatValue(a.value2)}else{a.value2=a.value2===""?null:new p(a.value2).oDate}}A.value1=a.value1;A.value2=a.value2}else if(["DATE","FROM","TO"].indexOf(a.operation)!==-1){if(typeof a.value1==="string"){if(this.oFieldMetadata&&this.oFieldMetadata.type==="Edm.String"){a.value1=R.formatValue(a.value1)}else{a.value1=a.value1===""?null:new p(a.value1).oDate}}A.value1=a.value1}else if(["DATETIME","DATETIMERANGE"].indexOf(a.operation)!==-1){if(typeof a.value1==="string"){a.value1=a.value1===""?null:new p(a.value1).oDate}A.value1=a.value1;if(typeof a.value2==="string"){a.value2=a.value2===""?null:new p(a.value2).oDate}A.value2=a.value2}else if(["LASTMINUTES","LASTHOURS","LASTDAYS","LASTWEEKS","LASTMONTHS","LASTQUARTERS","LASTYEARS","NEXTMINUTES","NEXTHOURS","NEXTDAYS","NEXTWEEKS","NEXTMONTHS","NEXTQUARTERS","NEXTYEARS"].indexOf(a.operation)>-1){A.value1=a.value1}else if(a.operation==="SPECIFICMONTH"){A.value1=a.value1+""}else if(a.operation==="TODAYFROMTO"){A.value1=a.value1;A.value2=a.value2}else{y=this.getOperation(a.operation);D=y&&y._getInitialValues?y._getInitialValues(a):null;if(!D){D=this._getValuesFromCurrentOperation(a)}if(!D){D=this.getDefaultValues(y)}A.value1=D[0];A.value2=D[1]}this.bIgnoreBindingChange=true;this.oModel.resume();delete this.bIgnoreBindingChange;this.serialize(true,false);this._setDDROperation.call(this,a);if(S){S.destroy()}};S.prototype._getValuesFromCurrentOperation=function(e){var t=[];if(Number.isInteger(e.value1)){t.push(e.value1)}if(Number.isInteger(e.value2)){t.push(e.value2)}if(t.length>0){return t}return null};S.prototype.serialize=function(e,t){var a={},n=this.getCondition();if(!n.operation){return null}var i=this.getOperation(n.operation);if(!i||!("value1"in i)){n.value1=null}if(!i||!("value2"in i)){n.value2=null}n.calendarType=(new p).getCalendarType();a.conditionTypeInfo={name:this.getName(),data:n};if(this.iChangeTimer){clearTimeout(this.iChangeTimer);delete this.iChangeTimer}if(e){this._updateProvider(a,true,t)}else{this.iChangeTimer=setTimeout(this._updateProvider.bind(this,a,false,t),0)}return a};S.prototype._updateProvider=function(e,t,a){e.ranges=this.getFilterRanges();e.items=[];var n=false;var i=0;var r=0;var o=0;var s=this.oModel.getData(),l=s.currentoperation;if(this.oFieldMetadata&&this.oFieldMetadata.type==="Edm.String"&&e.ranges[0]){var u,p=this.oFieldMetadata.ui5Type;if(p.isA("sap.ui.model.odata.type.String")){u=this.oFilterProvider._getType(Object.assign({},this.oFieldMetadata,{isCalendarDate:true,ui5Type:null}));p=u}if(!l.type||!l.type.includes("int")){e.conditionTypeInfo.data.value1=p.parseValue(e.conditionTypeInfo.data.value1);e.conditionTypeInfo.data.value2=p.parseValue(e.conditionTypeInfo.data.value2)}e.ranges[0].value1=p.parseValue(e.ranges[0].value1);if(e.ranges[0].value2){e.ranges[0].value2=p.parseValue(e.ranges[0].value2)}if(u){u.destroy()}}if(l&&l.languageText){var g=l.languageText;if(this._isIntIntInterval(l)){if(e.conditionTypeInfo.data.value1!=null&&e.conditionTypeInfo.data.value1!==""&&e.conditionTypeInfo.data.value2!=null&&e.conditionTypeInfo.data.value2!==""){g=this._formatIntIntInterval(l,e)}}else if(this._isIntInterval(l)){if(e.conditionTypeInfo.data.value1!==null&&e.conditionTypeInfo.data.value1!==""){g=this._formatIntInterval(l,e)}else if(this._bSuggestItemSelected){g=this._fillNumberToText(l.basicLanguageText);var f=l.basicLanguageText.indexOf("{0}");i=f+1;r=f;o=f+1;n=true}else{g=""}}else if(this._isFixedRange(l)){g=this._formatFixedRange(l,l.textValue)}else{if(e.conditionTypeInfo.data.value1!==null&&e.conditionTypeInfo.data.value1!==""){var T=this._calculateDateRangeValueText(l,e);var d=T.value;n=T.bSetCursor;if(d){g=this._formatFixedRange(l,d);i=g.length-1}else{g=""}}else{g=""}}this._bSuggestItemSelected=false;this.oModel.setProperty("/formattedText",g);if(n&&this._oInput){this._oInput.$("inner").cursorPos(i);if(r<o){this._oInput.selectText(r,o)}this._oInput._lastValue=""}}if(this.oFilterProvider){this.oFilterProvider.oModel.setProperty("/"+this.sFieldName,e);this.oFilterProvider.setFilterData({},false,this.sFieldName,true);if(a&&this.oFilterProvider._oSmartFilter){this.oFilterProvider._oSmartFilter.fireFilterChange()}}};S.prototype.getFilterRanges=function(){var e,t=this.getCondition(),a=[],n;if(this._bSingleFilterRestriction){t.operation="EQ";delete t.value2}else if(t.operation==="LASTMINUTES"){if(!isNaN(t.value1)){a=d.ranges.lastMinutes(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="LASTHOURS"){if(!isNaN(t.value1)){a=d.ranges.lastHours(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="LASTDAYS"){if(!isNaN(t.value1)){a=d.ranges.lastDays(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="LASTWEEKS"){if(!isNaN(t.value1)){a=d.ranges.lastWeeks(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="LASTMONTHS"){if(!isNaN(t.value1)){a=d.ranges.lastMonths(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="LASTQUARTERS"){if(!isNaN(t.value1)){a=d.ranges.lastQuarters(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="LASTYEARS"){if(!isNaN(t.value1)){a=d.ranges.lastYears(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTMINUTES"){if(!isNaN(t.value1)){a=d.ranges.nextMinutes(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTHOURS"){if(!isNaN(t.value1)){a=d.ranges.nextHours(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTDAYS"){if(!isNaN(t.value1)){a=d.ranges.nextDays(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTWEEKS"){if(!isNaN(t.value1)){a=d.ranges.nextWeeks(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTMONTHS"){if(!isNaN(t.value1)){a=d.ranges.nextMonths(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTQUARTERS"){if(!isNaN(t.value1)){a=d.ranges.nextQuarters(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="NEXTYEARS"){if(!isNaN(t.value1)){a=d.ranges.nextYears(t.value1)}t.value1=a[0];t.value2=a[1]}else if(t.operation==="SPECIFICMONTH"){var i=parseInt(t.value1),r=new p;if(Number.isFinite(i)){r.setDate(1);r.setMonth(i);r=d.getMonthStartDate(r);a=d.getRange(0,"MONTH",r);t.value1=a[0];t.value2=a[1]}}else if(t.operation==="TODAYFROMTO"){if(!isNaN(parseInt(t.value1))){t.value1=this._getTodayFromToValueFrom(t.value1)}if(!isNaN(parseInt(t.value2))){t.value2=this._getTodayFromToValueTo(t.value2)}}else{var o=this.getOperation(t.operation);if(o&&o.getDateRange){n=o.getDateRange(t);if(!n){return[]}t.value1=n&&n.value1?n.value1:null;t.value2=n&&n.value2?n.value2:null}}if(t.value1 instanceof p){t.value1=t.value1.oDate}if(t.value2 instanceof p){t.value2=t.value2.oDate}if(t.operation==="DATE"){if(!(this.isValidCondition()&&t.value1)){return[]}t.operation="BT";t.value2=t.value1;t.value1=S.setStartTime(t.value1).oDate;t.value2=S.setEndTime(t.value2,this._bIgnoreTime,this._Precision).oDate}else if(t.operation==="FROM"){if(!(this.isValidCondition()&&t.value1)){return[]}t.operation="GE";delete t.value2;t.value1=S.setStartTime(t.value1,this._bIgnoreTime).oDate}else if(t.operation==="TO"){if(!(this.isValidCondition()&&t.value1)){return[]}t.operation="LE";delete t.value2;t.value1=S.setEndTime(t.value1,this._bIgnoreTime).oDate}else if(this._bSingleFilterRestriction){if(!(this.isValidCondition()&&t.value1)){return[]}}else if(t.operation==="DATETIME"){if(!(this.isValidCondition()&&t.value1)){return[]}t.operation="EQ";delete t.value2}else if(t.operation==="DATETIMERANGE"||t.operation==="LASTMINUTES"||t.operation==="LASTHOURS"||t.operation==="NEXTHOURS"||t.operation==="NEXTMINUTES"){if(!(this.isValidCondition()&&t.value1&&t.value2)){return[]}t.operation="BT"}else{if(n){t.operation=n.operation;t.value1=t.value1?S.setStartTime(t.value1).oDate:null;t.value2=t.value2?S.setEndTime(t.value2,this._bIgnoreTime).oDate:null}else{if(!(this.isValidCondition()&&t.value1&&t.value2)){return[]}t.operation="BT";t.value1=S.setStartTime(t.value1).oDate;t.value2=S.setEndTime(t.value2,this._bIgnoreTime).oDate}}t.exclude=false;t.keyField=t.key;delete t.key;if(t.value2){if(typeof t.value1.getTime==="function"&&typeof t.value2.getTime==="function"&&t.value1.getTime()>t.value2.getTime()){e=t.value2;t.value2=t.value1;t.value1=e}}return[t]};S.prototype.getTokenText=function(){return""};S.prototype.getName=function(){return this.getMetadata().getName()};S.prototype.getType=function(){return"Edm.Date"};S.prototype._bindValueState=function(e){e.bindProperty("valueState",{path:"$smartEntityFilter>inputstate",formatter:function(){if(this.getBinding("valueState").getValue()==="ERROR"){return I.Error}else{return I.None}}})};S.prototype.initializeFilterItem=function(){return this._initializeFilterItemNew.apply(this,arguments)};S.prototype._getDateFormatter=function(e){var t={style:this.oDateFormat.style,pattern:this.oDateFormat.pattern,strictParsing:e};if(JSON.stringify(t)!==this._sFormatSettings){this._sFormatSettings=JSON.stringify(t);this._oDateFormatter=g.getInstance(t)}return this._oDateFormatter};S.prototype._fillNumberToText=function(e,t,a){var n="X",i="Y";if(t||t===0){n=String(t)}if(a||a===0){i=String(a);if(t<0){n="("+n+")"}if(a<0){i="("+i+")"}}e=e.replace("{0}",n);e=e.replace("{1}",i);return e};S.prototype._setIntControlBinding=function(e,a,n){e.setFieldWidth("auto");e.bindProperty("description",{path:"$smartEntityFilter>"+n,type:"sap.ui.model.type.Integer",formatter:function(){var e=a.descriptionTextKeys[0];var n=a.descriptionTextKeys[1];if(this.getBinding("description").getValue()===1){return t.getTranslatedText(e)}else{return t.getTranslatedText(n||e)}}})};S.prototype._createIntFromToControl=function(e,a,n){return new o(t._createStableId(e,a),{value:{path:"$smartEntityFilter>"+n,type:new f({},{minimum:-e._maxIntValue,maximum:e._maxIntValue})},textAlign:"End",width:"100%"})};S.prototype._isValidFromToPeriod=function(e,t){if(!e&&e!==0||isNaN(e)){return false}if(!t&&t!==0||isNaN(t)){return false}if(e<-this._maxIntValue||e>this._maxIntValue){return false}if(t<-this._maxIntValue||t>this._maxIntValue){return false}if(e<0&&Math.abs(e)>Math.abs(t)||e===0&&t<0||t<0&&Math.abs(t)>Math.abs(e)||t===0&&e<0||e<0&&t<0){return false}return true};S.prototype._getTodayFromToValueFrom=function(e){if(e<0){var t=d.getRange(-1*e,"DAY")[1];t.setHours(0,0,0);return t}return d.getRange(-e,"DAY")[0]};S.prototype._getTodayFromToValueTo=function(e){if(e<0){var t=d.getRange(e,"DAY")[0];t.setHours(23,59,59);return t}return d.getRange(e,"DAY")[1]};S.prototype._getInputValueState=function(){if(this._oInput){return this._oInput.getValueState()}};S.prototype.destroy=function(){if(this.iChangeTimer){clearTimeout(this.iChangeTimer);delete this.iChangeTimer}t.prototype.destroy.apply(this,arguments)};S.prototype._initializeFilterItemNew=function(){var e={style:this.oDateFormat.style,pattern:this.oDateFormat.pattern,strictParsing:false};this._oInput=new c(t._createStableId(this),{name:this.sFieldName,formatter:y.getInstance({date:e}),enableGroupHeaders:!this._bSingleFilterRestriction,calendarWeekNumbering:this.oFilterProvider&&this.oFilterProvider._oCalendarWeekSettings?this.oFilterProvider._oCalendarWeekSettings:undefined,standardOptions:{path:"$smartEntityFilter>/operations",formatter:function(e){return e.reduce(function(e,t){if(A.includes(t.key)){e.push(t.key)}return e},[])}},change:this._onDDRChange.bind(this)});this._createCustomDDOptions(this.getOperations());this._oInput.setValue(this._getDefaultValueDDR());this._bindValueState(this._oInput);this._oInput.setBindingContext(this.getContext(),"$smartEntityFilter");this._oInput.setModel(this.getModel(),"$smartEntityFilter");this.bFireFilterChange=false;this.getModel().checkUpdate(true);this.bFireFilterChange=true;return this._oInput};S.prototype.updateOperations=function(){var e=this.getOperations();for(var t=0;t<e.length;t++){this._updateOperation(e[t])}this._createCustomDDOptions(e);this.oModel.setProperty("operations",e,this.getContext(),true);if(this._customSemanticOperation){var a=e.find(function(e){return e.key===this._customSemanticOperation}.bind(this));if(a){this.setOperation(this._customSemanticOperation);this._customSemanticOperation=null}}return};S.prototype.setCondition=function(e){t.prototype.setCondition.apply(this,arguments);this._setDDROperation.call(this,e);return this};S.prototype._onDDRChange=function(e){var t,a,n=e.getParameter("value"),i=e.getParameter("valid");if(i&&n){var r=this._getOptionName(n.operator);t=this.getOperation(r);a=this._prepareDDRValues(t,n,r);this.oModel.setProperty("/currentoperation",t);this.oModel.setProperty("/condition/operation",r);this.oModel.setProperty("/condition/value1",a[0]);this.oModel.setProperty("/condition/value2",a[1])}else if(i){t=this.getOperation("DATERANGE");this.oModel.setProperty("/currentoperation",t);this.oModel.setProperty("/condition/operation","DATERANGE");this.oModel.setProperty("/condition/value1",null);this.oModel.setProperty("/condition/value2",null)}e.getSource().setValueStateText("");this.oModel.setProperty("inputstate",i?"NONE":"ERROR",this.getContext())};S.prototype._getDefaultValueDDR=function(){var e=this.getDefaultOperation(),t=e&&e.key;if(!this._getDDROption(t)){return null}var a=typeof e.defaultValues==="function"?e.defaultValues():e.defaultValues;if(!A.includes(t)){t=this._getCustomDDOptionName(t)}if(Array.isArray(a)&&a.length>0&&a[0]!==null){return{operator:t,values:a}}return null};S.prototype._getDDROption=function(e){if(!this._oInput){return null}if(A.includes(e)){return this._oInput.getOption(e)}return this._oInput.getOption(this._getCustomDDOptionName(e))};S.prototype._getCustomDDOptionName=function(e){return this.sFieldName+"__custom__"+e};S.prototype._getOptionName=function(e){var t=e.split("__custom__");if(t.length>1){return t[1]}return t[0]};S.prototype._createCustomDDOptions=function(e){if(!this._oInput){return}var t=this._oInput.getValue();this._oInput.destroyAggregation("customOptions");e.forEach(this._createCustomDDOption,this);if(t&&!this._getDDROption(this._getOptionName(t.operator))){this._oInput.setValue(null);this._oInput._oInput.setValue(null);this.oModel.setProperty("/currentoperation",null);this.oModel.setProperty("/condition/value1",null);this.oModel.setProperty("/condition/value2",null)}};S.prototype._createCustomDDOption=function(e){if(A.includes(e.key)){return}var t;var a=typeof e.category==="object"?e.category.key:e.category;if(a.toLowerCase().startsWith("fixed")||e.type==="range"){t=this._createCustomFixedDDOption(e)}else{t=this._createCustomDynamicDDOption(e)}t.getGroupHeader=function(){if(typeof e.category==="object"){var t=e.category.bundle;var a=e.category.key;if(sap.ui.getCore().getLibraryResourceBundle(t).hasText(a)){return sap.ui.getCore().getLibraryResourceBundle(t).getText(a)}}if(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").hasText(e.category)){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText(e.category)}if(sap.ui.getCore().getLibraryResourceBundle("sap.m").hasText(e.category)){return sap.ui.getCore().getLibraryResourceBundle("sap.m").getText(e.category)}return sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("DDR_OPTIONS_GROUP_0")};t.getGroup=function(){return e.order};this._oInput.addAggregation("customOptions",t)};S.prototype._createCustomFixedDDOption=function(e){var a=this._getCustomDDOptionName(e.key);var n=this;var i=E.extend(a,{metadata:{library:"sap.ui.comp"},getText:function(){return e.languageText||t.getTranslatedText(e.textKey)},getValueHelpUITypes:function(){return[]},enhanceFormattedValue:function(){if(!n.getOperation(n._getOptionName(e.key))){return false}var t=typeof e.category==="object"?e.category.key:e.category;if(t.toUpperCase().startsWith("FIXED.")&&e.type==="int"){return false}return true},format:this._customDDOptionFormatter.bind(this),toDates:function(t){var a=e.defaultValues;if(typeof a==="function"){a=a()}if(t&&a.length>0&&!(a[0]instanceof Date)){var i=n.oModel.getProperty("",n.oConditionContext),r=i.operation,o=a[0],s=a[1];i.operation=n._getOptionName(t.operator);i.value1=!isNaN(a[0])?parseInt(a[0]):a[0];i.value2=!isNaN(a[1])?parseInt(a[1]):a[1];var l=n.getFilterRanges();i.operation=r;i.value1=o;i.value2=s;if(l.length===0){return[]}return[l[0].value1]}return a},parse:function(a){var n=e.basicLanguageText||e.languageText||t.getTranslatedText(e.textKey);if(a&&n&&n.toLowerCase().startsWith(a.toLowerCase())){return{operator:this.getKey(),values:this.toDates()}}return null}});return new i({key:a})};S.prototype._createCustomDynamicDDOption=function(e){var a=this._getCustomDDOptionName(e.key);var n=this;var i=E.extend(a,{metadata:{library:"sap.ui.comp"},getText:function(){var a=e.languageText||t.getTranslatedText(e.textKey);if(a.indexOf("{0}")>=0){return n._fillNumberToText(a)}return a},getValueHelpUITypes:function(){if(e.type==="int"){return[new h({type:"int"})]}else if(e.type==="[int,int]"){return[new h({type:"int"}),new h({type:"int"})]}},createValueHelpUI:function(t,a){t.aControlsByParameters={};t.aControlsByParameters[this.getKey()]=[];n.setControls([]);var i=n.getControls(e),r=e.defaultValues.length,o=e.defaultValues;if(typeof o==="function"){o=o()}i.forEach(function(e){if(!e.getValue()&&o&&o[0]){if(typeof o==="function"){o=o()}e.setValue(o[0]);o.shift();n.oModel.setProperty("/condition/value"+(r-o.length),e.getValue())}if(typeof a==="function"){e.attachChange(function(){a(this)},this)}t.aControlsByParameters[this.getKey()].push(e)},this);n.setControls(i);return i},format:this._customDDOptionFormatter.bind(this),toDates:function(e){var t=n.oModel.getProperty("",n.oConditionContext),a=t.operation,i=t.value1,r=t.value2;t.operation=n._getOptionName(e.operator);t.value1=!isNaN(e.values[0])?parseInt(e.values[0]):e.values[0];t.value2=!isNaN(e.values[1])?parseInt(e.values[1]):e.values[1];var o=n.getFilterRanges();t.operation=a;t.value1=i;t.value2=r;if(o.length===0){return[]}return[o[0].value1,o[0].value2]},parse:function(t){var a=new l({key:e.key}),i=e.filterSuggestItem.call(e,t,a,n);if(i){return{operator:this.getKey(),values:[a._value1,a._value2||null]}}return null},validateValueHelpUI:function(e){var t=function(e){var t=e.getValue(),a=this._maxIntValue,n=-this._maxIntValue;if(!t&&t!==0||isNaN(t)){return false}if(r&&r.getBindingInfo("value")&&r.getBindingInfo("value").type&&r.getBindingInfo("value").type.oConstraints){if(r.getBindingInfo("value").type.oConstraints.hasOwnProperty("minimum")){n=r.getBindingInfo("value").type.oConstraints.minimum}if(r.getBindingInfo("value").type.oConstraints.hasOwnProperty("maximum")){a=r.getBindingInfo("value").type.oConstraints.maximum}}if(t<n||t>a){return false}return true};var a=this.getValueHelpUITypes();for(var i=0;i<a.length;i++){var r=e.aControlsByParameters[this.getKey()][i];switch(a[i].getType()){case"int":return t.call(n,r);case"month":case"date":case"daterange":if(!r.getSelectedDates()||r.getSelectedDates().length==0){return false}break;case"options":if(r.getSelectedIndex()<0){return false}break}}return true}});return new i({key:a})};S.prototype._customDDOptionFormatter=function(e){var t=this._getOptionName(e.operator),a=this.getOperation(t);if(!a){this._oInput.setValue(null);this._oInput._oInput.setValue(null);this.oModel.setProperty("/currentoperation",null);this.oModel.setProperty("/condition/value1",null);this.oModel.setProperty("/condition/value2",null);return""}var n=this._prepareDDRValues(a,e,t);var i={conditionTypeInfo:{data:{value1:n[0],value2:n[1]}}};if(a.languageText){var r=a.languageText;if(this._isIntIntInterval(a)){if(i.conditionTypeInfo.data.value1!=null&&i.conditionTypeInfo.data.value1!==""&&i.conditionTypeInfo.data.value2!=null&&i.conditionTypeInfo.data.value2!==""){r=this._formatIntIntInterval(a,i)}}else if(this._isIntInterval(a)){if(i.conditionTypeInfo.data.value1!==null&&i.conditionTypeInfo.data.value1!==""){r=this._formatIntInterval(a,i)}else{r=""}}else if(this._isFixedRange(a)){r=this._formatFixedRange(a,a.textValue)}else{if(i.conditionTypeInfo.data.value1!==null&&i.conditionTypeInfo.data.value1!==""){var o=this._calculateDateRangeValueText(a,i);var s=o.value;if(s){r=this._formatFixedRange(a,s)}else{r=""}}else{r=""}}}return r};S.prototype._isIntInterval=function(e){return e.basicLanguageText.indexOf("{0}")>=0};S.prototype._formatIntInterval=function(e,t){if(t.conditionTypeInfo.data.value1===0&&e.zeroNumberTextKey){return e.zeroNumberLanguageText}if(t.conditionTypeInfo.data.value1===1&&e.singulareBasicLanguageText){return e.singulareBasicLanguageText}return this._fillNumberToText(e.basicLanguageText,t.conditionTypeInfo.data.value1)};S.prototype._isIntIntInterval=function(e){return e.basicLanguageText.indexOf("{0}")>=0&&e.basicLanguageText.indexOf("{1}")>=0};S.prototype._formatIntIntInterval=function(e,t){return this._fillNumberToText(e.basicLanguageText,t.conditionTypeInfo.data.value1,t.conditionTypeInfo.data.value2)};S.prototype._isFixedRange=function(e){return e.textValue};S.prototype._formatFixedRange=function(e,t){return e.languageText};S.prototype._calculateDateRangeValueText=function(e,t){var a=t.conditionTypeInfo.data.value1;var n=t.conditionTypeInfo.data.value2;var i;var r=false;if((typeof a==="number"||typeof a==="string"&&!isNaN(parseInt(a)))&&e.valueList){i=e.valueList[a].text}else if(a instanceof Date){var o=this._getDateFormatter(false);if(t.conditionTypeInfo.data.operation!=="DATERANGE"&&(a&&!n)){i=o.format(a)}else if(t.conditionTypeInfo.data.operation==="DATERANGE"&&a&&n){i=o.format(a)+" - "+o.format(n)}else if(t.conditionTypeInfo.data.operation==="DATERANGE"&&a&&!n){i=o.format(a)+" - ";r=true}else{i=""}}else{i=t.conditionTypeInfo.data.value1}return{value:i,bSetCursor:r}};S.prototype._convertUniversalDateToDate=function(e){return e.map(function(e){if(e.getJSDate){return e.getJSDate()}return e})};S.prototype._prepareDDRValues=function(e,t,a){if(a==="SPECIFICMONTH"){return[].concat(t.values)}var n=typeof e.category==="object"?e.category.key:e.category;if(e.type==="int"&&!n.toUpperCase().startsWith("FIXED.")){return[parseInt(t.values[0]),null]}if(e.type==="[int,int]"){return[parseInt(t.values[0]),parseInt(t.values[1])]}var i=this._oInput.toDates(t);if(this._bDTOffset&&(a==="DATETIME"||a==="DATETIMERANGE")){if(i[0]){i[0]=m.localToUiTimezone(i[0].oDate)}if(i[1]){i[1]=m.localToUiTimezone(i[1].oDate)}}return this._convertUniversalDateToDate(i)};S.prototype._setDDROperation=function(e){if(this._oInput&&e.key&&e.operation){var t=[];if(e.value1||e.value1===0){t[0]=e.value1;if(e.value2||e.value2===0){t[1]=e.value2}}var a=this._getDDROption(e.operation),n=this.getOperation(e.operation),i=function(e,t){if(!e){return false}if(e.hasOwnProperty("value1")&&!t[0]&&t[0]!==0){return false}if(e.hasOwnProperty("value2")&&!t[1]&&t[1]!==0){return false}return true};if(this._bDTOffset&&(a.getKey()==="DATETIME"||a.getKey()==="DATETIMERANGE")){if(t[0]){t[0]=m.uiTimezoneToLocal(t[0])}if(t[1]){t[1]=m.uiTimezoneToLocal(t[1])}}if(i(n,t)){this._oInput.setValue({key:e.key,operator:a.getKey(),values:t})}else{this._oInput.setValue(null);this._oInput._oInput.setValue(null)}}};return S});
//# sourceMappingURL=DateRangeType.js.map