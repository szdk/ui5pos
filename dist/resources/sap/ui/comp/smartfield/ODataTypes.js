/*
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/model/SimpleType","sap/ui/core/format/NumberFormat","sap/ui/model/odata/type/Boolean","sap/ui/comp/smartfield/type/Double","sap/ui/comp/smartfield/type/DateTime","sap/ui/comp/odata/type/StringDate","sap/ui/comp/odata/type/FiscalDate","sap/ui/comp/odata/type/NumericText","sap/ui/comp/smartfield/type/DateTimeOffset","sap/ui/model/odata/type/DateTimeWithTimezone","sap/ui/comp/smartfield/type/Decimal","sap/ui/comp/smartfield/type/Int16","sap/ui/comp/smartfield/type/Int32","sap/ui/comp/smartfield/type/Int64","sap/ui/comp/smartfield/type/Byte","sap/ui/comp/smartfield/type/SByte","sap/ui/comp/smartfield/type/String","sap/ui/comp/smartfield/type/StringNullable","sap/ui/comp/smartfield/type/TextArrangementString","sap/ui/comp/smartfield/type/TextArrangementGuid","sap/ui/comp/smartfield/type/AbapBool","sap/ui/comp/smartfield/type/Currency","sap/ui/comp/smartfield/type/Time","sap/ui/comp/smartfield/type/Guid","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/smartfield/type/Unit","sap/ui/comp/smartfield/type/IanaTextArrangement","sap/ui/comp/odata/type/CalendarDate","sap/ui/comp/odata/CalendarMetadata","sap/ui/comp/library"],function(e,t,r,n,a,i,o,s,p,u,l,m,c,f,y,g,d,h,C,v,T,D,F,_,x,w,S,b,O,A,E){"use strict";var I=E.numericEdmTypes;var N=function(e){this._oParent=e};N.prototype.getType=function(t,T,D,S){S=S||{};var E=this._oParent.getBindingInfo("value"),N=E&&E.binding&&E.binding.getType(),L=S.composite&&N instanceof e;if(N&&!L){return B(N)}if(t&&t.property&&t.property.type){if(!N){D=this.getConstraints(t.property,D);T=this.getFormatOptions(t.property,T)}if(I.indexOf(t.property.type)!==-1&&D.nullable===false){T.parseEmptyValueToZero=true}switch(t.property.type){case"Edm.Boolean":return new r(T,D);case"Edm.Double":return new n(T,D);case"Edm.Decimal":case"Edm.Single":return new l(T,this._getDecimalConstraints(t,D));case"Edm.Int16":return new m(T,D);case"Edm.Int32":return new c(T,D);case"Edm.Int64":return new f(T,D);case"Edm.Byte":return new y(T,D);case"Edm.SByte":return new g(T,D);case"Edm.DateTimeOffset":if(this.isWithTimeZone(t)){return new u(T)}return new p(T,D);case"Edm.DateTime":return new a(T,this._getDateTimeConstraints(t,D));case"Edm.String":var P=A.getCalendarAnnotationType(t.property);if(P){return new O(T,D,{calendarType:P})}if(this.isCalendarDate(t)){return new i(T)}var M=w.getFiscalAnnotationType(t.property);if(M){return new o(T,D,{fiscalType:M})}if(!N){D=this._getStringConstraints(t,D)}if(N&&!D){D=N.oConstraints}if(D&&D.isDigitSequence&&!S.composite){return new s(T,D)}if(S.composite&&this.isTimeZone(t)){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new b(T,D,this._getTextArrangementOptions(S))}if(S.composite){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new C(T,D,this._getTextArrangementOptions(S))}if(this.isTimeZone(t)){return new u(T)}if(t.isStringNullable){return new h(T,D)}return new d(T,D);case"Edm.Time":return new F(T,D);case"Edm.Guid":var V={},k=this._getTextArrangementFormatOptions();if(x.hasTextArrangementAnnotation(t.property)&&k&&k.textArrangement==="descriptionOnly"){V={validateException:{resourceBundle:"sap.ui.comp",text:"ENTER_AN_EXISTING_DESCRIPTION"}}}if(S.composite){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new v(T,D,this._getTextArrangementOptions(S))}return new _(T,D,V);default:return null}}return null};function B(e){var t=e.parseValue,r=e.destroy;e.parseValue=function(e,r){var n=t.apply(this,arguments);if(typeof this.oFieldControl==="function"){this.oFieldControl(e,r)}return n};e.destroy=function(){r.apply(this,arguments);this.oFieldControl=null};return e}N.prototype.getConstraints=function(e,t){return Object.assign({},t,{nullable:x.isNullable(e),skipDecimalsValidation:x.isSkippingMeasuredQuantityCheck(e)})};N.prototype.getFormatOptions=function(e,t){var r={};if(x.isUpperCase(e)){r.displayFormat="UpperCase"}return Object.assign({},t,r)};N.prototype._getDateTimeConstraints=function(e,t){var r={},n;if(e.property["sap:display-format"]==="Date"||this.isCalendarDate(e)){r={displayFormat:"Date"}}for(n in t){r[n]=t[n]}return r};N.prototype.getMaxLength=function(e,t){var r=[],n,a=0;if(t&&t.constraints){if(t.constraints.maxLength&&t.constraints.maxLength>-1){r.push(t.constraints.maxLength)}}if(t&&t.type&&t.type.oConstraints){if(t.type.oConstraints.maxLength&&t.type.oConstraints.maxLength>-1){r.push(t.type.oConstraints.maxLength)}}if(e&&e.property&&e.property.maxLength){var i=parseInt(e.property.maxLength);if(i>-1){r.push(i)}}var o=this._oParent.getMaxLength();if(o>0){r.push(o)}var s=r.length;while(s--){n=r[s];if(n>0){if(a>0){if(n<a){a=n}}else{a=n}}}return a};N.prototype._getDecimalConstraints=function(e,t){var r=e.property;t=t||{};if(r.precision){t.precision=parseInt(r.precision)}if(r.scale){t.scale=parseInt(r.scale)}if(r["sap:variable-scale"]){t.variableScale=r["sap:variable-scale"]==="true"}return t};N.prototype._getTextArrangementFormatOptions=function(){return{textArrangement:this._oParent.getControlFactory()._getDisplayBehaviourConfiguration()}};N.prototype._getStringConstraints=function(e,t){t=t||{};var r=this._oParent.getBindingInfo("value"),n=this.getMaxLength(e,r),a;if(r&&r.type&&r.type.oConstraints){if(r.type.oConstraints.equals){a=r.type.oConstraints.equals}}if(n>0||a){if(n>0){t.maxLength=n}if(a){t.equals=a}}if(x.isDigitSequence(e.property)){t.isDigitSequence=true}return t};N.prototype._getTextArrangementOptions=function(e){var t=this._oParent.getControlFactory().oTextArrangementDelegate;return{keyField:e.keyField,descriptionField:e.descriptionField,valueListNoValidation:e.valueListNoValidation,valueList:e.valueList,onBeforeValidateValue:t.onBeforeValidateValue.bind(t),delegate:e.delegate,clientSideMandatoryCheck:this._oParent.getClientSideMandatoryCheck()}};N.prototype.isCalendarDate=function(e){var t=e.property["com.sap.vocabularies.Common.v1.IsCalendarDate"];if(t&&t.Bool){return t.Bool?t.Bool!=="false":true}return false};N.prototype.isTimeZone=function(e){return e.property["com.sap.vocabularies.Common.v1.IsTimezone"]&&e.property["com.sap.vocabularies.Common.v1.IsTimezone"].Bool!=="false"};N.prototype.isWithTimeZone=function(e){return e.property["com.sap.vocabularies.Common.v1.Timezone"]?true:false};N.prototype.getDisplayFormatter=function(e,t){t=t||{};if(t.currency){return this.getCurrencyDisplayFormatter(t)}else if(t.type&&t.type.oConstraints&&t.type.oConstraints.scale&&e.scale){e.scale=t.type.oConstraints.scale}return this.getUOMDisplayFormatter(e,t)};N.prototype.getCurrencyDisplayFormatter=function(e){var t={showMeasure:false,emptyString:NaN},r;this._enhanceFormatOptions(t);r=new D(t);return function(t,n,a){var i,o,s,p,u,l=this&&this.oParent&&this.oParent.oParent,m=l&&l.isA("sap.ui.comp.smartfield.SmartField")&&l.isFormContextType();if(!t||!n||n==="*"){return""}if(!e.currency){i=t+=" ";return i}if(isNaN(parseFloat(t))){return t.toString()+" "}i=r.formatValue([t,n,a],"string");p=a&&a[n]&&a[n].digits;s=r&&r.oOutputFormat&&r.oOutputFormat.oLocaleData.getCurrencyDigits(n);o=p||s;if(o===0&&!m){i+=" "}u=3-o;if(u&&!m&&i){i=i.padEnd(i.length+u," ")}else{i+=" "}if(e.mask){return N.maskValue(i)}return i}};N.prototype.getUOMDisplayFormatter=function(e,t){var r={showMeasure:false,emptyString:NaN},n;this._enhanceFormatOptions(r);n=new S(r,{scale:e&&e.scale?e.scale:0});return function(e,r,a){var i,o,s=this&&this.oParent&&this.oParent.oParent,p=s&&s.isA("sap.ui.comp.smartfield.SmartField")&&s.isFormContextType();if(!e&&e!==0||!r&&r!==""||r==="*"){return""}if(isNaN(parseFloat(e))){return e.toString()+" "}i=n.formatValue([e,r,a],"string");o=a&&a[r]&&a[r].UnitSpecificScale;if((o===0||o===null)&&!p){i+=" "}if(!p&&s&&s.getControlContext&&s.getControlContext()===""&&i&&o){i=i.padEnd(i.length+1," ")}if(p){i+=" "}if(t&&t.mask){return N.maskValue(i)}return i}};N.maskValue=function(e){if(e){return e.replace(new RegExp(".","igm"),"*")}return e};N.prototype.getCurrencyType=function(e){if(e){var t=this._getDecimalConstraints(e),r=this.getConstraints(e.property,t),n=L(r),a=P(t);this._enhanceFormatOptions(n);return new D(n,this.getConstraints(e.property,a))}return null};N.prototype.getUoMType=function(e){var t=["edm.int16","edm.int32","edm.byte","edm.double"];if(e){var r=this._getDecimalConstraints(e),n=this.getConstraints(e.property,r),a=L(n);if(t.includes(e.property.type.toLowerCase())){a.parseAsString=false;n.type=e.property.type}this._enhanceFormatOptions(a);return new S(a,n)}return null};function L(e){var t=e.nullable?null:0;return{showMeasure:false,parseAsString:true,emptyString:t,precision:e.precision}}function P(e){return{precision:e.precision,scale:e.scale,variableScale:e.variableScale}}N.prototype.getAbapBoolean=function(){return new T};N.prototype.destroy=function(){this._oParent=null};N.prototype._enhanceFormatOptions=function(e){var t=this._getCustomDataConfiguration();if(typeof t.preserveDecimals==="boolean"){e.preserveDecimals=t.preserveDecimals}};N.prototype._getCustomDataConfiguration=function(){var e={},t;if(this._oParent){t=this._oParent.data("preserveDecimals");if(t){e.preserveDecimals=t==="true"}}return e};return N},true);
//# sourceMappingURL=ODataTypes.js.map