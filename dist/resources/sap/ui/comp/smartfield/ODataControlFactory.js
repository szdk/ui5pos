/*
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/library","sap/m/library","sap/ui/comp/library","sap/ui/model/BindingMode","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/ui/comp/smartfield/ComboBox","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/HBox","sap/m/Input","sap/m/Select","sap/m/Text","sap/m/ExpandableText","sap/ui/core/Configuration","sap/ui/core/Renderer","sap/ui/comp/navpopover/SmartLink","./ControlFactoryBase","./FieldControl","./ODataControlSelector","./ODataHelper","sap/ui/comp/odata/ODataModelUtilSync","./ODataTypes","./TextArrangementDelegate","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/m/TimePicker","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/comp/util/FormatUtil","sap/ui/comp/smartfield/Configuration","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/navpopover/NavigationPopoverHandler","sap/ui/core/InvisibleText","sap/base/Log","sap/base/assert","sap/base/security/URLListValidator","sap/base/util/merge","sap/base/strings/capitalize","sap/base/util/deepClone","sap/base/strings/whitespaceReplacer","sap/m/FlexItemData","sap/ui/comp/odata/CalendarMetadata"],function(t,e,a,o,i,r,n,s,l,p,u,h,d,g,c,m,y,_,f,M,v,D,C,P,T,b,x,S,I,V,F,A,E,O,B,L,N,w,U,H,k,R,j,W,z,q){"use strict";var G=t.ValueState;var K=t.TextAlign;var $=e.InputType;var J=e.EmptyIndicatorMode;var Q=e.FlexJustifyContent;var X=a.smartfield.CriticalityRepresentationType;var Y=a.smartfield.ControlContextType;var Z=t.TextDirection;var tt=e.FlexAlignContent;var et=a.smartfield.TextInEditModeSource;var at;var ot=M.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(t,e,a){var o;M.call(this,t,e);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=a;if(t){o=t}else if(a&&a.modelObject){o=a.modelObject}this._oHelper=new C(o,this._oBinding,null,true);this._oFieldControl=new v(e,this._oHelper);this._oTypes=new T(e);this._oSelector=new D(this._oMetaData,e,this._oTypes);this.oTextArrangementDelegate=new b(this);this.oValueListDelegate=null;this._bInitialized=false;this._bInitializeFromConfig=false;this.bPending=false;this.oMeasureField=null;at=sap.ui.require("sap/ui/comp/smartfield/SmartField");if(!at){throw new Error("SmartField module not loaded for "+this)}}});ot.prototype._checkBoxFlag=function(t){if(!t.type){return}if(t.type==="Edm.Boolean"){this._oParent._bEdmBoolDetected=true}};ot.prototype._findProperty=function(t,e){return t.parameter.find(function(t){return t.name===e})};ot.prototype._init=function(t){var e=t.entitySetObject||this._oHelper.oMeta.getODataEntitySet(t.entitySet),a=this._oMetaData.path===t.path&&this._oMetaData.entitySet&&e&&this._oMetaData.entitySet.name===e.name&&this._oMetaData.model===t.model,o;if(!e){o=this._oHelper.oMeta.getODataFunctionImport(t.entitySet);if(o){e=this._oHelper.oMeta.getODataEntitySet(o.entitySet)}}if(a){return}this._oMetaData.model=t.model;this._oMetaData.path=t.path;this._oMetaData.entitySet=e;if(this._oHelper.oMeta){U(this._oMetaData.entitySet,'The entity set named "'+t.entitySet+'" was not found in the "'+this._oHelper.oMeta.getODataEntityContainer().name+'" entity container of the service metadata document. - '+this.getMetadata().getName())}this._oMetaData.entityType=t.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=t.navigationPath||null;if(typeof t.ignoreInsertRestrictions==="boolean"){this._oMetaData.ignoreInsertRestrictions=t.ignoreInsertRestrictions}if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);var i=this.getEdmProperty();if(!i&&o){i=this._findProperty(o,t.path);if(i){this._oMetaData.property.property=i}}U(!!i,'The EDM property "'+t.path+'" was not found in the "'+this._oMetaData.entityType.namespace+"."+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(i){this._checkBoxFlag(i);if(!this._oParent._shouldSuppressTextAnnotation()){this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData)}this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=O.getSemanticObjectsFromProperty(i);this._oMetaData.annotations.semanticKeys=this._oHelper.getAnalyzer().getSemanticKeyAnnotation(this._oMetaData.entitySet.entityType);this._oMetaData._isNumber=O.isNumber(i);if(this._oMetaData.annotations.uom){this._oMetaData.annotations.uom.annotations={};this._oHelper.getValueListData(this._oMetaData.annotations.uom)}this._oHelper.getUOMTextAnnotation(this._oMetaData);if(this._oParent&&this._oParent.getExpandNavigationProperties&&this._oParent.getExpandNavigationProperties()){var r=this._oParent.getBindingContext(),n=r&&r.getObject(),s=n&&n.__metadata.created;if(!s){var l=this._oHelper.getAutoExpandProperties(i);if(l.length>0){this._oParent.bindElement({path:"",parameters:{expand:l,select:l}})}}}}}else{this._oMetaData.modelObject=t.modelObject;this._oMetaData.property=t.property;this._oMetaData.annotations.text=t.annotations.text;this._oMetaData.annotations.uom=t.annotations.uom;if(this._oMetaData.annotations.uom&&!this._oMetaData.annotations.uom.annotations){this._oMetaData.annotations.uom.annotations={}}if(t.annotations.valueListData){this._oMetaData.annotations.valuelist=t.annotations.valueListData}else{this._oMetaData.annotations.valuelist=t.annotations.valuelist}this._oMetaData.annotations.valuelistType=t.annotations.valuelistType;this._oMetaData.annotations.lineitem=t.annotations.lineitem;this._oMetaData.annotations.semantic=t.annotations.semantic;this._oMetaData.annotations.valuelistuom=t.annotations.valuelistuom}};ot.prototype._initValueList=function(t){var e=this._oMetaData.property,a=t.primaryValueListAnnotation;this._oMetaData.annotations.valueListData=a;e.valueListAnnotation=a;e.valueListKeyProperty=this._oHelper.getODataValueListKeyProperty(a);e.valueListEntitySet=this._oHelper.oMeta.getODataEntitySet(a.valueListEntitySetName);e.valueListEntityType=this._oHelper.oMeta.getODataEntityType(this._oHelper.oMeta.getODataEntitySet(a.valueListEntitySetName).entityType)};ot.prototype._getTextArrangementType=function(){var t=null,e=b.getPaths("ValueList",this._oMetaData);if(e.keyField&&e.descriptionField){t=this._oTypes.getType(this._oMetaData.property,null,null,{composite:true,keyField:e.keyField,descriptionField:e.descriptionField,valueListNoValidation:this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation"});if(!(t.isA("sap.ui.comp.smartfield.type.TextArrangementString")||t.isA("sap.ui.comp.smartfield.type.TextArrangementGuid"))){t=null}}return t};ot.prototype._createEdmDisplay=function(t){var e,a,o,i=this._getLocalTextAnnotation(),r=i&&i.path||null,n,s,l,p="getText",u=this,h={width:true,textAlign:true},d=this.getEdmProperty(),g=this._oParent.data("configdata"),_=this._oSelector.checkDatePicker()||(d?d.type.startsWith("Edm.Date"):false),f=d?d.type==="Edm.Time":false,M=d&&O.getIsTimezoneProperty(d);if(this._checkLink()&&!this._oSelector.useObjectIdentifier()){return this._createLink(_)}n=this.createAttributes(null,this._oMetaData.property,h);n.emptyIndicatorMode=J.Auto;this.oType=null;var v=d&&O.getTimezonePropertyPath(d)||false;if(d&&d.type==="Edm.DateTimeOffset"&&v){this.oType=this._getDateFormatType();var D=function(){if(!arguments[0]&&!(this.oType.oFormatOptions&&this.oType.oFormatOptions.showDate===false&&this.oType.oFormatOptions.showTime===false)){return""}return this.oType.formatValue(arguments,"string")};n.text={model:this._oMetaData.model,type:this.oType,parts:[{path:this._oMetaData.path,type:this.oType},{path:v,parameters:{useUndefinedForUnresolved:true}}],useRawValues:true,formatter:D.bind(this)}}else if(_||f){this.oType=this._getDateFormatType();n.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this.oType}}else if(M){this.oType=this._oTypes.getType(this._oMetaData.property,{showDate:false,showTime:false});n.text={model:this._oMetaData.model,parts:[{value:null},{path:this._oMetaData.path}],type:this.oType}}else{n.text={model:this._oMetaData.model,type:this.oType};if(this._bTextInDisplayModeValueList&&this._oMetaData.property&&this._oMetaData.property.valueListAnnotation){l={};if(this._oHelper.oAnnotation.isUpperCase(this._oMetaData.property.property)){l.sDisplayFormat="UpperCase"}l.valueListNoValidation=this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation";s=this.oTextArrangementDelegate.getBindingInfo(l);this.oType=s.type;n.text.parts=s.parts}if(!this.oType){this.oType=this._oTypes.getType(this._oMetaData.property);n.text.path=this._oHelper.getEdmDisplayPath(this._oMetaData)}n.text.type=this.oType}if(d){a=this._oHelper.oAnnotation.isMasked(d);if(a){n.text.formatter=T.maskValue}if(r){o=this._oSelector.useObjectIdentifier(_,a);if(o){delete n.width;delete n.textAlign;n.text={path:this._oMetaData.path};n.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};if(this._oParent.hasListeners("press")){n.titleActive=true;n.titlePress=function(t){u._oParent.firePress(t)}}else if(this._oMetaData.annotations.semantic&&this._oMetaData.annotations.semantic.defaultSemanticObject){var C;var P;var b=this._oMetaData.annotations.semantic.additionalSemanticObjects.concat(this._oMetaData.annotations.semantic.defaultSemanticObject);F.getDistinctSemanticObjects().then(function(t){C=F.hasDistinctSemanticObject(b,t);if(C){var e=u._oParent.getBindingInfo("value");var a=e.parts[0].path;P=new L({semanticObject:u._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:u._oMetaData.annotations.semantic.additionalSemanticObjects,fieldName:a,navigationTargetsObtained:function(t){var e=sap.ui.getCore().byId(t.getSource().getControl());var a=t.getParameters().mainNavigation;if(a){a.setDescription(e.getText())}t.getParameters().show(e.getTitle(),a,undefined,undefined)}})}});n.titleActive={path:"$sapuicompsmartfield_distinctSO>/distinctSemanticObjects",formatter:function(t){return F.hasDistinctSemanticObject(b,t)}};n.titlePress=function(t){if(C&&P){P.setControl(t.getSource(t.getParameter("domRef")));P.openPopover()}}}}else if(!(g&&g.isInnerControl===true)){n.text={};n.text.parts=[];n.text.parts.push(this._oMetaData.path);n.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));n.text.formatter=function(t,e){if(u.oType&&!u._bTextInDisplayModeValueList){t=u.oType.formatValue(t,"string")}if(u.oType&&u.oType.isA("sap.ui.comp.odata.type.NumericText")&&t===null&&e){t=""}return u._formatDisplayBehaviour(null,t,e)}}}else if(this._oSelector.checkCheckBox()){n.text.formatter=function(t){return u._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",t)}}}if(o){e=new S(this._oParent.getId()+"-objIdentifier",n);if(this._oMetaData.annotations.semantic){e.setModel(F.getJSONModel(),"$sapuicompsmartfield_distinctSO")}}else{if(n.text.type&&n.text.type.isA("sap.ui.comp.smartfield.type.DateTime")&&n.text.type.oConstraints&&n.text.type.oConstraints.isDateOnly){n.wrapping=false}if(this._oParent.isContextTable()&&y.getRTL()){n.textDirection="LTR"}if(typeof n.text.formatter==="undefined"&&!v&&!M){n.text.formatter=function(t){return W(t)}}if(this._oHelper.oAnnotation.isMultiLineText(d)){delete n.width;e=new m(this._oParent.getId()+"-expandableText",n)}else{e=new c(this._oParent.getId()+"-text",n)}}if(o&&g&&g.configdata&&g.configdata.onText){delete g.configdata.onText}var x={control:e,onCreate:"_onCreate",params:{getValue:p,noValidations:true,type:null}};if(this.oType){x.type={type:this.oType,property:this._oMetaData.property}}return x};ot.prototype._getDateFormatType=function(){var t=this.getFormatSettings("dateFormatSettings"),e=this.getEdmProperty(),a;try{a=j(t)}catch(e){a=t}if(a&&e&&e.type==="Edm.DateTimeOffset"){a.UTC=false}return this._oTypes.getType(this._oMetaData.property,a)};ot.prototype._createEdmTime=function(){var t=this.getFormatSettings("dateFormatSettings"),e={width:true,placeholder:true,valueState:true,valueStateText:true};var a=ot.getBoundPropertiesMapInfoForControl(V.getMetadata().getName(),{propertyName:"value"})[0];var o={valueFormat:"HH:mm:ss"};o=Object.assign(o,this.createAttributes(a,this._oMetaData.property,e,{event:"change",parameter:"value"}));if(o.width===""){o.width="100%"}if(t){o[a].type=this._oTypes.getType(this._oMetaData.property,t)}var i=new V(this._oParent.getId()+"-timePicker",o);this._enhanceInputControls(i);return{control:i,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:o.value.type,property:this._oMetaData.property}}}};ot.prototype._createObjectStatus=function(){var t=this.createAttributes(null,this._oMetaData.property,null),e=this._getLocalTextAnnotation();var a=ot.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];if(e){t[a]={parts:[this._oHelper.getEdmDisplayPath(this._oMetaData)]}}else{t[a]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)}}this._addObjectStatusAttributes(t);var o=new I(this._oParent.getId()+"-objStatus",t);return{control:o,onCreate:"_onCreate",params:{getValue:"getText",noValidation:true}}};ot.prototype._addObjectStatusAttributes=function(t){var e,a=this._oParent.getControlProposal(),o=a&&a.getObjectStatus();if(o){e=o.getBindingInfo("criticality")}var i=function(t){var e={0:G.None,1:G.Error,2:G.Warning,3:G.Success};var a={"com.sap.vocabularies.UI.v1.CriticalityType/Neutral":G.Neutral,"com.sap.vocabularies.UI.v1.CriticalityType/Negative":G.Warning,"com.sap.vocabularies.UI.v1.CriticalityType/Critical":G.Error,"com.sap.vocabularies.UI.v1.CriticalityType/Positive":G.Success};return a[t]||e[t]||G.None};var r=function(){var t={};t[G.Error]="sap-icon://error";t[G.Warning]="sap-icon://alert";t[G.Success]="sap-icon://sys-enter-2";t[G.None]=null;var a;if(e){if(e.formatter){a=e.formatter.apply(null,arguments)}else{a=arguments[0]}}else{a=o.getCriticality()}if(a===undefined||a===null){return null}return t[i(a)]};var n=function(){if(!o){return false}return o.getCriticalityRepresentationType()!==X.WithoutIcon};if(e){t.state={formatter:function(){var t;if(e.formatter){t=e.formatter.apply(null,arguments)}else{t=arguments[0]}return i(t)},parts:e.parts};if(n()){t.icon={formatter:r,parts:e.parts}}}else{if(o){t.state=i(o.getCriticality())}if(n()){t.icon=r()}}};ot.prototype._createInput=function(t){var e=new d(this._oParent.getId()+"-input",t);this._enhanceInputControls(e);return e};ot.prototype._enhanceInputControls=function(t){if(t.isA("sap.m.InputBase")&&typeof t._setPreferUserInteraction==="function"){t._setPreferUserInteraction(true)}};ot.prototype._createEdmString=function(t){var e={},a=t.mode,o={},i=this.isEmptyStringSignificant();if(this._oSelector.checkCheckBox()){return this._createCheckBox()}var r=this._oSelector.checkSelection();if(r.selection){return this._createSelect({valueHelp:ot.getValueHelpDropdownSettings(r)})}r=this._oSelector.checkComboBox(t);if(r.combobox){return this._createComboBox({valueHelp:ot.getValueHelpDropdownSettings(r),edit:true})}var n={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var s=this.getEdmProperty();if(this._oHelper.oAnnotation.isMultiLineText(s)){delete n["width"];return this._createMultiLineText({attributesNamesMap:n})}var l=this._oParent.isTextInEditModeSourceNotNone(),p=/Edm.String|Edm.Guid/.test(s.type);if(l||this._bTextInDisplayModeValueList){U(p,"The ValueList and NavigationProperty"+"members of the sap.ui.comp.smartfield.TextInEditModeSource enumeration are only supported for OData "+"EDM Properties typed as Edm.String or Edm.Guid. - "+this.getMetadata().getName())}var u=ot.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];var h=this._oParent._getComputedTextInEditModeSource(),g,c;if(this._oParent.data("defaultTextInEditModeSource")&&this._oParent.isPropertyInitial("textInEditModeSource")&&a==="edit"){g=true}if(p){this.oTextArrangementDelegate.bValidMetadata=this.oTextArrangementDelegate.checkRequiredMetadata(h,g);c=this._oHelper.checkValueListRequiredMetadataForValidation(this._oMetaData.property)}if(this.oTextArrangementDelegate.bValidMetadata){o=this.createAttributes("",this._oMetaData.property,n);e.valueListNoValidation=this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation";o[u]=this.oTextArrangementDelegate.getBindingInfo(e)}else if(h===et.ValueList&&c&&a==="edit"){o=this.createAttributes(u,this._oMetaData.property,n);o[u]=this.oTextArrangementDelegate.getBindingInfo(e)}else if(i){o=this.createAttributes(u,Object.assign({isStringNullable:true},this._oMetaData.property),n)}else{o=this.createAttributes(u,this._oMetaData.property,n)}if(B.isFiscalValue(s)){o.placeholder=o.value.type.formatter.getPattern();return{control:this._createInput(o),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:o.value.type,property:this._oMetaData.property}}}}if(q.isCalendarValue(s)){o.placeholder=o.value.type.formatter.getPattern();return{control:this._createInput(o),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:o.value.type,property:this._oMetaData.property}}}}var m=o.value.type&&o.value.type.oConstraints;if(m&&m.maxLength&&!O.isValueList(s)){o.maxLength=m.maxLength}var y=this._createInput(o);if(this._oHelper.oAnnotation.isMasked(s)){y.setType($.Password)}var _=this.getCustomDataConfiguration();if(this.oTextArrangementDelegate.bValidMetadata){this._handleEventingForTextArrangement({control:y})}else{this._handleEventingForEdmString({control:y,edmProperty:this._oMetaData.property.property,currency:_&&_.currency})}return{control:y,onCreate:"_onCreate",params:{valuehelp:{annotation:r.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:o.value.type,property:this._oMetaData.property,emptyStringSignificant:i}}}};ot.prototype.isEmptyStringSignificant=function(){var t=this.getEdmProperty(),e=t&&(t["sap:semantics"]==="currency-code"||t["sap:semantics"]==="unit-of-measure"),a=this._getDisplayBehaviourConfiguration(),o=a==="descriptionAndId"||a==="idAndDescription"||false,i=this._oMetaData.annotations&&this._oMetaData.annotations.valueListData,r=i&&i.descriptionField!==undefined;return o&&!e&&r||false};ot.prototype.getLocalTextPropertyName=function(){var t,e=this._oHelper.getAnalyzer(),a=this.getEdmProperty();if(e&&a){t=e.getDescriptionFieldName(a)}return t};ot.getValueHelpDropdownSettings=function(t){return{annotation:t.annotation,noDialog:true,noTypeAhead:true}};ot.prototype._getMaxLength=function(){return this._oTypes.getMaxLength(this._oMetaData.property,this._oParent.getBindingInfo("value"))};ot.prototype._addAriaLabelledBy=function(t){var e,a,o,i=this._oParent.getControlContext();if(i===Y.None||i===Y.Form||i===Y.SmartFormGrid){M.prototype._addAriaLabelledBy.apply(this,arguments);o=this._oParent.data("configdata");if(o&&o.configdata.isInnerControl){if(t){a=t.control;if(a instanceof h){if(a.getItems().length>0){a=a.getItems()[0]}}}if(a&&a.getAriaLabelledBy&&a.getAriaLabelledBy().length===0){var r=this.getEdmProperty();if(this._oHelper.oAnnotation.getLabel(r)){e=new N({text:this._oHelper.oAnnotation.getLabel(r)});a.addAriaLabelledBy(e);this._oParent.addAggregation("_ariaLabelInvisibleText",e)}}}}};ot.prototype._addAriaDescribedBy=function(){var t=this._oParent.getControlContext();if(t===Y.None||t===Y.Form||t===Y.SmartFormGrid){M.prototype._addAriaDescribedBy.apply(this,arguments)}};ot.prototype._handleEventingForEdmString=function(t){var e=t.control;if(!e){return}e.attachChange(function a(o){var i=this._getChangeEventParams(o),r=o&&o.getParameters(),n=o&&o.getSource();if(r){var s=r.value;i.value=s;i.newValue=s;if(e._oSuggestionPopup&&e._oSuggestionPopup.isOpen()){if(!r.validated){return}}if(t.currency){var l=this.getCurrencyValidationSettings();l.oSource=n;if(this._oHelper.oAnnotation.isUpperCase(t.edmProperty)&&s){s=s.toUpperCase();e.setValue(s)}}try{this._oParent.fireChange(i)}catch(t){w.error(t)}}}.bind(this))};ot.prototype._handleEventingForTextArrangement=function(t){var e=t.control;if(!e){return}e.attachChange(function(t){var a=this._getChangeEventParams(t),o=e._oSuggPopover,i=e.getShowSuggestion(),r=i&&o.isOpen(),n=false;if(r){var s=o.getItemsContainer&&o.getItemsContainer();n=s&&s.getSelectedItem()!==null}if(r&&(!a.validated&&n)){return}try{var l=this._oParent.data("configdata");if(l&&l.configdata&&this._oParent.isTextInEditModeSourceNotNone()){this._oParent.checkValuesValidity().catch(function(){}).finally(function(){this._oParent.fireChange(a)}.bind(this))}else{this._oParent.fireChange(a)}}catch(t){w.error(t)}}.bind(this))};ot.prototype.getUOMChangeHandler=function(t){return function(e){try{var a=t.smartFieldRootControl,o=e.getParameters(),i=o.value,r=e.getSource(),n=t.currency,s=n?this.getCurrencyValidationSettings(t):this.getUnitValidationSettings(t);s.oSource=r;n?this.updateModelPropertiesForCurrency("value",s):this.updateModelPropertiesForUnit("value",s);a.fireChange({value:i,newValue:i,unitChanged:!!t.unit,validated:!!o.validated})}catch(e){if(e.validationUnitError){a.fireChange({value:i,newValue:i,unitChanged:!!t.unit,validated:!!o.validated})}w.error(e)}}.bind(this)};ot.prototype.getCurrencyValidationSettings=function(t){var e;if(t){e=t.smartFieldRootControl}else{var a=this.getCustomDataConfiguration();e=a&&a.smartFieldRootControl}var o=e.getInnerControls();return{amountField:o[0],currencyField:o[1],errorState:e._oError,checkValidity:e.checkValuesValidity.bind(e),rootControl:e}};ot.prototype.getUnitValidationSettings=function(t){var e;if(t){e=t.smartFieldRootControl}else{var a=this.getCustomDataConfiguration();e=a&&a.smartFieldRootControl}var o=e.getInnerControls();return{measureField:o[0],unitField:o[1],errorState:e._oError,checkValidity:e.checkUnitValidity.bind(e),rootControl:e}};ot.prototype.updateModelPropertiesForCurrency=function(t,e){var a=e.amountField,i=e.currencyField,r=e.oSource,n=a.getValue(),s,l="";if(i){var p=i.getMetadata().getName();s=ot.getBoundPropertiesMapInfoForControl(p,{propertyName:t})[0];var u="get"+R(s);l=i[u]()}var h=[n,l];var d={rawValues:h,handleSuccess:false};var g=e.checkValidity(d);function c(e){var l=a.getModel(),p=a.getBinding(t),u,d;if(i){u=i.getBinding(s);d=u.getType()}var g=p.getType(),c=p.getExternalValue(),m=u&&u.getExternalValue(),y=g.parseValue(n,"string",h),_=y[1],f=g.formatValue(y,"string"),M=d&&d.formatValue(_,"string");if(l.getDefaultBindingMode()===o.TwoWay){if(!e){p.setValue(y)}}if(!e){a.setValue(f)}var v=false,D=true;if(p.hasValidation()&&!e){var C={element:a,property:t,type:g,newValue:f,oldValue:c,mParameters:{originSource:r}};a.fireValidationSuccess(C,v,D)}if(u&&u.hasValidation()){var P={element:i,property:s,type:d,newValue:M,oldValue:m,mParameters:{originSource:r}};i.fireValidationSuccess(P,v,D)}}function m(t){}function y(){var o=e.errorState;if(o.bComplex&&o.bFirst&&o.bSecond){var r=a.getBinding(t).getExternalValue();h=[r,l];var n={rawValues:h,innerControls:[i],handleSuccess:false};var s=e.checkValidity(n);s.then(function(){return c.call(this,true)}.bind(this)).catch(m)}}g.then(function(){return c()}).catch(m).finally(y)};ot.prototype.updateModelPropertiesForUnit=function(t,e){var a=e.measureField,i=e.unitField,r=a.getValue(),n,s="",l=e.oSource,p=a.getMetadata().getName(),u,h,d={},g,c;if(i){var m=i.getMetadata().getName();n=ot.getBoundPropertiesMapInfoForControl(m,{propertyName:t})[0];var y="get"+R(n),_=i.getParent();if(i.isA("sap.m.ComboBox")){s=i.getSelectedKey()}else if(this._getDisplayBehaviourConfiguration()&&_&&(!_.getEditable()||_._oFactory._getTextArrangementType())){s=_.getBinding("value").getValue()}else{s=i[y]()}}else if(this._checkSuppressUnit()){var f=this.getMetaData().annotations.uom.path,M=a.getBindingContext();s=this._oModel.getData(f,M)}var v=[r,s];var D={rawValues:v,handleSuccess:false};var C=e.checkValidity(D);if(C){var P=a.getModel(),T=a.getBinding(t),b,x;if(i){b=i.getBinding(n);x=b.getType()}var S=T.getType(),I=S.parseValue(r,"string",v),V=I[1],F,A;if(V===undefined&&i&&!i.getEditable){F=S.formatValue([I[0],null],"string");A=V}else{F=S.formatValue(I,"string");if(!T.isA("sap.ui.comp.smartfield.type.Unit")){V=s}A=x&&x.formatValue(V,"string")}if(P.getDefaultBindingMode()===o.TwoWay){T.setValue(I);u=false;h=true;d=ot.getBoundPropertiesMapInfoForControl(p,{propertyName:"value"});g=d&&d[0];c={element:a,property:g,type:T.getType(),newValue:r,oldValue:T.getValue(),mParameters:{originSource:l}};a.fireValidationSuccess(c,u,h)}a.setValue(F);if(i&&i.getEditable&&i.getEditable()&&i.getParent().getVisible()&&!i.isA("sap.m.ComboBox")){i.setValue(A)}}};ot.prototype._createComboBox=function(t){var e=null,a=this._oSelector&&this._oSelector._oParent&&this._oSelector._oParent.oParent&&this._oSelector._oParent.oParent.isA("sap.ui.comp.smartmultiedit.Field")||this._oParent&&this._oParent.getFixedValueListValidationEnabled&&this._oParent.getFixedValueListValidationEnabled(),o=a?s:l,i=this._oParent._getComputedTextInEditModeSource(),r=i==="ValueList"?"realValue":"value",n=a?"value":r,p={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true},u,h={},d={width:"100%"},g=false;u=ot.getBoundPropertiesMapInfoForControl(o.getMetadata().getName(),{propertyName:n})[0];h["change"]=this._oHelper.getDropdownChangeHandler(this._oParent,!a);if(t.edit){if(a){h=Object.assign(h,this.createAttributes(u,this._oMetaData.property,p),d);e=new s(this._oParent.getId()+"-comboBoxEdit",h)}else{if(O.getIsTimezoneProperty(this._oMetaData.property)){h=Object.assign(h,this.createAttributes(u,this._oMetaData.property,p),d)}else{g=true;h=Object.assign(h,this.createAttributes(u,Object.assign({isStringNullable:true},this._oMetaData.property),p),d)}e=new l(this._oParent.getId()+"-comboBoxEdit",h)}this._enhanceInputControls(e);e.attachChange(function(){this._oParent.oValidation.handleComboValidation(e)}.bind(this))}else{h=Object.assign(h,this.createAttributes(u,this._oMetaData.property,p),d);e=this._createDisplayedComboBox(h)}this._oParent.oValidation.addValidationToType(h[u].type);e.setFilterFunction(function(t,e){RegExp.escape=function(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};var a=RegExp.escape(t);var o=new RegExp(a,"i");return e.getText().match(new RegExp(o,"i"))||e.getKey().match(new RegExp(o,"i"))});e.useHighlightItemsWithContains=function(){return true};return{control:e,onCreate:"_onCreate",params:{valuehelp:{annotation:t.valueHelp.annotation,aggregation:"items",noDialog:t.valueHelp.noDialog,noTypeAhead:t.valueHelp.noTypeAhead},getValue:"get"+u[0].toUpperCase()+u.slice(1),type:{type:h[u].type,property:this._oMetaData.property,emptyStringSignificant:g}}}};ot.prototype._createDisplayedComboBox=function(t){var e=s.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp",properties:{wrapping:{type:"boolean",group:"Appearance",defaultValue:true}}},renderer:{apiVersion:2,render:function(t,e){var a=e.getWidth(),o=e.getValue(),i=e.getTextDirection(),r=e.getTextAlign(),n=e.getTooltip_AsString(),s=e.getWrapping();t.openStart("span",e);t.class("sapMText");t.class("sapUiSelectable");if(s){if(o&&o.length>0&&!/\s/.test(o)){t.class("sapMTextBreakWord")}}else{t.class("sapMTextNoWrap")}if(a&&o!==""){t.style("width",a)}else{t.class("sapMTextMaxWidth")}if(i!==Z.Inherit){t.attr("dir",i.toLowerCase())}if(n){t.attr("title",n)}if(r){r=_.getTextAlign(r,i);if(r){t.style("text-align",r)}}var l=s?"sapMTextRenderWhitespaceWrap":"sapMTextRenderWhitespace";t.class(l);t.openEnd();o.replace(/\r\n|\n\r|\r/g,"\n");t.text(o);t.close("span")}},updateDomValue:function(t){if(!this.isActive()){return this}t=this._getInputValue(t);if(this.$().text()!==t){this.$().text(t);this._bCheckDomValue=true}return this},getValue:function(){return this.getProperty("value")},getFocusDomRef:function(){return this.getDomRef()},getEditable:function(){return false}});return new e(this._oParent.getId()+"-comboBoxDisp",t)};ot.prototype._createSelect=function(t){var e={width:true,name:true,valueState:true},a;var o=ot.getBoundPropertiesMapInfoForControl(g.getMetadata().getName(),{propertyName:"value"})[0];var i={change:this._oHelper.getDropdownChangeHandler(this._oParent),forceSelection:false};i=Object.assign(i,this.createAttributes(o,this._oMetaData.property,e));if(i.width===""){i.width="100%"}a=new g(this._oParent.getId()+"-select",i);this._enhanceInputControls(a);return{control:a,onCreate:"_onCreate",params:{valuehelp:{annotation:t.valueHelp.annotation,aggregation:"items",noDialog:t.valueHelp.noDialog,noTypeAhead:t.valueHelp.noTypeAhead},getValue:"getSelectedKey",type:{type:i.selectedKey.type,property:this._oMetaData.property}}}};ot.prototype._createCheckBox=function(){var t=ot.getBoundPropertiesMapInfoForControl(n.getMetadata().getName(),{propertyName:"value"})[0];var e=this.createAttributes(t,null,{},{event:"select",parameter:"selected"});e.editable=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable();e.selected.type=this._oTypes.getAbapBoolean();return{control:new n(this._oParent.getId()+"-cBox",e),onCreate:"_onCreate",params:{getValue:"getSelected"}}};ot.prototype._createEdmDateTime=function(){var t=this.getFormatSettings("dateFormatSettings"),e,a,o;var i={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var r=this.createAttributes(null,this._oMetaData.property,i,{event:"change",parameter:"value"});if(this._oSelector.checkDatePicker()){e=ot.getBoundPropertiesMapInfoForControl(p.getMetadata().getName(),{propertyName:"value"})[0];r[e]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,t,{displayFormat:"Date"}),model:this._oMetaData.model,mode:this._oParent.getBindingMode("value")};if(t&&t.style){r.displayFormat=t.style}o=new p(this._oParent.getId()+"-datePicker",r);this._enhanceInputControls(o);return{control:o,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:r.value.type,property:this._oMetaData.property}}}}e=ot.getBoundPropertiesMapInfoForControl(u.getMetadata().getName(),{propertyName:"value"})[0];r[e]={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,t),mode:this._oParent.getBindingMode("value")};a=new u(this._oParent.getId()+"-input",r);this._enhanceInputControls(a);return{control:a,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:r.value.type,property:this._oMetaData.property}}}};ot.prototype._createEdmDateTimeOffset=function(){var t,e=this.getFormatSettings("dateFormatSettings"),a=this.getEdmProperty(),o;try{t=j(e)}catch(a){t=e}if(t){t.UTC=false}var i=ot.getBoundPropertiesMapInfoForControl(u.getMetadata().getName(),{propertyName:"value"})[0];var r={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var n=this.createAttributes(null,this._oMetaData.property,r,{event:"change",parameter:"value"});var s=a&&O.getTimezonePropertyPath(a)||false;if(s){if(e&&e.showTimezone===false){n.showTimezone=false}else{n.showTimezone=true}if(t&&t.style){n.displayFormat=t.style}if(t&&t.pattern){n.displayFormat=t.pattern}this.oType=this._oTypes.getType(this._oMetaData.property,t);n[i]={model:this._oMetaData.model,type:this.oType,parts:[{path:this._oMetaData.path,parameters:{useUndefinedForUnresolved:true},type:this.oType},{path:s,parameters:{useUndefinedForUnresolved:true}}],useRawValues:true,mode:this._oParent.getBindingMode("value")}}else{n[i]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,t),mode:this._oParent.getBindingMode("value")}}o=new u(this._oParent.getId()+"-input",n);this._enhanceInputControls(o);return{control:o,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:n.value.type,property:this._oMetaData.property}}}};ot.prototype._createEdmNumeric=function(t){var e=this._oSelector.checkComboBox(t),a=t?t.mode:undefined,o;if(e.combobox){return this._createComboBox({valueHelp:{annotation:e.annotation,noDialog:true,noTypeAhead:true},edit:true})}var i={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var r=ot.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];var n=this.createAttributes(r,this._oMetaData.property,i,{event:"change",parameter:"value"});if(this._oParent.isContextTable()&&y.getRTL()){n.textDirection="LTR"}o=this._createInput(n);if(a==="edit"&&this._oParent.isFormContextType()){o.setTextAlign(K.End)}return{control:o,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:n.value.type,property:this._oMetaData.property}}}};ot.prototype._createEdmUOM=function(t){var e=t.mode,a=this._oParent.getEntitySet(),o=ot.getBoundPropertiesMapInfoForControl(at.getMetadata().getName(),{propertyName:"value"})[0],i=this._getPropertyBindingMode(o),r=this.getEdmProperty(),n=this._oMetaData.annotations.uom.property.property,s=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(r,n);var l={currency:s,edmProperty:n,bindingMode:i};var p=this._createEdmUOMAttributes(l),u=y.getRTL(),d=u&&this._oParent.isContextTable(),g=this._oParent.getId(),c;if(d){p.textDirection="LTR"}var m=this._createInput(p);this.oMeasureField=m;if(e==="edit"&&this._oParent.isFormContextType()){m.setTextAlign(K.End)}if(this._oParent.data("suppressUnit")==="true"){var _={getValue:"getValue"};if(!s){_.type={type:p.value.type,property:this._oMetaData.property}}return{control:m,onCreate:"_onCreate",params:_}}if(!s){c={type:p.value.type,property:this._oMetaData.property}}var f={textAlign:this._getEdmUOMTextAlignment()};if(i==="TwoWay"){f.change=this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:s,unit:true})}var M=this._oHelper.getUOMPath(this._oMetaData);f[o]={model:this._oMetaData.model,path:M,mode:i};this.mapBindings(f,ot._getEmbeddedSmartFieldMapSettings(),t);if(this._oParent.getConfiguration()){f.configuration=new E({preventInitialDataFetchInValueHelpDialog:this._getPreventInitialDataFetchInVHDialog()})}if(a){f.entitySet=a}var v=new at(g+"-sfEdit",f),D=this;v.data("configdata",{configdata:{currency:s,smartFieldRootControl:this._oParent,measureField:this.oMeasureField,isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:M,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,valuelistType:this._oMetaData.annotations.uom.annotations.valuelistType,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(t){D._updateStaticAmountInputFlexItemData(m);D._updateStaticUOMTextFlexItemData(v);D._updateInnerControl(t,{RTLInTable:d})},onInput:function(t){var e=v&&!v.getVisible();D._updateDynamicAmountInputFlexItemData(m,{isfullWidth:e});D._updateStaticUOMInputFlexItemData(v);D._updateInnerControl(t,{RTLInTable:d})}}});v.data("errorCheck","setComplexClientErrorSecondOperandNested");if(v.getVisible()){m.addStyleClass("smartFieldPaddingRight")}m.addStyleClass("sapUiCompSmartFieldValue");var C=new h({justifyContent:Q.End,items:[m,v],fitContainer:true,width:this._oParent.getWidth()});C.addStyleClass("sapUiCompUOM");C.enhanceAccessibilityState=function(t,e){this._oParent.enhanceAccessibilityState(t,e)}.bind(this);if(this._oParent.isContextTable()){if(d){C.addStyleClass("sapUiCompDirectionLTR")}C.addStyleClass("sapUiCompUOMInTable");if(e!=="edit"){C.addStyleClass("sapUiCompUOMInTableDisplay")}}return{control:C,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:c}}};ot.prototype._createEdmUOMAttributes=function(t){t=t||{};var e=this.createUOMDefaultAttributes(t);var a=ot.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];var i=t.bindingMode||"TwoWay";var r=t.currency||this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property);e[a]={mode:o.OneWay,model:this._oMetaData.model,parts:[{mode:i,path:this._oMetaData.path},{mode:i,path:this._oHelper.getUOMPath(this._oMetaData)},{mode:"OneTime",path:r?"/##@@requestCurrencyCodes":"/##@@requestUnitsOfMeasure",targetType:"any"}],type:r?this._oTypes.getCurrencyType(this._oMetaData.property):this._oTypes.getUoMType(this._oMetaData.property)};return e};ot.prototype.createUOMDefaultAttributes=function(t){return{textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),valueState:this.getValueStateBindingInfoForRecommendationStateAnnotation(),change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:t.currency})}};ot.prototype._getEdmUOMTextAlignment=function(){var t=this.getAttribute("textAlign");if(!t){t=K.Initial}if(t===K.Initial){if(this._oParent.isContextTable()){return K.End}return K.Begin}return t};ot.prototype._createEdmUOMDisplay=function(t){var e=this,a=this._oParent.getEntitySet(),o=this._oHelper.getUOMPath(this._oMetaData),i=this._getEdmUOMTextAlignment(),r=null,n=this.getEdmProperty(),s=y.getRTL(),l=s&&this._oParent.isContextTable(),p=this._oHelper.oAnnotation.isCurrency(n),u=ot.getBoundPropertiesMapInfoForControl(at.getMetadata().getName(),{propertyName:"value"})[0],d=this._getPropertyBindingMode(u)||"TwoWay";var g=ot.getBoundPropertiesMapInfoForControl(c.getMetadata().getName(),{propertyName:"value"})[0];var m={textAlign:i};m[g]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:o},{mode:"OneTime",path:p?"/##@@requestCurrencyCodes":"/##@@requestUnitsOfMeasure",targetType:"any"}],model:this._oMetaData.model,formatter:this._oTypes.getDisplayFormatter(n,{currency:p,mask:this._oHelper.oAnnotation.isMasked(n),type:this._oTypes.getType(this._oMetaData.property)}),useRawValues:true};if(l){m.textDirection="LTR"}var _=new c(this._oParent.getId()+"-text",m);o=this._oHelper.getUOMPath(this._oMetaData);m={textAlign:this._getEdmUOMTextAlignment()};if(d==="TwoWay"){m.change=this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:p,unit:true})}g=ot.getBoundPropertiesMapInfoForControl(at.getMetadata().getName(),{propertyName:"value"})[0];m[g]={model:this._oMetaData.model,path:o,mode:this._getPropertyBindingMode(g)};this.mapBindings(m,ot._getEmbeddedSmartFieldMapSettings(),t);_.addStyleClass("sapUiCompSmartFieldValue");_.addStyleClass("smartFieldUoMAmountDisplayText");_.addStyleClass("smartFieldPaddingRight");if(this._checkSuppressUnit()){return{control:_}}if(a){m.entitySet=a}r=new at(this._oParent.getId()+"-sfDisp",m);r.data("configdata",{configdata:{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:o,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(t){if(t&&t.setWrapping){t.setWrapping(false)}e._updateInnerControl(t,{RTLInTable:l})},onInput:function(t){e._updateInnerControl(t,{RTLInTable:l})},getContextEditable:function(){return e._oParent.getContextEditable()}}});r.data("errorCheck","setComplexClientErrorSecondOperandNested");var f=new h({alignItems:tt.Center,items:[_,r],fitContainer:true,width:this._oParent.getWidth()});f.enhanceAccessibilityState=function(t,e){this._oParent.enhanceAccessibilityState(t,e)}.bind(this);if(this._oParent.isContextTable()){f.setJustifyContent("End");this._oParent.addStyleClass("sapUiCompUOMInTable");if(l){f.addStyleClass("sapUiCompDirectionLTR")}f.addStyleClass("sapUiCompUOMInTable")}return{control:f}};ot.prototype._createEdmUOMObjectStatus=function(){var t,e=this.getEdmProperty(),a=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(e),o=this._oTypes.getDisplayFormatter(e,{currency:a}),i=this._oHelper.getUOMPath(this._oMetaData),r={};var n=ot.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];r[n]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:i},{mode:"OneTime",path:a?"/##@@requestCurrencyCodes":"/##@@requestUnitsOfMeasure",targetType:"any"}],formatter:function(){var t=o.apply(this,arguments);return t+arguments[1]},useRawValues:true};this._addObjectStatusAttributes(r);t=new I(this._oParent.getId()+"-objStatus",r);t.addStyleClass("sapUiCompUOM");return{control:t}};ot.prototype._createEdmUOMObjectNumber=function(){var t,e,a=this._getEdmUOMTextAlignment();var o=ot.getBoundPropertiesMapInfoForControl(x.getMetadata().getName(),{propertyName:"value"});if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property)){t={model:this._oMetaData.model,textAlign:a};t[o[0]]={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)},{mode:"OneTime",path:"/##@@requestCurrencyCodes",targetType:"any"}],type:this._oTypes.getCurrencyType(this._oMetaData.property)};t[o[1]]={path:this._oHelper.getUOMPath(this._oMetaData)}}else{t={model:this._oMetaData.model,textAlign:a};t[o[0]]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};t[o[1]]={path:this._oHelper.getUOMPath(this._oMetaData)}}e=new x(this._oParent.getId()+"-objNumber",t);e.addStyleClass("sapUiCompUOM");return{control:e}};ot.prototype._createEdmSemantic=function(){var t=this,e=this._oParent.getBindingPath("value"),a=this.getEdmProperty(),o=this._getLocalTextAnnotation(),i=o&&o.path||null;var r={semanticObject:this._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:this._oMetaData.annotations.semantic.additionalSemanticObjects,fieldName:e,width:this.getAttribute("width"),createControlCallback:function(){var t=this.createControl(true);if(t){return t.control}return null}.bind(this)};this.oType=this._oTypes.getType(this._oMetaData.property);if(i){r.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],model:this._oMetaData.model,formatter:function(e,a){if(t.oType){e=t.oType.formatValue(e,"string")}if(t.oType&&t.oType.isA("sap.ui.comp.odata.type.NumericText")&&e===null&&a){e=""}if(e&&a){return t._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",e,a)}return e?e:""}};r.navigationTargetsObtained=function(e){var a=this.getBinding("text");if(!Array.isArray(a.getValue())){e.getParameters().show();return}var o=a.getValue();var i=t._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")||"idOnly";var r=A.getTextsFromDisplayBehaviour(i,o[0],o[1]);var n=e.getParameters().mainNavigation;if(n){n.setDescription(r.secondText)}e.getParameters().show(r.firstText,n,undefined,undefined)}}else{var n=this._oHelper.getUOMPath(this._oMetaData);if(n){r.text={parts:[{path:e},{path:n}],model:this._oMetaData.model,formatter:this._oHelper.oAnnotation.isCurrency(a,this._oMetaData.annotations.uom.property.property)?A.getAmountCurrencyFormatter():A.getMeasureUnitFormatter(),useRawValues:true};r.uom={path:n}}else{r.text={path:e,model:this._oMetaData.model,type:this.oType}}}return{control:new f(this._oParent.getId()+"-sl",r),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}}};ot.prototype._createMultiLineText=function(t){var e=ot.getBoundPropertiesMapInfoForControl(i.getMetadata().getName(),{propertyName:"value"})[0];var a=this.createAttributes(e,this._oMetaData.property,t.attributesNamesMap);var o=this.getFormatSettings("multiLineSettings");a=k(a,o);if(this._oParent.isContextTable()){a.width="100%"}var r=new i(this._oParent.getId()+"-textArea",a);this._enhanceInputControls(r);this._handleEventingForEdmString({control:r,edmProperty:this._oMetaData.property.property});return{control:r,onCreate:"_onCreate",params:{type:{type:a.value.type,property:this._oMetaData.property},getValue:"getValue"}}};ot.prototype._createLink=function(t){var e=this,a=this._oParent,o=a.getBindingInfo("url");var i={text:"",href:""};var n=ot.getBoundPropertiesMapInfoForControl(r.getMetadata().getName(),{propertyName:"url"})[0];if(o){i[n]=this._oBinding.toBinding(o)}else{i[n]=a.getUrl()}if(a.hasListeners("press")){i.press=function(t){t.preventDefault();a.firePress(t)}}var s=a.getBindingInfo("value");var l=ot.getBoundPropertiesMapInfoForControl(r.getMetadata().getName(),{propertyName:"value"});if(s){var p=this._oMetaData,u=p.path,h=p.property.property;if(p.annotations.text&&h.type==="Edm.String"){i[l[0]]={parts:[p.path,this._oHelper.getEdmDisplayPath(p)],formatter:this._formatText.bind(e)}}else if(ot.isSpecialLink(h)){var d=ot[ot._getLinkFormatterFunctionName(h)];i[l[0]]={path:u};i[l[1]]={path:u,formatter:null};if(typeof d==="function"){i[l[1]].formatter=d}}else if(t){i[l[0]]={path:u,type:this._getDateFormatType()}}else{i[l[0]]=this._oBinding.toBinding(s)}}else{i[l[0]]=a.getValue()}return{control:new r(a.getId()+"-link",i),onCreate:"_onCreate",params:{noValidation:true}}};ot.prototype._createEdmBoolean=function(t){var e=this._oSelector.checkComboBox(t),a=t.mode==="edit",o=this,i=null,r;if(e.combobox){if(a||this._oParent.getFetchValueListReadOnly()){return this._createComboBox({valueHelp:{annotation:e.annotation,noDialog:true,noTypeAhead:true},edit:a})}}var s,l;if(a){l=ot.getBoundPropertiesMapInfoForControl(n.getMetadata().getName(),{propertyName:"value"})[0];s=this.createAttributes(l,this._oMetaData.property,{},{event:"select",parameter:"selected"});r=new n(this._oParent.getId()+"-cBoxBool",s);i={getValue:"getSelected"}}else{l=ot.getBoundPropertiesMapInfoForControl(c.getMetadata().getName(),{propertyName:"value"})[0];s=this.createAttributes(l,this._oMetaData.property,{width:true,textAlign:true});s[l]={model:this._oMetaData.model,path:this._oMetaData.path,formatter:function(t){return o._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",t)}};r=new c(this._oParent.getId()+"-text",s)}return{control:r,onCreate:"_onCreate",params:i}};ot.prototype._createValueHelp=function(){var t=this._oParent.getContent();if(!t){return}var e={annotation:this._oMetaData.annotations.valuelist,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"};this._getValueHelpDialogTitle(e);e.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:t,edmProperty:this.getEdmProperty(),valueHelp:e,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(t){this._oParent.fireValueListChanged({changes:t.mParameters.changes})}.bind(this)})};ot.prototype.getValueListProviderConfiguration=function(t){var e=M.prototype.getValueListProviderConfiguration.apply(this,arguments);if(this._oHelper.oAnnotation.isUpperCase(this._oMetaData.property.property)){e.displayFormat="UpperCase"}return e};ot.prototype._checkSuppressUnit=function(){if(this._oParent.data("suppressUnit")==="true"){return true}var t=this._oParent.getBindingInfo("uomVisible");return!t&&!this._oParent.getUomVisible()};ot.prototype.getEdmProperty=function(){var t=this._oHelper;if(t){return t.getEdmProperty(this._oMetaData)}return null};ot.prototype.getEntityType=function(){if(this._oMetaData){return this._oMetaData.entityType}return null};ot.prototype._checkLink=function(){var t=this._oParent.getBindingInfo("url"),e=this.getEdmProperty();if(t||this._oParent.getUrl()||ot.isSpecialLink(e)){return true}return this._oParent.hasListeners("press")};ot._getEmbeddedSmartFieldMapSettings=function(){return{uomEditable:"editable",uomEnabled:"enabled",uomVisible:"visible",mandatory:"mandatory",contextEditable:"contextEditable"}};ot.getBoundPropertiesMapInfoForControl=function(t,e){e=e||{};var a=null;switch(t){case"sap.m.Input":case"sap.m.TimePicker":case"sap.m.DatePicker":case"sap.m.DateTimePicker":case"sap.m.TextArea":a={value:["value"]};break;case"sap.m.Text":case"sap.m.ObjectIdentifier":case"sap.ui.comp.navpopover.SmartLink":a={value:["text"]};break;case"sap.m.Link":a={url:["href"],value:["text","href"]};break;case"sap.m.ObjectStatus":a={value:["text","state","icon"]};break;case"sap.m.ObjectNumber":a={value:["number","unit"]};break;case"sap.m.Select":case"sap.m.ComboBox":case"sap.ui.comp.smartfield.DisplayComboBox":a={value:["selectedKey"]};break;case"sap.ui.comp.smartfield.ComboBox":a={value:["enteredValue"],realValue:["realValue"]};break;case"sap.m.CheckBox":a={value:["selected"]};break;case"sap.ui.comp.smartfield.SmartField":var o=Object.keys(at.getMetadata().getProperties());a={};o.forEach(function(t,e,o){a[t]=[o[e]]});break}if(a&&e.propertyName){return a[e.propertyName]||null}return a};ot.isSpecialLink=function(t){return O.isEmailAddress(t)||O.isPhoneNumber(t)||O.isURL(t)};ot._getLinkFormatterFunctionName=function(t){return"_format"+O.getLinkDisplayFormat(t)};ot._formatEmailAddress=function(t){return"mailto:"+t};ot._formatPhoneNumber=function(t){return"tel:"+t};ot._formatURL=function(t){return H.validate(t)?t:""};ot.prototype._formatText=function(t,e){if(t&&e){var a=this._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",t,e);return W(a)}return t||""};ot.prototype._getCreator=function(t){return this._oSelector.getCreator(t)};ot.prototype._onCreate=function(t,e){var a,o,i,r=true,n=this;if(e){if(e.noValidation){r=false}if(e.valuehelp){this._getValueHelpDialogTitle(e.valuehelp);e.valuehelp.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:t,edmProperty:this.getEdmProperty(),valueHelp:e.valuehelp,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(t){n._oParent.fireValueListChanged({changes:t.mParameters.changes})}})}if(e.getValue){o=e.getValue;e.getValue=function(){return t[o]()}}if(e.type){a=e.type.emptyStringSignificant||false;i=this._oFieldControl.getMandatoryCheck(e.type.property,a);if(i){e.type.type.oFieldControl=i}}}if(r){this.addValidations(t,this._oParent.data("errorCheck")||"setSimpleClientError")}if(!this._checkUOM()){t.addStyleClass("sapUiCompSmartFieldValue")}};ot.prototype._checkUOM=function(){var t=this._oParent.data("configdata");if(t&&t.configdata){if(t.configdata.onInput||t.configdata.onText){return true}}return false};ot.prototype.getValueStateBindingInfoForRecommendationStateAnnotation=function(t,e,a){t=t||this.getEdmProperty();var o=t&&t["com.sap.vocabularies.UI.v1.RecommendationState"];if(!o){return null}U(!(o.Path===undefined),'Missing "Path" attribute of the "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+t.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());U(!(o.Path===""),'Missing path name of "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+t.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());e=e||this._oHelper.findProperty(this._oMetaData.entityType.property,o.Path);U(!!e,'The EDM property was not found in the "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(e&&e.type==="Edm.Byte"){return{model:a||this._oMetaData.model,path:o.Path,formatter:ot.formatRecommendationState}}U(e&&e.type==="Edm.Byte",'The EDM property "'+e.name+'" of "'+this._oMetaData.entityType.name+'" entity type must be typed as Edm.Byte. - '+this.getMetadata().getName());return null};ot.formatRecommendationState=function(t){t=String(t);switch(t){case"0":return G.None;case"1":return G.Information;case"2":return G.Warning;default:return G.None}};ot.prototype._updateDynamicAmountInputFlexItemData=function(t,e){var a=t.getLayoutData()||new z,o="sapUiCompSmartFieldFlexItemAmountEdit",i="";if(a){if(e.isfullWidth){o="sapUiCompSmartFieldFlexItemAmountNoUnitEdit";i="100%"}a.setGrowFactor(1);a.setMaxWidth(i);a.setStyleClass(o);a.setMinWidth("0")}t.setLayoutData(a)};ot.prototype._updateStaticAmountInputFlexItemData=function(t){var e=t.getLayoutData()||new z;if(e){e.setGrowFactor(1);e.setMaxWidth("");e.setStyleClass("")}t.setLayoutData(e)};ot.prototype._updateStaticUOMInputFlexItemData=function(t){var e=t.getLayoutData()||new z;if(e){e.setShrinkFactor(1);e.setGrowFactor(0);e.setStyleClass("sapUiCompSmartFieldFlexItemUnitEdit");e.setMinWidth("")}t.setLayoutData(e)};ot.prototype._updateStaticUOMTextFlexItemData=function(t){var e=t.getLayoutData()||new z;if(e){e.setShrinkFactor(0);e.setGrowFactor(0);e.setStyleClass("sapUiCompSmartFieldUOMDisplayText");e.setMinWidth("auto")}t.setLayoutData(e)};ot.prototype._updateInnerControl=function(t,e){var a=e.RTLInTable,o,i;if(t){o=typeof t.getParent==="function"?t.getParent():{};i=o&&o.getInnerControls?o.getInnerControls():[];if(a&&typeof t.setTextDirection==="function"){t.setTextDirection("LTR")}t.addStyleClass("sapUiCompSmartFieldUnit");if(i.length>0&&i[0].getEditable&&i[0].getEditable()===true){t.addStyleClass("sapUiCompSmartFieldFlexItemUnitEdit")}}};ot.prototype._getValueHelpDialogTitle=function(t){t.dialogtitle=this._oParent.getComputedTextLabel();if(!t.dialogtitle){var e=this.getEdmProperty();t.dialogtitle=this._oHelper.oAnnotation.getLabel(e)||e.name}};ot.prototype._onCreateUOM=function(t,e){var a=t.getItems(),o;this.addValidations(a[0],"setComplexClientErrorFirstOperand");if(e&&e.getValue){e.getValue=function(){return a[0].getValue()}}e.uom=function(){return a[1].getValue()};e.uomset=function(t){a[1].setValue(t)};if(e.type){o=this._oFieldControl.getMandatoryCheck(e.type.property);if(o){e.type.type.oFieldControl=o}}};ot.prototype.triggerCreationOfControls=function(){try{this._setUOMEditState();this._oFieldControl.bindProperties({metadata:this._oMetaData});this._addLabelAndQuickInfo();if(this._oParent.isContextTable()&&this._oMetaData._isNumber==undefined){this._oMetaData._isNumber=O.isNumber(this._oMetaData.property.property)}}catch(t){w.error(t,null,this.getMetadata().getName())}};ot.prototype._checkTextInDisplayModeValueList=function(t){var e=this._oHelper.getValueListAnnotationPath(this._oMetaData),a=this.getEdmProperty();return!!(this._oMetaData.annotations&&this._oMetaData.annotations.valuelist!==undefined&&this._getDisplayBehaviourConfiguration()&&(this._oMetaData.property&&(this._oMetaData.property.property.type==="Edm.String"||this._oMetaData.property.property.type==="Edm.Guid"))&&t.mode==="display"&&this._oParent.getFetchValueListReadOnly()&&e&&!(this._oParent.getExpandNavigationProperties&&this._oParent.getExpandNavigationProperties())&&!this._oHelper.startWithNavigationProperty(e,this._oMetaData)&&!this.isValueInitialWithTextArrangement(a)&&this._getDisplayBehaviourConfiguration()!=="idOnly")};ot.prototype.isValueInitialWithTextArrangement=function(t){var e=this._getLocalTextAnnotation();return this._oParent._isValueInitial()&&e};ot.prototype._hasBoundFieldControl=function(){var t=this._oFieldControl.getPropertyNames();for(var e=0;e<t.length;e++){if(this._oParent.getBinding(t[e])){return true}}return false};ot.prototype.bind=function(t){var e=t.mode,t=t||{};this._bTextInDisplayModeValueList=this._checkTextInDisplayModeValueList(t);if(!(!this._bInitialized&&!this.bPending)&&(!t.rebind&&!this._bTextInDisplayModeValueList)){return Promise.resolve({skipInit:this._bInitializeFromConfig})}this._bInitialized=true;var a=this._oParent.data("configdata");if(a&&a.configdata){try{this._init(this._oMeta);if(this._oMetaData&&this._oMetaData.annotations&&typeof a.configdataVL==="function"){this._bInitializeFromConfig=true;return a.configdataVL().then(function(t){this._initValueList(t);return Promise.resolve({fetchIDAndDescription:true})}.bind(this)).catch(function(t){return Promise.resolve()})}}catch(t){if(t){w.error(t,null,this.getMetadata().getName()+".onMetaModelLoaded")}}return Promise.resolve()}if(!this._oModel){return Promise.reject()}var o=!!(this._oParent&&this._oParent.isTextInEditModeSourceNotNone());if(!o&&this._oModel.bMetaModelLoaded&&(e!=="display"||!this._oParent.getFetchValueListReadOnly())){try{this._init(this._oMeta)}catch(t){if(t){w.error(t,null,this.getMetadata().getName()+".onMetaModelLoaded")}}return Promise.resolve()}this.bPending=true;return this._metadataInitialise().then(function t(){if(!this._oParent){this.bPending=false;return Promise.reject()}this._init(this._oMeta);if(e!=="display"&&o||this._bTextInDisplayModeValueList){var a=this._oMetaData.annotations.valuelist;if(typeof a==="string"){var i=this._oParent&&this._oParent.getBindingContext()&&this._oParent.getBindingContext().getPath();return this._oHelper.loadValueListAnnotation(a,i)}else{this.bPending=false;return Promise.reject()}}this.bPending=false}.bind(this)).then(function t(e){var a={fetchIDAndDescription:false};if(!o&&!this._bTextInDisplayModeValueList||!this._oParent){return}this.bPending=false;if(e){this._initValueList(e)}if(e&&this.oTextArrangementDelegate){a.fetchIDAndDescription=true}return a}.bind(this)).catch(function(t){if(t){w.error(t,null,this.getMetadata().getName()+".onMetaModelLoaded");this._oParent._rejectLifecyclePromises("Metadata loading problem.")}}.bind(this))};ot.prototype._metadataInitialise=function(){return Promise.resolve().then(function(){if(this._oParent._bMetaModelLoadAttached){return this._oModel.getMetaModel().loaded()}else{return P.handleModelInit(this._oParent,function(){},true)}}.bind(this)).catch(function(t){w.error("The meta model could not be loaded.",t,this.getMetadata().getName())}.bind(this))};ot.prototype._addLabelAndQuickInfo=function(){var t=this.getDataProperty();t=t.property;var e=this._oHelper.oAnnotation.getLabel(t);var a=this._oHelper.oAnnotation.getQuickInfo(t);if(e){this._oParent._sAnnotationLabel=e}if(a&&this._oParent.isPropertyInitial("tooltipLabel")){this._oParent.setTooltipLabel(a)}};ot.prototype.rebindOnCreated=function(){var t,e=this._oFieldControl.getControlFormatters(this._oMetaData,["editable"]);for(var a in e){t=this._oBinding.fromFormatter(this._oMetaData.model,e[a]);this._oParent.bindProperty(a,t)}};ot.prototype._setUOMEditState=function(){if(this._oFieldControl.hasUomEditState(this._oMetaData)){var t=this._oFieldControl.getUOMEditState(this._oMetaData);if(t){var e=this._oBinding.fromFormatter(this._oMetaData.model,t);this._oParent.bindProperty("uomEditState",e)}}};ot.prototype.getDataProperty=function(){return this._oMetaData.property};ot.prototype.getDropdownItemKeyType=function(t){var e=t.getMetadata().getName();if(e==="sap.ui.comp.smartfield.DisplayComboBox"||e==="sap.m.ComboBox"||e==="sap.ui.comp.smartfield.ComboBox"||e==="sap.m.Select"){var a=ot.getBoundPropertiesMapInfoForControl(e,{propertyName:"value"})[0];var o=t.getBindingInfo(a);return o&&o.type||null}return null};ot.prototype.getMetaData=function(){return this._oMetaData};ot.prototype.getODataHelper=function(){return this._oHelper};ot.prototype._getChangeEventParams=function(t){var e,a={},o=t&&t.getParameters();if(o){e=o.value;a.value=e;a.newValue=e;if(o.validated){a.validated=o.validated}}else{a=t}return a};ot.prototype._getPropertyBindingMode=function(t){var e=typeof this._oParent.getBinding==="function"&&this._oParent.getBinding(t);return e&&typeof e.getBindingMode==="function"&&e.getBindingMode()||"TwoWay"};ot.prototype._getLocalTextAnnotation=function(){var t=this.getMetaData(),e=t&&t.annotations&&t.annotations.text||null;return e};ot.prototype.fetchIDAndDescriptionCollectionIfRequired=function(t){var e=t.mode==="edit"&&this._isFixedList();if(this.oValueListDelegate&&e){this.oValueListDelegate.fetchIDAndDescriptionCollectionIfRequired()}else if(this.oTextArrangementDelegate){this.oTextArrangementDelegate.fetchIDAndDescriptionCollectionIfRequired(t)}};ot.prototype._isFixedList=function(){var t=this.getMetaData();return t&&t.annotations&&t.annotations.valuelistType==="fixed-values"};ot.prototype.destroy=function(){if(this._oFieldControl){this._oFieldControl.destroy()}if(this._oSelector){this._oSelector.destroy()}if(this._oTypes){this._oTypes.destroy()}if(this._oHelper){this._oHelper.destroy()}if(this.oType){this.oType.destroy();this.oType=null}if(this.oValueListDelegate){this.oValueListDelegate.destroy()}if(this.oTextArrangementDelegate){this.oTextArrangementDelegate.destroy()}this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;this.oMeasureField=null;this.oTextArrangementDelegate=null;M.prototype.destroy.apply(this,arguments)};return ot},true);
//# sourceMappingURL=ODataControlFactory.js.map