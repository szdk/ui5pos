/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/date/UI5Date","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/odata/ODataType","sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat","sap/ui/core/format/TimezoneUtil","sap/base/Log"],function(e,a,t,i,n,r,l,s){"use strict";var o=e.smartfilterbar.FilterType;var u=e.valuehelpdialog.ValueHelpRangeOperation;var g=e.ANALYTICAL_PARAMETER_PREFIX;var d=function(){};d.prototype.convert=function(e,a,t,i,n,r,l){var s,o,u,g,f=null,p,h;var c={SelectionVariantID:e};if(r){c.ParameterContextUrl=r}if(l){c.FilterContextUrl=l}this._sAPILevel=n;if(t&&a){u=JSON.parse(t);if(u){s=this._getFields(a);if(s&&s.length>0){for(o=0;o<s.length;o++){this._convertField(c,s[o],u,i)}}if(u._CUSTOM){if(typeof u._CUSTOM==="string"){g=JSON.parse(u._CUSTOM)}else{g=u._CUSTOM}for(f in g){if(f){if(Array.isArray(g[f])&&g[f].length>1){this._addArrayOfSingleValues(c,f,g[f])}else{this._addSingleValue(c,f,d._getValue(g[f],true))}}}}if(i&&i.getBasicSearchName){p=i.getBasicSearchName();if(p){h=i.getBasicSearchValue();this._addSingleValue(c,p,d._getValue(h,true))}}}}return JSON.stringify(c)};d.prototype._getParameterMetaData=function(e,a){var t,i,n;var r=a.getFilterBarViewMetadata();if(r){for(t=0;t<r.length;t++){n=r[t];for(i=0;i<n.fields.length;i++){if(e===n.fields[i].fieldName){return n.fields[i]}}}}if(a.getAnalyticalParameters){var l=a.getAnalyticalParameters();if(l){for(i=0;i<l.length;i++){if(e===l[i].fieldName){return l[i]}}}}return null};d.prototype._convertField=function(e,a,t,r){var l,s,u=null,g,f,p,h;if(t&&a&&e){l=t[a];if(l){f=this._getParameterMetaData(a,r);if(f){if(f.isCustomFilterField){return}var c=r.getUseDateRangeType()&&(f.type==="Edm.DateTime"&&f.displayFormat==="Date"||f.type==="Edm.String"&&f.isCalendarDate)||t[a]&&t[a].conditionTypeInfo&&t[a].conditionTypeInfo.name&&t[a].conditionTypeInfo.name==="sap.ui.comp.config.condition.DateRangeType";if(f.filterRestriction===o.single&&(!c||f.isParameter)){s=l.value===undefined?l:l.value;s=d._getValueWithMetadata(r,f,s,true);this._addSingleValue(e,a,s);if(c&&f.isParameter){if(t&&a&&e&&t[a]&&t[a].conditionTypeInfo){var l=t[a];if(l.ranges&&l.ranges.length>0){g=d.addRangeEntry(e,a);d.addRanges(g,l.ranges,r,f)}}}}else if(f.filterRestriction===o.interval){if(l.conditionTypeInfo){this._convertFieldByValue(e,a,t,r,f)}else{g=d.addRangeEntry(e,a);if(f.type==="Edm.DateTime"&&!l.high){l.high=l.low}else if(f.type==="Edm.String"&&!l.high){u="EQ"}if(f.type==="Edm.Time"){this._addRangeMultipleRangeValues(r,f,g,l.ranges,true)}else if(f.type==="Edm.DateTimeOffset"&&!l.high){u="BT";p=n.parseDateTimeOffsetInterval(l.low);if(p&&p.length===2&&p[0]){p[0]=f.ui5Type.parseValue(p[0],"string");if(p.length===2){p[1]=f.ui5Type.parseValue(p[1],"string")}h={low:p[0],high:p[1]};this._addRangeLowHigh(r,f,g,h,"BT")}else{this._addRangeLowHigh(r,f,g,l,"EQ")}}else if(i.isNumeric(f.type)&&!l.high){p=n.parseFilterNumericIntervalData(l.low);if(p&&p.length===2&&p[0]){this._addRangeLowHigh(r,f,g,{low:p[0],high:p[1]},"BT")}else{this._addRangeLowHigh(r,f,g,l,"EQ")}}else{this._addRangeLowHigh(r,f,g,l,u)}}}else if(f.filterRestriction===o.multiple){g=d.addRangeEntry(e,a);if(l.items&&l.items.length>0){this._addRangeMultipleSingleValues(r,f,g,l.items)}else if(l.ranges&&l.ranges.length>0){this._addRangeMultipleRangeValues(r,f,g,l.ranges,l.conditionTypeInfo?true:false)}else{this._addRangeSingleValue(g,l.value)}}else{this._convertFieldByValue(e,a,t,r,f)}}else{this._convertFieldByValue(e,a,t,r,f)}}}};d.prototype._convertFieldByValue=function(e,a,t,i,n){var r;var l;if(t&&a&&e){r=t[a];if(r){if(r.conditionTypeInfo){if(r.ranges&&r.ranges.length>0){l=d.addRangeEntry(e,a);d.addRanges(l,r.ranges,i,n)}}else if(r.ranges!==undefined&&r.items!==undefined&&r.value!==undefined){l=d.addRangeEntry(e,a);if(r.ranges&&r.ranges.length>0){d.addRanges(l,r.ranges,i,n)}if(r.items&&r.items.length>0){this._addRangeMultipleSingleValues(i,n,l,r.items)}if(r.value){this._addRangeSingleValue(l,d._getValueWithMetadata(i,n,r.value))}}else if(r.items!==undefined&&r.items&&r.items.length>0){l=d.addRangeEntry(e,a);this._addRangeMultipleSingleValues(i,n,l,r.items)}else if(r.low!==undefined&&r.low&&r.high!==undefined&&r.high){l=d.addRangeEntry(e,a);this._addRangeLowHigh(i,n,l,r)}else if(r.value!==undefined&&r.value){this._addSingleValue(e,a,r.value)}else if(r){this._addSingleValue(e,a,r)}}}};d.addRangeEntry=function(e,a){var t={PropertyName:a,Ranges:[]};if(!e.SelectOptions){e.SelectOptions=[]}e.SelectOptions.push(t);return t.Ranges};d.addRanges=function(e,a,t,i){var n,r,l,s;for(var o=0;o<a.length;o++){n=a[o].exclude?"E":"I";l=d._getValueWithMetadata(t,i,a[o].value1,true);s=null;if(a[o].operation===u.BT){s=d._getValueWithMetadata(t,i,a[o].value2)}l=d._prepareLowValue(a[o].operation,l);r=d._prepareOptionValue(a[o].operation,l);if(r){e.push({Sign:n,Option:r,Low:l,High:s})}}};d.addP13nRanges=function(e,a,t,i,n){var r,l,s,o;for(var g=0;g<a.length;g++){r=a[g].exclude?"E":"I";s=""+a[g].value1;o=null;if(a[g].operation===u.BT){o=""+a[g].value2}if(["date","datetime","time"].includes(t)){s=d._processP13NDateValue(a[g].value1,t,i,n);o=d._processP13NDateValue(a[g].value2,t,i,n)}s=d._prepareLowValue(a[g].operation,s);l=d._prepareOptionValue(a[g].operation,s);e.push({Sign:r,Option:l,Low:s,High:o})}};d._processP13NDateValue=function(e,i,n,r){if(!e||r){return e}if(typeof e==="string"){e=a.getInstance(e)}if(n&&(i==="date"||i==="time")){e=t.localToUtc(e)}if(i==="datetime"){return e.toISOString()}return e.toISOString().slice(0,-1)};d._prepareLowValue=function(e,a){switch(e){case u.Contains:if(a){a="*"+a+"*"}break;case u.StartsWith:if(a){a=a+"*"}break;case u.EndsWith:if(a){a="*"+a}break;case u.Empty:a="";break;case u.EQ:case u.BT:case u.LE:case u.GE:case u.GT:case u.LT:break;default:s.error("ValueHelpRangeOperation is not supported '"+e+"'");return}return a};d._prepareOptionValue=function(e,a){var t;switch(e){case u.Contains:case u.StartsWith:case u.EndsWith:t="CP";break;case u.Empty:t="EQ";break;case u.EQ:case u.BT:case u.LE:case u.GE:case u.GT:case u.LT:t=e;break;default:s.error("ValueHelpRangeOperation is not supported '"+e+"'");return}return t};d.prototype._addRangeMultipleSingleValues=function(e,a,t,i){for(var n=0;n<i.length;n++){t.push({Sign:"I",Option:"EQ",Low:d._getValueWithMetadata(e,a,i[n].key,true),High:null})}};d.prototype._addRangeMultipleRangeValues=function(e,a,t,i,n){for(var r=0;r<i.length;r++){t.push({Sign:i[r].exclude?"E":"I",Option:n?"BT":"EQ",Low:d._getValueWithMetadata(e,a,i[r].value1,true),High:n?d._getValueWithMetadata(e,a,i[r].value2):null})}};d.prototype._addRangeSingleValue=function(e,a){e.push({Sign:"I",Option:"EQ",Low:d._getValue(a,true),High:null})};d.prototype._addRangeLowHigh=function(e,a,t,i,n){var r=n||"BT";t.push({Sign:"I",Option:r,Low:d._getValueWithMetadata(e,a,i.low,true),High:d._getValueWithMetadata(e,a,i.high)})};d.prototype._addParamaterSingleValue=function(e,a,t){if(!e.Parameters){e.Parameters=[]}e.Parameters.push({PropertyName:a,PropertyValue:t})};d.prototype._createRangeSingleValue=function(e,a,t){var i=d.addRangeEntry(e,a);this._addRangeSingleValue(i,t)};d.prototype._addSingleValue=function(e,a,t){var i;if(this._sAPILevel){i=a.split(g);if(i.length>1){this._addParamaterSingleValue(e,i[i.length-1],t)}else{this._createRangeSingleValue(e,a,t)}}else{this._addParamaterSingleValue(e,a,t)}};d.prototype._addArrayOfSingleValues=function(e,a,t){var i=d.addRangeEntry(e,a);t.forEach(function(e){i.push({Sign:"I",Option:"EQ",Low:d._getValue(e,true),High:null})})};d.prototype._getFields=function(e){var a=[];if(e){for(var t=0;t<e.length;t++){a.push(e[t].name)}}return a};d._getValue=function(e,a){if(e===null||e===undefined||e===""){return a?"":null}return""+e};d._getValueWithMetadata=function(e,i,n,r){if(n===null||n===undefined||n===""){return r?"":null}else if(e&&i){if(i.type==="Edm.DateTime"||i.type==="Edm.Time"){if(i.isParameter&&n.oData){n=n.oData}if(i.isParameter&&!n.oData&&n.ranges&&n.ranges[0]&&n.ranges[0].value1){n=n.ranges[0].value1}if(e&&e.isInUTCMode&&e.isInUTCMode()){n=t.localToUtc(a.getInstance(n)).toJSON()}if(n.indexOf("Z")===n.length-1){n=n.substr(0,n.length-1)}}else if(i.type==="Edm.DateTimeOffset"){var l=e&&e._oFilterProvider&&e._oFilterProvider._getFilterTimeZone(i.name);if(l){n=t.toTimezone(n,l).toJSON()}else{n=a.getInstance(n).toJSON()}}}return""+n};return d},true);
//# sourceMappingURL=VariantConverterTo.js.map