/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","./Factory","./LinkData","sap/base/Log"],function(t,e,n,i){"use strict";var r={getContactAnnotationPath:function(t,e){var n=t?t.getContactAnnotationPath():undefined;if(n===undefined&&e&&e.getContactAnnotationPaths()&&e.getContactAnnotationPaths()[t.getFieldName()]!==undefined){n=e.getContactAnnotationPaths()[t.getFieldName()]}return n},getForceLinkRendering:function(t,e){if(!t){return undefined}return t.getForceLinkRendering()||!!(e&&e.getForceLinkRendering()&&e.getForceLinkRendering()[t.getFieldName()])},getStorableAvailableActions:function(t){return t?t.filter(function(t){return t&&t.key!==undefined}):[]},sortArrayAlphabetical:function(t){var e;try{e=sap.ui.getCore().getConfiguration().getLocale().toString();if(typeof window.Intl!=="undefined"){var n=window.Intl.Collator(e,{numeric:true});t.sort(function(t,e){return n.compare(t,e)})}else{t.sort(function(t,n){return t.localeCompare(n,e,{numeric:true})})}}catch(t){}},retrieveNavigationTargets:function(t,r,a,o,c,s,u,l,v,f){var m={mainNavigation:undefined,ownNavigation:undefined,availableActions:[]};var p=e.getService("CrossApplicationNavigation",true);var g=e.getService("URLParsing",true);return Promise.all([p,g]).then(function(e){var p=e[0];var g=e[1];if(!p||!g){i.error("Service 'CrossApplicationNavigation' or 'URLParsing' could not be obtained");return Promise.resolve(m)}var b=[t].concat(r);var d=b.map(function(t){return[{semanticObject:t,params:c?c[t]:undefined,appStateKey:a,ui5Component:o,sortResultsBy:"text"}]});var h;return new Promise(function(t){p.getLinks(d).then(function(e){return t(e)})}).then(function(t){h=t;return h&&h.length?this.retrieveSemanticObjectUnavailableActions(u,l,v):Promise.resolve({})}.bind(this)).then(function(t){if(!h||!h.length){return Promise.resolve(m)}return p.hrefForExternalAsync().then(function(e){if(e&&e.indexOf("?")!==-1){e=e.split("?")[0]}if(e){e+="?"}var i=function(e,n){return!!t&&!!t[e]&&t[e].indexOf(n)>-1};h[0][0].forEach(function(t){var r=g.parseShellHash(t.intent);var a=r.semanticObject&&r.action?r.semanticObject+"-"+r.action:undefined;var o=t.tags&&t.tags.indexOf("superiorAction")>-1;if(t.intent.indexOf(e)===0){var c=new n({key:a,href:t.intent,visible:true,isSuperiorAction:o});c.setText(t.text);m.ownNavigation=c;return}if(r.action&&r.action==="displayFactSheet"&&!i(r.semanticObject,r.action)){m.mainNavigation=new n({key:a,href:t.intent,text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_FACTSHEET"),visible:true,isSuperiorAction:o});if(f){f.addSemanticObjectIntent(r.semanticObject,{text:t.text,intent:t.intent})}return}if(!i(r.semanticObject,r.action)){var s=new n({key:a,href:t.intent,visible:true,isSuperiorAction:o});s.setText(t.text);m.availableActions.push(s);if(f){f.addSemanticObjectIntent(r.semanticObject,{text:t.text,intent:t.intent})}}});if(!m.mainNavigation&&typeof s==="string"){var r=new n({visible:true});r.setText(s);m.mainNavigation=r}var a=[];for(var o=1;o<b.length;o++){a=a.concat(h[o][0])}a.forEach(function(t){var e=g.parseShellHash(t.intent);if(i(e.semanticObject,e.action)){return}var r=t.tags&&t.tags.indexOf("superiorAction")>-1;var a=new n({key:e.semanticObject&&e.action?e.semanticObject+"-"+e.action:undefined,href:t.intent,visible:true,isSuperiorAction:r});a.setText(t.text);m.availableActions.push(a);if(f){f.addSemanticObjectIntent(e.semanticObject,{text:t.text,intent:t.intent})}});return Promise.resolve(m)})})}.bind(this))},retrieveSemanticObjectMapping:function(t,e,n){return this._getEntityTypeAnnotationOfProperty(t,e,n).then(function(t){if(!t){return Promise.resolve(null)}if(!t[0]["com.sap.vocabularies.Common.v1.SemanticObjectMapping"]){return Promise.resolve(null)}var i=this._getSemanticObjectMappingsOfProperty(t[0],this._getSemanticObjectsOfProperty(t[0],e,n));var r={};for(var a in i){r[i[a].name]=i[a].mapping}return Promise.resolve(r)}.bind(this))},retrieveSemanticObjectUnavailableActions:function(t,e,n){return this._getEntityTypeAnnotationOfProperty(t,e,n).then(function(t){if(!t){return Promise.resolve(null)}if(!t[0]["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]){return Promise.resolve(null)}var i=this._getSemanticObjectUnavailableActionsOfProperty(t[0],this._getSemanticObjectsOfProperty(t[0],e,n));var r={};for(var a in i){r[i[a].name]=i[a].unavailableActions}return Promise.resolve(r)}.bind(this))},oNavigationPromise:undefined,navigate:function(t){if(t.indexOf("#")===0&&e.getUShellContainer()){var n=this;if(!n.oNavigationPromise){n.oNavigationPromise=e.getService("CrossApplicationNavigation",true).then(function(e){e.toExternal({target:{shellHash:t.substring(1)}});n.oNavigationPromise=undefined})}}else{window.location.href=t}},_getEntityTypeAnnotationOfProperty:function(t,e,n){if(!t){return Promise.resolve(null)}if(!e||!e.getMetaModel()){return Promise.resolve(null)}var r=e.getMetaModel();return r.loaded().then(function(){var e;try{e=r.getMetaContext(n)}catch(t){i.error("sap.ui.comp.navpopover.Util._getEntityTypeAnnotationOfProperty: binding path '"+n+"' is not valid. Error has been caught: "+t);return Promise.resolve(null)}if(!e){return Promise.resolve(null)}var a=e.getProperty(e.getPath());if(!a.property){return Promise.resolve(null)}var o=a.property.filter(function(e){return e.name===t});if(o.length!==1){return Promise.resolve(null)}return Promise.resolve(o)})},_getSemanticObjectsOfProperty:function(t,e,n){var i={};for(var r in t){var a=r.split("#")[0];var o=r.split("#")[1]||"";if(a.startsWith("com.sap.vocabularies.Common.v1.SemanticObject")&&a.endsWith("com.sap.vocabularies.Common.v1.SemanticObject")){i[o]={name:t[r]["Path"]?e.getProperty(n+"/"+t[r]["Path"]):t[r]["String"],mapping:undefined}}}return i},_getSemanticObjectMappingsOfProperty:function(t,e){var n=function(t){var e={};if(Array.isArray(t)){t.forEach(function(t){e[t.LocalProperty.PropertyPath]=t.SemanticObjectProperty.String})}return e};for(var i in t){var r=i.split("#")[0];var a=i.split("#")[1]||"";if(r.startsWith("com.sap.vocabularies.Common.v1.SemanticObjectMapping")&&r.endsWith("com.sap.vocabularies.Common.v1.SemanticObjectMapping")){if(e[a]){e[a].mapping=n(t[i])}}}return e},_getSemanticObjectUnavailableActionsOfProperty:function(t,e){var n=function(t){var e=[];if(Array.isArray(t)){t.forEach(function(t){e.push(t.String)})}return e};for(var i in t){var r=i.split("#")[0];var a=i.split("#")[1]||"";if(r.startsWith("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")&&r.endsWith("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")){if(e[a]){e[a].unavailableActions=n(t[i])}}}return e}};return r},true);
//# sourceMappingURL=Util.js.map