/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery",".././library","sap/ui/core/Control","sap/ui/comp/smartmultiedit/Field","sap/ui/model/Context","sap/base/Log"],function(jQuery,t,e,i,a,o){"use strict";var r=e.extend("sap.ui.comp.smartmultiedit.Container",{metadata:{library:"sap.ui.comp",properties:{entitySet:{type:"string",defaultValue:null},contexts:{type:"sap.ui.model.Context[]",defaultValue:[]}},defaultAggregation:"layout",aggregations:{layout:{type:"sap.ui.comp.smartform.SmartForm",multiple:false}},designTime:"sap/ui/comp/designtime/smartmultiedit/Container.designtime"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiCompSmartMultiEditContainer");t.openEnd();if(e._bReadyToRender){t.renderControl(e.getLayout())}t.close("div")}}});r.prototype.init=function(){this._bIsInitialized=false;this._bReadyToRender=false;this._aFields=null;this.attachEvent("modelContextChange",this._initializeMetadata,this)};r.prototype.setEntitySet=function(t){if(t!==this.getProperty("entitySet")){this.setProperty("entitySet",t,true);if(t){this._initializeMetadata()}}return this};r.prototype.setContexts=function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(!(t[e]instanceof a)){return this}}this.setProperty("contexts",t,true);this._getFields().forEach(function(t){t._updateContextItems()})}else{o.error("Parameter contexts is expected to be an array.")}return this};r.prototype.setLayout=function(t){this.setAggregation("layout",t,true);this._refreshFields();return this};r.prototype.addCustomData=function(t){var i;if(!t){return this}e.prototype.addCustomData.apply(this,arguments);this._getFields().forEach(function(e){i=t.clone();e._oSmartField.addCustomData(i)});return this};r.prototype.insertCustomData=function(t,i){var a;if(!t){return this}e.prototype.insertCustomData.apply(this,arguments);this._getFields().forEach(function(e){a=t.clone();e._oSmartField.addCustomData(a)});return this};r.prototype.removeCustomData=function(t){var i=e.prototype.removeCustomData.apply(this,arguments);if(i){this._getFields().forEach(function(t){t._oSmartField.removeCustomData(i)})}return i};r.prototype.removeAllCustomData=function(){var t=e.prototype.removeAllCustomData.apply(this,arguments);if(t.length>0){this._getFields().forEach(function(e){t.forEach(function(t){e._oSmartField.removeCustomData(t)})})}return t};r.prototype.destroyCustomData=function(){e.prototype.destroyCustomData.apply(this,arguments);this._getFields().forEach(function(t){t._oSmartField.destroyCustomData()});return this};r.prototype.getAllUpdatedContexts=function(t){var e=this.getContexts(),i=[],a=this,o=0,r=10;if(e.length===0){return Promise.resolve(i)}return new Promise(function(n){function s(u,l,d){for(o=l;o<Math.min(d,u.length);o++){i.push({context:u[o],data:a._getUpdatedDataObject(u[o].getObject(),t)})}if(o<u.length){setTimeout(s.bind(null,e,o,o+r),0)}else{n(i)}}s(e,o,o+r)})};r.prototype.getErroneousFields=function(){return this._getFields().filter(function(t){t._performValidation();return t.hasClientError()})};r.prototype.getErroneousFieldsAndTokens=function(){var t=this._getFields().map(function(t){return t._performValidation()});return Promise.all(t).then(function(){var t=this._getFields().filter(function(t){return t.hasClientError()});return t}.bind(this))};r.prototype.indexField=function(t){var e;if(!(t instanceof i)){o.error("Container.indexField","Element '"+JSON.stringify(t)+"' must be of type sap.ui.comp.smartmultiedit.Field","sap.ui.comp.smartmultiedit.Container");return}this._aFields.push(t);t._setContainer(this);this.getCustomData().forEach(function(i){if(t.getSmartField()){e=i.clone();t.getSmartField().addCustomData(e)}})};r.prototype._getUpdatedDataObject=function(t,e){var i=e?Object.assign({},t):{},a,r,n,s;this._getFields().forEach(function(e){a=e.getPropertyName();r=e.getUnitOfMeasurePropertyName();s=e.getRawValue();if(s.hasOwnProperty(a)){if(e.isDate()||e.isDateTime()){if(!t[a]){if(s[a]){i[a]=s[a]}}else if(!s[a]){i[a]=null}else if(!t[a].getTime){o.error("Container._getUpdatedDataObject","Field "+a+" has incompatible data and metadata, expected: Date/DateTime, but found "+typeof i[a],"sap.ui.comp.smartmultiedit.Container");return}else if(s[a].getTime()!==t[a].getTime()){i[a]=s[a]}}else{if(s[a]!==t[a]&&(s[a]!==""&&s[a]!=null||t[a]!==""&&t[a]!=null)){i[a]=s[a]}}}if(e.isComposite()&&s.hasOwnProperty(r)&&s[r]!==t[r]){i[r]=s[r]}else if(e.isComboBox()){n=e.getRecordTextPath();if(s.hasOwnProperty(n)&&s[n]!==t[n]){i[n]=s[n]}}});return i};r.prototype.getFields=function(t){return this._getFields(t)};r.prototype._getFields=function(t){var e=[];if((t||!this._aFields||Array.isArray(this._aFields)&&!this._aFields.length)&&this.getLayout()){this._aFields=[];this.getLayout().getGroups().forEach(function(a){a.getGroupElements().forEach(function(a){a.getElements().forEach(function(a){if(a instanceof i){this.indexField(a)}else if(t){e.push(a)}}.bind(this))}.bind(this))}.bind(this))}return e.concat(this._aFields||[])};r.prototype._initializeMetadata=function(){var t=this.getModel();if(!this._bIsInitialized&&this.getEntitySet()&&t&&t.getMetadata().getName()==="sap.ui.model.odata.v2.ODataModel"){if(!this.getBindingContext()){var e=t.createEntry("/"+this.getEntitySet());this.setBindingContext(e);this.getModel().resetChanges([e.getPath()],undefined,true)}t.getMetaModel().loaded().then(this._onMetadataInitialized.bind(this))}};r.prototype._onMetadataInitialized=function(){if(this._bIsInitialized){return}this._bIsInitialized=true;this._bReadyToRender=true;this.invalidate()};r.prototype.resetContainer=function(){this._aFields.forEach(function(t){t.resetField()});this._bIsInitialized=false};r.prototype._refreshFields=function(){this._aFields=null;this._getFields()};return r});
//# sourceMappingURL=Container.js.map