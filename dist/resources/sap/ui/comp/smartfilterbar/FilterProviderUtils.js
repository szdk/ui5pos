/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/date/UI5Date","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FilterUtil","sap/ui/comp/library","sap/ui/core/Configuration"],function(e,i,t,a,n,l,s,o,r){"use strict";var f=o.smartfilterbar.FilterType,u=o.valuehelpdialog.ValueHelpRangeOperation;var c=e.extend("sap.ui.comp.smartfilterbar.FilterProviderUtils");c.FIELD_NAME_REGEX=/\./g;c.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";c.BASIC_FILTER_AREA_ID="_BASIC";c.FILTER_MODEL_NAME="fi1t3rM0d31";c.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";c.ASSOCIATE_VALUE_LISTS="AssociateValueLists";c.INTL_TIMEZONE=Intl.DateTimeFormat().resolvedOptions().timeZone;c.UI_TIMEZONE=r.getTimezone();c._getStringEmptyFilter=function(e,i,n){var l=n?a.NE:a.EQ,s=i&&i.type==="Edm.Guid"?"00000000-0000-0000-0000-000000000000":"";if(i&&i.nullable==="false"){return new t(e,l,s)}else{return new t({and:!!n,filters:[new t(e,l,s),new t(e,l,null)]})}};c._getFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fields){e.fields.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null})}return t!==null});return t};c._getAnalyticalFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null});return t};c._getTimezone=function(e,i){var t=e&&e.find(function(e){return e.key===i});if(t){return t.value}return null};c.adaptTime=function(e,i){var t;if(!(e instanceof Date)||!i){return e}if(i.filterRestriction===f.single&&i.control&&i.control.isA("sap.m.DynamicDateRange")){return n.normalizeDate(e,true)}if(i.displayFormat==="Date"){return n.normalizeDate(e,true)}t=parseInt(i.precision);return n.adaptPrecision(e,t)};c.generateFilters=function(e,o,r){var f=[],p=null,m=null,T=null,d=null,E=c.FIELD_NAME_REGEX,g=null,I,h,w=null,D=0,_=0,C,v,F,O,U,S,y,L,N,A,M,V=[],R,x,z,B,Q;if(r){C=r.dateSettings;v=r.useContainsAsDefault;F=r.stringFields;O=r.timeFields;y=r.dateTimeOffsetValueFields;V=r.viewMetadataData||[];L=r.dateTimeOffsetWithTimeZone}if(e){if(o){_=e.length;while(_--){S=false;N=false;d=e[_];A=this._getTimezone(L,d);M=c._getFieldMetadata(V,d);if(M&&M.isCustomFilterField){continue}if(M){B=M.isConstant;Q=M.isInitialValueSignificant}if(d&&d!==c.BASIC_SEARCH_FIELD_ID){w=null;U=false;if(v&&F){if(F.indexOf(d)>-1){U=true}}else if(O&&O.indexOf(d)>-1){S=true}else if(y&&y.indexOf(d)>-1){N=true}g=o[d];d=d.replace(E,"/");if(g&&g.hasOwnProperty("low")){if(g.low&&g.high){I=g.low;h=g.high;if(!N&&C&&C.UTC&&I instanceof Date&&h instanceof Date){I=n.localToUtc(I);h=n.localToUtc(h)}I=c.adaptTime(I,M);h=c.adaptTime(h,M);f.push(new t(d,a.BT,I,h))}else if(g.low){if(g.low instanceof Date){I=g.low;if(!N&&C&&C.UTC){I=n.localToUtc(I)}I=c.adaptTime(I,M);f.push(new t(d,a.EQ,I))}else if(typeof g.low==="string"){if(N&&M){w=l.parseDateTimeOffsetInterval(g.low);w[0]=M.ui5Type.parseValue(w[0],"string");if(w.length===2){w[1]=M.ui5Type.parseValue(w[1],"string")}}else{w=l.parseFilterNumericIntervalData(g.low)}if(w&&w.length===2){g[0]=c.adaptTime(g[0],M);g[1]=c.adaptTime(g[1],M);f.push(new t(d,a.BT,w[0],w[1]))}else if(w&&w.length===1){g[0]=c.adaptTime(g[0],M);f.push(new t(d,a.EQ,w[0]))}else{f.push(new t(d,U?a.Contains:a.EQ,g.low))}}}}else if(g&&g.hasOwnProperty("items")){p=[];T=[];m=null;if(g&&g.hasOwnProperty("ranges")){w=g.ranges;D=w.length;while(D--){R=w[D];I=R.value1;h=R.value2;if(S){if(I instanceof Date){I=l.getEdmTimeFromDate(I)}if(h instanceof Date){h=l.getEdmTimeFromDate(h)}}else if(M&&M.isCalendarDate){if(I instanceof Date){I=M.ui5Type.parseValue(I)}if(h instanceof Date){h=M.ui5Type.parseValue(h)}}else if(!N&&C&&C.UTC){if(I instanceof Date){I=n.localToUtc(I)}if(h instanceof Date){h=n.localToUtc(h)}}else if(N&&A){if(I){I=n.toTimezone(I,A);if(c.UI_TIMEZONE!==c.INTL_TIMEZONE){I=i.getInstance(I)}I=n.localToUtc(I)}if(h){h=n.toTimezone(h,A);if(c.UI_TIMEZONE!==c.INTL_TIMEZONE){h=i.getInstance(h)}h=n.localToUtc(h)}}else if(N&&!A){if(I){if(C&&C.UTC){I=n.uiTimezoneToUtc(I);I=n.localToUtc(I)}else{I=n.toTimezone(I,c.INTL_TIMEZONE)}}if(h){if(C&&C.UTC){h=n.uiTimezoneToUtc(h);h=n.localToUtc(h)}else{h=n.toTimezone(h,c.INTL_TIMEZONE)}}}I=c.adaptTime(I,M);h=c.adaptTime(h,M);x=R.exclude?T:p;if(R.operation===u.Empty){if(M&&["Edm.DateTime","Edm.DateTimeOffset"].indexOf(M.type)>-1){x.push(new t(d,R.exclude?a.NE:a.EQ,null))}else{x.push(c._getStringEmptyFilter(d,M,R.exclude))}}else{if(R.operation!==a.BT&&R.operation!==a.NB){h=undefined}z=R.exclude?s.getTransformedExcludeOperation(R.operation):R.operation;x.push(new t(d,z,I,h))}}if(T.length){m=new t(T,true)}}w=g.items;D=w.length;while(D--){p.push(new t(d,a.EQ,w[D].key))}if(g.value||g.value===0||g.value===false){if(typeof g.value==="string"){g.value=g.value.trim()}p.push(new t(d,U?a.Contains:a.EQ,g.value))}else if(g.value===""&&B&&Q){p.push(new t(d,U?a.Contains:a.EQ,g.value))}if(p.length){if(m){f.push(new t([new t(p,false),m],true))}else{f.push(new t(p,false))}}else if(m){f.push(m)}}else if(M&&M.control&&M.control.isA("sap.m.ComboBox")&&this.isValueSignificant(M)){if(g===null&&M.control.getSelectedKey()===""){g=""}if(M.control.getSelectedItem()){g=c.adaptTime(g,M);f.push(new t(d,U?a.Contains:a.EQ,g))}}else if(g||g===0||g===false){if(typeof g==="string"){g=g.trim()}if(g&&g instanceof Date){if(S){g=l.getEdmTimeFromDate(g)}else if(!N&&C&&C.UTC){g=n.localToUtc(g)}}if(g||g===0||g===false){g=c.adaptTime(g,M);f.push(new t(d,U?a.Contains:a.EQ,g))}}else if(g===""&&B&&Q){f.push(new t(d,U?a.Contains:a.EQ,g))}}}}}return f.length>1?[new t(f,true)]:f};c.isValueSignificant=function(e){var i=e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].Parameters,t;if(i){t=i.find(function(e){return e.hasOwnProperty("InitialValueIsSignificant")})}if(t&&t["InitialValueIsSignificant"]){return t["InitialValueIsSignificant"].Bool.toLocaleLowerCase()==="true"}return false};return c});
//# sourceMappingURL=FilterProviderUtils.js.map