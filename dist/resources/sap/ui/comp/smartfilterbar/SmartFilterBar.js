/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/m/MessageBox","sap/ui/comp/util/DateTimeUtil","sap/ui/base/ManagedObjectObserver","sap/ui/comp/filterbar/FilterBar","sap/ui/comp/smartfilterbar/SmartFilterBarFilterGroupItem","sap/ui/comp/filterbar/FilterItem","sap/ui/comp/library","./AdditionalConfigurationHelper","./ControlConfiguration","./FilterProvider","sap/ui/comp/smartfilterbar/FilterProviderUtils","./GroupConfiguration","sap/ui/comp/util/FormatUtil","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/comp/odata/ODataModelUtil","sap/ui/core/library","sap/ui/core/date/UI5Date","sap/ui/comp/variants/VariantItem","sap/ui/model/odata/AnnotationHelper","sap/ui/model/Context","sap/ui/comp/filterbar/VariantConverterFrom","sap/base/Log","sap/base/util/merge","sap/ui/Device","sap/ui/performance/trace/FESRHelper","sap/ui/comp/rules/RulesLog","sap/ui/comp/odata/MetadataAnalyser"],function(e,t,i,r,a,n,o,s,l,d,u,h,f,p,c,g,_,m,y,F,S,v,V,b,C,P,A,M){"use strict";var I=_.ValueState;var T=o.smartfilterbar.FilterType;var E=o.ANALYTICAL_PARAMETER_PREFIX;var B=r.extend("sap.ui.comp.smartfilterbar.SmartFilterBar",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartfilterbar/SmartFilterBar.designtime",properties:{entityType:{type:"string",group:"Misc",defaultValue:null,deprecated:true},entitySet:{type:"string",group:"Misc",defaultValue:null},resourceUri:{type:"string",group:"Misc",defaultValue:null},basicSearchFieldName:{type:"string",group:"Misc",defaultValue:null},enableBasicSearch:{type:"boolean",group:"Misc",defaultValue:false},liveMode:{type:"boolean",group:"Misc",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:false},considerAnalyticalParameters:{type:"boolean",group:"Misc",defaultValue:false},useDateRangeType:{type:"boolean",group:"Misc",defaultValue:null},suppressSelection:{type:"boolean",group:"Misc",defaultValue:false},considerSelectionVariants:{type:"boolean",group:"Misc",defaultValue:false},defaultSelectionVariantName:{type:"string",group:"Misc",defaultValue:null},useProvidedNavigationProperties:{type:"boolean",group:"Misc",defaultValue:false},navigationProperties:{type:"string",group:"Misc",defaultValue:""}},associations:{smartVariant:{type:"sap.ui.comp.smartvariants.SmartVariantManagement",multiple:false}},aggregations:{controlConfiguration:{type:"sap.ui.comp.smartfilterbar.ControlConfiguration",multiple:true,singularName:"controlConfiguration"},groupConfiguration:{type:"sap.ui.comp.smartfilterbar.GroupConfiguration",multiple:true,singularName:"groupConfiguration"}},events:{pendingChange:{parameters:{pendingValue:{type:"boolean"}}}}},renderer:{apiVersion:2}});B.LIVE_MODE_INTERVAL=300;B.SELECTION_VARIANT_KEY_PREFIX="#";B.prototype.init=function(){if(!d){d=sap.ui.require("sap/ui/comp/smartfilterbar/FilterProvider")}this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._bCreateFilterProviderCalled=false;this._aFilterBarViewMetadata=null;this._oFilterBarViewMetadataExtend=null;this._bSetFilterDataSuspended=false;this._oStoredFilterData={};this._oObservers=[];r.prototype.init.apply(this);sap.ui.getCore().getMessageManager().registerObject(this,true);this.getMetadata().addPublicMethods(["suspendSelection","resumeSelection"]);this._oRulesLog=new A};B.prototype._applyFESRSemantic=function(e,t,i){if(!e||!t){return}if(!i){i="press"}t=t.slice(0,20);P.setSemanticStepname(e,i,t)};B.prototype.onBeforeRendering=function(){this._applyFESRSemantic(this._oSearchButton,"sc:sfbGo");this._applyFESRSemantic(this._oHideShowButton,"sc:sfbShowHideToggle");this._applyFESRSemantic(this._oClearButtonOnFB,"sc:sfbClear");this._applyFESRSemantic(this._oRestoreButtonOnFB,"sc:sfbRestore");this._applyFESRSemantic(this._oFiltersButton,"sc:sfbAdaptFilters");r.prototype.onBeforeRendering.apply(this,arguments)};B.prototype._initializeMetadata=function(){if(!this.bIsInitialised){g.handleModelInit(this,this._onMetadataInitialised,!this.getIsRunningInValueHelpDialog())}};B.prototype._onMetadataInitialised=function(){var e,t,i,r;this._bMetaModelLoadAttached=false;if(!this.bIsInitialised&&!this._bCreateFilterProviderCalled){t=this.getModel();e=this.getResourceUri();i=this.getEntityType();r=this.getEntitySet();if((t||e)&&(i||r)){this._bCreateFilterProviderCalled=true;this._createFilterProvider(t,e,i,r).then(function(e){if(!e){return}if(this.bIsDestroyed){e.destroy();return}this._oFilterProvider=e;this._aFilterBarViewMetadata=e.getFilterBarViewMetadata();this._aAnalyticalFilterBarViewMetadata=e.getAnalyticParameters();this._oFilterBarViewMetadataExtend=e._getFilterBarViewMetadataExtend();if(this._aFilterBarViewMetadata){this._attachAdditionalConfigurationChanged();this.bIsInitialised=true;this.setModel(e.oModel,e.sFilterModelName);this.registerGetFiltersWithValues(this.getFiltersWithValues.bind(this));this.registerFetchData(function(e){return this.getFilterDataAsStringForVariant(true,e)}.bind(this));this.registerApplyData(function(e,t){this.setFilterDataAsStringFromVariant(e,true,t)}.bind(this));this._initializeVariantManagement()}e.attachPendingChange(function(e){this.firePendingChange({pendingValue:e.getParameter("pending")})}.bind(this))}.bind(this))}}};B.prototype._setInitialFocus=function(){var e=this.getAssociation("smartVariant")||this.getConsiderSelectionVariants(),t=this.getBasicSearchControl(),i=this.getAllFilterItems(true),r;if(!e){if(this.getEnableBasicSearch()){this._onAfterRenderingBasicSearchDelegate={onAfterRendering:function(){setTimeout(function(){t.focus();t.removeDelegate(this._onAfterRenderingBasicSearchDelegate)}.bind(this))}.bind(this)};t.addDelegate(this._onAfterRenderingBasicSearchDelegate,this)}else if(i.length>0){r=i[0]._getControl();this._onAfterRenderingFirstFilterVisibleFieldDelegate={onAfterRendering:function(){setTimeout(function(){r.focus();r.removeDelegate(this._onAfterRenderingFirstFilterVisibleFieldDelegate)}.bind(this))}.bind(this)};r.addDelegate(this._onAfterRenderingFirstFilterVisibleFieldDelegate,this)}}};B.prototype.getModelData=function(){return this._oFilterProvider?this._oFilterProvider.getModel().getData():null};B.prototype.getFilterContextUrl=function(){return this._oFilterProvider?this._oFilterProvider.getFilterContextUrl():null};B.prototype.getParameterContextUrl=function(){return this._oFilterProvider?this._oFilterProvider.getParameterContextUrl():null};B.prototype.getFilterBarViewMetadata=function(e){var t;if(this._aFilterBarViewMetadata===null){return[]}t=Object.assign({},this._aFilterBarViewMetadata);t=this._aFilterBarViewMetadata.map(function(t){var i=Object.assign({},t);if(e&&this._oFilterBarViewMetadataExtend!==null){i.fields=i.fields.map(function(e){var t,i=e.groupName,r=e.fullName,a=this._oFilterBarViewMetadataExtend[i]&&this._oFilterBarViewMetadataExtend[i][r];if(a!==undefined){t=Object.assign({},e,a)}else{t=Object.assign({},e)}return t}.bind(this))}return i}.bind(this));return t};B.prototype.getAnalyticalParameters=function(){return this._oFilterProvider?this._oFilterProvider.getAnalyticParameters():[]};B.prototype.getSelectionVariants=function(){var e=null;if(this._oFilterProvider){e=this._oFilterProvider.getSelectionVariants();if(Object.keys(e).length<1){e=null}}return e};B.prototype._createFilterProvider=function(e,t,i,r){return d._createFilterProvider({basicSearchFieldName:this.getBasicSearchFieldName(),enableBasicSearch:this.getEnableBasicSearch(),entityType:i,entitySet:r,serviceUrl:t,isRunningInValueHelpDialog:this.getIsRunningInValueHelpDialog(),model:e,additionalConfiguration:this.getAdditionalConfiguration(),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),defaultTokenDisplayBehaviour:this.data("defaultTokenDisplayBehaviour"),defaultSingleFieldDisplayBehaviour:this.data("defaultSingleFieldDisplayBehaviour"),defaultFilterBarExpanded:this.data("defaultFilterBarExpanded"),defaultShowAllFilters:this.data("defaultShowAllFilters"),dateFormatSettings:this.data("dateFormatSettings"),calendarWeekSettings:this.data("calendarWeekSettings"),useContainsAsDefaultFilter:this.data("useContainsAsDefaultFilter"),smartFilter:this,filterBarClass:B,considerAnalyticalParameters:this.getConsiderAnalyticalParameters(),useDateRangeType:this.getUseDateRangeType(),considerSelectionVariants:this.getConsiderSelectionVariants(),considerNavigations:this.getUseProvidedNavigationProperties()?this._createArrayFromString(this.getNavigationProperties()):null,suppressValueListsAssociation:this.getSuppressValueListsAssociation()})};B.prototype._createArrayFromString=function(e){return!e?[]:e.split(",").filter(function(e){return e!==""?e.trim():false})};B.prototype._attachAdditionalConfigurationChanged=function(){var e,t,i,r;t=this.getGroupConfiguration();r=t.length;for(i=0;i<r;i++){t[i].attachChange(this._handleGroupConfigurationChanged.bind(this))}e=this.getControlConfiguration();r=e.length;for(i=0;i<r;i++){e[i].attachChange(this._handleControlConfigurationChanged.bind(this))}};B.prototype._handleControlConfigurationChanged=function(e){var t,i,r,a,n;t=e.getParameter("propertyName");i=e.oSource;if(!i){return}a=i.getKey();r=this._getFilterItemByName(a);if(!r){this._handleControlConfigurationChangedForDelayedFilterItems(a,i,t);return}if(t==="visible"){n=i.getVisible();r.setVisible(n)}else if(t==="label"){n=i.getLabel();r.setLabel(n)}else if(t==="visibleInAdvancedArea"){n=i.getVisibleInAdvancedArea();if(r.setVisibleInAdvancedArea){r.setVisibleInAdvancedArea(n)}}};B.prototype._handleControlConfigurationChangedForDelayedFilterItems=function(e,t,i){var r,a;if(this._aFilterBarViewMetadata){this._aFilterBarViewMetadata.some(function(t){t.fields.some(function(t){if(t.fieldName===e){a=t}return!!a});return!!a})}if(a){if(i==="visible"){r=t.getVisible();a.isVisible=r}else if(i==="label"){r=t.getLabel();a.label=r}else if(i==="visibleInAdvancedArea"){r=t.getVisibleInAdvancedArea();a.visibleInAdvancedArea=r}}};B.prototype._handleGroupConfigurationChanged=function(e){var t,i;t=e.getParameter("propertyName");i=e.oSource;if(t==="label"){this._handleGroupConfigurationLabelChanged(i)}};B.prototype._handleGroupConfigurationLabelChanged=function(e){var t,i,r;if(!e){return}r=e.getLabel();i=e.getKey();t=this._getFilterGroupItemByGroupName(i);if(t){t.setGroupTitle(r)}else{this._handleGroupConfigurationLabelChangedForDelayedFilterItems(i,r)}};B.prototype._handleGroupConfigurationLabelChangedForDelayedFilterItems=function(e,t){var i=null;if(this._aFilterBarViewMetadata){this._aFilterBarViewMetadata.some(function(t){if(t.groupName===e){i=t}return!!i})}if(i){i.groupLabel=t}};B.prototype._getFilterItemByName=function(e){return this.determineFilterItemByName(e)};B.prototype._getFilterGroupItemByGroupName=function(e){return this.determineFilterItemByName(e)};B.prototype.determineControlByFilterItem=function(e,t){V.warning("Using deprecated method: sap.ui.comp.smartfilterbar.SmartFilterBar#determinControlByFilterItem. Consider changing it with proper one.");return this._determineControlByFilterItem.apply(this,arguments)};B.prototype._determineControlByFilterItem=function(e,t){return r.prototype.determineControlByFilterItem.apply(this,arguments)};B.prototype.determineControlByName=function(e,t){V.warning("Using deprecated method: sap.ui.comp.smartfilterbar.SmartFilterBar#determineControlByName. Consider changing it with proper one.");return this._determineControlByName.apply(this,arguments)};B.prototype._determineControlByName=function(e,t){return r.prototype.determineControlByName.apply(this,arguments)};B.prototype.getAdditionalConfiguration=function(){return new s(this.getControlConfiguration(),this.getGroupConfiguration())};B.prototype.setEntityType=function(e){this.setProperty("entityType",e);this._initializeMetadata();return this};B.prototype.setEntitySet=function(e){this.setProperty("entitySet",e);this._initializeMetadata();return this};B.prototype.setResourceUri=function(e){this.setProperty("resourceUri",e);this._initializeMetadata();return this};B.prototype.propagateProperties=function(){r.prototype.propagateProperties.apply(this,arguments);this._initializeMetadata()};B.prototype._getFilterInformation=function(){var e=this.data("hiddenFields"),t,i,a,n=0,o=0,s,l=[],d;if(this._aFilterBarViewMetadata){n=this._aFilterBarViewMetadata.length;for(i=0;i<n;i++){t=this._aFilterBarViewMetadata[i];s=t.fields;o=s.length;for(a=0;a<o;a++){d=s[a];if(Array.isArray(e)&&e.indexOf(d.name)!==-1){continue}else if(d.name===u.BASIC_SEARCH_FIELD_ID){this.setBasicSearch(d.control);this._attachToBasicSearch(d.control);continue}else if(t.groupName===u.BASIC_FILTER_AREA_ID){this._createFieldInAdvancedArea({groupName:r.INTERNAL_GROUP,groupLabel:""},d)}else{this._createFieldInAdvancedArea(t,d)}l.push(d)}}var h=this.getAnalyticalParameters();n=h.length;for(i=0;i<n;i++){d=h[i];this._createAnalyticParameter(d);l.push(d)}}return l};B.prototype._validateState=function(){var e,t,i,r=false;e=this.getAllFilterItems(true);if(Array.isArray(e)){t=e.length;while(t--){i=this._determineControlByFilterItem(e[t],true);if(i){if(i.__bValidatingToken){this.bIsSearchPending=true;r=true;break}else if(i.getValueState&&i.getValueState()===I.Error&&!i.data("__mandatoryEmpty")){r=true;break}}}}if(this._oFilterProvider&&this._oFilterProvider._mConditionTypeFields){var a=Object.keys(this._oFilterProvider._mConditionTypeFields);for(var n=0;n<a.length;n++){var o=a[n];var s=this._oFilterProvider._mConditionTypeFields[o].conditionType;i=s&&s._oInput;if(i&&i.getValueState&&i.getValueState()===I.Error&&!i.data("__mandatoryEmpty")){r=true;break}}}if(this._oFilterProvider){return!r&&!this._oFilterProvider._validateConditionTypeFields()}else{return!r}};B.prototype._isDateRangeTypeFilter=function(e){return!!(this._oFilterProvider&&this._oFilterProvider._mConditionTypeFields[e])};B.prototype._specialControls=function(e,t){return!!(e.setValue&&(this._isDateRangeTypeFilter(t)||e.isA("sap.m.DatePicker")))};B.prototype._clearErroneusControlValues=function(){var e,t,i,r,a,n=null,o=false;e=this.getAllFilterItems(false);if(e){t=e.length;while(t--){i=this._determineControlByFilterItem(e[t],true);if(i){if(i.getValueState&&i.getValueState()===I.Error){r=i.getBinding("value");a=this._oFilterProvider.oModel;if(a){n=a.getProperty("/"+e[t].getName())}o=n!==null&&n!==undefined&&(n===i.getValue()||typeof n.hasOwnProperty==="function"&&n.hasOwnProperty("value")&&n.value===i.getValue());if(r&&!o&&!this._specialControls(i,e[t].getName())){r.checkUpdate(true)}else if(i.data("__validationError")){if(i.isA("sap.m.MultiInput")){i.setValueState(I.None);i.setValue("")}else if(i.isA("sap.m.Input")){i.setValueState(I.None);i.setValue(n);if(n!==null){i.fireChange({value:n,newValue:n})}}}else if(i.setValue){i.resetProperty("value");i.setValueState(I.None)}}}}}};B.prototype._attachToBasicSearch=function(e){if(e){e.attachSearch(function(e){if(e&&e.getParameter("clearButtonPressed")){return}if(!this.isDialogOpen()){this._searchFromFilterBar()}}.bind(this));e.attachChange(this._onChange.bind(this))}};B.prototype._onLiveChange=function(e){var t=e.getSource();if(t.data("__validationError")&&!t.getValue()){t.data("__validationError",null);t.setValueState(I.None);delete t.__sValidationText}};B.prototype._onChange=function(e){var t=e.getSource(),i=t._oFieldViewMetadata,r=this._oFilterProvider._oMetadataAnalyser,a=this._oFilterProvider._bUpdatingFilterData||this._oFilterProvider._bCreatingInitialModel;if(t.data("__mandatoryEmpty")){t.data("__mandatoryEmpty",null);t.setValueState(I.None)}if(t.data("__validationError")&&!t.getValue()){t.data("__validationError",null);t.setValueState(I.None)}if(t.isA("sap.m.ComboBox")&&t.getValue()){this._filterSetInErrorState(t);if(!t.getSelectedItem()){t.data("__validationError",true);t.setValueState(I.Error);if(!a){this.fireFilterChange(e)}return}if(t.data("__validationError")){t.data("__validationError",null);t.setValueState(I.None)}}if(i&&r&&r.getMultiUnitBehaviorEnabled()){if(i.isMeasureField){this._setWarningState(t)}if(M.isUnitOfMeasure(i)||M.isCurrencyCode(i)){this._clearWarningState(t)}}if(a){return}if(!t||t&&!t.__bValidatingToken){this.fireFilterChange(e);this._oFilterProvider._updateConditionTypeFields(e.getParameter("filterChangeReason"))}else{this._filterSetInErrorState(t)}if(this.isLiveMode()){if(e.getSource().isA("sap.m.MultiComboBox")||e.getSource().isA("sap.m.ComboBox")){this.triggerSearch()}else{this._searchFromFilterBar()}}};B.prototype._setWarningState=function(e){var t=e._oFieldViewMetadata,i=this._oFilterProvider&&this._oFilterProvider._getFieldMetadata(t.unit),r=i&&i.label,a=this._oResourceBundle.getText("UNIT_WARNING_TEXT",r),n=this._checkIfFilterHasValue(t.name),o=i&&this._checkIfFilterHasValue(i.name);if(!i||i.filterRestriction==="single"||M.isHidden(i)||M.isHiddenFilter(i)){return}if(!o&&n){setTimeout(function(){e.setValueState(I.Warning);e.setValueStateText(a)})}if(!n){e.setValueState(I.None)}};B.prototype._clearWarningState=function(e){var t=e._oFieldViewMetadata,i=t&&t.name,r=t&&t.label,a=this._oResourceBundle.getText("UNIT_WARNING_TEXT",r),n,o=this._checkIfFilterHasValue(t.name),s;if(t.filterRestriction==="single"){return}this._oFilterProvider.aAllFields.forEach(function(e){if(e.isCurrencyField&&e["Org.OData.Measures.V1.ISOCurrency"].Path===i||e.isMeasureField&&e["Org.OData.Measures.V1.Unit"]&&e["Org.OData.Measures.V1.Unit"].Path===i){n=this.getControlByKey(e.name);if(n){s=this._checkIfFilterHasValue(e.name);if(o&&n.getValueState()===I.Warning){n.setValueState(I.None)}if(!o&&s&&n.getValueState()===I.None){n.setValueState(I.Warning);n.setValueStateText(a)}}}}.bind(this))};B.prototype._handleChange=function(e){if(e){if(e.attachChange){e.attachChange(this._onChange.bind(this))}if(e.attachLiveChange){e.attachLiveChange(this._onLiveChange.bind(this))}}};B.prototype._handleSelectionChange=function(e){if(e){if(e.attachSelectionChange){e.attachSelectionChange(this._onChange.bind(this))}}};B.prototype._handleEnter=function(e){if(this.isLiveMode()){return}e.attachBrowserEvent("keydown",function(t){if(t.which===13){e.__bSuggestInProgress=e._oSuggestionPopup&&e._oSuggestionPopup.isOpen()}});e.attachBrowserEvent("keyup",function(t){if(t.which===13&&!e.__bSuggestInProgress&&(e.isA("sap.m.InputBase")||e.isA("sap.m.Select")||e.isA("sap.m.DynamicDateRange"))){this._searchFromFilterBar()}}.bind(this))};B.prototype._createFilterFieldControl=function(e){if(e.conditionType){e.control=e.conditionType.initializeFilterItem()}else if(!e.control&&e.fCreateControl){e.fCreateControl(e);delete e.fCreateControl}this._handleEnter(e.control);this._handleChange(e.control);if(e.isCustomFilterField&&e.control.isA("sap.m.MultiComboBox")){this._handleSelectionChange(e.control)}};B.prototype._createAnalyticParameter=function(e){e.factory=function(){this._createFilterFieldControl(e);if(!e.control){return}var t=new a({controlTooltip:e.quickInfo,name:e.fieldName,mandatory:e.isMandatory,visible:e.isVisible,control:e.control,hiddenFilter:false});this._setLabel(t,e.label);this._addParameter(t)}.bind(this);e.groupName=r.INTERNAL_GROUP;return e};B.prototype._createFieldInAdvancedArea=function(e,t){t.factory=function(){this._createFilterFieldControl(t);var i=new a({controlTooltip:t.quickInfo,name:t.fieldName,groupName:e.groupName,groupTitle:e.groupLabel,entitySetName:t.groupEntitySet,entityTypeName:t.groupEntityType,mandatory:t.isMandatory,visible:t.isVisible,visibleInAdvancedArea:t.visibleInAdvancedArea||e.groupName===r.INTERNAL_GROUP,control:t.control,hiddenFilter:t.hiddenFilter});if(t.isCustomFilterField){i.data("isCustomField",true);this._attachCustomControlCustomDataChange(i._getControl().getCustomData())}if(t.control&&t.control.getTooltip&&t.control.getTooltip()){i.setControlTooltip(t.control.getTooltip())}if(t.quickInfo){this._setLabelTooltip(i,t.quickInfo)}this._setLabel(i,t.label);this.addFilterGroupItem(i)}.bind(this);t.groupName=e.groupName;t.groupTitle=e.groupLabel;return t};B.prototype._setLabel=function(e,t){if(t.match(/{@i18n>.+}/gi)){e.bindProperty("label",t.substring(1,t.length-1))}else{e.setLabel(t)}};B.prototype._setLabelTooltip=function(e,t){var i=/{(@?i18n>.+)}/i.exec(t);if(i&&i[1]){e.bindProperty("labelTooltip",i[1])}else{e.setLabelTooltip(t)}};B.prototype._logAccessWhenNotInitialized=function(e){if(!this.bIsInitialised){V.error("SmartFilterBar."+e+": called before the SmartFilterBar is initialized")}};B.prototype.ensureLoadedValueHelp=function(e){this._logAccessWhenNotInitialized("ensureLoadedValueHelp");if(this._oFilterProvider){this._oFilterProvider.getAssociatedValueHelpProviders().some(function(t){if(t.sFieldName===e){this._ensureLoadedValueHelpList(t);return true}}.bind(this))}};B.prototype.ensureLoadedValueList=function(e){if(this._oFilterProvider){this._oFilterProvider.getAssociatedValueListProviders().some(function(t){if(t.sFieldName===e){this._ensureLoadedValueHelpList(t);return true}}.bind(this))}};B.prototype._ensureLoadedValueHelpList=function(e){if(!e._bValueListRequested){e.loadAnnotation()}};B.prototype._getValueListHelpProvider=function(e){var t=null;if(this._oFilterProvider){this._oFilterProvider.getAssociatedValueListProviders().some(function(i){if(i.sFieldName===e){t=i}return t!=null});if(!t){this._oFilterProvider.getAssociatedValueHelpProviders().some(function(i){if(i.sFieldName===e){t=i}return t!=null})}}return t};B.prototype.getDescriptionForKeys=function(e){var t=[];if(e){e.forEach(function(e){var i=this._getValueListHelpProvider(e.filterName);if(i){if(!i._bValueListRequested){i.loadAnnotation()}e.provider=i;t.push(e)}}.bind(this));if(t&&t.length>0){t.forEach(function(e){if(e.provider){e.provider.readData(e.keys)}})}}};B.prototype.ensureLoadedValueHelpList=function(e){this.ensureLoadedValueHelp(e);this.ensureLoadedValueList(e)};B.prototype.getFilters=function(e){this._logAccessWhenNotInitialized("getFilters");if(!e||!e.length){if(this.getIsRunningInValueHelpDialog()){e=this._getAllFieldNames()}else{e=this._getVisibleFieldNames(true)}}return this._oFilterProvider?this._oFilterProvider.getFilters(e):[]};B.prototype.getParameters=function(){this._logAccessWhenNotInitialized("getParameters");return this._oFilterProvider?this._oFilterProvider.getParameters():{}};B.prototype.getAnalyticBindingPath=function(){var e="";this._logAccessWhenNotInitialized("getAnalyticBindingPath");if(this._oFilterProvider){e=this._oFilterProvider.getAnalyticBindingPath()}return e};B.prototype.getParameterBindingPath=function(){return this.getAnalyticBindingPath()};B.prototype.getControlByKey=function(e){V.warning("Using deprecated method: sap.ui.comp.smartfilterbar.SmartFilterBar#getControlByKey. Consider changing it with proper one.");this._logAccessWhenNotInitialized("getControlByKey");if(this._oRulesLog){this._oRulesLog.setInvokedMethod("getControlByKey",true)}return this._determineControlByName(e)};B.prototype._getAllFieldNames=function(){var e,t=[],i,r,a;if(this._oFilterProvider&&this._oFilterProvider._oMetadataAnalyser){e=this._oFilterProvider._oMetadataAnalyser.getFieldsByEntitySetName(this.getEntitySet())}if(e){r=e.length;for(i=0;i<r;i++){a=e[i];if(a){t.push(a.name)}}}return t};B.prototype._getAllFilterAndParameterNames=function(e){var t=[],i=this.getAllFilterItems(false),r=i.length,a;while(r--){a=i[r];if(a){if(e&&a._isParameter()){continue}t.push(a.getName())}}return t};B.prototype._getVisibleFieldNames=function(e,t){var i=[],r=this.getAllFilterItems(true),a=r.length,n,o,s,l=false;if(t===undefined){t=true}while(a--){n=r[a];if(!n){continue}o=n._getControl&&n._getControl();s=n._isParameter()&&e;if(!t&&o&&o.getValueState&&o.getValueState()===I.Error){l=true}if(s||l){l=false;continue}i.push(n.getName())}return i};B.prototype._checkHasValueData=function(e){if(!e||e==="false"){return false}if(typeof e==="boolean"){return e}else if(typeof e==="string"&&e.toLowerCase()==="true"){return true}return false};B.prototype._checkForValues=function(e,t,i){var r,a=true,n=null,o;if(e&&t&&i){r=t.getName();if(!t.data("isCustomField")){n=e[r];if(!n&&i.getSelectedItem&&i.getSelectedItem()){o=u._getFieldMetadata(this._aFilterBarViewMetadata,r);if(o&&o.type==="Edm.Boolean"){if(i.getSelectedItem().getKey()===""){return false}}return true}if(!n&&i.getSelectedKey&&i.getSelectedKey()){return true}if(r.indexOf(E)===0&&Array.isArray(this._aAnalyticalFilterBarViewMetadata)){o=u._getAnalyticalFieldMetadata(this._aAnalyticalFilterBarViewMetadata,r)}else if(Array.isArray(this._aFilterBarViewMetadata)){o=u._getFieldMetadata(this._aFilterBarViewMetadata,r)}if(o&&o.hasValidation===false){a=o.hasValidation}if(n&&i.isA("sap.m.ComboBox")&&a&&!i.getItemByKey(n.toString())){return false}if(n===undefined){return false}}else{var s=i.data("hasValue");if(s!==undefined&&s!=null){return this._checkHasValueData(s)}else{if(i.getValue){if(i.getValue()){return true}}if(i.getSelectedItem&&i.getSelectedItem()){return true}if(i.getSelectedKey&&i.getSelectedKey()){return true}if(i.getSelectedKeys&&i.getSelectedKeys().length>0){return true}if(i.getTokens&&i.getTokens().length>0){return true}}}}return!!n};B.prototype.getFiltersWithValues=function(){this._logAccessWhenNotInitialized("getFiltersWithValues");return this._getFiltersWithAssignedValues(true)};B.prototype.getAllFiltersWithValues=function(){return this._getFiltersWithAssignedValues(false)};B.prototype._getFiltersWithAssignedValues=function(e){var t=[];var i=this.getAllFilterItems(e),r,a,n=0,o;if(e){r=this.getFilterData()}else if(this._oFilterProvider){r=this._bSetFilterDataSuspended?this._oStoredFilterData:this._oFilterProvider.getFilledFilterData(this._getAllFilterAndParameterNames())}if(i&&r){n=i.length;while(n--){a=i[n];o=this._determineControlByFilterItem(a,true);if(this._checkForValues(r,a,o)){t.push(a)}}}return t.reverse()};B.prototype._checkIfFilterHasValue=function(e,t){var i=t||this._oFilterProvider.getFilterData();var r=i[e]||i._CUSTOM&&i._CUSTOM[e];if(r===null||typeof r==="undefined"){return false}if(typeof r==="string"&&r){return true}if(typeof r==="number"){return true}if(typeof r==="object"&&Object.prototype.toString.call(r)==="[object Date]"){return true}if(typeof r==="object"&&(r.hasOwnProperty("low")||r.hasOwnProperty("high"))){return!!r.low||!!r.high}if(typeof r==="object"&&(r.hasOwnProperty("value")||r.hasOwnProperty("items")||r.hasOwnProperty("ranges"))){return!!r.value||r.items&&!!r.items.length||r.ranges&&!!r.ranges.length}return false};B.prototype._checkIfCustomControlFilterHasValue=function(e){if(!e.control){return false}return e.control.data("hasValue")};B.prototype._removeEmptyFilters=function(e){var t=JSON.parse(e);var i={};Object.keys(t).forEach(function(e){if(e==="_CUSTOM"||this._checkIfFilterHasValue(e)){i[e]=t[e]}}.bind(this));return JSON.stringify(i)};B.prototype._removeValuesForNonPartOfCurrentVariants=function(e){var t=[];if(this._oFilterProvider&&e&&e.length>0){var i=this._oFilterProvider.getFilterData();e.forEach(function(e){var r=e.getName();if(!e.data("isCustomField")){var a=this._oFilterProvider._getFieldMetadata(r);if(a.conditionType){t.push(a)}this._oFilterProvider._createInitialModelForField(i,a,false)}else if(i._CUSTOM&&i._CUSTOM[r]){delete i._CUSTOM[r]}},this);this.setFilterData(i);t.forEach(function(e){var t=e.fieldName;this._oFilterProvider._mConditionTypeFields[t].conditionType.initialize(i[t])},this)}};B.prototype.getFilterDataAsStringForVariant=function(e,t){var i={},r=this._oFilterProvider._aFilterBarDateTimeFieldNames;i=b(i,this.getFilterData(e));r.forEach(function(e){var t,r,a=u._getFieldMetadata(this._aFilterBarViewMetadata,e);if(a&&a.type==="Edm.DateTimeOffset"){r=i[e];if(r&&r.low){if(a.filterRestriction===T.interval){t=f.parseDateTimeOffsetInterval(r.low);if(t&&t.length===2){r.low=a.ui5Type.parseValue(t[0],"string");r.high=a.ui5Type.parseValue(t[1],"string")}}}}}.bind(this));this._oFilterProvider._aFilterBarDateFieldNames.concat(this._oFilterProvider._aFilterBarTimeFieldNames).forEach(function(e){var t,r=u._getFieldMetadata(this._aFilterBarViewMetadata,e);if(!r){r=this.getParameterMetadata(e)}if(r&&(r.filterType==="date"||r.filterType==="time")){t=i[e];var a=this._oFilterProvider._isSingleDynamicDateEnabled(r);if(t){var n=t.conditionTypeInfo;if(r.filterRestriction===T.multiple||r.filterRestriction===T.auto){this._processDateRanges(t.ranges)}else if(r.filterRestriction===T.single&&a){this._processDateRanges(t.ranges)}else if(r.filterRestriction===T.single){i[e]=this._dateConvert(t)}else if(r.filterRestriction===T.interval){if(t.ranges){this._processDateRanges(t.ranges)}else{if(t.low){t.low=this._dateConvert(t.low)}if(t.high){t.high=this._dateConvert(t.high)}}}if(n&&n.data){if(n.data.value1&&n.data.value1 instanceof Date){n.data.value1=this._dateConvert(n.data.value1)}if(n.data.value2&&n.data.value2 instanceof Date){n.data.value2=this._dateConvert(n.data.value2)}}}}}.bind(this));return JSON.stringify(i)};B.prototype._dateConvert=function(e){if(this.isInUTCMode()){if(typeof e==="string"){e=m.getInstance(e)}e=t.localToUtc(e).toJSON()}if(e.indexOf&&e.indexOf("Z")===e.length-1){e=e.substr(0,e.length-1)}return e};B.prototype._processDateRanges=function(e){if(!Array.isArray(e)){return}e.forEach(function(e){e.tokenText=null;if(e.value1){e.value1=this._dateConvert(e.value1)}if(e.value2){e.value2=this._dateConvert(e.value2)}}.bind(this))};B.prototype.getFilterData=function(e,t){if(this._bSetFilterDataSuspended){return Object.assign({},this._oStoredFilterData)}var i=this._oFilterProvider;this._logAccessWhenNotInitialized("getFilterData");if(!i){return null}if(t===undefined){t=false}return e?i.getFilterData():i.getFilledFilterData(this._getVisibleFieldNames(false,t))};B.prototype.getFilterDataAsString=function(e){var t=this._oFilterProvider;this._logAccessWhenNotInitialized("getFilterDataAsString");if(!t){return null}return e?t.getFilterDataAsString():t.getFilledFilterDataAsString(this._getVisibleFieldNames(false,false))};B.prototype.getParameterMetadata=function(e){var t=null,i=this.getAnalyticalParameters();if(e.indexOf(o.ANALYTICAL_PARAMETER_PREFIX)===0){e=e.substring(o.ANALYTICAL_PARAMETER_PREFIX.length)}if(Array.isArray(i)){i.some(function(i){if(i.name===e){t=i}return t!==null})}return t};B.prototype.setFilterDataAsStringFromVariant=function(e,t,i){var r,a=this._oFilterProvider._aFilterBarDateTimeFieldNames;if(e){r=JSON.parse(e);a.forEach(function(e){var t,i=u._getFieldMetadata(this._aFilterBarViewMetadata,e);if(i&&i.type==="Edm.DateTimeOffset"){t=r[e];if(t&&(i.filterRestriction===T.multiple||i.filterRestriction===T.auto)){if(t.ranges){for(var a=0;a<t.ranges.length;a++){delete t.ranges[a].tokenText}}}}}.bind(this));this._oFilterProvider._aFilterBarDateFieldNames.concat(this._oFilterProvider._aFilterBarTimeFieldNames).forEach(function(e){var t,i=u._getFieldMetadata(this._aFilterBarViewMetadata,e);if(!i){i=this.getParameterMetadata(e)}if(i&&(i.filterType==="date"||i.filterType==="time")){t=r[e];if(t){if(t.ranges){for(var a=0;a<t.ranges.length;a++){delete t.ranges[a].tokenText}}}}}.bind(this));this.setFilterData(r,t)}};B.prototype.setFilterData=function(e,t){if(this._bSetFilterDataSuspended){if(t){this._oStoredFilterData=e}else{this._oStoredFilterData=Object.assign({},this._oStoredFilterData,e)}return}this._setFilterData(e,t)};B.prototype.suspendSetFilterData=function(){this._bSetFilterDataSuspended=true};B.prototype.resumeSetFilterData=function(){if(this._bSetFilterDataSuspended){this._bSetFilterDataSuspended=false;this.setFilterData(this._oStoredFilterData,true);this._oStoredFilterData={}}};B.prototype._setFilterData=function(e,t){var i;this._logAccessWhenNotInitialized("setFilterData");if(e){Object.keys(e).forEach(function(t){i=this._getFilterMetadata(t);if(i&&this._checkIfFilterHasValue(t,e)){this._instanciateFilterItem(i)}}.bind(this))}if(this._oFilterProvider){this._oFilterProvider.setFilterData(e,t)}if(e&&Object.keys(e).length===1&&e._CUSTOM){return}this.fireFilterChange({afterFilterDataUpdate:true})};B.prototype.setFilterDataAsString=function(e,t){if(e){this.setFilterData(JSON.parse(e),t)}};B.prototype._isFilterBarContext=function(){return false};B.prototype.fireClear=function(){this._clearFilterFields();this.fireEvent("clear",arguments)};B.prototype._clearFilterFields=function(){if(this._oFilterProvider){this._oFilterProvider.clear();this._clearErroneusControlValues()}this.fireFilterChange({afterFilterDataUpdate:true})};B.prototype.fireReset=function(){this._resetFilterFields();this.fireEvent("reset",arguments)};B.prototype._resetFilterFields=function(){if(this._oFilterProvider){this._oFilterProvider.reset();this._clearErroneusControlValues()}this.fireFilterChange({afterFilterDataUpdate:true})};B.prototype._suspendedTriggerSearch=function(e){if(this.getSuppressSelection()){return}this._oSuspendedTriggerSearch={delay:e};return true};B.prototype._regularTriggerSearch=function(e){if(this.getSuppressSelection()){return}this._clearDelayedSearch();this._iDelayedSearchId=setTimeout(function(){var e=this._getVisibleControlsLoadingPromises();if(!this._bSearchTriggeredOnce&&e.length){Promise.all(e).then(this._search.bind(this)).catch(this._search.bind(this))}else{this._search()}}.bind(this),e||0)};B.prototype.suspendSelection=function(){this.triggerSearch=this._suspendedTriggerSearch};B.prototype.resumeSelection=function(){this.triggerSearch=this._regularTriggerSearch;if(this._oSuspendedTriggerSearch){this.triggerSearch(this._oSuspendedTriggerSearch.delay);this._oSuspendedTriggerSearch=undefined}};B.prototype.triggerSearch=B.prototype._regularTriggerSearch;B.prototype._getVisibleControlsLoadingPromises=function(){var e=[];this.determineMandatoryFilterItems().forEach(function(t){var r=t._getControl();if(r&&!t.data("isCustomField")&&r.isA("sap.m.ComboBox")&&!r.getItems().length){e.push(new Promise(function(e){var t=r.getBinding("items"),a;if(t){t.attachEventOnce("dataReceived",e);return}a=new i(function(t){if(t&&t.mutation==="ready"){r.getBinding("items").attachEventOnce("dataReceived",e);a.unobserve(r,{bindings:["items"]})}});a.observe(r,{bindings:["items"]});this._oObservers.push(a)}.bind(this)))}}.bind(this));return e};B.prototype.search=function(e){if(this.getSuppressSelection()){return undefined}this._logAccessWhenNotInitialized("search");if(e&&!this.isLiveMode()){return this._search()}this.triggerSearch(0);return true};B.prototype._search=function(){var t=true,i=false,r,a,n;this._bSearchTriggeredOnce=true;a=this.verifySearchAllowed();if(a.hasOwnProperty("pending")){if(this._iDelayedSearchId&&!this.getSuppressSelection()){this.triggerSearch()}return undefined}else if(a.hasOwnProperty("error")){t=false;i=true}else if(a.hasOwnProperty("mandatory")){t=false}if(this.isPending()&&!this._bIsPendingChangeAttached){n=function(e){if(e.getParameter("pendingValue")===false){this.detachPendingChange(n);this._bIsPendingChangeAttached=false;this.triggerSearch()}}.bind(this);this._bIsPendingChangeAttached=true;this.attachPendingChange(n);return undefined}this._clearDelayedSearch();if(t){if(this._isTablet()&&this.getUseToolbar()&&!this.getAdvancedMode()){this.setFilterBarExpanded(false)}this.fireSearch([{selectionSet:this._retrieveCurrentSelectionSet(false,true),firedFromFilterBar:this._bSearchFiredFromFilterBar}]);this._bSearchFiredFromFilterBar=false}else{if(!i){if(!this._sMandatoryErrorMessage){this._sMandatoryErrorMessage=this._oResourceBundle.getText("EMPTY_MANDATORY_MESSAGE")}r=this._sMandatoryErrorMessage}else{if(!this._sValidationErrorMessage){this._sValidationErrorMessage=this._oResourceBundle.getText("VALIDATION_ERROR_MESSAGE")}r=this._sValidationErrorMessage}if(this.getShowMessages()&&!this.getLiveMode()){try{e.error(r,{styleClass:this.$()&&this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:this._setFocusOnFirstErroneousField.bind(this)})}catch(e){return undefined}}else{this._setFocusOnFirstErroneousField();V.warning("search was not triggered. "+r);if(C.system.desktop){this.setFilterBarExpanded(true)}}if(this._bExpandAdvancedFilterArea&&this.rerenderFilters){this.rerenderFilters(true)}}return t};B.prototype.validateMandatoryFields=function(){this._logAccessWhenNotInitialized("validateMandatoryFields");return this._validateMandatoryFields()};B.prototype.verifySearchAllowed=function(){this._logAccessWhenNotInitialized("verifySearchAllowed");this.bIsSearchPending=false;if(this._validateState()){if(this.validateMandatoryFields()){return{}}return{mandatory:true}}if(this.bIsSearchPending){return{pending:true}}return{error:true}};B.prototype.checkSearchAllowed=function(){this._logAccessWhenNotInitialized("checkSearchAllowed");var e=false,t=null;this.bIsSearchPending=false;if(this._validateState()){t=this._checkMandatoryFields();if(!t.emptyMandatory&&!t.valueStateInError){e=true}}if(this.bIsSearchPending){e=false}return e};B.prototype._setFocusOnFirstErroneousField=function(){var e,t,i,r;e=this.getAllFilterItems(true);if(Array.isArray(e)){t=e.length;for(r=0;r<t;r++){i=this._determineControlByFilterItem(e[r],true);if(i&&i.getValueState&&i.getValueState()===I.Error){setTimeout(i["focus"].bind(i),0);break}}}};B.prototype.setLiveMode=function(e){if(!this._isPhone()){if(e){this.hideGoButton()}else{this.restoreGoButton()}}if(this._oSmartVariantManagement){if(e){if(this._bShowShareState===undefined){this._bShowShareState=this._oSmartVariantManagement.getShowExecuteOnSelection()}this._oSmartVariantManagement.setShowExecuteOnSelection(false)}else if(this._bShowShareState!==undefined){this._oSmartVariantManagement.setShowExecuteOnSelection(this._bShowShareState)}}return this.setProperty("liveMode",e)};B.prototype.isLiveMode=function(){return this._isPhone()?false:this.getLiveMode()};B.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){clearTimeout(this._iDelayedSearchId);this._iDelayedSearchId=null}};B.prototype.isPending=function(){return!this._oFilterProvider?false:this._oFilterProvider.isPending()};B.prototype._validateMandatoryFields=function(){var e=true,t=this.determineMandatoryFilterItems(),i,r=this.getFilterData(false,true),a=0,n;this._bExpandAdvancedFilterArea=false;if(t&&r){a=t.length;while(a--){i=t[a];n=this._determineControlByFilterItem(i,true);if(n&&n.setValueState){if(this._checkForValues(r,i,n)){if(n.data("__mandatoryEmpty")){n.data("__mandatoryEmpty",null);n.setValueState(I.None)}}else{e=false;if(n.setValueStateText){if(i.getLabel&&i.getLabel()){n.setValueStateText(this._oResourceBundle.getText("MANDATORY_FIELD_WITH_LABEL_ERROR",[i.getLabel()]))}else{n.setValueStateText(this._oResourceBundle.getText("MANDATORY_FIELD_ERROR"))}}n.setValueState(I.Error);n.data("__mandatoryEmpty",true);if(i.getGroupName){this._bExpandAdvancedFilterArea=true}}}}}return e};B.prototype._checkMandatoryFields=function(){this._logAccessWhenNotInitialized("checkMandatoryFields");var e=false,t=false,i=this.determineMandatoryFilterItems(),r,a=this.getFilterData(),n=0,o;if(i&&a){n=i.length;while(n--){r=i[n];o=this._determineControlByFilterItem(r,true);if(o){if(!this._checkForValues(a,r,o)){e=true}if(o.getValueState&&o.getValueState()===I.Error){t=true}}}}return{emptyMandatory:e,valueStateInError:t}};B.prototype._setSmartVariant=function(e){var t;if(!e){return}t=sap.ui.getCore().byId(e);if(t){if(t.isA("sap.ui.comp.smartvariants.SmartVariantManagement")){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._replaceVariantManagement(t);this._oSmartVariantManagement=t}}else{V.error("Control with the id="+e+" not of expected type")}}else{V.error("Control with the id="+e+" not found")}};B.prototype.setSmartVariant=function(e){if(this.getAdvancedMode()){V.error("not supported for the advanced mode");return this}this.setAssociation("smartVariant",e);this._setSmartVariant(e);return this};B.prototype.getSmartVariant=function(){if(this.getAdvancedMode()){V.error("not supported for the advanced mode");return null}var e=this.getAssociation("smartVariant");if(e){return sap.ui.getCore().byId(e)}return this._oSmartVariantManagement};B.prototype._createVariantManagement=function(){if(this.getAdvancedMode()){return r.prototype._createVariantManagement.apply(this)}this._setSmartVariant(this.getSmartVariant());if(!this._oSmartVariantManagement){this._oSmartVariantManagement=new c(this.getId()+"-variant",{showExecuteOnSelection:true,showShare:true})}return this._oSmartVariantManagement};B.prototype._initializeVariantManagement=function(){if(!this.getIsRunningInValueHelpDialog()&&this._oSmartVariantManagement&&this.getPersistencyKey()){var e=new p({type:"filterBar",keyName:"persistencyKey",dataSource:this.getEntitySet()||this.getEntityType()});e.setControl(this);if(this.getConsiderSelectionVariants()&&!this._oSmartVariantManagement.isPageVariant()){this._oSmartVariantManagement._createMetadataPromise();this._prepareSelectionVariants();this._oSmartVariantManagement._resolveMetadataPromise()}this._oSmartVariantManagement.addPersonalizableControl(e);if(this._checkHasValueData(this.data("executeStandardVariantOnSelect"))){this._oSmartVariantManagement._executeOnSelectForStandardVariantByXML(true)}r.prototype._initializeVariantManagement.apply(this,arguments)}else{this.fireInitialise();this.fireInitialized()}};B.prototype.fireInitialized=function(){var e=this._getVisibleControlsLoadingPromises();if(e.length&&this.getDomRef()&&!this.getSuppressValueListsAssociation()){Promise.all(e).then(this._fireInitialized.bind(this)).catch(this._fireInitialized.bind(this))}else{this._fireInitialized()}};B.prototype._fireInitialized=function(){if(this.getConsiderSelectionVariants()&&this._oSmartVariantManagement&&!this._oSmartVariantManagement.isPageVariant()){if(this._oStandardSelectionVariant){this._oSmartVariantManagement._oStandardVariant=b({},this._defaultSelectionVariantHandling(this._oStandardSelectionVariant))}if(!this._oSmartVariantManagement._getDefaultVariantKey()){if(this.getDefaultSelectionVariantName()){var e=B.SELECTION_VARIANT_KEY_PREFIX+this.getDefaultSelectionVariantName();this._oSmartVariantManagement.setInitialSelectionKey(e);this._oSmartVariantManagement.fireSelect({key:e})}else if(this._oStandardSelectionVariant){this._oSmartVariantManagement.fireSelect({key:this._oSmartVariantManagement.STANDARDVARIANTKEY})}}this._oStandardSelectionVariant=null}r.prototype.fireInitialized.apply(this,arguments)};B.prototype._prepareSelectionVariants=function(){var e,t=B.SELECTION_VARIANT_KEY_PREFIX,i=[],r=this._oSmartVariantManagement;e=this.getSelectionVariants();if(e){var a={callback:this.getSelectionVariant,handler:this};e.forEach(function(e){var r=t+e.qualifier;if(e.qualifier){i.push({id:r,favorite:true,name:e.annotation.Text.String})}else{this._oStandardSelectionVariant=e}}.bind(this));if(i.length>0){a.variants=i;r.registerSelectionVariantHandler(a,t)}}};B.prototype._defaultSelectionVariantHandling=function(e){var t={},i=this._oSmartVariantManagement,r,a;if(!i||i._sAppStandardVariantKey||!(e&&e.annotation)){return t}t=this.convertSelectionVariantToInternalVariant(e.annotation);if(!t){return t}if(!i.isPageVariant()){t.version="V1";a=JSON.parse(t.filterBarVariant);if(i._oStandardVariant){r=JSON.parse(i._oStandardVariant.filterBarVariant);if(r._CUSTOM){a._CUSTOM=r._CUSTOM;t.filterBarVariant=JSON.stringify(a)}}}return t};B.prototype._adaptFilterVisibilityProperties=function(e){var t,i=[];if(this._oSmartVariantManagement&&this._oSmartVariantManagement._oStandardVariant&&this._oSmartVariantManagement._oStandardVariant.filterbar){b(i,this._oSmartVariantManagement._oStandardVariant.filterbar)}Object.keys(e).forEach(function(e){t=false;i.some(function(i){if(i.name===e){t=true;i.partOfCurrentVariant=true}return t});if(!t){i.push({group:this._determineGroupNameByName(e),name:e,partOfCurrentVariant:true,visibleInFilterBar:false,visible:true})}}.bind(this));return i};B.prototype.getSelectionVariant=function(e){var t=null,i=null,r=e.substring(B.SELECTION_VARIANT_KEY_PREFIX.length);this.getSelectionVariants().some(function(e){if(e.qualifier===r){i=e;return true}return false});if(i){if(i.variantContent){t=i.variantContent}else{t=this.convertSelectionVariantToInternalVariant(i.annotation);i.variantContent=t}}return t};B.prototype.convertSelectionVariantToInternalVariant=function(e){var t=JSON.parse(JSON.stringify(e)),i,r,a,n=t.SelectOptions,o=t.Parameters,s;if(n||o){a=new S(null,"/")}if(n){n.forEach(function(e){e.PropertyName=e.PropertyName.PropertyPath;e.Ranges.forEach(function(e){e.Sign=e.Sign.EnumMember.split("/")[1];e.Option=e.Option.EnumMember.split("/")[1];e.Low=e.Low&&F.format(a,e.Low)||null;e.High=e.High&&F.format(a,e.High)||null})})}if(o){o.forEach(function(e){e.PropertyName=e.PropertyName.PropertyPath.split("/")[1]||e.PropertyName.PropertyPath;e.PropertyValue=F.format(a,e.PropertyValue)||null})}s=new v;i=s.convert(JSON.stringify(t),this,true);r=JSON.parse(i.payload);i={version:"V2",filterbar:this._adaptFilterVisibilityProperties(r),filterBarVariant:JSON.stringify(r)};return i};B.prototype.getBasicSearchControl=function(){return sap.ui.getCore().byId(this.getBasicSearch())};B.prototype.addFieldToAdvancedArea=function(e){var t;this._logAccessWhenNotInitialized("addFieldToAdvancedArea");t=this._getFilterItemByName(e);if(t&&t.setVisibleInAdvancedArea){t.setVisibleInAdvancedArea(true)}};B.prototype._onCustomFieldCustomDataChange=function(e){var t=e.getParameter("newValue"),i=e.getParameter("oldValue"),r=e.getParameter("name");if(i!==t&&r==="value"){this._updateToolbarText()}};B.prototype._attachCustomControlCustomDataChange=function(e){var t,i;for(i=0;i<e.length;i++){t=e[i];if(t.getKey()==="hasValue"){t.attachEvent("_change",this._onCustomFieldCustomDataChange,this);break}}};B.prototype.getConditionTypeByKey=function(e){if(this._oFilterProvider&&this._oFilterProvider._mConditionTypeFields[e]){return this._oFilterProvider._mConditionTypeFields[e].conditionType}if(this._oFilterProvider&&e.indexOf(E)===-1&&this._oFilterProvider._mConditionTypeFields[E+e]){return this._oFilterProvider._mConditionTypeFields[E+e].conditionType}};B.prototype.getDateRangeTypeByKey=function(e){return this.getInitializedPromise().then(function(){if(this._oFilterProvider._mConditionTypeFields[e]){return this._oFilterProvider._mConditionTypeFields[e].conditionType}if(e.indexOf(E)===-1&&this._oFilterProvider._mConditionTypeFields[E+e]){return this._oFilterProvider._mConditionTypeFields[E+e].conditionType}}.bind(this))};B.prototype.setDateRangeTypeOperationByKey=function(e,t){return this.getDateRangeTypeByKey(e).then(function(e){if(e&&typeof e.setOperation==="function"){e.setOperation(t)}})};B.prototype.isInUTCMode=function(){if(this._oFilterProvider&&this._oFilterProvider._oDateFormatSettings){return this._oFilterProvider._oDateFormatSettings.UTC}return false};B.prototype.isInitialised=function(){return!!this.bIsInitialised};B.prototype.associateValueLists=function(){if(this.getSuppressValueListsAssociation()&&this._oFilterProvider){this._oFilterProvider._fireEvent(u.ASSOCIATE_VALUE_LISTS);this._oFilterProvider._bSuppressValueListsAssociation=false;this._valueListAnnotationsLoaded();if(typeof this._enhanceFilterItemsWithTextOnValueListAssociation==="function"){this._enhanceFilterItemsWithTextOnValueListAssociation()}}};B.prototype._refreshFiltersCountOnValueListAnnotationLoaded=function(){for(var e=0;e<this._oFilterProvider._aFilterBarDropdownFieldMetadata.length;e++){var t=this._oFilterProvider._aFilterBarDropdownFieldMetadata[e].control;if(t&&t.isA("sap.m.ComboBox")){t.addEventDelegate({onAfterRendering:function(){this.refreshFiltersCount()}.bind(this)})}}};B.prototype._enhanceFilterItemsWithTextValue=function(e,t){if(!this._enhanceFilterItemsWithTextOnValueListAssociation&&this.getSuppressValueListsAssociation()){this._enhanceFilterItemsWithTextOnValueListAssociation=function(){var e=this.getUiState();r.prototype._enhanceFilterItemsWithTextValue.call(this,e.getValueTexts(),e.getSelectionVariant())}.bind(this)}else{r.prototype._enhanceFilterItemsWithTextValue.apply(this,arguments)}};B.prototype._createVisibleFilters=function(){r.prototype._createVisibleFilters.apply(this,arguments);if(!this.getSuppressValueListsAssociation()&&this._oFilterProvider){this._valueListAnnotationsLoaded()}if(!this.getIsRunningInValueHelpDialog()){this._setInitialFocus()}};B.prototype._valueListAnnotationsLoaded=function(){return this._fireValueListAnnotationLoaded().then(this._refreshFiltersCountOnValueListAnnotationLoaded.bind(this))};B.prototype._attachValueListAnnotationLoaded=function(e,t,i){this.attachEvent("valueListAnnotationLoaded",e,t,i)};B.prototype._fireValueListAnnotationLoaded=function(e){var t=this._oFilterProvider&&Array.isArray(this._oFilterProvider.aFilterAnnotations)?this._oFilterProvider.aFilterAnnotations:[];return Promise.all(t).then(function(){this.fireEvent("valueListAnnotationLoaded",e)}.bind(this))};B.prototype.getSuppressValueListsAssociation=function(){return false};B.prototype.setCustomFilterData=function(e){if(this._oFilterProvider&&this._oFilterProvider.getModel()){this._oFilterProvider.getModel().setProperty("/"+u.CUSTOM_FIELDS_MODEL_PROPERTY,e)}};B.prototype.getCustomFilterData=function(){if(this._oFilterProvider&&this._oFilterProvider.getModel()){return this._oFilterProvider.getModel().getProperty("/"+u.CUSTOM_FIELDS_MODEL_PROPERTY)}};B.prototype.refreshFiltersCount=function(){return Promise.all(this._oFilterProvider._getCurrentValidationPromises()).then(function(){return this._updateToolbarText()}.bind(this))};B.prototype.hasDateRangeTypeFieldsWithValue=function(){var e=this._oFilterProvider,t=this.getFilterData(),i=Object.keys(e._mConditionTypeFields).some(function(e){return!!t[e]});return this.getInitializedPromise().then(function(){return i})};B.prototype.destroy=function(){this._clearDelayedSearch();if(this._oFilterProvider&&this._oFilterProvider.destroy){this._oFilterProvider.destroy()}this._oFilterProvider=null;if(this._oSmartVariantManagement&&this.getConsiderSelectionVariants()){this._oSmartVariantManagement.unregisterSelectionVariantHandler(this)}r.prototype.destroy.apply(this,arguments);sap.ui.getCore().getMessageManager().unregisterObject(this);this._oObservers.forEach(function(e){e.disconnect();e.destroy()});this._aFilterBarViewMetadata=null;this._oFilterBarViewMetadataExtend=null;this._bExpandAdvancedFilterArea=null;this._oResourceBundle=null;this._sMandatoryErrorMessage=null;this._sValidationErrorMessage=null;this._oSmartVariantManagement=null;this._oRulesLog.destroy()};return B});
//# sourceMappingURL=SmartFilterBar.js.map