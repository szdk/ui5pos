/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/date/UI5Date","sap/ui/comp/util/DateTimeUtil","sap/m/DateTimePicker","sap/m/Select","sap/ui/core/Item","sap/ui/comp/odata/ComboBox","sap/m/DatePicker","sap/m/DateRangeSelection","sap/m/TimePicker","sap/m/Input","sap/ui/comp/smartfilterbar/SFBMultiComboBox","sap/ui/comp/smartfilterbar/SFBMultiInput","sap/ui/comp/smartfilterbar/SortingUtil","sap/m/SearchField","sap/m/Token","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/providers/ValueHelpProvider","sap/ui/comp/providers/ValueListProvider","sap/ui/model/json/JSONModel","sap/ui/comp/odata/ODataType","sap/ui/comp/util/FormatUtil","sap/ui/base/EventProvider","sap/ui/comp/util/IdentifierUtil","sap/ui/comp/providers/TokenParser","sap/ui/core/format/DateFormat","sap/ui/comp/library","sap/ui/core/library","sap/ui/model/analytics/odata4analytics","sap/ui/model/FilterOperator","sap/base/Log","sap/base/security/encodeURL","sap/base/util/merge","sap/ui/comp/smartfilterbar/FilterProviderUtils","sap/ui/comp/filterbar/VariantConverterFrom","sap/ui/comp/odata/CalendarMetadata"],function(e,t,i,a,n,r,l,o,s,d,u,f,h,p,c,m,g,_,y,F,v,T,D,C,S,V,A,M,P,I,N,E,B,b,x,w){"use strict";var O=A.smartfilterbar.ControlType;var L=A.smartfilterbar.DisplayBehaviour;var R=A.smartfilterbar.FilterType;var k=M.ValueState;var H=A.smartfilterbar.MandatoryType;var U=function(e){this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;this._bAttachInitializedDone=false;this.aFilterAnnotations=[];if(e){this._sSmartContainerId=e.smartContainerId;this._sContext=e.context;this._oParentODataModel=e.model;this._sServiceURL=e.serviceUrl;this._sBasicSearchFieldName=e.basicSearchFieldName;this._isBasicSearchEnabled=e.enableBasicSearch;this._bUseContainsAsDefault=e.useContainsAsDefaultFilter==="true";this.sEntityType=e.entityType;this.sEntitySet=e.entitySet;this._isRunningInValueHelpDialog=e.isRunningInValueHelpDialog;this._oAdditionalConfiguration=e.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=e.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=e.defaultTokenDisplayBehaviour;this.mDefaultFilterBarExpanded=e.defaultFilterBarExpanded;this.mDefaultShowAllFilters=e.defaultShowAllFilters;this.sDefaultSingleFieldDisplayBehaviour=e.defaultSingleFieldDisplayBehaviour;if(typeof e.dateFormatSettings==="string"){try{this._oDateFormatSettings=e.dateFormatSettings?JSON.parse(e.dateFormatSettings):undefined}catch(e){}}else{this._oDateFormatSettings=e.dateFormatSettings}if(!this._oDateFormatSettings){this._oDateFormatSettings={}}if(!this._oDateFormatSettings.hasOwnProperty("UTC")){this._oDateFormatSettings["UTC"]=true}if(typeof e.calendarWeekSettings==="string"){this._oCalendarWeekSettings=e.calendarWeekSettings?e.calendarWeekSettings:undefined}if(!this._oCalendarWeekSettings){this._oCalendarWeekSettings=undefined}this._oSmartFilter=e.smartFilter;this.filterBarClass=e.filterBarClass;this._bConsiderAnalyticalParameters=e.considerAnalyticalParameters;this._bUseDateRangeType=e.useDateRangeType;this._bConsiderSelectionVariants=e.considerSelectionVariants;this._aConsiderNavigations=e.considerNavigations;this._bSuppressValueListsAssociation=e.suppressValueListsAssociation;this._aConstParams=this._getConstParams();this._aSignificantParams=this._getSignificantParams()}this.sFilterModelName=b.FILTER_MODEL_NAME;this._sBasicFilterAreaID=b.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._oFilterBarViewMetadataExtend={};this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarSingleValueWithValueListFieldMetadata=[];this._aFilterBarDropdownFieldMetadata=[];this._aFilterBarStringDateFieldNames=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFilterBarDateTimeFieldNames=[];this._aFilterBarDateTimeOffsetWithTimezoneFieldNames=[];this._aFilterBarNumericFieldMetadata=[];this._sSingleInputsTextArrangementData={};this._oNotValidatedSingleFields={};this._oSingleFieldSetFromFilterData={};this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new m(this._oParentODataModel||this._sServiceURL);this.oModel=new F;this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mTokenHandler={};this._mConditionTypeFields={};this._aSelectionVariants=[];this._oParameterization=null;this._oNonAnaParameterization=null;this._aPromises=[]};U._reduceRangesForParameters=function(e){if(e.ranges&&e.ranges.length>1){var t=e.ranges.find(function(e){return e.semantic!==undefined});if(t){e.ranges=[t]}if(e.ranges.length>1){e.ranges=[e.ranges[0]]}}};U.prototype._getConstParams=function(){return this._oSmartFilter&&this._oSmartFilter.data&&this._oSmartFilter.data("hiddenFields")||null};U.prototype._getSignificantParams=function(){return this._oSmartFilter&&this._oSmartFilter.data&&this._oSmartFilter.data("significantFields")||null};U._createFilterProvider=function(e){var t=new U(e);return t._intialiseMetadata()};U.prototype._intialiseMetadata=function(){var e,t,i,a,n,r,l,o,s,d,u,f,h;this._aPromises=[];this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){(function(){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType)}).bind(this)()}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);r=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet,this._bConsiderAnalyticalParameters,this._aConsiderNavigations);this.aAllFields=this._oMetadataAnalyser.getFieldsByEntitySetName(this.sEntitySet);if(r){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupsByFilterFacetsAnnotation(this.sEntityType);a=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(a&&a.selectionFields){this._aSelectionFields=a.selectionFields}if(this._aFieldGroupAnnotation){e=this._aFieldGroupAnnotation.length;for(l=0;l<e;l++){n=this._aFieldGroupAnnotation[l];u=this._createGroupMetadata(n);u.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(u)}}e=r.length;for(l=0;l<e;l++){n=r[l];t=n.fields.length;u=this._createGroupMetadata(n);this._aFilterBarViewMetadata.push(u);for(o=0;o<t;o++){s=n.fields[o];if(s.type.indexOf("Edm.")===0){d=this._createFieldMetadata(s);u.fields.push(d);this._aFilterBarFieldNames.push(d.fieldName)}}i=n.hiddenFields&&n.hiddenFields.length;if(this._isRunningInValueHelpDialog&&i){for(o=0;o<i;o++){s=n.hiddenFields[o];if(s.type.indexOf("Edm.")===0){d=this._createFieldMetadata(s);u.hiddenFields.push(d)}}}}}h=this._getAdditionalConfigurationForCustomGroups(r);e=h.length;for(o=0;o<e;o++){u=this._createGroupMetadataForCustomGroup(h[o]);if(u){this._aFilterBarViewMetadata.push(u)}}f=this._getAdditionalConfigurationForCustomFilterFields();t=f.length;for(o=0;o<t;o++){d=this._createFieldMetadataForCustomFilterFields(f[o]);if(d){this._aFilterBarViewMetadata[0].fields.push(d)}}if(this._hasBasicSearch()){d=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(d)}if(this._bConsiderAnalyticalParameters||!this._isRunningInValueHelpDialog){this._createParameters()}return new Promise(function(e){Promise.all(this._aPromises).then(function(){if(this._bConsiderSelectionVariants){this._createSelectionVariants()}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());this._bInitialized=true;e(this)}.bind(this))}.bind(this))};U.prototype._createSelectionVariants=function(){this._aSelectionVariants=this._oMetadataAnalyser.getSelectionVariantAnnotationList(this.sEntityType)};U.prototype._createParameters=function(){if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){if(this._bConsiderAnalyticalParameters){var e=sap.ui.require("sap/ui/model/analytics/odata4analytics");if(e){this._createAnalyticalParameters(e)}else{var t=new Promise(function(e){sap.ui.require(["sap/ui/model/analytics/odata4analytics"],function(t){this._createAnalyticalParameters(t);e()}.bind(this))}.bind(this));this._aPromises.push(t)}}}else{this._createNonAnalyticalParameters()}};U.prototype._createAnalyticalParameters=function(e){this._oParameterization=this._getAnalyticParameterization(e);this._createAnalyticParameters(this._oParameterization)};U.prototype._getAnalyticParameterization=function(e){var t,i;try{t=new e.Model(new e.Model.ReferenceByModel(this._oParentODataModel))}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message}i=t&&t.findQueryResultByName(this.sEntitySet);return i&&i.getParameterization()};U.prototype._createNonAnalyticalParameters=function(){if(this.sEntitySet){this._oNonAnaParameterization=this._oMetadataAnalyser.getParametersByEntitySetName(this.sEntitySet);if(this._oNonAnaParameterization){this._createParametersByEntitySetName(this._oNonAnaParameterization.entitySetName,this._oNonAnaParameterization.parameters)}}};U.prototype.attachPendingChange=function(e){this._attachEvent("PendingChange",e)};U.prototype.detachPendingChange=function(e){this._detachEvent("PendingChange",e)};U.prototype.setPending=function(e){var t=this._bPending!==e;this._bPending=e;if(t){var i={};i.pending=e;this._fireEvent("PendingChange",i)}};U.prototype.isPending=function(){if(!this._bInitialized){return true}for(var e in this._mConditionTypeFields){if(this._mConditionTypeFields[e].conditionType.isPending()){return true}}return false};U.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour}else{this.sDefaultDropDownDisplayBehaviour=L.descriptionAndId}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour}else{this.sDefaultTokenDisplayBehaviour=L.descriptionAndId}}if(!this.sDefaultSingleFieldDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultSingleFieldDisplayBehaviour=this._sTextArrangementDisplayBehaviour}else{this.sDefaultSingleFieldDisplayBehaviour=L.descriptionAndId}}};U.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled};U.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,t,i,a;if(!this._oAdditionalConfiguration){return[]}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e}a=[];t=e.length;for(i=0;i<t;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){a.push(e[i])}}return a};U.prototype._getAdditionalConfigurationForCustomGroups=function(e){var t,i,a,n,r,l,o,s;if(!this._oAdditionalConfiguration){return[]}t=this._oAdditionalConfiguration.getGroupConfiguration();if(!e||!e.length){return t}r=[];a=e.length;i=t.length;for(n=0;n<i;n++){o=false;for(l=0;l<a;l++){s=e[l].groupName||e[l].groupEntitySetName;if(s===t[n].key){o=true;break}}if(!o){r.push(t[n])}}return r};U.prototype._createInitialModelForField=function(t,i,a){var n=false,r,l,o=false,s=false,d=null,u=null,f,h=null,p=[],c=[];if(!i||i.isCustomFilterField){return}if(i.filterRestriction!==R.multiple){s=true}if((i.filterType==="date"||i.filterType==="time"||i.filterType==="datetime")&&!i.isFiscalDate&&!i.isCalendarType){n=true}if(a){r=i.defaultFilterValues;o=r&&r.length;if(!o){if(i.defaultPropertyValue&&i.isParameter){l=i.defaultPropertyValue;if(i.filterType==="numeric"){l=this._getType(i).parseValue(l,"string")}r=[{low:l}];o=true}else if(i.defaultFilterValue){l=i.defaultFilterValue;r=[{low:l,high:l,operator:"EQ",sign:"I"}];o=true}}}var m=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(i.fieldName):null;if(i.hasFixedValues||m&&m.controlType===O.dropDownList){this._aFilterBarDropdownFieldMetadata.push(i)}if(i.filterRestriction===R.single&&!this._isSingleDynamicDateEnabled(i)){if(o){l=r[0];d=n?this._createDateTimeValue(i,l.low):l.low}if(i.type==="Edm.String"&&i.hasValueListAnnotation&&!i.hasFixedValues&&i.controlType!=="dropDownList"){this._aFilterBarSingleValueWithValueListFieldMetadata.push(i);if(!o&&i.control){i.control.setValue("")}}t[i.fieldName]=d}else if(i.filterRestriction===R.interval&&i.type!=="Edm.Time"){if(o){l=r[0];d=n?this._createDateTimeValue(i,l.low):l.low;u=n?this._createDateTimeValue(i,l.high):l.high}t[i.fieldName]={low:d,high:u}}else{if(o){f=r.length;while(f--){l=r[f];if(s){h={exclude:l.sign==="E",operation:l.operator==="CP"?"Contains":l.operator,keyField:i.fieldName,value1:n?this._createDateTimeValue(i,l.low):l.low,value2:n?null:l.high};if(i.filterType==="time"&&l.high){h.value2=e.getInstance(l.high)}}else{h={key:n?this._createDateTimeValue(i,l.low):l.low,text:n?"":l.low}}p.push(h)}}this._aFilterBarMultiValueFieldMetadata.push(i);t[i.fieldName]={value:null};if(s){c=p.slice(0);p=[];t[i.fieldName].ranges=c}t[i.fieldName].items=p;this._updateMultiValueControl(i.control,p,c)}};U.prototype._createDateTimeValue=function(t,i){switch(t.type){case"Edm.Time":if(i.indexOf("PT")===0){return this._getTime(i)}else{N.error("Default value for "+t.fieldName+" could not be parsed.")}break;case"Edm.DateTime":if(typeof i=="string"&&t.displayFormat&&t.displayFormat.toLowerCase()=="date"){var a=i.split("T");i=a[0]+"T00:00:00";return e.getInstance(i)}else{N.error("Default value for "+t.fieldName+" could not be parsed.")}break;case"Edm.DateTimeOffset":return e.getInstance(i);default:N.error("Default value for "+t.fieldName+" could not be parsed.")}};U.prototype._createInitialModel=function(e){var t,i,a,n,r,l,o,s;t={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarSingleValueWithValueListFieldMetadata=[];this._aFilterBarDropdownFieldMetadata=[];if(this._aFilterBarViewMetadata){i=this._aFilterBarViewMetadata.length;for(o=0;o<i;o++){r=this._aFilterBarViewMetadata[o];a=r.fields.length;for(l=0;l<a;l++){this._createInitialModelForField(t,r.fields[l],e)}n=r.hiddenFields&&r.hiddenFields.length;if(this._isRunningInValueHelpDialog&&n){for(l=0;l<n;l++){this._createInitialModelForField(t,r.hiddenFields[l],e)}}}}if(this._aCustomFieldMetadata){for(s=0;s<this._aCustomFieldMetadata.length;s++){this._createInitialModelForField(t,this._aCustomFieldMetadata[s],false)}}if(this._aAnalyticalParameters){a=this._aAnalyticalParameters.length;for(l=0;l<a;l++){this._createInitialModelForField(t,this._aAnalyticalParameters[l],e)}}this.oModel&&this.oModel.setData(t);if(!e){this._clearConditionTypeFields()}this._updateConditionTypeFields();this._bCreatingInitialModel=false};U.prototype._setTokenTooltip=function(e,t){if(!e||!t){return}if(typeof t!=="string"){try{t=t.toString()}catch(e){}}e.setTooltip(t)};U.prototype._updateMultiValueControl=function(e,i,a,n){var r=0,l=null,o=null,s=null,d=null,h=null,p,m,g,_;if(e&&i){r=i.length;if(e instanceof f){l=[];while(r--){d=i[r].text||i[r].key;var o=new c;o.setKey(i[r].key);o.setText(d);this._setTokenTooltip(o,d);l.push(o)}if(a){r=a.length;while(r--){s=a[r];if((s.value1===""||s.value1===null)&&s.operation===I.EQ){_=x.convertOption(s.operation,s.value1);s.operation=_.op;s.tokenText=T.getFormattedRangeText(s.operation,null,null,s.exclude);s.value1=_.v}if(s.tokenText){d=s.tokenText}else{p=s.value1;m=s.value2;if(n){var y=true;var F=["date","datetime","time"];if(F.indexOf(n.filterType)>-1){g=this._getType(n);if(g){if(p){if(n.filterType==="time"){p=t.dateToEdmTime(t.localToUtc(p))}p=g.formatValue(p,"string",y)}if(m){if(n.filterType==="time"){m=t.dateToEdmTime(t.localToUtc(m))}m=g.formatValue(m,"string",y)}}}else if(n.filterType==="numeric"){g=this._getType(n);if(g){if(p!==""&&p!==undefined){if(typeof p==="string"&&!isNaN(p)){p=parseFloat(p);s.value1=p}p=g.formatValue(p,"string")}if(m!==""&&m!==undefined){if(typeof m==="string"&&!isNaN(m)){m=parseFloat(m);s.value2=m}m=g.formatValue(m,"string")}}}else if(n.filterType==="boolean"){g=this._getType(n);if(g){if(p!==""&&p!==undefined&&p==="false"){p=g.formatValue(false,"string")}else{p=g.formatValue(p,"string")}if(m!==""&&m!==undefined&&m==="false"){m=g.formatValue(false,"string")}else{m=g.formatValue(p,"string")}}}else{var v=n.isCalendarDate||n.isFiscalDate||n.isCalendarType||(p instanceof Date||m instanceof Date);if(v){g=this._getType(n);if(p){p=g.formatValue(p,"string")}if(m){m=g.formatValue(m,"string")}}}}d=T.getFormattedRangeText(s.operation,p,m,s.exclude)}o=new c;o.setText(d);this._setTokenTooltip(o,d);o.data("range",s);l.push(o)}}e.setTokens(l);e.fireTokenUpdate()}if(e instanceof u){h=[];while(r--){h.push(i[r].key)}e.setSelectedKeys(h)}}};U.prototype._updateSingleValueControl=function(e){var t=e.control,i=e.fieldName,a=e.displayBehaviour||this.sDefaultSingleFieldDisplayBehaviour,n=this.oModel.getData(),r=n[i],l=r,o=this._getSingleInputsTextArrangementData(i);if(o&&o.key===r&&o.key!==o.text){l=T.getFormattedExpressionFromDisplayBehaviour(a,o.key,o.text);delete this._oNotValidatedSingleFields[i]}t.setValue(l);if(r&&r===l){this._oSingleFieldSetFromFilterData[i]=true;var s=this._aValueListProvider.find(function(e){return e.sFieldName===i});if(s&&s.bInitialised){s._validateInput(r);delete this._oNotValidatedSingleFields[i]}else{this._oNotValidatedSingleFields[i]=r}}};U.prototype._applyIndexes=function(){if(!this._aFilterBarViewMetadata){return}this._aFilterBarViewMetadata=h.groupSorting(this._aFilterBarViewMetadata)};U.prototype._applyGroupId=function(){var e=Array.isArray(this._aFilterBarViewMetadata)?this._aFilterBarViewMetadata.length:0,t,i,a,n,r,l;for(n=0;n<e;n++){if(!this._aFilterBarViewMetadata[n].fields){continue}t=this._aFilterBarViewMetadata[n].fields.length;for(r=0;r<t;r++){a=this._aFilterBarViewMetadata[n].fields[r];if(a&&a.groupId&&a.groupId!==this._aFilterBarViewMetadata[n].groupName){i=undefined;for(l=0;l<e;l++){if(this._aFilterBarViewMetadata[l].groupName===a.groupId){i=this._aFilterBarViewMetadata[l];break}}if(i){this._aFilterBarViewMetadata[n].fields.splice(r,1);r--;t--;i.fields=i.fields||[];i.fields.push(a)}}}}};U.prototype._createFilterControlId=function(e){var t=this._oSmartFilter?this._oSmartFilter.getId():"FilterPanel";var i=C.replace(e.groupId||"");var a=C.replace(e.fieldName);var n=e.customColumnKey&&C.replace(e.customColumnKey);if(n){a+=n}if(this._sSmartContainerId){a=this._sSmartContainerId+"-"+a}return t+"-filterItemControl"+i+"-"+a};U.prototype._createGroupMetadata=function(e){var t,i=null,a;a=e.groupName||e.groupEntitySetName;if(this._oAdditionalConfiguration){i=this._oAdditionalConfiguration.getGroupConfigurationByKey(a)}t={};t.groupName=a;t.groupLabel=this._getGroupLabel(e,i);t.fields=[];t.hiddenFields=[];t.index=this._getGroupIndex(i);return t};U.prototype._createGroupMetadataForCustomGroup=function(e){var t;t={};t.groupName=e.key;t.groupLabel=e.label;t.fields=[];t.index=this._getGroupIndex(e);return t};U.prototype._getTime=function(e){var t=V.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return t.parse(e)};U.prototype._checkMetadataDefaultValue=function(e){var t=e.defaultFilterValue||e.defaultPropertyValue;if(t){try{if(e.type==="Edm.Time"&&t.indexOf("PT")===0){this._getTime(t)}else{this._getType(e)}}catch(t){e.defaultPropertyValue=null;e.defaultFilterValue=null;N.error("default value for "+e.fieldName+" could not be parsed.")}}};U.prototype._getType=function(e){var t,i={},a={},n={};if(e.ui5Type){return e.ui5Type}if(e.precision||e.scale){a.precision=e.precision;a.scale=e.scale}if(e.maxLength){a.maxLength=e.maxLength}if(e.displayFormat){a.displayFormat=e.displayFormat}if(e.isDigitSequence){a.isDigitSequence=e.isDigitSequence}if(e.isCalendarDate){n.isCalendarDate=true}if(e.isCalendarType&&!e.isCalendarDate){n.isCalendarType=true;n.calendarType=e.calendarType}if(e.isFiscalDate&&e.fiscalType){n.isFiscalDate=true;n.fiscalType=e.fiscalType}if(e.filterType==="date"||e.filterType==="time"||e.filterType==="datetime"||e.isCalendarDate){i=Object.assign({},this._oDateFormatSettings,{UTC:false})}t=v.getType(e.type,i,a,n);return t};U.prototype._setControlDisplayFormat=function(e,t){var i;if(!t){return}i=t.style||t.pattern;if(!i){return}e.setDisplayFormat(i)};U.prototype._setControlCalendarWeekSetting=function(e,t){if(!t){return}if(typeof e.setCalendarWeekNumbering==="function"){e.setCalendarWeekNumbering(t)}};U.prototype._createControl=function(e){var t,h,p=false,c,m,g=e.type!=="Edm.String"||e.isFiscalDate||e.isCalendarType||e.isDigitSequence;if(e.customControl){return e.customControl}h=this._getType(e);t=new e.fControlConstructor(this._createFilterControlId(e));t._oFieldViewMetadata=e;if(e.fControlConstructor===o){this._setControlDisplayFormat(t,this._oDateFormatSettings);this._setControlCalendarWeekSetting(t,this._oCalendarWeekSettings);if(e.isCalendarDate){t.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/low",type:h});t.bindProperty("secondDateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/high",type:h})}else{t.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName+"/low");t.bindProperty("secondDateValue",this.sFilterModelName+">/"+e.fieldName+"/high")}}else if(e.fControlConstructor===r||e.fControlConstructor===a){if(t.setForceSelection){t.setForceSelection(true)}if(e.fControlConstructor===a){t.addItem(new n({key:"",text:""}));t.addItem(new n({key:false,text:h.formatValue(false,"string")}));t.addItem(new n({key:true,text:h.formatValue(true,"string")}))}else{this._associateValueList(t,"items",e,false,this._getSuppressValueListsAssociation());t.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return}t.fireChange({filterChangeReason:e.fieldName,value:""})}.bind(this));if(t.isA("sap.ui.comp.odata.ComboBox")){t.useHighlightItemsWithContains=function(){return true};t.attachSelectedKeyChange(function(){if(t.data("__validationError")){t.data("__validationError",null);t.setValueState(k.None)}})}}t.bindProperty("selectedKey",this.sFilterModelName+">/"+e.fieldName)}else if(e.fControlConstructor===u){this._associateValueList(t,"items",e,false,this._getSuppressValueListsAssociation());t.attachSelectionChange(function(t){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return}var i=t.getSource(),a=null,n=[],r;a=i.getSelectedItems();if(a){r=a.length;while(r--){n.push({key:a[r].getKey(),text:a[r].getText()})}}if(this.oModel){this.oModel.setProperty("/"+e.fieldName+"/items",n)}i.fireChange({filterChangeReason:e.fieldName,value:""})}.bind(this));t.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/value")}else if(e.fControlConstructor===f){if(e.controlType===O.date||e.type==="Edm.Time"||e.type==="Edm.DateTimeOffset"){t.setValueHelpOnly&&t.setValueHelpOnly(true);if(e.filterRestriction===R.interval){this._associateValueHelpDialog(t,e,false,false)}else{this._associateValueHelpDialog(t,e,true,true)}this._setControlCalendarWeekSetting(t,this._oCalendarWeekSettings)}else{if(e.hasValueHelpDialog){this._associateValueHelpDialog(t,e,e.filterRestriction!==R.multiple,true)}else{t.setShowValueHelp(false)}t.bindProperty("value",{path:this.sFilterModelName+">/"+e.fieldName+"/value",type:h})}this._handleMultiInput(t,e,h)}else if(e.fControlConstructor===d){if(e.filterRestriction===R.interval){p=true;t.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp")}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT")}t.setPlaceholder(this.sIntervalPlaceholder)}else if(e.hasValueListAnnotation){t.attachChange(function(i){var a=i.getParameter("value");t.__sValidationText="";if(!a){this.oModel.setProperty("/"+e.fieldName,"")}}.bind(this))}else{t.bindProperty("value",{path:this.sFilterModelName+">/"+e.fieldName,type:h})}if(e.hasValueHelpDialog){t.setShowValueHelp(true);if(p&&g){t.setValueHelpOnly&&t.setValueHelpOnly(true)}this._associateValueHelpDialog(t,e,false,false)}}else if(e.isCalendarDate){this._setControlDisplayFormat(t,this._oDateFormatSettings);this._setControlCalendarWeekSetting(t,this._oCalendarWeekSettings);t.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName,type:h})}else if(e.fControlConstructor===l){t.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName);this._setControlDisplayFormat(t,this._oDateFormatSettings);this._setControlCalendarWeekSetting(t,this._oCalendarWeekSettings)}else if(e.fControlConstructor===s||e.fControlConstructor===i){t.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName);if(this._oDateFormatSettings&&this._oDateFormatSettings.style){t.setDisplayFormat(this._oDateFormatSettings.style)}this._setControlCalendarWeekSetting(t,this._oCalendarWeekSettings)}if(t instanceof l){t.attachChange(function(e){var i=e.getParameter("valid");t.data("__mandatoryEmpty",null);if(i){t.setValueState(k.None);t.setValueStateText()}else{var a=t._parseValue(e.getParameter("newValue")),n=this._getSelectedDateRange(a);t.setValueState(k.Error);if(n[0]&&n[1]){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp"),l=this._getDateFieldOutOfRangeErrorText(t,n,h,r);t.setValueStateText(l)}else if(h){try{h.parseValue("foo","string")}catch(e){t.setValueStateText(e.message)}}}}.bind(this))}if(e.hasTypeAhead){if(e.hasValueListAnnotation){t.setShowSuggestion(true)}t.setFilterSuggests(false);this._associateValueList(t,"suggestionRows",e,true,this._getSuppressValueListsAssociation())}if(e.displayFormat==="UpperCase"&&e.controlType!==O.dropDownList&&t.attachChange&&t.getValue&&t.setValue){t.attachChange(function(i){var a=t.getValue();if(a&&!e.hasValueListAnnotation){t.setValue(a.toUpperCase())}});if(this._mTokenHandler[t.getId()]&&this._mTokenHandler[t.getId()].parser){var _=this._mTokenHandler[t.getId()].parser;_.getKeyFields()[0].displayFormat=e.displayFormat}}if(t instanceof d){if(e.maxLength){c=parseInt(e.maxLength);if(!isNaN(c)){if(this._mTokenHandler[t.getId()]&&this._mTokenHandler[t.getId()].parser){var _=this._mTokenHandler[t.getId()].parser;_.getKeyFields()[0].maxLength=c}else{if(!e.hasValueListAnnotation&&!p){t.setMaxLength(c)}}}}if(e.isCalendarType&&e.calendarType){t.setPlaceholder(h.formatter.getPattern())}if(e.isFiscalDate){t.setPlaceholder(h.formatter.getPattern())}var y=e.filterRestriction==="auto"||e.filterRestriction==="multi-value"||e.filterRestriction==="multiple";if(e.type==="Edm.String"&&y&&(this._oSmartFilter&&!this._oSmartFilter.getDisableSearchMatchesPatternWarning())){t.attachLiveChange(this._oSmartFilter._onLiveChangeValidateSymbols.bind(this._oSmartFilter))}}m=function(e){var i=e.getParameter("exception");var a=e.getParameter("element");if(t&&a&&t.getId()===a.getId()){if(i){if(t.setValueStateText){t.setValueStateText(i.message)}}if(t.setValueState){t.setValueState(k.Error)}t.data("__mandatoryEmpty",null)}};t.attachParseError(m);t.attachFormatError(m);t.attachValidationError(m);t.attachValidationSuccess(function(e){var i=e.getParameter("element");if(t&&i&&t.getId()===i.getId()){if(t.setValueState){t.setValueState(k.None)}if(t.setValueStateText){t.setValueStateText()}t.data("__mandatoryEmpty",null);delete t.__sValidationText}});if(e.fControlConstructor===r||e.fControlConstructor===u){t.setFilterFunction(function(e,t){RegExp.escape=function(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};var i=RegExp.escape(e);var a=new RegExp(i,"i");return t.getText().match(new RegExp(a,"i"))||t.getKey().match(new RegExp(a,"i"))})}return t};U.prototype._getControlConstructor=function(e,t){var n=d,h,p,c;c=t?t+e.fieldName:e.fieldName;if(e.isCustomFilterField){n=undefined}else{h=e.filterRestriction===R.single;p=e.filterRestriction===R.interval;if(e.controlType===O.date){if(h&&!this._isSingleDynamicDateEnabled(e)){n=l}else{n=p?o:f}if(e.isCalendarDate){this._aFilterBarStringDateFieldNames.push(c)}else{this._aFilterBarDateFieldNames.push(c)}if(e.filterRestriction===R.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(c)}}else if(e.controlType===O.dropDownList){if(h){n=this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)?a:r}else{n=u}if(!h){e.filterRestriction=R.multiple}}else if(e.type==="Edm.Time"){if(h){n=s}else{n=f}this._aFilterBarTimeFieldNames.push(c);if(p){this._aFilterBarTimeIntervalFieldNames.push(c)}else if(e.filterRestriction===R.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(c)}}else if(!p&&e.controlType===O.dateTimePicker){if(h){n=i}else{n=f}this._aFilterBarDateTimeFieldNames.push(c);if(e.filterRestriction===R.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(c)}}else if(p&&e.type==="Edm.DateTimeOffset"){var g=this._getFilterTimeZone(c);if(g){var _={key:c,value:g};this._aFilterBarDateTimeOffsetWithTimezoneFieldNames.push(_)}this._aFilterBarDateTimeFieldNames.push(c)}else if(h&&m.isNumber(e)){this._aFilterBarNumericFieldMetadata.push(c)}else if(!h&&!p){n=f}}return n};U.prototype._handleTokenUpdate=function(e,t){this._tokenUpdate({control:t.control,fieldViewMetadata:t.fieldViewMetadata,removedTokens:e&&e.getParameter("removedTokens")})};U.prototype._tokenUpdate=function(e){var i=e.removedTokens,a=e.control,n=e.fieldViewMetadata,r,l=[],o,s,d,u=[],f="/"+n.fieldName;if(this._bUpdatingFilterData||this._bCreatingInitialModel){return}r=a.getTokens();if(i){r=r.filter(function(e){return i.indexOf(e)===-1})}if(Array.isArray(r)&&r.length>0){o=r.length;while(o--){s=r[o];d=s.data("range");if(d){d.tokenText=s.getText();if(n.customColumnKey){d.customColumnKey=n.customColumnKey}if(d&&s.getKey().indexOf("range_")===0){if(n.type==="Edm.Time"){if(d.value1&&(d.value1.ms||d.value1.ms===0)){d.value1=t.utcToLocal(t.edmTimeToDate(d.value1))}if(d.value2&&(d.value2.ms||d.value2.ms===0)){d.value2=t.utcToLocal(t.edmTimeToDate(d.value2))}}}u.push(d)}else{l.push({key:s.getKey(),text:s.getText()})}}}if(this.oModel){this.oModel.setProperty(f+"/items",l);this.oModel.setProperty(f+"/ranges",u)}if(a.__bValidatingToken){delete a.__bValidatingToken}if(!a._pendingAutoTokenGeneration){a.fireChange({filterChangeReason:n.fieldName,value:""})}};U.prototype._handleMultiInput=function(e,t,i){e._setFilterProvider(this);e._setFieldViewMetadata(t);e.attachTokenUpdate({control:e,fieldViewMetadata:t},this._handleTokenUpdate,this);var a,n=t.type==="Edm.DateTime"&&t.displayFormat==="Date";if(t.hasValueListAnnotation||t.type==="Edm.String"||n){e.attachEvent("_validateOnPaste",function(r){var l=r.getParameter("texts"),o,s,d,u,f;s=l?l.length:0;if(s>1){r.preventDefault();o=this.oModel.getProperty("/"+t.fieldName);f=o.ranges||[];e.setValue("");while(s--){d=l[s];if(d){u=null;if(t.isUpperCase){d=d.toUpperCase()}if(n){a=this._getDateValue(d,i);if(isNaN(a.getDate())){continue}else{u=d;d=a}}var h=S._createRangeByText(d);f.push(Object.assign({keyField:t.fieldName,tokenText:u,value1:d,value2:null},h))}}this.oModel.setProperty("/"+t.fieldName+"/ranges",f);this._updateMultiValueControl(e,o.items,f,t)}}.bind(this))}};U.prototype._associateValueHelpDialog=function(e,t,i,a){var n=t.visibleInAdvancedArea||t.groupId===b.BASIC_FILTER_AREA_ID;if(this._getSuppressValueListsAssociation()&&n){this._attachEventOnce(b.ASSOCIATE_VALUE_LISTS,function(){this._associateValueHelpDialogHandler(e,t,i,a)}.bind(this))}else{this._associateValueHelpDialogHandler(e,t,i,a)}};U.prototype._addToParams=function(e,t,i){if(t==="true"||t==="false"){e[i]=t==="true"}else if(typeof t==="object"&&t!==null&&Object.keys(t).length>0){e[i]=t[e.fieldName]==="true"}else if(t!==undefined&&t!==null){N.error("customData for "+i+" is not of type boolean or object")}};U.prototype._associateValueHelpDialogHandler=function(e,t,i,a){var n,r,l={fieldName:t.fieldName,control:e,model:this._oParentODataModel,filterModel:this.oModel,filterProvider:this,dateFormatSettings:this._oDateFormatSettings,calendarWeekSettings:this._oCalendarWeekSettings,fieldViewMetadata:t,displayFormat:t.displayFormat,displayBehaviour:t.displayBehaviour,loadAnnotation:t.hasValueListAnnotation,fullyQualifiedFieldName:t.fullName,metadataAnalyser:this._oMetadataAnalyser,preventInitialDataFetchInValueHelpDialog:t.preventInitialDataFetchInValueHelpDialog,supportMultiSelect:a,supportRanges:i,isSingleIntervalRange:t.filterRestriction===R.interval,isSearchExpressionFilterRestriction:t.filterRestriction===R.searchExpression,isUnrestrictedFilter:t.filterRestriction!==R.multiple,type:t.filterType,maxLength:t.maxLength,scale:t.scale,precision:t.precision,context:this._oSmartFilter?"SmartFilterBar":"mdcFilterPanel",filterBarClass:this.filterBarClass,defaultOperation:t.conditionPanelDefaultOperation,enabledMultiSelectionPlugin:true,_onBeforeOpenValueHelpDialog:function(e){if(this._oSmartFilter){this._oSmartFilter.fireEvent("_beforeOpenVHD",e)}}.bind(this)};if(l.isSearchExpressionFilterRestriction){r={defaultOperation:m._getSearchExpressionTypeOperations().string[0],typeOperations:m._getSearchExpressionTypeOperations(),rangeOperationsKeys:m._getSearchExpressionRangeOperationsKeys()}}if(t.isCalendarDate){l.oType=this._getType(t)}if(this.mDefaultFilterBarExpanded){this._addToParams(l,this.mDefaultFilterBarExpanded,"defaultFilterBarExpanded")}if(this.mDefaultShowAllFilters){this._addToParams(l,this.mDefaultShowAllFilters,"defaultShowAllFilters")}var o=new _(l);o.attachValueListChanged(function(e){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(e);this._oSmartFilter.validateMandatoryFields()}}.bind(this));if(t.visibleInAdvancedArea||t.groupId===b.BASIC_FILTER_AREA_ID){this.aFilterAnnotations.push(o.loadAnnotation().then(function(e){this._enrichFieldViewMetadata(t,e)}.bind(this)))}this._aValueHelpDialogProvider.push(o);if(i&&e.addValidator){n=new S(r);n.addKeyField({key:t.fieldName,label:t.label,type:t.filterType,oType:t.ui5Type});if(t.filterType==="numeric"){n.setDefaultOperation("EQ")}n.associateInput(e);this._mTokenHandler[e.getId()]={parser:n}}};U.prototype._determineFieldLabel=function(e){var t,i=e.label;if(this._oSmartFilter&&this._oSmartFilter.determineFilterItemByName){t=this._oSmartFilter.determineFilterItemByName(e.name,e.groupName);if(t){i=t.getLabel()}}return i};U.prototype._associateValueList=function(e,t,i,a,n){var r=i.visibleInAdvancedArea||i.groupId===b.BASIC_FILTER_AREA_ID,l={control:e,aggregation:t,fieldViewMetadata:i,hasTypeAhead:a,annotaionIsToBeLoaded:r};if(n&&r){this._attachEventOnce(b.ASSOCIATE_VALUE_LISTS,function(){this._associateValueListHandler(l)}.bind(this))}else{this._associateValueListHandler(l)}};U.prototype._associateValueListHandler=function(e){var t,i=e.control,a=e.aggregation,n=e.fieldViewMetadata,r=e.hasTypeAhead,l=e.annotaionIsToBeLoaded;if(this._oSmartFilter&&!this._bAttachInitializedDone&&new URLSearchParams(window.location.search).get("sap-ui-comp-filterbar-data-defer")){var o=this._oParentODataModel;this._sDeferredGroupId="sapUiCompFilterBarData";var s=o.getDeferredGroups?this._oParentODataModel.getDeferredGroups():null;if(s!==null){s.push(this._sDeferredGroupId);o.setDeferredGroups(s);var d=function(){o.submitChanges({groupId:this._sDeferredGroupId});var e=o.getDeferredGroups().filter(function(e){return e!==this._sDeferredGroupId}.bind(this));o.setDeferredGroups(e);delete this._sDeferredGroupId;this._oSmartFilter.detachInitialized(d)}.bind(this);this._oSmartFilter.attachInitialized(d);this._bAttachInitializedDone=true}}if(n.hasValueListAnnotation){t=new y({fieldName:n.fieldName,control:i,model:this._oParentODataModel,filterModel:this.oModel,filterProvider:this,displayFormat:n.displayFormat,dateFormatSettings:this._oDateFormatSettings,fieldViewMetadata:n,displayBehaviour:n.displayBehaviour,loadAnnotation:true,fullyQualifiedFieldName:n.fullName,metadataAnalyser:this._oMetadataAnalyser,type:n.filterType,aggregation:a,typeAheadEnabled:r,enableShowTableSuggestionValueHelp:n.hasValueHelpDialog,deferredGroupId:this._sDeferredGroupId,context:this._sContext?this._sContext:"SmartFilterBar",fieldHistoryEnabled:n.historyEnabled!==undefined?n.historyEnabled:true,fieldHistoryEnabledInitial:n.historyEnabledInitial!==undefined?n.historyEnabledInitial:true});t.attachValueListChanged(function(e){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(e);this._oSmartFilter.validateMandatoryFields()}}.bind(this));if(l){this.aFilterAnnotations.push(t.loadAnnotation().then(function(e){this._enrichFieldViewMetadata(n,e)}.bind(this)))}this._aValueListProvider.push(t)}else if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser&&n.filterRestriction!=="searchExpression"){this._mTokenHandler[i.getId()].parser.setDefaultOperation("EQ")}};U.prototype._createAnalyticParameters=function(e){var t,i;if(e){i=e.getAllParameterNames();t=e.getEntitySet();if(t){this._createParametersByEntitySetName(t.getQName(),i)}}};U.prototype._createParametersByEntitySetName=function(e,t){var i,a=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var n=0;n<a.length;n++){if(t.indexOf(a[n].name)>=0){i=this._createAnalyticParameterMetadata(a[n]);if(i&&i.visible){if(this._oNonAnaParameterization&&i.isCustomFilterField){continue}this._aAnalyticalParameters.push(i)}}}};U.prototype._createAnalyticParameterMetadata=function(e){var t,i=A.ANALYTICAL_PARAMETER_PREFIX,a=function(e){return e.type==="Edm.String"&&e["sap:parameter"]==="optional"};e.filterRestriction="single-value";t=this._createFieldMetadata(e,i);if(t){t.fieldName=i+e.name;t.isMandatory=a(t)?false:true;t.isParameter=true;t.visibleInAdvancedArea=true}else{N.error("_createAnalyticParameterMetadata issue with property: "+e.name)}return t};U.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters};U.prototype.getSelectionVariants=function(){return this._aSelectionVariants};U.prototype.getAnalyticBindingPath=function(){var e,t=[],i=this.getAnalyticParameters();i.forEach(function(e){t.push(e.fieldName)});e=this.getFilledFilterData(t);if(this._oParameterization){return this._createAnalyticBindingPath(i,e)}else{return this._createNonAnalyticBindingPath(i,e)}};U.prototype._createAnalyticBindingPath=function(e,i){var a,n="",r;r=this._getParameterizationRequest(this._oParameterization);if(r){e.forEach(function(e){a=i[e.fieldName];if(!a){a=""}else if(e.type==="Edm.Time"&&a instanceof Date){if(this._oDateFormatSettings&&!this._oDateFormatSettings.UTC){a=t.utcToLocal(a)}a=t.localToUtc(a);a={__edmType:"Edm.Time",ms:a.valueOf()}}else if(e.type==="Edm.DateTime"&&i[e.fieldName]&&i[e.fieldName].conditionTypeInfo&&i[e.fieldName].ranges&&i[e.fieldName].ranges[0]){a=i[e.fieldName].ranges[0].value1;if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=t.localToUtc(a)}}else if(e.type!=="Edm.DateTimeOffset"&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=t.localToUtc(a)}r.setParameterValue(e.name,a)}.bind(this));n=r.getURIToParameterizationEntry()+"/"+this._oParameterization.getNavigationPropertyToQueryResult()}return n};U.prototype._createNonAnalyticBindingPath=function(e,i){var a,n="",r="";if(this._oNonAnaParameterization){n="/"+this._oNonAnaParameterization.entitySetName+"(";e.forEach(function(e){a=i[e.fieldName];if(!a){a=""}else if(e.type==="Edm.Time"&&a instanceof Date){a=t.localToUtc(a);a={__edmType:"Edm.Time",ms:a.valueOf()}}else if(e.type==="Edm.DateTime"&&i[e.fieldName]&&i[e.fieldName].conditionTypeInfo&&i[e.fieldName].ranges&&i[e.fieldName].ranges[0]){a=i[e.fieldName].ranges[0].value1;if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=t.localToUtc(a)}}else if(e.type!=="Edm.DateTimeOffset"&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=t.localToUtc(a)}n+=r+e.name+"="+E(this._oParentODataModel.formatValue(a,e.type));r=","}.bind(this));n+=")/"+this._oNonAnaParameterization.navPropertyName}return n};U.prototype._getParameterizationRequest=function(){return this._oParameterization?new P.ParameterizationRequest(this._oParameterization):null};U.prototype._constructContextUrl=function(e,t){var i=e._getServerUrl();if(i&&i.lastIndexOf("/")===i.length-1){i=i.substr(0,i.length-1)}return i+e.sServiceUrl+"/$metadata#"+t};U.prototype.getFilterContextUrl=function(){var e,t=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){e=this._oParentODataModel.getMetaModel().getODataEntitySet(this.sEntitySet);if(e){t=this._constructContextUrl(this._oParentODataModel,e.name)}}return t};U.prototype.getParameterContextUrl=function(){var e,t=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){if(this._oParameterization&&this._oParameterization.getEntitySet()){e=this._oParameterization.getEntitySet().getQName()}else if(this._oNonAnaParameterization){e=this._oNonAnaParameterization.entitySetName}if(e){t=this._constructContextUrl(this._oParentODataModel,e)}}return t};U.prototype._createFieldMetadata=function(t,i){var a,n,r,l,s;t.fieldName=this._getFieldName(t);t.fieldNameOData=t.fieldName.replace(b.FIELD_NAME_REGEX,"/");n=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(t.fieldName):null;a=Object.assign({},t);a.filterRestriction=this._getFilterRestriction(t.filterRestriction,n);this._updateValueListMetadata(a,t);a.hasValueHelpDialog=this._hasValueHelpDialog(a,n);a.isConstant=Array.isArray(this._aConstParams)&&this._aConstParams.indexOf(t.fieldName)!==-1;a.isInitialValueSignificant=Array.isArray(this._aSignificantParams)&&this._aSignificantParams.indexOf(t.fieldName)!==-1;if(n){a.preventInitialDataFetchInValueHelpDialog=this._getPreventInitialDataFetchInValueHelpDialog(a,n);a.conditionPanelDefaultOperation=n.conditionPanelDefaultOperation;if(n.displayBehaviour&&n.displayBehaviour!=="auto"){a.displayBehaviour=n.displayBehaviour}a.isCustomFilterField=!!n.customControl;a.visibleInAdvancedArea=!!n.visibleInAdvancedArea;a.defaultFilterValues=n.defaultFilterValues;a.customControl=n.customControl;r=n.conditionType;a.width=this._getWidth(n);a.isVisible=this._isVisible(n);a.historyEnabled=n.historyEnabled;a.historyEnabledInitial=n.historyEnabledInitial;a.hasValidation=n.hasValidation}else{a.preventInitialDataFetchInValueHelpDialog=this._getPreventInitialDataFetchInValueHelpDialog(a);a.isVisible=true;a.isCustomFilterField=false;a.visibleInAdvancedArea=false}a.controlType=this._getControlType(a,n);a.label=this._getLabel(t,n);a.isMandatory=this._isMandatory(t,n);a.groupId=this._getGroupID(t,n);a.index=this._getIndex(t,n);a.fControlConstructor=this._getControlConstructor(a,i);a.isFiscalDate=g.isFiscalValue(a);a.isCalendarType=w.isCalendarValue(a);a.fiscalType=g.getFiscalAnnotationType(a);a.calendarType=w.getCalendarAnnotationType(a);if(a.isFiscalDate){g.updateViewMetadata(a)}if(a.isCalendarType&&a.calendarType){w.updateViewMetadata(a)}a.filterType=this._getFilterType(a);a.hasTypeAhead=this._hasTypeAhead(a,t,n);a.ui5Type=this._getType(a);if(a.ui5Type&&a.ui5Type.isA("sap.ui.model.odata.type.DateTime")){a.ui5Type.formatValue(e.getInstance(),"string");a.ui5Type.oFormat.oFormatOptions.UTC=false}a.fCreateControl=function(e){var t;e.control=this._createControl(e);t=this.oModel.getData()[e.fieldName];if(t){this._updateMultiValueControl(e.control,t.items,t.ranges,e);var i=this._aFilterBarSingleValueWithValueListFieldMetadata.some(function(t){return t.name===e.fieldName||A.ANALYTICAL_PARAMETER_PREFIX+t.name===a.fieldName});if(i){this._updateSingleValueControl(e)}}}.bind(this);this._applyWidth(a);if(a.type==="Edm.String"){this._aFilterBarStringFieldNames.push(a.fieldName)}a.conditionType=null;var d=a.filterRestriction===R.single&&(a.type==="Edm.DateTime"&&a.displayFormat==="Date"||a.type==="Edm.String"&&a.isCalendarDate);var u=a.type==="Edm.DateTimeOffset"&&a.filterRestriction==="interval";if(!r&&this._bUseDateRangeType&&(a.fControlConstructor===o||d||u)){r="sap.ui.comp.config.condition.DateRangeType"}if(r){l="";if(typeof r==="object"){if(this._bUseDateRangeType&&!r.module&&a.fControlConstructor===o||d||u){r.module="sap.ui.comp.config.condition.DateRangeType"}l=r.module}else{l=r;r=null}try{l=l.replace(/\./g,"/");var f=sap.ui.require(l);if(f){this._enhanceConditionTypeInfo(f,l,r,a,i)}else{s=new Promise(function(e){sap.ui.require([l],function(t){this._enhanceConditionTypeInfo(t,l,r,a,i);e()}.bind(this))}.bind(this));this._aPromises.push(s)}}catch(e){N.error("Module "+l+" could not be loaded")}}else{this._checkMetadataDefaultValue(a)}return a};U.prototype._requireConditionType=function(e,t,i){var e=e.replace(/\./g,"/");var a=sap.ui.require(e);if(a){this._enhanceConditionTypeInfo(a,e,t,i)}else{sap.ui.require([e],function(a){this._enhanceConditionTypeInfo(a,e,t,i)}.bind(this))}};U.prototype._enhanceConditionTypeInfo=function(e,t,i,a,n){var r=e;var l=n===A.ANALYTICAL_PARAMETER_PREFIX&&a.fieldName.indexOf(A.ANALYTICAL_PARAMETER_PREFIX)===-1?n+a.fieldName:a.fieldName;a.conditionType=new r(l,this,a);this._mConditionTypeFields[l]=a;a.calendarWeekNumbering=this._oCalendarWeekSettings;if(i&&!this._bUseDateRangeType){if(a.defaultValue&&n===A.ANALYTICAL_PARAMETER_PREFIX){i=Object.assign({},i,{defaultDate:a.defaultValue})}a.conditionType.applySettings(i)}if(this._bUseDateRangeType&&i&&n!==A.ANALYTICAL_PARAMETER_PREFIX){a.conditionType.applySettings(i)}if(this._bUseDateRangeType&&n===A.ANALYTICAL_PARAMETER_PREFIX&&(a.defaultValue||i&&i.defaultOperation)){var o={defaultDate:a.defaultValue};i=Object.assign({},o,i);a.conditionType.applySettings(i)}this._checkMetadataDefaultValue(a)};U.prototype._getFilterType=function(e){return T._getFilterType(e)};U.prototype._updateValueListMetadata=function(e,t){e.hasValueListAnnotation=t["sap:value-list"]!==undefined;if(e.hasValueListAnnotation){e.hasFixedValues=t["sap:value-list"]==="fixed-values"}else if(t["com.sap.vocabularies.Common.v1.ValueList"]){e.hasValueListAnnotation=true;e.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(t["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";if(!e.hasFixedValues){e.hasFixedValues=m.isValueListWithFixedValues(t)}}};U.prototype._createBasicSearchFieldMetadata=function(){var e;var t=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");e={};e.filterRestriction=R.single;e.name=b.BASIC_SEARCH_FIELD_ID;e.fieldName=b.BASIC_SEARCH_FIELD_ID;e.label=undefined;e.isMandatory=false;e.isVisible=true;e.groupId=b.BASIC_FILTER_AREA_ID;e.index=-1;e.control=new p(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){e.control.setPlaceholder(t.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"))}e.control.bindProperty("value",this.sFilterModelName+">/"+e.fieldName);this._oBasicSearchControl=e.control;return e};U.prototype._applyWidth=function(e){if(e&&e.width&&e.control&&typeof e.control.setWidth==="function"){e.control.setWidth(e.width)}};U.prototype._createFieldMetadataForCustomFilterFields=function(e){var t;if(!e||!e.customControl){return undefined}t={};t.name=e.key;t.fieldName=e.key;t.label=e.label;t.visibleInAdvancedArea=!!(e&&e.visibleInAdvancedArea);t.isVisible=this._isVisible(e);t.groupId=e.groupId;t.isMandatory=this._isMandatory(undefined,e);t.index=e.index;t.width=this._getWidth(e);t.control=e.customControl;t.isCustomFilterField=true;this._applyWidth(t);return t};U.prototype._getFieldName=function(e){if(!e.parentPropertyName){return e.name}else{return e.parentPropertyName+"."+e.name}};U.prototype._getPreventInitialDataFetchInValueHelpDialog=function(e,t){if(t&&!t.isSetPreventInitialDataFetchInValueHelpDialog){return t.preventInitialDataFetchInValueHelpDialog}if(m.isValueList(e)&&e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].FetchValues){return e["com.sap.vocabularies.Common.v1.ValueList"].FetchValues.Int!=="1"}return false};U.prototype._hasValueHelpDialog=function(e,t){var i=true;if(t){if(t.controlType===O.dropDownList){i=false}else if(t.hasValueHelpDialog!==true){i=false}}if(e&&!e.hasValueListAnnotation){if(e.filterRestriction===R.single||e.filterRestriction===R.multiple){i=false}}return i};U.prototype._isVisible=function(e){if(e&&e.isVisible===false){return false}return true};U.prototype._getWidth=function(e){if(e&&e.width){return e.width}return undefined};U.prototype._isMandatory=function(e,t){if(t&&t.mandatory!==H.auto){return t.mandatory===H.mandatory}if(e){return e.requiredFilterField}return false};U.prototype._getFilterRestriction=function(e,t){if(t&&t.filterType&&t.filterType!==R.auto){return t.filterType}switch(e){case"single-value":return R.single;case"multi-value":return R.multiple;case"interval":return R.interval;case"search-expression":return R.searchExpression;default:return R.auto}};U.prototype._getControlType=function(e,t){var i;if(t&&t.controlType&&t.controlType!==O.auto){i=t.controlType}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.isCalendarDate){i=O.date}else if(e.type==="Edm.DateTimeOffset"){i=O.dateTimePicker}else if(e.hasValueListAnnotation&&e.hasFixedValues){i=O.dropDownList}else if(this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)){i=O.dropDownList}else{i=O.input}return i};U.prototype._isBooleanWithFixedValuedButWithoutValueListAnnotation=function(e){if(e.type==="Edm.Boolean"&&!e.hasFixedValues&&!e.hasValueListAnnotation&&e.filterRestriction==="single"){return true}return false};U.prototype._getGroupID=function(e,t){if(t&&t.groupId){return t.groupId}else if(e&&(e.requiredFilterField||this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1)){return this._sBasicFilterAreaID}return this._getGroupIDFromFieldGroup(e)};U.prototype._getGroupIDFromFieldGroup=function(e){var t=0,i=null,a;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){t=this._aFieldGroupAnnotation.length;while(t--){i=this._aFieldGroupAnnotation[t];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){a=i.groupName;break}}}return a};U.prototype._getLabel=function(e,t){if(t&&t.label){return t.label}return this._getLabelFromFieldGroup(e)||e.fieldLabel||e.fieldName};U.prototype._getLabelFromFieldGroup=function(e){var t=0,i=null,a;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){t=this._aFieldGroupAnnotation.length;while(t--){i=this._aFieldGroupAnnotation[t];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){a=i.labels[e.fieldNameOData];break}}}return a};U.prototype._getIndex=function(e,t){if(t&&t.index>=0){return t.index}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1){return this._aSelectionFields.indexOf(e.fieldNameOData)}return this._getIndexFromFieldGroup(e)};U.prototype._getIndexFromFieldGroup=function(e){var t=0,i=null,a;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){t=this._aFieldGroupAnnotation.length;while(t--){i=this._aFieldGroupAnnotation[t];if(i&&i.fields){a=i.fields.indexOf(e.fieldNameOData);if(a>-1){break}a=undefined}}}return a};U.prototype._getGroupIndex=function(e){if(e&&(e.index||e.index===0)){return e.index}};U.prototype._getGroupLabel=function(e,t){if(t&&t.label){return t.label}return e.groupLabel||e.groupName||e.groupEntitySetName};U.prototype._hasTypeAhead=function(e,t,i){var a;a=true;if(i){a=i.hasTypeAhead}else if(t.type!=="Edm.String"){return false}if(!(e.fControlConstructor===d||e.fControlConstructor===f)){return false}return a};U.prototype.getModel=function(){return this.oModel};U.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata};U.prototype._getFilterBarViewMetadataExtend=function(){return this._oFilterBarViewMetadataExtend};U.prototype.getAssociatedValueHelpProviders=function(){return this._aValueHelpDialogProvider};U.prototype.getAssociatedValueListProviders=function(){return this._aValueListProvider};U.prototype.getParameters=function(){var e,t=null;if(this.oModel){t=this.oModel.getProperty("/"+b.BASIC_SEARCH_FIELD_ID)}if(this._sBasicSearchFieldName||t){e={custom:{}};if(this._sBasicSearchFieldName){e.custom["search-focus"]=this._sBasicSearchFieldName}e.custom["search"]=t||""}return e};U.prototype.getFilters=function(e){var t=null;if(this.oModel){t=this.oModel.getData()}return b.generateFilters(e,t,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,dateTimeOffsetWithTimeZone:this._aFilterBarDateTimeOffsetWithTimezoneFieldNames,viewMetadataData:this._aFilterBarViewMetadata})};U.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null};U.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null};U.prototype.getFilledFilterData=function(e){var t,i={},a,n,r;t=this.oModel?this.oModel.getData():null;if(t&&e){a=e.length;while(a--){n=e[a];if(n&&n!==b.BASIC_SEARCH_FIELD_ID){r=t[n];if(r&&r.hasOwnProperty("low")){if(r.low){i[n]=r}}else if(r&&r.hasOwnProperty("items")){if(r.value&&typeof r.value==="string"){r.value=r.value.trim()}if(r.items.length||r.ranges&&r.ranges.length||r.value||typeof r.value==="boolean"){i[n]=r}}else if(r){if(typeof r==="string"){r=r.trim()}if(r){i[n]=r}}}if(a===0){n=b.CUSTOM_FIELDS_MODEL_PROPERTY;r=t[n];if(r){i[n]=r}}}}return B({},i)};U.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e))};U.prototype.setFilterData=function(e,t){var i=null,a=null,n=null;if(this.oModel&&e){this._bUpdatingFilterData=true;try{if(t){this._createInitialModel(false)}i=this._parseFilterData(e,t);if(i){this.oModel.setData(i,true);a=[];var r=arguments[2];if(r){a.push(r)}for(n in i){a.push(n)}this._handleFilterDataUpdate(a,arguments[3])}}finally{this._bUpdatingFilterData=false}}};U.prototype.setFilterDataAsString=function(e,t){if(e){this.setFilterData(JSON.parse(e),t)}};U.prototype._parseFilterData=function(e,t){return U.parseFilterData(this.oModel.getData(),e,{stringDateFields:this._aFilterBarStringDateFieldNames,dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,dateTimeOffsetWithTimeZone:this._aFilterBarDateTimeOffsetWithTimezoneFieldNames,viewMetadataData:this._aFilterBarViewMetadata,filterProvider:this},t)};U.prototype._handleFilterDataUpdate=function(e,t){var i=0,a,n,t=t===undefined?false:t,r=this.oModel.getData();var l=function(e,t){var i=t;e.forEach(function(e){t.forEach(function(a){if(a.operation===I.EQ&&a.value1===e.key){i.splice(t.indexOf(a),1)}})});return i};if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(r){a=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(a.fieldName)>-1){n=r[a.fieldName];if(n){if(n.items&&n.items.length>0&&n.ranges&&n.ranges.length>0){n.ranges=l(n.items,n.ranges)}this._updateMultiValueControl(a.control,n.items,n.ranges,a)}}}}this._updateConditionTypeFields()}if(this._aFilterBarSingleValueWithValueListFieldMetadata&&r&&!t){this._aFilterBarSingleValueWithValueListFieldMetadata.forEach(function(t){var i=t.control,a=t.fieldName;if(!i||m.isHiddenFilter(t)){return}if(e.includes(a)){this._updateSingleValueControl(t)}else if(!r[a]){i.setValue("");i.__sValidationText=""}}.bind(this))}};U.prototype.clear=function(){this._createInitialModel(false)};U.prototype.reset=function(){this._createInitialModel(true)};U.prototype._initializeConditionTypeFields=function(){var e=function(e){this.setPending(this.isPending())}.bind(this);for(var t in this._mConditionTypeFields){this._mConditionTypeFields[t].conditionType.initialize(this.oModel.getData()[t]);if(this._mConditionTypeFields[t].conditionType.getAsync()){this._mConditionTypeFields[t].conditionType.attachPendingChange(e)}}};U.prototype._updateConditionTypeFields=function(){var e=this._oldData;var t=this.oModel.getData();this._oldData=B({},t);if(e!==undefined){var i=[],a;for(a in t){var n=JSON.stringify(t[a]);var r=JSON.stringify(e[a]);if(n!==r){i.push(a)}}if(i.length>0){for(a in this._mConditionTypeFields){this._mConditionTypeFields[a].conditionType.providerDataUpdated(i,t)}}}};U.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var t in this._mConditionTypeFields){if(!e[t]){this._mConditionTypeFields[t].conditionType.initialize({})}else{this._mConditionTypeFields[t].conditionType.initialize(e[t])}}};U.prototype._validateConditionTypeFields=function(){var e=false;for(var t in this._mConditionTypeFields){var i=this._mConditionTypeFields[t].conditionType.validate();if(!i&&!e){e=true}}return e};U.prototype._getFieldMetadata=function(e){return b._getFieldMetadata(this.getFilterBarViewMetadata(),e)};U.prototype._getSelectedDateRange=function(e){if(!Array.isArray(e)){e=[e,e]}return e};U.prototype._getDateFieldOutOfRangeErrorText=function(e,t,i,a){var n=e.getMinDate()||e._oMinDate,r=e.getMaxDate()||e._oMaxDate;if(t[0].getTime()<n.getTime()){return a.getText("FILTER_BAR_DATE_FIELD_MIN_DATE_ERROR",[i.formatValue(n,"string")])}if(t[1].getTime()>r.getTime()){return a.getText("FILTER_BAR_DATE_FIELD_MAX_DATE_ERROR",[i.formatValue(r,"string")])}};U.generateFilters=function(e,t,i){return b.generateFilters(e,t,i)};U.parseFilterData=function(t,i,a,n){var r={},l=null,o=null,s=null,d,u,f,h,p,c,m,g,_,y,F,v,T,D,C;if(a){c=a.stringDateFields;m=a.dateFields;g=a.timeFields;_=a.timeIntervalFields;y=a.dateTimeMultiValueFields;l=a.conditionTypeFields||{};F=a.dateTimeOffsetValueFields;v=a.viewMetadataData||[];D=a.filterProvider||null}if(!c){c=[]}if(!m){m=[]}if(!g){g=[]}if(!_){_=[]}if(!y){y=[]}if(!F){F=[]}if(t&&i){u=Object.assign({},i,true);for(o in u){T=b._getFieldMetadata(v,o);if(t.hasOwnProperty(o)&&o!==b.CUSTOM_FIELDS_MODEL_PROPERTY){s=t[o];d=u[o];if(o in l){if(l[o]&&typeof d==="string"){var S=e.getInstance(d);if(S instanceof Date&&!isNaN(S)){l[o].conditionType.initialize({value1:S})}else if(l[o].type==="Edm.String"&&l[o].ui5Type&&typeof l[o].ui5Type.formatValue==="function"){var S=l[o].ui5Type.formatValue(d);l[o].conditionType.initialize({value1:S})}}else if(d&&(d.low||d.low===0)&&(d.high||d.high===0)){var V=e.getInstance(d.low),A=e.getInstance(d.high);if(V instanceof Date&&!isNaN(V)&&A instanceof Date&&!isNaN(A)){l[o].conditionType.initialize({value1:V,value2:A})}else if(l[o].type==="Edm.String"&&l[o].ui5Type&&typeof l[o].ui5Type.formatValue==="function"){var V=l[o].ui5Type.formatValue(d.low),A=l[o].ui5Type.formatValue(d.high);l[o].conditionType.initialize({value1:V,value2:A})}}else if(d&&"conditionTypeInfo"in d){if(l[o].isParameter){this._reduceRangesForParameters(d)}else if(d.ranges&&d.ranges.length>0){p=d.ranges[d.ranges.length-1];if(p){if(d.conditionTypeInfo.data.operation==="DATE"){d.conditionTypeInfo.data.value1=p.value1}else if(d.conditionTypeInfo.data.operation==="DATERANGE"){d={value1:p.value1,value2:p.value2}}}}l[o].conditionType.initialize(d)}else if(d&&!("conditionTypeInfo"in d)&&d.ranges){if(l[o].isParameter){this._reduceRangesForParameters(d)}l[o].conditionType.initialize(d)}}else if(s&&s.hasOwnProperty("low")){r[o]=d;if(d){if((d.low||d.low===0)&&(d.high||d.high===0)){if(m.indexOf(o)>-1||g.indexOf(o)>-1){if(!(d.low instanceof Date)){r[o].low=e.getInstance(d.low)}if(!(d.high instanceof Date)){r[o].high=e.getInstance(d.high)}}else if(D&&T&&F.indexOf(o)>-1){r[o].low=T.ui5Type.formatValue(e.getInstance(d.low),"string")+"-"+T.ui5Type.formatValue(e.getInstance(d.high),"string");r[o].high=null}else if(c.indexOf(o)===-1){r[o].low=d.low+"-"+d.high;r[o].high=null}}else if((d.low||d.low===0||d.value)&&!d.high){if(!d.low&&d.value){d.low=d.value}if((m.indexOf(o)>-1||g.indexOf(o)>-1||F.indexOf(o)>-1)&&!(d.low instanceof Date)){C=Date.parse(d.low);if(!Number.isNaN(C)){r[o].low=e.getInstance(C)}}r[o].low=d.low;r[o].high=null}}}else if(s&&s.hasOwnProperty("items")){if(d&&(d.items||d.ranges)){if(d.ranges&&d.ranges.length){if(_.indexOf(o)>-1){h=d.ranges.length;for(f=0;f<h;f++){p=d.ranges[f];if(!p.exclude&&(p.operation==="EQ"||p.operation==="BT")){break}p=null}if(p){if(p.value1&&typeof p.value1==="string"){p.value1=e.getInstance(p.value1)}if(p.value2&&typeof p.value2==="string"){p.value2=e.getInstance(p.value2)}r[o]={ranges:[p],items:[],value:""}}continue}else if(m.indexOf(o)>-1||g.indexOf(o)>-1||F.indexOf(o)>-1){h=d.ranges.length;for(f=0;f<h;f++){p=d.ranges[f];if(p.value1&&typeof p.value1==="string"){p.value1=e.getInstance(p.value1)}if(p.value2&&typeof p.value2==="string"){p.value2=e.getInstance(p.value2)}}}else if(T&&T.isCalendarDate){h=d.ranges.length;for(f=0;f<h;f++){p=d.ranges[f];if(p.value1&&typeof p.value1==="string"&&!p.value1.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){p.value1=T.ui5Type.parseValue(e.getInstance(p.value1),"date")}if(p.value2&&typeof p.value2==="string"&&!p.value2.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){p.value2=T.ui5Type.parseValue(e.getInstance(p.value2),"date")}}}else if(T&&T.filterType==="boolean"){h=d.ranges.length;for(f=0;f<h;f++){p=d.ranges[f];if(p.hasOwnProperty("value1")){if(typeof p.value1==="string"){p.value1=p.value1==="true"}}if(p.hasOwnProperty("value2")){if(typeof p.value2==="string"){p.value2=p.value2==="true"}}}}}r[o]=d;if(!n&&r[o].ranges){for(f=0;f<r[o].ranges.length;f++){r[o].ranges[f].tokenText=null}}}else if(typeof d==="string"||typeof d==="boolean"||typeof d==="number"||d instanceof Date){if(d&&(m.indexOf(o)>-1||g.indexOf(o)>-1)){if(typeof d==="string"){d=e.getInstance(d)}r[o]={ranges:[{exclude:false,operation:"EQ",keyField:o,value1:d,value2:null}],items:[],value:""}}else{r[o]={value:d,items:[]}}}}else{r[o]=null;if(typeof d==="string"||typeof d==="boolean"||typeof d==="number"||d instanceof Date){if(typeof d==="string"&&(m.indexOf(o)>-1||g.indexOf(o)>-1||F.indexOf(o)>-1)){r[o]=e.getInstance(d)}else{r[o]=d}}else if(d&&(d.value||d.value===0||d.value===false)){r[o]=d.value}else if(d&&d.items&&d.items.length){r[o]=d.items[0].key}else if(d&&d.ranges&&d.ranges.length){h=d.ranges.length;for(f=0;f<h;f++){p=d.ranges[f];if(!p.exclude&&p.operation==="EQ"){break}p=null}if(p&&p.value1){if(typeof p.value1==="string"&&(m.indexOf(o)>-1||g.indexOf(o)>-1||F.indexOf(o)>-1)){r[o]=e.getInstance(p.value1)}else{r[o]=p.value1}}}}}else if(n||o===b.CUSTOM_FIELDS_MODEL_PROPERTY){r[o]=u[o]}}}return r};U.prototype._attachEvent=function(e,t){if(!this._oEventProvider){this._oEventProvider=new D}this._oEventProvider.attachEvent(e,t)};U.prototype._attachEventOnce=function(e,t){if(!this._oEventProvider){this._oEventProvider=new D}this._oEventProvider.attachEventOnce(e,t)};U.prototype._detachEvent=function(e,t){if(!this._oEventProvider){return}this._oEventProvider.detachEvent(e,t)};U.prototype._fireEvent=function(e,t){if(!this._oEventProvider){return}this._oEventProvider.fireEvent(e,t||{})};U.prototype._getSuppressValueListsAssociation=function(){return this._bSuppressValueListsAssociation};U.prototype._getCurrentValidationPromises=function(){return this._aValueListProvider.concat(this._aValueHelpDialogProvider).reduce(function(e,t){return e.concat(t._getCurrentValidationPromises())},[])};U.prototype._enrichFieldViewMetadata=function(e,t){var i,a,n,r,l,o,s={},d="com.sap.vocabularies.Common.v1.ValueList";if(t===undefined||e===undefined){return}a=e["groupName"];n=e["fullName"];r=t.primaryValueListAnnotation!==undefined;l=Array.isArray(t.additionalAnnotations)&&t.additionalAnnotations.length>0;if(r){s[d]=t.primaryValueListAnnotation.annotation}if(l){for(i=0;i<t.additionalAnnotations.length;i++){o=t.additionalAnnotations[i];s[d+"#"+o.qualifier]=o.annotation}}if(r||l){if(this._oFilterBarViewMetadataExtend[a]===undefined){this._oFilterBarViewMetadataExtend[a]={}}if(this._oFilterBarViewMetadataExtend[a][n]===undefined){this._oFilterBarViewMetadataExtend[a][n]={}}this._oFilterBarViewMetadataExtend[a][n]=s}};U.prototype._isSingleDynamicDateEnabled=function(e){var t=this._bUseDateRangeType&&(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.type==="Edm.String"&&e.isCalendarDate);if(t){return true}var i=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName)||this._oAdditionalConfiguration.getControlConfigurationByKey(e.name):null;var a=i&&(i.conditionType==="sap.ui.comp.config.condition.DateRangeType"||i.conditionType&&i.conditionType&&typeof i.conditionType==="object"&&i.conditionType.module==="sap.ui.comp.config.condition.DateRangeType")&&(e.type==="Edm.DateTime"||e.type==="Edm.String"&&e.isCalendarDate);return a};U.prototype._setSingleInputsTextArrangementData=function(e){this._sSingleInputsTextArrangementData=Object.assign({},e);return this};U.prototype._setSingleInputsTextArrangementFieldData=function(e,t,i){this._sSingleInputsTextArrangementData[e]={key:t,text:i};return this};U.prototype._getSingleInputsTextArrangementData=function(e){if(e){return this._sSingleInputsTextArrangementData[e]}return this._sSingleInputsTextArrangementData};U.prototype._getFilterTimeZone=function(e){var t=this._oAdditionalConfiguration,i=t?t.getControlConfigurationByKey(e):null,a=null;if(i){a=i.timezone}return a};U.prototype.destroy=function(){var e=function(e){var t;if(e){t=e.length;while(t--){e[t].destroy()}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oFilterBarViewMetadataExtend=null;this._oParameterization=null;this._oNonAnaParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarStringDateFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFilterBarDropdownFieldMetadata=null;this._aFilterBarNumericFieldMetadata=null;this._sSingleInputsTextArrangementData=null;this._oNotValidatedSingleFields={};this._oSingleFieldSetFromFilterData={};this._aFilterBarDateTimeFieldNames=null;this._aFilterBarDateTimeOffsetWithTimezoneFieldNames=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;this._aSelectionVariants=null;if(this._oBasicSearchControl&&this._oBasicSearchControl.destroy){this._oBasicSearchControl.destroy()}this._oBasicSearchControl=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy()}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;if(this._mTokenHandler){for(var t in this._mTokenHandler){var i=this._mTokenHandler[t];if(i.parser){i.parser.destroy();i.parser=null}}delete this._mTokenHandler}this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this.sDefaultSingleFieldDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy()}this._oEventProvider=null}for(var a in this._mConditionTypeFields){this._mConditionTypeFields[a].conditionType.destroy()}this._mConditionTypeFields=null;if(this.oModel){this.oModel.destroy();this.oModel=null}this._aPromises=[];this.bIsDestroyed=true};return U},true);
//# sourceMappingURL=FilterProvider.js.map