/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ColumnHeaderMenuAdapter","sap/ui/table/ColumnMenu","sap/ui/table/AnalyticalColumnMenu","sap/ui/table/utils/TableUtils","sap/ui/core/Popup","sap/ui/Device","sap/ui/base/ManagedObjectObserver"],function(e,t,n,a,r,l,u){"use strict";var i=["sortProperty","filterProperty","showSortMenuEntry","showFilterMenuEntry"];var o=["filterValue"];var s=["enableCustomFilter","enableGrouping","enableColumnFreeze","showColumnVisibilityMenu"];var p=e.extend("sap.ui.table.menus.LegacyColumnMenuAdapter",{constructor:function(){e.apply(this,arguments);this._oLegacyMenuObserver=new u(function(e){if(e.old!==e.current){if(i.indexOf(e.name)>-1){this._invalidateMenu(e.object)}else if(o.indexOf(e.name)>-1){this._setFilterValue(e.object,e.current)}else if(s.indexOf(e.name)>-1){this._invalidateAllMenus()}}}.bind(this))}});p.prototype.injectMenuItems=function(e,t){var n=t._getTable();var a=t.getDomRef();var r=a.querySelector(".sapUiTableColDropDown")!==null;if(!l.system.desktop&&!r){return this._applyColumnHeaderCellMenu(t)}this._removeColumnHeaderCellMenu(n);var u=n.fireColumnSelect({column:t});if(u){this._openColumnContextMenu(t)}};p.prototype._invalidateMenu=function(e){var t=e.getMenu();if(a.isA(t,"sap.ui.table.ColumnMenu")){t._invalidate()}};p.prototype._invalidateAllMenus=function(e){var t=e.getColumns();for(var n=0,a=t.length;n<a;n++){this._invalidateMenu(t[n])}};p.prototype._setFilterValue=function(e,t){var n=e.getMenu();if(a.isA(n,"sap.ui.table.ColumnMenu")){n._setFilterValue(t)}};p.prototype._setFilterState=function(e,t){var n=e.getMenu();if(a.isA(n,"sap.ui.table.ColumnMenu")){n._setFilterState(t)}};p.prototype._applyColumnHeaderCellMenu=function(e){var t=e._getTable();var n=e.getDomRef();var a=n.getAttribute("colspan");var r=n.querySelector(".sapUiTableCellInner");var l=n.querySelector(".sapUiTableCellTouchMenu")!==null;if(a&&a!=="1"||l||!e.getResizable()&&!e._menuHasItems()){return false}var u=document.createElement("div");this._removeColumnHeaderCellMenu(t);r.style.display="none";if(e._menuHasItems()){var i;i=document.createElement("div");i.classList.add("sapUiTableColDropDown");i.textContent="";u.appendChild(i)}if(e.getResizable()){var o;o=document.createElement("div");o.classList.add("sapUiTableColResizer");o.textContent="";u.appendChild(o)}u.classList.add("sapUiTableCellTouchMenu");n.appendChild(u);var s=function(){this._removeColumnHeaderCellMenu(t);n.removeEventListener("focusout",s)}.bind(this);n.addEventListener("focusout",s);return true};p.prototype._removeColumnHeaderCellMenu=function(e){var t=e&&e.$().find(".sapUiTableCHT .sapUiTableCellTouchMenu");if(t.length){t.parent().find(".sapUiTableCellInner").show();t.remove()}};p.prototype._openColumnContextMenu=function(e){var t=e._getTable();var n=e._cellPressed;var a=t.getColumns();for(var r=0;r<a.length;r++){if(a[r]!==e){this._closeColumnContextMenu(e)}}var l=n.getAttribute("colspan");if(l&&l!=="1"){return false}return this._openMenu(e,n)};p.prototype._openMenu=function(e,t){var n=this._getMenu(e);if(!e._menuHasItems()){return false}var a=e.fireColumnMenuOpen({menu:n});if(a){var l=r.Dock;n.open(null,t,l.BeginTop,l.BeginBottom,t);return true}else{return true}};p.prototype._closeColumnContextMenu=function(e){var t=e.getMenu();if(t){t.close()}};p.prototype._getMenu=function(e){var t=e.getMenu();if(!t){t=this._createMenu(e);e.setAggregation("menu",t,true);var n=i.concat(o).concat(s);this._oLegacyMenuObserver.observe(e,{properties:n});a.Hook.register(e._getTable(),a.Hook.Keys.Column.SetFilterState,this._setFilterState,this)}return t};p.prototype._createMenu=function(e){var a=e.isA("sap.ui.table.AnalyticalColumn")?n:t;return new a(e.getId()+"-menu",{ariaLabelledBy:e})};return p});
//# sourceMappingURL=LegacyColumnMenuAdapter.js.map