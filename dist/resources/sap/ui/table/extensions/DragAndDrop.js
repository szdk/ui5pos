/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ExtensionBase","../utils/TableUtils","sap/ui/core/library"],function(t,e,o){"use strict";var r="sap.ui.table";var a=o.dnd.DropPosition;var i={getSessionData:function(t,e){return t.getComplexData(r+(e==null?"":"-"+e))},setSessionData:function(t,e,o){t.setComplexData(r+(o==null?"":"-"+o),e)},getInstanceSessionData:function(t,e){return this.getSessionData(t,e.getId())},setInstanceSessionData:function(t,e,o){this.setSessionData(t,o,e.getId())},scrollVertically:e.throttle(function(t,e,o,r){var a=t._getScrollExtension().getVerticalScrollbar();a.scrollTop+=this.calculateScrollDistance(o,r)*(e?1:-1)},50),scrollHorizontally:e.throttle(function(t,e,o,r){var a=t._getScrollExtension().getHorizontalScrollbar();a.scrollLeft+=this.calculateScrollDistance(o,r)*(e?1:-1)},50),calculateScrollDistance:function(t,e){var o=2;var r=50;var a=e/t;return Math.max(o,Math.round(r*a))}};var l={ondragstart:function(t){var e=t.dragSession;if(!e||!e.getDragControl()){return}var o=e.getDragControl();var r={};if(o.isA("sap.ui.table.Row")){if(o.isEmpty()||o.isGroupHeader()||o.isSummary()){t.preventDefault();return}else{r.draggedRowContext=o.getRowBindingContext()}}i.setInstanceSessionData(e,this,r)},ondragenter:function(t){var o=t.dragSession;if(!o||!o.getDropControl()){return}var r=i.getInstanceSessionData(o,this);var l=o.getDragControl();var n=o.getDropControl();if(!r){r={}}if(n.isA("sap.ui.table.Row")){var s=r.draggedRowContext;var g=n.getRowBindingContext();var c=o.getDropInfo().getDropPosition();if(n.isEmpty()&&c===a.On&&e.hasData(this)||s&&s===g||n.isGroupHeader()||n.isSummary()){t.setMarked("NonDroppable")}else{if(!g){var f=this.getRows()[e.getNonEmptyRowCount(this)-1];o.setDropControl(f||this)}if(o.getDropControl()!==this){var u=this.getDomRef().classList.contains("sapUiTableVScr");var h=this.getDomRef("sapUiTableCnt").getBoundingClientRect();o.setIndicatorConfig({width:h.width-(u?16:0),left:h.left+(this._bRtlMode&&u?16:0)})}}}else if(n.isA("sap.ui.table.Column")){var v=e.getCellInfo(e.getCell(this,t.target)).columnIndex;if(l.isA("sap.ui.table.Column")&&!e.Column.isColumnMovableTo(l,v,true)){t.setMarked("NonDroppable");return}var h=this.getDomRef("sapUiTableCnt").getBoundingClientRect();o.setIndicatorConfig({height:h.height-(this._getScrollExtension().isHorizontalScrollbarVisible()?16:0)})}else if(l===n){t.setMarked("NonDroppable")}if(!r.verticalScrollEdge){var d=window.pageYOffset;var p=this.getDomRef("table").getBoundingClientRect();r.verticalScrollEdge={bottom:p.bottom+d,top:p.top+d}}var D=window.pageXOffset;var S=this.getDomRef("sapUiTableCtrlScr").getBoundingClientRect();r.horizontalScrollEdge={left:S.left+D,right:S.right+D};i.setInstanceSessionData(o,this,r)},ondragover:function(t){var e=t.dragSession;if(!e){return}var o=i.getInstanceSessionData(e,this);if(!o){return}var r=50;var a=e.getDropControl();var l=this._getScrollExtension();var n=l.getVerticalScrollbar();var s=l.getHorizontalScrollbar();var g=o.verticalScrollEdge;var c=o.horizontalScrollEdge;if(g&&n&&a!==this){var f=t.pageY;if(f>=g.top-r&&f<=g.top+r){i.scrollVertically(this,false,r*2,g.top+r-f)}else if(f<=g.bottom+r&&f>=g.bottom-r){i.scrollVertically(this,true,r*2,f-g.bottom+r)}}if(c&&s&&a!==this){var u=t.pageX;if(u>=c.left-r&&u<=c.left+r){i.scrollHorizontally(this,false,r*2,c.left+r-u)}else if(u<=c.right+r&&u>=c.right-r){i.scrollHorizontally(this,true,r*2,u-c.right+r)}}},onlongdragover:function(t){var o=t.dragSession;if(!o){return}var r=e.getCell(this,t.target);var a=e.getCellInfo(r).rowIndex;var i=a==null?null:this.getRows()[a];var l=o.getDropControl();if(i&&(l===i||!l)){i.expand()}},ondragend:function(t){i.scrollVertically.cancel();i.scrollHorizontally.cancel()}};var n=t.extend("sap.ui.table.extensions.DragAndDrop",{_init:function(t,o,r){this._oDelegate=l;e.addDelegate(t,this._oDelegate,t);return"DragAndDropExtension"},_debug:function(){this._ExtensionDelegate=l},destroy:function(){var e=this.getTable();if(e){e.removeEventDelegate(this._oDelegate)}i.scrollVertically.cancel();i.scrollHorizontally.cancel();this._oDelegate=null;t.prototype.destroy.apply(this,arguments)}});return n});
//# sourceMappingURL=DragAndDrop.js.map