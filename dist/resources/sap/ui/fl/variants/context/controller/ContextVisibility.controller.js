/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/fl/write/_internal/Storage","sap/ui/fl/Layer","sap/base/util/restricted/_isEqual"],function(e,t,r,n,o){"use strict";function i(e){var t={layer:n.CUSTOMER,type:"role"};return Object.assign({},t,e)}function s(e){var t={layer:n.CUSTOMER,flexObjects:e};return r.loadContextDescriptions(t).then(function(t){if(t.role&&t.role.length===e.role.length){this.oSelectedContextsModel.setProperty("/selected",t.role)}}.bind(this))}function l(){return t.load({id:this.getView().getId(),name:"sap.ui.fl.variants.context.view.fragment.AddContextDialog",controller:this}).then(function(e){this.getView().addDependent(e);e._oList.attachUpdateStarted(this._updateStartedHandler.bind(this));e._oList.attachSelectionChange(this._onSelectionChange.bind(this));return e}.bind(this))}function a(e,t){return r.getContexts(i(e)).then(function(e){if(t){e.values=t.concat(e.values)}this.oContextsModel.setData(e);this.oContextsModel.refresh(true)}.bind(this))}function d(e){return{id:e.getTitle(),description:e.getDescription()}}return e.extend("sap.ui.fl.variants.context.controller.ContextVisibility",{onInit(){this.oSelectedContextsModel=this.getView().getModel("selectedContexts");this.oContextsModel=this.getView().getModel("contexts");this.oI18n=this.getView().getModel("i18n").getResourceBundle()},onBeforeRendering(){this.oSelectedContextsModel.refresh(true);if(!this.oSelectedContextsModel.getProperty("/noDataText")){this.oSelectedContextsModel.setProperty("/noDataText",this.oI18n.getText("NO_SELECTED_ROLES"));this.oSelectedContextsModel.refresh(true)}var e=this.getOwnerComponent().getSelectedContexts();var t=e.role.length>0;if(t){return s.call(this,e)}return Promise.resolve()},_onSelectionChange(e){var t=d(e.getParameter("listItem"));if(e.getParameter("selected")===true){this.oCurrentSelection.push(t)}else{this.oCurrentSelection=this.oCurrentSelection.filter(function(e){return!o(e,t)})}},isSelected(e,t){return t.some(function(t){return t.id===e.id})},formatTooltip(e){this.oI18n||=this.getView().getModel("i18n").getResourceBundle();return e.length===0?this.oI18n.getText("NO_DESCRIPTION"):e},_appendDataFromBackend(){var e=this.oContextsModel.getProperty("/values");if(this.oContextsModel.getProperty("/lastHitReached")===false){var t={$skip:e.length};return a.call(this,t,e)}return Promise.resolve(e)},_updateStartedHandler(e){if(e.getParameter&&e.getParameter("reason")==="Growing"){return this._appendDataFromBackend()}return Promise.resolve()},_addContexts(e){e.clearSelection();this.oCurrentSelection=this.oSelectedContextsModel.getProperty("/selected")||[];return a.call(this,{}).then(function(){return e.open()})},onAddContextsHandler(){this._oDialog||=l.call(this);return this._oDialog.then(function(e){return this._addContexts(e)}.bind(this))},onSearch(e){e.getSource().clearSelection();var t={$filter:e.getParameter("value")};return a.call(this,t)},onSelectContexts(){this.oSelectedContextsModel.setProperty("/selected",this.oCurrentSelection);this.oSelectedContextsModel.refresh(true);this.oCurrentSelection=[]},onDeleteContext(e){var t=this.oSelectedContextsModel.getProperty("/selected");var r=e.getParameter("listItem");var n=t.filter(function(e){return e.id!==r.getTitle()});this.oSelectedContextsModel.setProperty("/selected",n);var o=e.getSource();o.attachEventOnce("updateFinished",o.focus,o)},removeAll(){this.oSelectedContextsModel.setProperty("/selected",[])},isRemoveAllEnabled(e){return e&&e.length!==0},isMessageStripVisible(e,t){return t&&e.length===0}})});
//# sourceMappingURL=ContextVisibility.controller.js.map