/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/changes/FlexCustomData","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/Utils"],function(e,r,n,t,o){"use strict";var i={};function a(e){if(!e.isApplyProcessFinished()&&e.hasApplyProcessStarted()){return e.addPromiseForApplyProcessing().then(function(r){if(r&&r.error){e.markRevertFinished(r.error);throw Error(r.error)}})}return Promise.resolve()}function l(e,r,t,o){return i.revertChangeOnControl(e,r,t).then(function(t){n.destroyAppliedCustomData(t||r,e,o.modifier);if(t){o.flexController._oChangePersistence._deleteChangeInMap(e)}})}i.revertChangeOnControl=function(r,n,o){var i=t.getControlIfTemplateAffected(r,n,o);var l;return t.getChangeHandler(r,i,o).then(function(e){l=e}).then(a.bind(null,r)).then(function(){if(r.isSuccessfullyApplied()){r.startReverting();return l.revertChange(r,i.control,o)}throw Error("Change was never applied")}).then(function(){i.control=o.modifier.bySelector(r.getSelector(),o.appComponent,o.view);if(i.bTemplateAffected){return o.modifier.updateAggregation(i.control,r.getContent().boundAggregation)}return undefined}).then(function(){r.markRevertFinished();return i.control}).catch(function(n){var t=`Change could not be reverted: ${n.message}`;e.error(t);r.markRevertFinished(t);return false})};i.revertMultipleChanges=function(n,t){var i=[];n.forEach(function(r){r.setQueuedForRevert();i.push(function(){var n=r.getSelector&&r.getSelector();var i=t.modifier.bySelector(n,t.appComponent);if(!i){e.warning(`A flexibility change tries to revert changes on a nonexistent control with id ${n.id}`);return o.FakePromise?new o.FakePromise:Promise.resolve()}var a={modifier:t.modifier,appComponent:t.appComponent,view:o.getViewForControl(i)};return l(r,i,a,t)})});const a=o.execPromiseQueueSequentially(i);r.addPreConditionForInitialChangeApplying(a);return a};return i});
//# sourceMappingURL=Reverter.js.map