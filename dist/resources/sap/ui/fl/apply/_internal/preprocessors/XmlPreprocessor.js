/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/util/reflection/XmlTreeModifier","sap/ui/core/Component","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/Utils","sap/base/Log"],function(e,t,n,a,r,i,o,p,s,l){"use strict";var c=function(){};c.NOTAG="<NoTag>";c.process=async function(a,r){try{r.viewId=r.id;var i=n.getComponentById(r.componentId);if(!i){l.warning("View is generated without a component. Flexibility features are not possible.");return a}var c=s.getAppComponentForControl(i);if(!s.isApplication(c.getManifestObject())){return a}const f=e({appComponent:c,modifier:t,view:a},r);var u=p.getChangePersistenceForControl(c);const g=await u.getChangesForView(f);await o.applyAllChangesForXMLView(f,g);l.debug(`flex processing view ${r.id} finished`);return a}catch(e){var f=`view ${r.id}: ${e}`;l.info(f);return a}};function u(e,t){if(!t){return e}return e.concat("-",t)}function f(e){return e.replace(/(^W\/|")/g,"")}c.getCacheKey=async function(e){var t=n.getComponentById(e.componentId);var o=s.getAppComponentForControl(t);if(s.isVariantByStartupParameter(o)){return undefined}var p=r.getFlexReferenceForControl(o);let l=c.NOTAG;if(p){const e=await a.getStorageResponse(p);if(e?.cacheKey){l=f(e.cacheKey);const t=await i.getVariantModel(o);var g=t.getVariantManagementControlIds();var d=t.getCurrentControlVariantIds().filter(function(e){return!g.includes(e)});l=u(l,d.join("-"))}}return l};return c},true);
//# sourceMappingURL=XmlPreprocessor.js.map