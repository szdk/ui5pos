/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Lib","sap/ui/fl/apply/_internal/changes/descriptor/Applier","sap/ui/fl/apply/_internal/changes/descriptor/ApplyStrategyFactory","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/variants/VariantModel","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement"],function(e,t,n,o,r,a,i,s,l,p,c,u,d,f){"use strict";var m={};m._componentInstantiationPromises=new WeakMap;var g={};function h(n,o){if(u.getUshellContainer()){return Promise.resolve(n)}var r=window.sessionStorage.getItem(`sap.ui.rta.restart.${c.CUSTOMER}`);if(r){var a=i.getFlexReferenceForControl(o);if(r!==a&&r!=="true"){e.error(`an application component was started which does not match the component for which the restart was triggered:\n\t\t\t\t\tTriggering component: ${r}\n\t\t\t\t\tStarted component: ${a}`);return Promise.resolve(n)}return new Promise(function(e,r){Promise.all([t.load({name:"sap.ui.rta"}),o.rootControlLoaded()]).then(function(){sap.ui.require(["sap/ui/rta/api/startKeyUserAdaptation"],function(t){t({rootControl:o});e(n)})}).catch(function(e){r(e)})})}return Promise.resolve(n)}function C(e){const t=i.getFlexReferenceForControl(e);const n=a.getStorageResponse(t);if(n.messagebundle&&!e.getModel("i18nFlexVendor")&&n.changes?.changes?.some(e=>e.layer===c.VENDOR)){e.setModel(new d(n.messagebundle),"i18nFlexVendor")}}function y(e){var t=p.createForControl(e);var n;return t._oChangePersistence.loadChangesMapForComponent(e).then(function(o){var a=r.applyAllChangesForControl.bind(r,o,e,t);a._bIsSapUiFlFlexControllerApplyChangesOnControl=true;e.addPropagationListener(a);n=m._createVariantModel(t,e);return n.initialize()}).then(function(){e.setModel(n,s.getVariantModelName());f.end("flexProcessing");return n}).then(function(t){return h(t,e)})}function M(e,t){if(u.isApplicationComponent(e)){var n=e.getId();a.rebuildFilteredResponse(i.getFlexReferenceForControl(e));var o=a.initialize({componentId:n,asyncHints:t.asyncHints}).then(y.bind(this,e)).then(C.bind(this,e)).then(function(){if(g[n]){g[n].forEach(function(t){var n=e.getModel(s.getVariantModelName());t.setModel(n,s.getVariantModelName())});delete g[n]}});m._componentInstantiationPromises.set(e,o);return o}else if(u.isEmbeddedComponent(e)){var r=u.getAppComponentForControl(e);if(m._componentInstantiationPromises.has(r)){return m._componentInstantiationPromises.get(r).then(function(){var t=r.getModel(s.getVariantModelName());e.setModel(t,s.getVariantModelName())})}g[r.getId()]=g[r.getId()]||[];g[r.getId()].push(e);return Promise.resolve()}return Promise.resolve()}function v(e,t){if(!u.isApplication(t)||!e.id){return Promise.resolve()}a.initialize({componentData:e.componentData||e.settings&&e.settings.componentData,asyncHints:e.asyncHints,manifest:t,componentId:e.id});return n.applyChangesIncludedInManifest(t,o.getRuntimeStrategy())}m._createVariantModel=function(e,t){return new l({},{flexController:e,appComponent:t})};m.instanceCreatedHook=function(...e){return M(...e)};m.componentLoadedHook=function(...e){return v(...e)};return m});
//# sourceMappingURL=ComponentLifecycleHooks.js.map