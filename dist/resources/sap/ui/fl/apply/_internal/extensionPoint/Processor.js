/*!
* OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/changes/ExtensionPointState","sap/ui/fl/Utils","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/base/SyncPromise","sap/base/util/merge","sap/ui/base/DesignTime"],function(e,n,t,i,r,o,a,s){"use strict";var u;function f(e,n,t,i,r){return r(e,true).then(function(r){r.forEach(function(e,r){n.splice(t+r+i,0,e)});e.index+=i;return r.length-1})}function l(e,n,t){var i=[];var r=[];var a=0;var s;t.forEach(function(t,o){if(t._isExtensionPoint){t.targetControl=e.targetControl;t.aggregationName=e.aggregationName;t.fragmentId=e.fragmentId;t.index=o;if(s){s._nextSibling=t}s=t;t.referencedExtensionPoint=e;i.push(function(){return f(t,r,o,a,n).then(function(e){a+=e})})}else{r.push(t)}});if(i.length>0){return i.reduce(function(e,n){return e.then(n)},o.resolve()).then(function(){return r})}return o.resolve(r)}function g(e,o){var s=i.getAppComponentForControl(e.targetControl);var f={};var l=a({defaultContent:[]},e);f.appComponent=s;f.modifier=r;f.viewId=e.view.getId();f.componentId=s.getId();return u.registerExtensionPoint(l).then(n.initialize.bind(n,f)).then(t.enhanceExtensionPointChanges.bind(t,f,e)).then(u.createDefaultContent.bind(this,e,o,g)).then(u.addDefaultContentToExtensionPointInfo.bind(this,l,o))}u={oExtensionPointRegistry:undefined,oRegistryPromise:Promise.resolve(),registerExtensionPoint(e){if(s.isDesignModeEnabled()){if(u.oExtensionPointRegistry){u.oExtensionPointRegistry.registerExtensionPoint(e);return o.resolve()}u.oRegistryPromise=u.oRegistryPromise.then(function(){return new Promise(function(n,t){sap.ui.require(["sap/ui/fl/write/_internal/extensionPoint/Registry"],function(t){u.oExtensionPointRegistry=t;t.registerExtensionPoint(e);n()},function(e){t(e)})})});return u.oRegistryPromise}return o.resolve()},createDefaultContent(e,n,t,i){if(i.length===0){return e.createDefault().then(l.bind(undefined,e,t)).then(function(t){if(!n){t.forEach(function(n,t){r.insertAggregation(e.targetControl,e.aggregationName,n,e.index+t,e.view)});e.ready(t)}return t})}return o.resolve([])},addDefaultContentToExtensionPointInfo(e,n,t){if(!n){e.defaultContent=e.defaultContent.concat(t)}return t},applyExtensionPoint(n){var t=g(n,false);e.addPreConditionForInitialChangeApplying(t);return t}};return u});
//# sourceMappingURL=Processor.js.map