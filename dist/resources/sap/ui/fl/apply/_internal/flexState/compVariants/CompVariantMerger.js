/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/ui/fl/apply/_internal/flexObjects/FlexObjectFactory","sap/ui/fl/apply/_internal/flexState/compVariants/Utils","sap/base/Log"],function(e,t,n,a){"use strict";var i={addFavorite(e){e.setFavorite(true)},removeFavorite(e){e.setFavorite(false)},updateVariant(e,t){var n=t.getContent();if(n.executeOnSelection!==undefined){e.setExecuteOnSelection(n.executeOnSelection)}if(n.favorite!==undefined){e.setFavorite(n.favorite)}if(n.contexts){e.setContexts(n.contexts)}if(n.visible!==undefined){e.setVisible(n.visible)}if(n.variantContent){e.setContent(n.variantContent,true)}var a=t.getText("variantName");if(a){e.setName(a,true)}},standardVariant(e,t){e.setExecuteOnSelection(t.getContent().executeOnSelect)}};function r(e){var t={};e.changes.forEach(function(e){var n=e.getSelector().variantId||e.getContent().key;t[n]||=[];t[n].push(e)});return t}function o(e,t){a.error(`No change handler for change with the ID '${t.getId()}' and type '${t.getChangeType()}' defined.\n\t\t\tThe variant '${e.getId()}'was not modified'`)}function d(n,a){var i={fileName:a.fileName,variantId:a.id||e.STANDARD_VARIANT_ID,persisted:a.persisted,content:a.content||{},texts:{variantName:{value:a.name||""}},selector:{persistencyKey:n}};if(a.favorite!==undefined){i.favorite=a.favorite}if(a.executeOnSelection!==undefined){i.executeOnSelection=a.executeOnSelection}if(a.adaptationId!==undefined){i.adaptationId=a.adaptationId}return t.createCompVariant(i)}function f(e,t){var n=i[t.getChangeType()]||o;n(e,t);e.addChange(t)}function s(e,t){var n=t.getVariantId();if(e[n]){e[n].forEach(function(e){f(t,e)})}}return{merge(e,t,a){var i=t.nonPersistedVariants.concat(t.variants);var o=r(t);var f;i.forEach(function(e){if(e.getContent()&&e.getContent().standardvariant){f=e}});if(!f){f=d(e,a)}else{i=i.filter(function(e){return!e.getContent()||!e.getContent().standardvariant})}i.forEach(s.bind(undefined,o));i=i.filter(function(e){var n=e.getVisible();if(!n){var a=e.getId();delete o[a];delete t.byId[a]}return n});f.setFavorite(true);f.setStandardVariant(true);t.byId[f.getVariantId()]=f;var c=t.standardVariantChange;if(c){o[f.getVariantId()]=o[f.getVariantId()]||[];o[f.getVariantId()].push(c);o[f.getVariantId()].sort(function(e,t){if(e.getCreation()<t.getCreation()){return-1}if(e.getCreation()>t.getCreation()){return 1}return 0})}s(o,f);t.standardVariant=f;const u=n.getDefaultVariantId(t);i.some(e=>{if(!e.getFavorite()&&e.getId()===u){e.setFavorite(true)}});return{standardVariant:f,variants:i}},createVariant(e,t){return d(e,t)},applyChangeOnVariant:f}});
//# sourceMappingURL=CompVariantMerger.js.map