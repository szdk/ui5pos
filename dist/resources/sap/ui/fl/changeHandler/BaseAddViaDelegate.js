/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/condenser/Classification","sap/ui/fl/changeHandler/Base","sap/ui/fl/requireAsync","sap/base/util/merge","sap/base/util/ObjectPath"],function(e,t,n,o,r){"use strict";function a(e){return typeof e==="function"}function i(e){if(e.modelType){return e.modelType}else if(e.oDataServiceVersion){return"sap.ui.model.odata.v2.ODataModel"}return undefined}const l={createAddViaDelegateChangeHandler(l){function c(e){return e+l.fieldSuffix}function d(e,t){if(a(l[t])){return!!l[t](e)}return!!l[t]}function s(e){return d(e,"skipCreateLabel")}function p(e){return d(e,"skipCreateLayout")}async function f(e,t){const o=t.modifier.bySelector(e.getSelector(),t.appComponent);const r=i(e.getContent());const c=await n("sap/ui/fl/apply/api/DelegateMediatorAPI");const d=await c.getDelegateForControl({control:o,modifier:t.modifier,modelType:r,supportsDefault:l.supportsDefault});const s=!a(d.instance.createLayout);return s||p(e.getSupportInformation().oDataInformation)}async function g(e,t,n){const r=o({},t);r.fieldSelector.id=c(r.fieldSelector.id);const a=await n.createControlForProperty(r);if(s(e)){return a}const i=t.modifier.getId(a.control);t.labelFor=i;const l=await n.createLabel(t);return{label:l,control:a.control,valueHelp:a.valueHelp}}async function u(e,t,n,i){const c=o({aggregationName:l.aggregationName,payload:t.payload||{},parentSelector:e.parentId},n);const d=t.instance;let s;if(a(d.createLayout)&&!p(i)){s=await d.createLayout(c)}if(r.get("control",s)){s.layoutControl=true;return s}return g(i,c,d)}return{async applyChange(e,r,a){const c=a.appComponent;const d=e.getContent();const s=e.getSupportInformation().oDataInformation;const p=d.newFieldSelector;const f={appComponent:a.appComponent,view:a.view,fieldSelector:p,bindingPath:d.bindingPath,modifier:a.modifier,element:r};if(a.modifier.bySelector(p,c,a.view)){await t.markAsNotApplicable(`Control to be created already exists:${p.id||p}`,true);return}const g={newFieldSelector:p};e.setRevertData(g);const C=i(d);const m=await n("sap/ui/fl/apply/api/DelegateMediatorAPI");const w=await m.getDelegateForControl({control:r,modifier:a.modifier,modelType:C,supportsDefault:l.supportsDefault});const y=await u(d,w,f,s);const I=o({},{control:r,innerControls:y,change:e},a);await l.addProperty(I);if(y.valueHelp){const t=a.modifier.getSelector(a.modifier.getId(y.valueHelp),c);const n=e.getRevertData();n.valueHelpSelector=t;e.setRevertData(n)}},async revertChange(e,t,n){const r=n.appComponent;const i=n.modifier;const c=e.getRevertData().newFieldSelector;const d=e.getRevertData().valueHelpSelector;const s=i.bySelector(c,r);const p=e.getDependentControl(l.parentAlias,n)||t;await i.removeAggregation(p,l.aggregationName,s);await i.destroy(s);if(d){const e=i.bySelector(d,r);await i.removeAggregation(p,"dependents",e);await i.destroy(e)}const f=o({},{control:t,change:e},n);if(a(l.revertAdditionalControls)){await l.revertAdditionalControls(f);e.resetRevertData()}},completeChangeContent(e,t,n){const o=n.appComponent;const r={};if(t.parentId){if(a(l.mapParentIdIntoChange)){l.mapParentIdIntoChange(e,t,n)}else{e.addDependentControl(t.parentId,l.parentAlias,n)}try{r.parentId=n.modifier.getSelector(t.parentId,o)}catch(e){}}else{throw new Error("mSpecificChangeInfo.parentId attribute required")}if(t.bindingPath){r.bindingPath=t.bindingPath}else{throw new Error("mSpecificChangeInfo.bindingPath attribute required")}if(t.newControlId){r.newFieldSelector=n.modifier.getSelector(t.newControlId,o)}else{throw new Error("mSpecificChangeInfo.newControlId attribute required")}if(t.index===undefined){throw new Error("mSpecificChangeInfo.targetIndex attribute required")}else{r.newFieldIndex=t.index}if(t.oDataServiceVersion){r.oDataServiceVersion=t.oDataServiceVersion}if(t.modelType&&l.supportsDefault){r.modelType=t.modelType}e.setContent(r)},getChangeVisualizationInfo(e){const t=e.getRevertData();if(t&&t.labelSelector){return{affectedControls:[t.labelSelector]}}return{affectedControls:[e.getContent().newFieldSelector]}},async getCondenserInfo(t,n){const o=await f(t,n);if(!o){return undefined}if(!t.getContent().newFieldSelector||!t.getContent().parentId||!l.aggregationName){return undefined}return{affectedControl:t.getContent().newFieldSelector,classification:e.Create,targetContainer:t.getContent().parentId,targetAggregation:l.aggregationName,setTargetIndex(e,t){const n=e.getContent();n.newFieldIndex=t;e.setContent(n)},getTargetIndex(e){return e.getContent().newFieldIndex}}}}}};return l});
//# sourceMappingURL=BaseAddViaDelegate.js.map