/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/fl/support/apps/contentbrowser/lrepConnector/LRepConnector","sap/ui/fl/support/apps/contentbrowser/utils/DataUtils","sap/ui/fl/Layer","sap/m/Dialog","sap/m/Text","sap/m/Button","sap/m/Input","sap/m/library","sap/ui/model/json/JSONModel","sap/ui/core/UIComponent"],function(e,t,a,n,i,s,o,r,l,p,c){"use strict";var{ButtonType:d}=l;return e.extend("sap.ui.fl.support.apps.contentbrowser.controller.ContentDetailsEdit",{oSelectedContentModel:undefined,oDataUtils:a,onInit(){this._initAndBindSelectedContentModel();var e=c.getRouterFor(this);e.getRoute("ContentDetailsEdit").attachMatched(this._onRouteMatched,this)},_initAndBindSelectedContentModel(){this.oSelectedContentModel=new p;this.getView().setModel(this.oSelectedContentModel,"selectedContent")},_onRouteMatched(e){var a=this;var n=e.getParameter("arguments");var i={};i.layer=n.layer;i.namespace=decodeURIComponent(n.namespace);i.fileName=n.fileName;i.fileType=n.fileType;if(i.namespace[i.namespace.length-1]!=="/"){i.namespace+="/"}var s=`${i.namespace+i.fileName}.${i.fileType}`;var o=a.getView().getContent()[0];o.setBusy(true);return t.getContent(i.layer,s,null,null,true).then(a._onContentReceived.bind(a,i,o,s),function(){o.setBusy(false)})},_onContentReceived(e,n,i,s){return t.getContent(e.layer,i,true).then(function(t){e.data=a.formatData(s,e.fileType);e.metadata=t;this.oSelectedContentModel.setData(e);e.metadata.some(function(e){if(e.name==="layer"){if(e.value==="CUSTOMER"){this.getView().byId("activeVersionCheckBox").setVisible(true)}else{this.getView().byId("activeVersionCheckBox").setVisible(true)}return true}}.bind(this));n.setBusy(false)}.bind(this),function(){n.setBusy(false)})},onSave(){var e=this;var t=this.getView().getModel("selectedContent");var a=this.getView().byId("activeVersionCheckBox").getSelected();var l=t.getData();var p;var c;var u;var f;var m;l.metadata.some(function(e){if(e.name==="layer"){p=e.value;return true}});l.metadata.some(function(e){if(e.name==="transportId"){c=e.value;return true}});try{u=JSON.parse(l.data).packageName}catch(e){}if(p===n.USER||p==="LOAD"||p==="VENDOR_LOAD"||!c&&(!u||u==="$TMP")){f=undefined;this._saveFile(p,l.namespace,l.fileName,l.fileType,l.data,f,m,a)}else if(c==="ATO_NOTIFICATION"){f=c;this._saveFile(p,l.namespace,l.fileName,l.fileType,l.data,f,m,a)}else{var v=!!(p===n.VENDOR||p===n.CUSTOMER_BASE);var h=new r({visible:v,placeholder:"Package name (Only necessary for cross client content)"});var y=new r({placeholder:"Transport ID or ATO_NOTIFICATION"});var C=new i({title:"{i18n>transportInput}",type:"Message",content:[new s({text:"{i18n>transportInputDescription}"}),h,y],beginButton:new o({text:"{i18n>confirm}",type:d.Reject,press(){m=h.getValue();f=y.getValue();C.close();e._saveFile(p,l.namespace,l.fileName,l.fileType,l.data,f,m)}}),endButton:new o({text:"{i18n>cancel}",press(){C.close()}}),afterClose(){C.destroy()}});this.getView().addDependent(C);C.open()}},_saveFile(e,a,n,i,s,o,r,l){return t.saveFile(e,a,n,i,s,o,r,l).then(this._navToDisplayMode.bind(this))},onCancel(){this._navToDisplayMode()},_navToDisplayMode(){var e=this.getView().getModel("selectedContent");var t=e.getData();var a=c.getRouterFor(this);a.navTo("ContentDetailsFlip",{layer:t.layer,namespace:encodeURIComponent(t.namespace),fileName:t.fileName,fileType:t.fileType})}})});
//# sourceMappingURL=ContentDetailsEdit.controller.js.map