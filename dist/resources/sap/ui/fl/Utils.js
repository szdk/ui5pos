/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/i18n/Localization","sap/base/util/isPlainObject","sap/base/util/uid","sap/base/util/restricted/_isEqual","sap/base/Log","sap/ui/base/SyncPromise","sap/ui/base/ManagedObject","sap/ui/core/util/reflection/BaseTreeModifier","sap/ui/core/Component","sap/ui/core/Element","sap/ui/fl/initial/_internal/FlexConfiguration","sap/ui/fl/Scenario","sap/ui/thirdparty/hasher","sap/ui/core/mvc/View"],function(e,t,r,n,o,i,a,s,p,u,c,l,f,g){"use strict";function m(e){if(e?.getEntry){return e.getEntry?.("sap.app")?.type}return e?.["sap.app"]?.type}function h(e,t){if(e?.startupParameters&&t&&Array.isArray(e.startupParameters[t])){return e.startupParameters[t][0]}}let d=false;const P={isVariantByStartupParameter(e){const t=this.getAppComponentForControl(e);if(t?.getComponentData){return!!h(t.getComponentData(),"sap-app-id")}return false},getAppDescriptor(e){return this.getAppComponentForControl(e)?.getMetadata?.()?.getManifestObject?.().getJson()},isBinding(e){return typeof e==="string"&&!!a.bindingParser(e)||t(e)&&((e.hasOwnProperty("path")||e.hasOwnProperty("parts"))&&!e.hasOwnProperty("ui5object"))},getComponentForControl(e){function t(e){const r=p.getOwnerIdFor(e);if(!r){if(typeof e?.getParent==="function"){const r=e.getParent();if(r){return t(r)}}}return r||""}if(e){const r=t(e);if(r){return p.getComponentById(r)}}},getAppComponentForControl(e){let t=e instanceof p?e:P.getComponentForControl(e);if(t?.getAppComponent?.()instanceof p){return t.getAppComponent()}if(t?.oComponentData?.appComponent){return t.oComponentData.appComponent}if(t?.getManifestEntry){var r=t.getManifestEntry("sap.app");if(r?.type&&r.type!=="application"){if(t instanceof p){t=P.getComponentForControl(t)}return this.getAppComponentForControl(t)}}return t},getAppComponentForSelector(e){return e.appComponent||P.getAppComponentForControl(e)},getViewForControl(e){if(e instanceof g){return e}if(typeof e?.getParent==="function"){e=e.getParent();return P.getViewForControl(e)}},getClient(){return new URLSearchParams(window.location.search).get("sap-client")},getLrepUrl(){const e=c.getFlexibilityServices();const t=e.find(e=>e.connector==="LrepConnector");return t?.url||""},getCurrentLanguage(){const t=e.getLanguage();if(typeof t!=="string"){return""}const r=t.indexOf("-");if(r<0&&t.length<=2){return t.toUpperCase()}if(r>0&&r<=2){return t.substring(0,r).toUpperCase()}return""},getControlType(e){return e?.getMetadata?.()?.getElementName?.()},checkControlId(e,t){if(!t){e=e instanceof a?e:u.getElementById(e);t=P.getAppComponentForControl(e)}return s.checkControlId(e,t)},hasLocalIdSuffix:s.hasLocalIdSuffix,getParsedURLHash(e){return e?.parseShellHash(f.getHash())||{}},getUrlParameter(e){return new URLSearchParams(window.location.search).get(e)},getUshellContainer(){const e=sap.ui.require("sap/ushell/Container");if(e&&!d){try{e.getLogonSystem();d=true}catch(e){return undefined}}return e},createDefaultFileName(e){const t=r().replace(/-/g,"_");return e?`${t}_${e}`:t},createNamespace(e,t){const r=t==="ctrl_variant"?"variants":"changes";const n=e.reference.replace(".Component","");return`apps/${n}/${r}/`},buildLrepRootNamespace(e,t,r){const n="apps";const o="Error in sap.ui.fl.Utils#buildLrepRootNamespace:";if(!e){throw new Error(`${o} for every scenario you need a base ID`)}switch(t){case l.VersionedAppVariant:case l.AppVariant:if(!r){throw new Error(`${o} in the ${t} scenario you additionally need a project ID`)}return`${n}/${e}/appVariants/${r}/`;case l.AdaptationProject:if(!r){throw new Error(`${o} in the ${t} scenario you additionally need a project ID`)}return`${n}/${e}/adapt/${r}/`;case l.FioriElementsFromScratch:case l.UiAdaptation:default:return`${n}/${e}/`}},isApplication(e){return m(e)==="application"},isApplicationComponent(e){return e instanceof p&&P.isApplication(e.getManifestObject())},isEmbeddedComponent(e){const t=P.getAppComponentForControl(e);return!!(e instanceof p&&m(e.getManifestObject())==="component"&&t&&P.isApplicationComponent(t))},indexOfObject(e,t){return e.findIndex(e=>n(e,t))},execPromiseQueueSequentially(e,t,r){if(e.length===0){if(r){return Promise.resolve()}return P.FakePromise?new P.FakePromise:Promise.resolve()}var n=e.shift();if(typeof n==="function"){var i;try{i=n()}catch(e){i=Promise.reject(e)}return i.then(function(){if(!r&&i instanceof Promise){r=true}}).catch(function(e){var r="Error during execPromiseQueueSequentially processing occurred";r+=e?`: ${e.message}`:"";o.error(r,e);if(t){throw new Error(r)}}).then(function(){return this.execPromiseQueueSequentially(e,t,r)}.bind(this))}o.error("Changes could not be applied, promise not wrapped inside function.");return this.execPromiseQueueSequentially(e,t,r)},FakePromise:function(e,t,r){P.FakePromise.fakePromiseIdentifier="sap.ui.fl.Utils.FakePromise";this.vValue=e;this.vError=t;this.bContinueWithFakePromise=arguments.length<3||r===P.FakePromise.fakePromiseIdentifier;var n=function(e,t){try{var r=t(e,P.FakePromise.fakePromiseIdentifier);if(i.isThenable(r)){return r}return new P.FakePromise(r)}catch(e){var n=e;return new P.FakePromise(undefined,n)}};P.FakePromise.prototype.then=function(e,t){if(!this.bContinueWithFakePromise){return Promise.resolve(e(this.vValue))}if(!this.vError){return n(this.vValue,e)}else if(t){return n(this.vError,t)}return this};P.FakePromise.prototype.catch=function(e){if(!this.bContinueWithFakePromise){return Promise.reject(e(this.vError))}if(this.vError){return n(this.vError,e)}return this};if(this.vValue instanceof Promise||this.vValue instanceof P.FakePromise){return this.vValue}},getChangeFromChangesMap(e,t){let r;Object.values(e).some(e=>{r=e.find(e=>e.getId()===t);return r});return r},handleUrlParameters(e,t,r,n){if(P.hasParameterAndValue(t,r,n)){if(e.startsWith("?")){e=e.substr(1,e.length)}const n=e.split("&").filter(e=>e!==`${t}=${r}`);e="";if(n.length>0){e=`?${n.join("&")}`}}else{e+=`${(e.length>0?"&":"?")+t}=${r}`}return e},hasParameterAndValue(e,t,r){return P.getParameter(e,r)===t},getParameter(e,t){return P.getParsedURLHash(t)?.params?.[e]?.[0]||P.getUrlParameter(e)},findAggregation(e,t){return e?.getMetadata?.()?.getAllAggregations?.()?.[t]},getAggregation(e,t){const r=P.findAggregation(e,t);if(r){return e[r._sGetter]()}return undefined},getProperty(e,t){const r=e.getMetadata().getPropertyLikeSetting(t)?._sGetter;return e[r]()},getUShellService(e){if(e){const t=this.getUshellContainer();if(t){return t.getServiceAsync(e)}}return Promise.resolve()},async getUShellServices(e){const t={};for(const r of e){t[r]=await this.getUShellService(r)}return t}};return P});
//# sourceMappingURL=Utils.js.map