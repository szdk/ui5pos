/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/Lib","sap/ui/fl/Layer","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/core/BusyIndicator","sap/base/Log","sap/m/MessageBox"],function(e,n,t,r,s,a,i,o,u,l,S,E){"use strict";var c="/flex/keyuser";var R=e({},r,{layers:[t.CUSTOMER,t.PUBLIC],ROUTES:{CHANGES:`${c+s.API_VERSION}/changes/`,SETTINGS:`${c+s.API_VERSION}/settings`,TOKEN:`${c+s.API_VERSION}/settings`,VERSIONS:{GET:`${c+s.API_VERSION}/versions/`,ACTIVATE:`${c+s.API_VERSION}/versions/activate/`,DISCARD:`${c+s.API_VERSION}/versions/draft/`,PUBLISH:`${c+s.API_VERSION}/versions/publish/`},TRANSLATION:{UPLOAD:`${c+s.API_VERSION}/translation/texts`,DOWNLOAD:`${c+s.API_VERSION}/translation/texts/`,GET_SOURCELANGUAGE:`${c+s.API_VERSION}/translation/sourcelanguages/`},CONTEXTS:`${c+s.API_VERSION}/contexts/`},isLanguageInfoRequired:true,loadFeatures(e){return r.loadFeatures.call(R,e).then(function(e){e.isContextSharingEnabled=true;return e})},getContexts(e){var n=["type","$skip","$filter"];var t=o(e,n);var r=a.getUrl(R.ROUTES.CONTEXTS,e,t);return a.sendRequest(r,"GET",{initialConnector:s}).then(function(e){return e.response})},loadContextDescriptions(e){var n={};a.addLanguageInfo(n);T(e);var t=a.getUrl(R.ROUTES.CONTEXTS,e,n);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return i.sendRequest(t,"POST",e).then(function(e){return e.response})},isContextSharingEnabled(){return Promise.resolve(true)},getFlexInfo(e){return u.get(e.selector)||{}}});function T(e){e.initialConnector=s;e.tokenUrl=R.ROUTES.TOKEN}function O(e){var n={title:e.title};e.payload=JSON.stringify(n);e.dataType="json";e.contentType="application/json; charset=utf-8"}function g(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}R.versions={load(e){T(e);var n={};a.addLanguageInfo(n);n.limit=e.limit;var t=a.getUrl(R.ROUTES.VERSIONS.GET,e,n);return a.sendRequest(t,"GET",e).then(function(e){return e.response.versions.map(function(e){return g(e)})})},activate(e){T(e);O(e);var n={version:e.version};a.addLanguageInfo(n);var t=a.getUrl(R.ROUTES.VERSIONS.ACTIVATE,e,n);return i.sendRequest(t,"POST",e).then(function(e){var n=e.response;return g(n)})},discardDraft(e){T(e);var n=a.getUrl(R.ROUTES.VERSIONS.DISCARD,e);return i.sendRequest(n,"DELETE",e)},publish(e){var t=n.getResourceBundleFor("sap.ui.fl");var r=function(n){l.hide();var r=t.getText("MSG_CF_PUBLISH_ERROR",n?[n.message||n]:undefined);var s=t.getText("HEADER_TRANSPORT_ERROR");S.error(`publish version error${n}`);E.show(r,{icon:E.Icon.ERROR,title:s,styleClass:e.styleClass});return"Error"};T(e);var s={version:e.version};var o=a.getUrl(R.ROUTES.VERSIONS.PUBLISH,e,s);return i.sendRequest(o,"POST",e).then(function(){l.hide();return t.getText("MSG_CF_PUBLISH_SUCCESS")}).catch(r)}};R.translation={getTexts(e){T(e);var n=o(e,["sourceLanguage","targetLanguage"]);var t=a.getUrl(R.ROUTES.TRANSLATION.DOWNLOAD,e,n);return a.sendRequest(t,"GET",e).then(function(e){return e.response})},getSourceLanguages(e){T(e);var n={};var t=a.getUrl(R.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,n);return a.sendRequest(t,"GET",e).then(function(e){return e&&e.response&&e.response.sourceLanguages?e.response.sourceLanguages:[]})},postTranslationTexts(e){T(e);var n=a.getUrl(R.ROUTES.TRANSLATION.UPLOAD,e,{});return a.sendRequest(n,"POST",e)}};R.initialConnector=s;return R});
//# sourceMappingURL=KeyUserConnector.js.map