/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/base/Log","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","sap/m/library","./ColumnMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming"],function(t,e,i,a,o,s,r,l,n,u){"use strict";var h=r.Size;var p=r.ValueColor;var f=e.extend("sap.suite.ui.microchart.ColumnMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{group:"Misc",type:"sap.m.Size",defaultValue:h.Auto},width:{group:"Misc",type:"sap.ui.core.CSSSize"},height:{group:"Misc",type:"sap.ui.core.CSSSize"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},showTopLabels:{type:"boolean",defaultValue:true},showBottomLabels:{type:"boolean",defaultValue:true},allowColumnLabels:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},events:{press:{}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"columns",aggregations:{columns:{multiple:true,type:"sap.suite.ui.microchart.ColumnMicroChartData",defaultValue:null,bindable:"bindable"},leftTopLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultValue:null},rightTopLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultValue:null},leftBottomLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultValue:null},rightBottomLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultValue:null}}},renderer:l});f.THRESHOLD_LOOK_XS=1.125;f.THRESHOLD_LOOK_S=3.5;f.THRESHOLD_LOOK_M=4.5;f.THRESHOLD_LOOK_L=5.875;f.THRESHOLD_WIDTH_NO_LABEL=6;f.prototype.init=function(){this._oRb=n.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};f.prototype._handleCoreInitialized=function(){u.attachApplied(this._handleThemeApplied.bind(this))};f.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();u.detachApplied(this._handleThemeApplied.bind(this))};f.prototype.onBeforeRendering=function(){this.$().off("mouseenter");this.$().off("mouseleave")};f.prototype.onAfterRendering=function(){if(this._sChartResizeHandlerId){i.deregister(this._sChartResizeHandlerId)}t._checkControlIsVisible(this,this._onControlIsVisible);this.$().on("mouseenter",this._addTitleAttribute.bind(this));this.$().on("mouseleave",this._removeTitleAttribute.bind(this))};f.prototype._onControlIsVisible=function(){this._fChartHeight=undefined;this._aBars=[];var t=this.getColumns().length;for(var e=0;e<t;e++){this._aBars.push({})}this._onResize();this._sChartResizeHandlerId=i.register(this,this._onResize.bind(this))};f.prototype.exit=function(){i.deregister(this._sChartResizeHandlerId)};f.prototype._onResize=function(){this._calcColumns();var t=this.$(),e=parseInt(t.width()),i=parseInt(t.height()),o=t.find(".sapSuiteClMCPositionTop").children(),s=t.find(".sapSuiteClMCLabelColumn.sapSuiteClMCLabelColumnTop,.sapSuiteClMCLabelColumn.sapSuiteClMCLabelColumnBottom"),r=t.find(".sapSuiteClMCBars")[0],l=this.getColumns(),n=l.length;t.removeClass("sapSuiteClMCNoLabels sapSuiteClMCNoColumnLabels sapSuiteClMCNoTopLabels sapSuiteClMCLookM sapSuiteClMCLookS sapSuiteClMCLookXS");if(e<=this.convertRemToPixels(f.THRESHOLD_WIDTH_NO_LABEL)){t.addClass("sapSuiteClMCNoLabels")}if(i<this.convertRemToPixels(f.THRESHOLD_LOOK_S)){t.addClass("sapSuiteClMCLookXS")}else if(i<this.convertRemToPixels(f.THRESHOLD_LOOK_M)){if(this.getAllowColumnLabels()){t.addClass("sapSuiteClMCNoColumnLabels")}t.addClass("sapSuiteClMCLookS")}else if(i<this.convertRemToPixels(f.THRESHOLD_LOOK_L)){t.addClass("sapSuiteClMCLookM")}if(this._isAnyLabelTruncated(o)){t.addClass("sapSuiteClMCNoTopLabels")}if(this.getAllowColumnLabels()&&this._isAnyLabelTruncated(s)){t.addClass("sapSuiteClMCNoColumnLabels")}if(n>0&&r){t.find(".sapSuiteClMCBar").show();while(r.scrollWidth>r.offsetWidth){l[--n].$().hide();a.warning(this.toString()+" Chart overflow","Column "+n+" was not rendered")}}};f.prototype._calcColumns=function(){var t=this.getColumns();if(t&&t.length===this._aBars.length){var e=parseFloat(this.$().css("height"));if(e!==this._fChartHeight){this._fChartHeight=e;this._calcColumnsHeight(e,this._aBars)}for(var i=0;i<t.length;i++){t[i].$().css(this._aBars[i])}}};f.prototype._calcColumnsHeight=function(t,e){var i=this.getColumns().length;if(i!==e.length){return}var a,o,s;a=o=0;for(var r=0;r<i;r++){var l=this.getColumns()[r];if(a<l.getValue()){a=l.getValue()}else if(o>l.getValue()){o=l.getValue()}}if(a===0&&o===0){for(var n=0;n<i;n++){e[n].top="calc(100% - 1px)";e[n].height="1px"}return}var u=a-o;var h=u/t;var p,f;p=f=0;for(var C=0;C<i;C++){s=this.getColumns()[C].getValue();if(Math.abs(s)<h){if(s>=0){if(s===a){f=h-s}}else if(s===o){p=h+s}}}if(f){a+=f;o-=f}if(p){a-=p;o+=p}var c=0-h;for(var g=0;g<i;g++){s=this.getColumns()[g].getValue();var d=s;if(s>=0){d=Math.max(d+f-p,h)}else{d=Math.min(d+f-p,c)}e[g].value=d}function b(t){return(t/u*100).toFixed(2)+"%"}var _=b(a);for(var n=0;n<i;n++){s=e[n].value;e[n].top=s<0?_:b(a-s);e[n].height=b(Math.abs(s))}};f.prototype.attachEvent=function(t,i,a,o){e.prototype.attachEvent.call(this,t,i,a,o);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};f.prototype.detachEvent=function(t,i,a){e.prototype.detachEvent.call(this,t,i,a);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};f.prototype.getLocalizedColorMeaning=function(t){return p[t]?this._oRb.getText(("SEMANTIC_COLOR_"+t).toUpperCase()):""};f.prototype.setSize=function(t){if(this.getSize()!==t){this.setProperty("size",t,false)}return this};f.prototype._getAltHeaderText=function(t){var e=this._oRb.getText("COLUMNMICROCHART");if(t){e+=" "+this._oRb.getText("IS_ACTIVE")}if(!this._hasData()){e+="\n"+this._oRb.getText("NO_DATA");return e}var i=this.getLeftTopLabel();var a=this.getRightTopLabel();var o=this.getLeftBottomLabel();var s=this.getRightBottomLabel();var r;if(i&&i.getLabel()||o&&o.getLabel()){if(i){r=i.getColor()}else if(o){r=o.getColor()}else{r=""}e+="\n"+this._oRb.getText("COLUMNMICROCHART_START")+": "+(o?o.getLabel()+" ":"")+(i?i.getLabel()+" ":"")+this.getLocalizedColorMeaning(r)}if(a&&a.getLabel()||s&&s.getLabel()){if(a){r=a.getColor()}else if(s){r=s.getColor()}else{r=""}e+="\n"+this._oRb.getText("COLUMNMICROCHART_END")+": "+(s?s.getLabel()+" ":"")+(a?a.getLabel()+" ":"")+this.getLocalizedColorMeaning(r)}return e};f.prototype._getAltSubText=function(t){var e="";var i=this.getColumns();for(var a=0;a<i.length;a++){var o=i[a],s=o.getTooltip_AsString(),r="";if(!s){continue}r+=(t?"":"\n")+this._getBarAltText(o);r=s.split("((AltText))").join(r);if(r){e+=r;t=false}}return e};f.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_COLUMNMICROCHART")};f.prototype.onclick=function(t){if(!this.fireBarPress(t)){this.firePress()}};f.prototype.onkeydown=function(t){var e,i;switch(t.keyCode){case o.SPACE:t.preventDefault();break;case o.ARROW_LEFT:case o.ARROW_UP:i=this.$().find(":focusable");e=i.index(t.target);if(i.length>1){if(e===-1){i.eq(i.length-2).get(0).focus()}else{i.eq(e-1>=0?e-1:i.length-1).get(0).focus()}t.preventDefault();t.stopPropagation()}break;case o.ARROW_DOWN:case o.ARROW_RIGHT:i=this.$().find(":focusable");e=i.index(t.target);if(i.length>0){i.eq(e+1<i.length?e+1:0).get(0).focus();t.preventDefault();t.stopPropagation()}break;default:}};f.prototype.onkeyup=function(t){if(t.which===o.ENTER||t.which===o.SPACE){if(!this.fireBarPress(t)){this.firePress();t.preventDefault()}}};f.prototype.fireBarPress=function(t){var e=t.srcControl;if(e&&e.isA("sap.suite.ui.microchart.ColumnMicroChartData")){if(e.hasListeners("press")){e.firePress();t.preventDefault();t.stopPropagation();return true}}return false};f.prototype._getBarAltText=function(t){var e=this.getLocalizedColorMeaning(t.getColor());return t.getLabel()+" "+t.getValue()+" "+e};f.prototype.setBarPressable=function(t,e){var i=t.$();if(e){var a=this._getBarAltText(t);i.addClass("sapSuiteUiMicroChartPointer").attr("tabindex",0).attr("title",a).attr("role","presentation").attr("aria-label",a)}else{i.removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer").removeAttr("title").removeAttr("role").removeAttr("aria-label")}};f.prototype.onsaptabnext=function(t){var e=this.$().find(":focusable").last();if(e){this._bIgnoreFocusEvt=true;e.get(0).focus()}};f.prototype.onsaptabprevious=function(t){if(t.target.id!==t.currentTarget.id){var e=this.$().find(":focusable").first();if(e){e.get(0).focus()}}};f.prototype.onfocusin=function(t){if(this._bIgnoreFocusEvt){this._bIgnoreFocusEvt=false;return}if(this.getId()+"-hidden"===t.target.id){this.$().trigger("focus");t.preventDefault();t.stopPropagation()}};f.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};f.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};f.prototype._hasData=function(){return this.getColumns().length>0};f.prototype.firePress=function(){if(this._hasData()){e.prototype.fireEvent.call(this,"press",arguments)}};s.extendMicroChart(f);return f});
//# sourceMappingURL=ColumnMicroChart.js.map