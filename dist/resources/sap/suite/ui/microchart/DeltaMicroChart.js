/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/m/library","sap/m/FlexBox","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","./DeltaMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming"],function(t,e,i,a,s,r,o,l,n,p){"use strict";var u=e.ValueColor;var h=t.DeltaMicroChartViewType;var c=a.extend("sap.suite.ui.microchart.DeltaMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{value1:{type:"float",group:"Misc"},value2:{type:"float",group:"Misc"},title1:{type:"string",group:"Misc",defaultValue:null},title2:{type:"string",group:"Misc",defaultValue:null},displayValue1:{type:"string",group:"Misc",defaultValue:null},displayValue2:{type:"string",group:"Misc",defaultValue:null},deltaDisplayValue:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.m.ValueCSSColor",group:"Misc",defaultValue:"Neutral"},view:{type:"sap.suite.ui.microchart.DeltaMicroChartViewType",group:"Appearance",defaultValue:"Normal"},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{group:"Misc",type:"sap.ui.core.CSSSize"},size:{type:"sap.m.Size",group:"Misc",defaultValue:"Auto"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{press:{}}},renderer:l});c.THRESHOLD_LOOK_XS=1.125;c.THRESHOLD_LOOK_S=3.5;c.THRESHOLD_LOOK_M=4.5;c.THRESHOLD_LOOK_L=5.875;c.THRESHOLD_WIDTH_NO_LABEL=6;c.THRESHOLD_WIDTH_WIDE_MODE=12;c.prototype.init=function(){this._oRb=n.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};c.prototype.setSize=function(t){if(this.getSize()!==t){this.setProperty("size",t,false)}return this};c.prototype._handleCoreInitialized=function(){p.attachApplied(this._handleThemeApplied.bind(this))};c.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();p.detachApplied(this._handleThemeApplied.bind(this))};c.prototype._calcChartData=function(){var t=this.getValue1();var e=this.getValue2();var i=Math.min(t,e,0);var a=Math.max(t,e,0);var s=a-i;function r(t){return(s===0?0:Math.abs(t)/s*100).toFixed(2)}var o={};var l=t-e;o.delta={left:a===0,width:r(l),isFirstStripeUp:t<e,isMax:t<0&&e>=0||t>=0&&e<0,isZero:t===0&&e===0,isEqual:l===0};o.bar1={left:e>=0,width:r(t),isSmaller:Math.abs(t)<Math.abs(e)};o.bar2={left:t>=0,width:r(e),isSmaller:Math.abs(e)<Math.abs(t)};return o};c.prototype._getDeltaValue=function(){var t=this.getValue1(),e=this.getValue2();return Math.abs(t-e).toFixed(Math.max(this._digitsAfterDecimalPoint(t),this._digitsAfterDecimalPoint(e)))};c.prototype._getLocalizedColorMeaning=function(t){return u[t]?this._oRb.getText(("SEMANTIC_COLOR_"+t).toUpperCase()):""};c.prototype._getAltHeaderText=function(t){var e=this._oRb.getText("DELTAMICROCHART");if(t){e+=" "+this._oRb.getText("IS_ACTIVE")}e+="\n";if(!this._hasData()){e+=this._oRb.getText("NO_DATA");return e}var i=this.getDisplayValue1();var a=this.getDisplayValue2();var s=this.getDeltaDisplayValue();var r=this.getValue1();var o=this.getValue2();var l=i?i:""+r;var n=a?a:""+o;var p=s?s:""+Math.abs(r-o).toFixed(Math.max(this._digitsAfterDecimalPoint(r),this._digitsAfterDecimalPoint(o)));var u=this._getLocalizedColorMeaning(this.getColor());e+=this.getTitle1()+" "+l+"\n"+this.getTitle2()+" "+n+"\n"+this._oRb.getText("DELTAMICROCHART_DELTA_TOOLTIP",[p,u]);return e};c.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_DELTAMICROCHART")};c.prototype.onBeforeRendering=function(){this._oChartData=this._calcChartData();if(this._sResizeHandlerId){s.deregister(this._sResizeHandlerId)}this.$().off("mouseenter");this.$().off("mouseleave")};c.prototype.onAfterRendering=function(){t._checkControlIsVisible(this,this._onControlIsVisible);this.$().on("mouseenter",this._addTitleAttribute.bind(this));this.$().on("mouseleave",this._removeTitleAttribute.bind(this))};c.prototype._onControlIsVisible=function(){if(this._hasData()){this._onResize();this._sResizeHandlerId=s.register(this,this._onResize.bind(this))}};c.prototype.exit=function(){s.deregister(this._sResizeHandlerId)};c.prototype._onResize=function(){var t=this.$(),e=parseInt(t.width()),i=parseInt(t.height()),a=t.find(".sapSuiteDMCLbls .sapSuiteDMCLabel"),s=this.getView();t.removeClass("sapSuiteDMCNoLabels sapSuiteDMCNoRightLabels sapSuiteDMCLookM sapSuiteDMCLookS sapSuiteDMCLookXS");if(s===h.Responsive){t.removeClass("sapSuiteDMCWideMode")}if(e<=this.convertRemToPixels(c.THRESHOLD_WIDTH_NO_LABEL)||i<=this.convertRemToPixels(c.THRESHOLD_LOOK_XS)){t.addClass("sapSuiteDMCNoLabels")}if(s===h.Responsive&&e>this.convertRemToPixels(c.THRESHOLD_WIDTH_WIDE_MODE)){t.addClass("sapSuiteDMCWideMode")}if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_S)){t.addClass("sapSuiteDMCLookXS")}else if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_M)){t.addClass("sapSuiteDMCLookS")}else if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_L)){t.addClass("sapSuiteDMCLookM")}if(this._isAnyLabelTruncated(a)){t.addClass("sapSuiteDMCNoRightLabels")}};c.prototype.attachEvent=function(t,e,i,s){a.prototype.attachEvent.call(this,t,e,i,s);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.detachEvent=function(t,e,i){a.prototype.detachEvent.call(this,t,e,i);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.ontap=function(t){this.firePress()};c.prototype.onkeydown=function(t){if(t.which===r.SPACE){t.preventDefault()}};c.prototype.onkeyup=function(t){if(t.which===r.ENTER||t.which===r.SPACE){this.firePress();t.preventDefault()}};c.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};c.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};c.prototype._isActuallyANumber=function(t){return!isNaN(t)&&t!==null&&(t!=="Infinity"&&t!=="-Infinity")};c.prototype._hasData=function(){return this._isActuallyANumber(this.getValue1())||this._isActuallyANumber(this.getValue2())};c.prototype.firePress=function(){if(this._hasData()){a.prototype.fireEvent.call(this,"press",arguments)}};o.extendMicroChart(c);return c});
//# sourceMappingURL=DeltaMicroChart.js.map