/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/m/FlexBox","sap/suite/ui/microchart/MicroChartUtils","sap/base/Log","sap/ui/events/KeyCodes","sap/ui/core/theming/Parameters","sap/m/library","sap/ui/core/ResizeHandler","./AreaMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","sap/base/i18n/Localization"],function(e,t,i,r,s,a,n,o,h,l,u,d,p){"use strict";var g=o.ValueColor;var f=e.AreaMicroChartViewType;var _=t.extend("sap.suite.ui.microchart.AreaMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{type:"sap.m.Size",group:"Misc",defaultValue:"Auto"},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},maxXValue:{type:"float",group:"Misc",defaultValue:null},minXValue:{type:"float",group:"Misc",defaultValue:null},maxYValue:{type:"float",group:"Misc",defaultValue:null},minYValue:{type:"float",group:"Misc",defaultValue:null},view:{type:"sap.suite.ui.microchart.AreaMicroChartViewType",group:"Appearance",defaultValue:"Normal"},colorPalette:{type:"string[]",group:"Appearance",defaultValue:[]},showLabel:{type:"boolean",group:"Misc",defaultValue:true},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{press:{}},defaultAggregation:"lines",aggregations:{chart:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartItem",bindable:"bindable"},maxThreshold:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartItem"},innerMaxThreshold:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartItem"},innerMinThreshold:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartItem"},minThreshold:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartItem"},target:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartItem",bindable:"bindable"},firstXLabel:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartLabel"},firstYLabel:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartLabel"},lastXLabel:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartLabel"},lastYLabel:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartLabel"},maxLabel:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartLabel"},minLabel:{multiple:false,type:"sap.suite.ui.microchart.AreaMicroChartLabel"},lines:{multiple:true,type:"sap.suite.ui.microchart.AreaMicroChartItem",bindable:"bindable"}}},renderer:l});_.THRESHOLD_LOOK_XS=1.125;_.THRESHOLD_LOOK_S=3.5;_.THRESHOLD_LOOK_M=4.5;_.THRESHOLD_LOOK_L=5.875;_.THRESHOLD_WIDTH_NO_LABEL=6;_.THRESHOLD_WIDE_HEIGHT_NO_LABEL=2.25;_.ITEM_NEUTRAL_COLOR="sapSuiteAMCSemanticColorNeutral";_.ITEM_NEUTRAL_NOTHRESHOLD_CSSCLASS="sapSuiteAMCNeutralNoThreshold";_._CHARTITEM_AGGREGATIONS=["chart","target","minThreshold","maxThreshold","innerMinThreshold","innerMaxThreshold"];_.prototype.init=function(){this._oRb=u.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;u.ready(this._handleCoreInitialized.bind(this))};_.prototype._handleCoreInitialized=function(){d.attachApplied(this._handleThemeApplied.bind(this));p.attachChange(this._handleThemeApplied.bind(this))};_.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate()};_.prototype._getCssValues=function(){this._$CssHelper.className=Array.prototype.slice.call(arguments).join(" ");var e=window.getComputedStyle(this._$CssHelper);if(!e.backgroundColor){e.backgroundColor=e["background-color"]}if(!e.outlineStyle){e.outlineStyle=e["outline-style"]}if(!e.outlineWidth){e.outlineWidth=e["outline-width"]}return e};_.prototype.__fillThresholdArea=function(e,t,i,r){e.beginPath();e.moveTo(t[0].x,t[0].y);for(var s=1,a=t.length;s<a;s++){e.lineTo(t[s].x,t[s].y)}for(var n=i.length-1;n>=0;n--){e.lineTo(i[n].x,i[n].y)}e.closePath();e.fillStyle="white";e.fill();e.fillStyle=r;e.fill();e.lineWidth=1;e.strokeStyle="white";e.stroke();e.strokeStyle=r;e.stroke()};_.prototype._renderDashedLine=function(e,t,i){if(e.setLineDash){e.setLineDash(i);this._renderLine(e,t);e.setLineDash([])}else{e.beginPath();for(var r=0,s=t.length-1;r<s;r++){e._dashedLine(t[r].x,t[r].y,t[r+1].x,t[r+1].y,i)}e.stroke()}};_.prototype._renderLine=function(e,t){e.beginPath();e.moveTo(t[0].x,t[0].y);for(var i=1,r=t.length;i<r;i++){e.lineTo(t[i].x,t[i].y)}e.stroke()};_.prototype._getItemColor=function(e,t){var i;if(t&&this.getTarget()){i="sapSuiteAMCSemanticColor"+this.getTarget().getColor()}else if(!t&&this.getChart()){i="sapSuiteAMCSemanticColor"+this.getChart().getColor()}if(i===_.ITEM_NEUTRAL_COLOR&&!this._isThresholdPresent(e)){return _.ITEM_NEUTRAL_NOTHRESHOLD_CSSCLASS}else{return i}};_.prototype._isThresholdPresent=function(e){var t=[e.minThreshold.length,e.maxThreshold.length,e.innerMinThreshold.length,e.innerMaxThreshold.length];for(var i=0;i<t.length;i++){if(t[i]>1){return true}}return false};_.prototype._renderTarget=function(e,t){if(t.target.length>1){var i=this._getItemColor(t,true);var r=this._getCssValues("sapSuiteAMCTarget",i);e.strokeStyle=r.color;e.lineWidth=parseFloat(r.width);if(r.outlineStyle=="dotted"){this._renderDashedLine(e,t.target,[parseFloat(r.outlineWidth),3])}else{this._renderLine(e,t.target,t)}}else if(t.target.length==1){s.warning("Target is not rendered because only 1 point was given")}};_.prototype._renderThresholdLine=function(e,t){if(t&&t.length){var i=this._getCssValues("sapSuiteAMCThreshold");e.strokeStyle=i.color;e.lineWidth=i.width;this._renderLine(e,t)}};_.prototype._fillMaxThreshold=function(e,t){if(t.maxThreshold.length>1){var i=this._getCssValues("sapSuiteAMCThreshold","sapSuiteAMCSemanticColor"+this.getMaxThreshold().getColor());this.__fillThresholdArea(e,t.maxThreshold,[{x:t.maxThreshold[0].x,y:t.minY},{x:t.maxThreshold[t.maxThreshold.length-1].x,y:t.minY}],i.backgroundColor);this._renderThresholdLine(e,t.maxThreshold,t)}else if(t.maxThreshold.length==1){s.warning("Max Threshold is not rendered because only 1 point was given")}};_.prototype._fillMinThreshold=function(e,t){if(t.minThreshold.length>1){var i=this._getCssValues("sapSuiteAMCThreshold","sapSuiteAMCSemanticColor"+this.getMinThreshold().getColor());this.__fillThresholdArea(e,t.minThreshold,[{x:t.minThreshold[0].x,y:t.maxY},{x:t.minThreshold[t.minThreshold.length-1].x,y:t.maxY}],i.backgroundColor)}else if(t.minThreshold.length==1){s.warning("Min Threshold is not rendered because only 1 point was given")}};_.prototype._fillThresholdArea=function(e,t){if(t.minThreshold.length>1&&t.maxThreshold.length>1){var i=this._getCssValues("sapSuiteAMCThreshold","sapSuiteAMCSemanticColorCritical");this.__fillThresholdArea(e,t.maxThreshold,t.minThreshold,i.backgroundColor)}};_.prototype._fillInnerThresholdArea=function(e,t){if(t.innerMinThreshold.length>1&&t.innerMaxThreshold.length>1){var i=this._getCssValues("sapSuiteAMCThreshold","sapSuiteAMCSemanticColor"+this.getInnerMaxThreshold().getColor());this.__fillThresholdArea(e,t.innerMaxThreshold,t.innerMinThreshold,i.backgroundColor)}else if(t.innerMinThreshold.length||t.innerMaxThreshold.length){s.warning("Inner threshold area is not rendered because inner min and max threshold were not correctly set")}};_.prototype._renderChart=function(e,t){if(t.chart.length>1){var i=this._getItemColor(t);var r=this._getCssValues("sapSuiteAMCChart",i);e.strokeStyle=r.color;e.lineWidth=parseFloat(r.width);this._renderLine(e,t.chart,t)}else if(t.chart.length==1){s.warning("Actual values are not rendered because only 1 point was given")}};_.prototype._renderLines=function(e,t){var i=this.getColorPalette().length,r=0,s=this._getCssValues("sapSuiteAMCLine"),a=t.lines.length;var o=function(e){if(i){if(r===i){r=0}e=this.getColorPalette()[r++].trim()}if(g[e]){s=this._getCssValues("sapSuiteAMCLine","sapSuiteAMCSemanticColor"+e);return s.color}return n.get(e)||e}.bind(this);e.lineWidth=parseFloat(s.width);for(var h=0;h<a;h++){if(t.lines[h].length>1){e.strokeStyle=o(this.getLines()[h].getColor());this._renderLine(e,t.lines[h],t)}}};_.prototype._renderCanvas=function(){var e=this.getDomRef("canvas");if(!this._hasData()||!e){return}this._$CssHelper=this.getDomRef("css-helper");var t=this.$();var i=window.getComputedStyle(e);var r=parseFloat(i.width);e.setAttribute("width",r||360);var s=parseFloat(i.height);e.setAttribute("height",s||242);var a=e.getContext("2d");a.lineJoin="round";a._dashedLine=this._drawDashedLine;var n=this._calculateDimensions(e.width,e.height);if(this._isThresholdPresent(n)){t.find(".sapSuiteAMCCanvasContainer").addClass("sapSuiteAMCWithThreshold")}this._fillMaxThreshold(a,n);this._fillMinThreshold(a,n);this._fillThresholdArea(a,n);this._renderThresholdLine(a,n.minThreshold,n);this._renderThresholdLine(a,n.maxThreshold,n);this._fillInnerThresholdArea(a,n);this._renderThresholdLine(a,n.innerMinThreshold,n);this._renderThresholdLine(a,n.innerMaxThreshold,n);this._renderTarget(a,n);this._renderChart(a,n);this._renderLines(a,n)};_.prototype._drawDashedLine=function(e,t,i,r,s){var a=s.length;this.moveTo(e,t);var n=i-e,o=r-t,h=n?o/n:1e15,l=Math.sqrt(n*n+o*o),u=0,d=true;while(l>=.1){var p=s[u++%a];if(p>l){p=l}var g=Math.sqrt(p*p/(1+h*h));if(n<0){g=-g}e+=g;t+=h*g;this[d?"lineTo":"moveTo"](e,t);l-=p;d=!d}};_.prototype._calculateDimensions=function(e,t){var i,r,a,n;function o(){if(!this._isMinXValue||!this._isMaxXValue||!this._isMinYValue||!this._isMaxYValue){var e=this.getLines();if(this.getMaxThreshold()){e.push(this.getMaxThreshold())}if(this.getMinThreshold()){e.push(this.getMinThreshold())}if(this.getChart()){e.push(this.getChart())}if(this.getTarget()){e.push(this.getTarget())}if(this.getInnerMaxThreshold()){e.push(this.getInnerMaxThreshold())}if(this.getInnerMinThreshold()){e.push(this.getInnerMinThreshold())}for(var t=0,s=e.length;t<s;t++){var o=e[t].getPoints();for(var h=0,l=o.length;h<l;h++){var u=o[h].getXValue();if(u>i||i===undefined){i=u}if(u<a||a===undefined){a=u}var d=o[h].getYValue();if(d>r||r===undefined){r=d}if(d<n||n===undefined){n=d}}}}if(this._isMinXValue){a=this.getMinXValue()}if(this._isMaxXValue){i=this.getMaxXValue()}if(this._isMinYValue){n=this.getMinYValue()}if(this._isMaxYValue){r=this.getMaxYValue()}}o.call(this);var h={minY:0,minX:0,maxY:t,maxX:e,lines:[]};var l;var d=i-a;if(d>0){l=e/d}else if(d==0){l=0;h.maxX/=2}else{s.warning("Min X is greater than max X.")}var p;var g=r-n;if(g>0){p=t/(r-n)}else if(g==0){p=0;h.maxY/=2}else{s.warning("Min Y is greater than max Y.")}function f(e){var t=u.getConfiguration().getRTL();var i=function(e){var i=l*(e-a);if(t){i=h.maxX-i}return i};var r=function(e){return h.maxY-p*(e-n)};var o=[];if(e&&l!==undefined&&p!==undefined){var d=e.getPoints();var g=d.length;var f,_,c,C;if(g==1){c=d[0].getXValue();C=d[0].getYValue();if(c==undefined^C==undefined){var T,M;if(c==undefined){M=_=r(C);f=h.minX;T=h.maxX}else{T=f=i(c);_=h.minY;M=h.maxY}o.push({x:f,y:_},{x:T,y:M})}else{s.warning("Point with coordinates ["+c+" "+C+"] ignored")}}else{for(var A=0;A<g;A++){c=d[A].getXValue();C=d[A].getYValue();if(c!=undefined&&C!=undefined){f=i(c);_=r(C);o.push({x:f,y:_})}else{s.warning("Point with coordinates ["+c+" "+C+"] ignored")}}}}return o}h.maxThreshold=f(this.getMaxThreshold());h.minThreshold=f(this.getMinThreshold());h.chart=f(this.getChart());h.target=f(this.getTarget());h.innerMaxThreshold=f(this.getInnerMaxThreshold());h.innerMinThreshold=f(this.getInnerMinThreshold());var _=this.getLines().length;for(var c=0;c<_;c++){h.lines.push(f(this.getLines()[c]))}return h};_.prototype.setMinXValue=function(e,t){this._isMinXValue=this._isNumber(e);return this.setProperty("minXValue",this._isMinXValue?e:NaN,t)};_.prototype.setMaxXValue=function(e,t){this._isMaxXValue=this._isNumber(e);return this.setProperty("maxXValue",this._isMaxXValue?e:NaN,t)};_.prototype.setMinYValue=function(e,t){this._isMinYValue=this._isNumber(e);return this.setProperty("minYValue",this._isMinYValue?e:NaN,t)};_.prototype.setMaxYValue=function(e,t){this._isMaxYValue=this._isNumber(e);return this.setProperty("maxYValue",this._isMaxYValue?e:NaN,t)};_.prototype._isNumber=function(e){return typeof e==="number"&&!isNaN(e)&&isFinite(e)};_.prototype.onBeforeRendering=function(){if(this._bUseIndex){this._indexChartItems()}if(this._sChartResizeHandlerId){h.deregister(this._sChartResizeHandlerId)}this._unbindMouseEnterLeaveHandler()};_.prototype.onAfterRendering=function(){e._checkControlIsVisible(this,this._onControlIsVisible);this._bindMouseEnterLeaveHandler()};_.prototype.setSize=function(e){if(this.getSize()!==e){this.setProperty("size",e)}return this};_.prototype._onControlIsVisible=function(){this._onResize();this._sChartResizeHandlerId=h.register(this,this._onResize.bind(this))};_.prototype._indexChartItems=function(){var e,t=_._CHARTITEM_AGGREGATIONS.length;for(var i=0;i<t;i++){e=this.getAggregation(_._CHARTITEM_AGGREGATIONS[i]);if(e){this._indexChartItemPoints(e)}}};_.prototype._indexChartItemPoints=function(e){var t=e.getPoints();for(var i=0;i<t.length;i++){t[i].setProperty("x",i,true)}};_.prototype.enableXIndexing=function(e){this._bUseIndex=e};_.prototype._onResize=function(){var e=this.$(),t=parseInt(e.width()),i=parseInt(e.height()),r=e.find(".sapSuiteAMCPositionCenter"),s=e.find(".sapSuiteAMCPositionTop .sapSuiteAMCPositionLeft, .sapSuiteAMCPositionTop .sapSuiteAMCPositionRight,"+".sapSuiteAMCSideLabels .sapSuiteAMCLbl:first-child");e.removeClass("sapSuiteAMCNoLabels sapSuiteAMCLookM sapSuiteAMCLookS sapSuiteAMCLookXS sapSuiteAMCNoMinMaxLabels sapSuiteAMCNoTopLabels");if(t<=this.convertRemToPixels(_.THRESHOLD_WIDTH_NO_LABEL)){e.addClass("sapSuiteAMCNoLabels")}if(i<this.convertRemToPixels(_.THRESHOLD_WIDE_HEIGHT_NO_LABEL)){e.addClass("sapSuiteAMCLookXS")}else if(i<this.convertRemToPixels(_.THRESHOLD_LOOK_S)&&this.getView()===f.Normal){e.addClass("sapSuiteAMCLookXS")}else if(i<this.convertRemToPixels(_.THRESHOLD_LOOK_M)){e.addClass("sapSuiteAMCLookS")}else if(i<this.convertRemToPixels(_.THRESHOLD_LOOK_L)){e.addClass("sapSuiteAMCLookM")}if(this._isAnyLabelTruncated(s)||this._isAnyLabelVerticallyTruncated(s)){e.addClass("sapSuiteAMCNoMinMaxLabels");if(this._isAnyLabelTruncated(s)){e.removeClass("sapSuiteAMCNoMinMaxLabels");e.addClass("sapSuiteAMCNoTopLabels")}}if(this._isAnyLabelTruncated(r)){e.addClass("sapSuiteAMCNoMinMaxLabels")}this._renderCanvas()};_.prototype._isLabelTruncated=function(e){return e.offsetWidth<e.scrollWidth};_.prototype.ontap=function(e){this.firePress()};_.prototype.onkeydown=function(e){if(e.which==a.SPACE){e.preventDefault()}};_.prototype.onkeyup=function(e){if(e.which==a.ENTER||e.which==a.SPACE){this.firePress();e.preventDefault()}};_.prototype.attachEvent=function(){t.prototype.attachEvent.apply(this,arguments);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};_.prototype.detachEvent=function(){t.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};_.prototype._getLocalizedColorMeaning=function(e){return g[e]?this._oRb.getText(("SEMANTIC_COLOR_"+e).toUpperCase()):""};_.prototype._getAltHeaderText=function(e){var t=this._oRb.getText("AREAMICROCHART");if(e){t+=" "+this._oRb.getText("IS_ACTIVE")}if(!this._hasData()){t+="\n"+this._oRb.getText("NO_DATA");return t}var i=this.getFirstXLabel();var r=this.getFirstYLabel();var s=this.getLastXLabel();var a=this.getLastYLabel();var n=this.getMinLabel();var o=this.getMaxLabel();var h=this.getChart();var l=this.getTarget();if(i&&i.getLabel()||r&&r.getLabel()){t+="\n"+this._oRb.getText("AREAMICROCHART_START")+": "+(i?i.getLabel():"")+" "+(r?r.getLabel()+" "+this._getLocalizedColorMeaning(r.getColor()):"")}if(s&&s.getLabel()||a&&a.getLabel()){t+="\n"+this._oRb.getText("AREAMICROCHART_END")+": "+(s?s.getLabel():"")+" "+(a?a.getLabel()+" "+this._getLocalizedColorMeaning(a.getColor()):"")}if(n&&n.getLabel()){t+="\n"+this._oRb.getText("AREAMICROCHART_MINIMAL_VALUE")+": "+n.getLabel()+" "+this._getLocalizedColorMeaning(n.getColor())}if(o&&o.getLabel()){t+="\n"+this._oRb.getText("AREAMICROCHART_MAXIMAL_VALUE")+": "+o.getLabel()+" "+this._getLocalizedColorMeaning(o.getColor())}if(h&&h.getPoints()&&h.getPoints().length>0){t+="\n"+this._oRb.getText("AREAMICROCHART_ACTUAL_VALUES")+":";var u=h.getPoints();for(var d=0;d<u.length;d++){t+=" "+u[d].getY()}}if(l&&l.getPoints()&&l.getPoints().length>0){t+="\n"+this._oRb.getText("AREAMICROCHART_TARGET_VALUES")+":";var p=l.getPoints();for(var g=0;g<p.length;g++){t+=" "+p[g].getY()}}return t};_.prototype._getAltSubText=function(e){var t="";for(var i=0;i<this.getLines().length;i++){var r=this.getLines()[i],s=r.getTooltip_AsString(),a="",n="";if(!s){continue}if(r.getPoints()&&r.getPoints().length>0){n+=(e?"":"\n")+(r.getTitle()?r.getTitle():this._oRb.getText("AREAMICROCHART_LINE",[i+1]))+":";var o=r.getPoints();for(var h=0;h<o.length;h++){a+=" "+o[h].getY()}if(this.getColorPalette().length===0){a+=" "+this._getLocalizedColorMeaning(r.getColor())}}a=s.split("((AltText))").join(a);if(a){t+=n+a;e=false}}return t};_.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_AREAMICROCHART")};_.prototype.clone=function(){var e=t.prototype.clone.apply(this,arguments);e._isMinXValue=this._isMinXValue;e._isMaxXValue=this._isMaxXValue;e._isMinYValue=this._isMinYValue;e._isMaxYValue=this._isMaxYValue;return e};_.prototype.exit=function(){h.deregister(this._sChartResizeHandlerId);d.attachApplied(this._handleThemeApplied.bind(this));p.detachChange(this._handleThemeApplied.bind(this))};_.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};_.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};_.prototype._bindMouseEnterLeaveHandler=function(){if(!this._oMouseEnterLeaveHandler){this._oMouseEnterLeaveHandler={mouseEnterChart:this._addTitleAttribute.bind(this),mouseLeaveChart:this._removeTitleAttribute.bind(this)}}this.$().on("mouseenter",this._oMouseEnterLeaveHandler.mouseEnterChart);this.$().on("mouseleave",this._oMouseEnterLeaveHandler.mouseLeaveChart)};_.prototype._unbindMouseEnterLeaveHandler=function(){if(this._oMouseEnterLeaveHandler){this.$().off("mouseenter",this._oMouseEnterLeaveHandler.mouseEnterChart);this.$().off("mouseleave",this._oMouseEnterLeaveHandler.mouseLeaveChart)}};_.prototype._hasData=function(){return this.getLines().length>0||!!this.getChart()};_.prototype.firePress=function(){if(this._hasData()){t.prototype.fireEvent.call(this,"press",arguments)}};r.extendMicroChart(_);return _});
//# sourceMappingURL=AreaMicroChart.js.map