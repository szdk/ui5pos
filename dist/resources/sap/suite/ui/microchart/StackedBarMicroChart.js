/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/m/library","sap/m/FlexBox","sap/suite/ui/microchart/MicroChartUtils","sap/ui/core/ResizeHandler","./StackedBarMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","sap/ui/core/Lib"],function(jQuery,t,e,i,r,a,o,s,n,l,p){"use strict";var u=i.Size;var h=i.ValueColor;var d=e.extend("sap.suite.ui.microchart.StackedBarMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{type:"sap.m.Size",group:"Appearance",defaultValue:u.Auto},maxValue:{type:"float",group:"Appearance",defaultValue:null},precision:{type:"int",group:"Appearance",defaultValue:1},displayZeroValue:{type:"boolean",group:"Appearance",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},showLabels:{type:"boolean",group:"Misc",defaultValue:true},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"bars",aggregations:{bars:{type:"sap.suite.ui.microchart.StackedBarMicroChartBar",multiple:true,bindable:"bindable"}},events:{press:{}}},renderer:s});d.THRESHOLD_SMALL_LOOK=1.125;d.BAR_COLOR_PARAM_DEFAULT="sapUiChartPaletteQualitativeHue";d.BAR_LABEL_CSSCLASS=".sapSuiteStackedMCBarLabel";d.BAR_CSSCLASS=".sapSuiteStackedMCBar";d.prototype.attachEvent=function(){e.prototype.attachEvent.apply(this,arguments);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};d.prototype.detachEvent=function(){e.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};d.prototype.onclick=function(t){if(this.hasListeners("press")){t.stopPropagation();this.firePress()}};d.prototype.onsapspace=d.prototype.onclick;d.prototype.onsapenter=d.prototype.onclick;d.prototype.setMaxValue=function(t){var e=jQuery.isNumeric(t);this.setProperty("maxValue",e?t:null);return this};d.prototype.setTooltip=function(t){this._title=null;this.setAggregation("tooltip",t,true);return this};d.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_STACKEDBARMICROCHART")};d.prototype.init=function(){this._oRb=p.getResourceBundleFor("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};d.prototype._handleCoreInitialized=function(){l.attachApplied(this._handleThemeApplied.bind(this))};d.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate()};d.prototype.onBeforeRendering=function(){if(this._sChartResizeHandlerId){o.deregister(this._sChartResizeHandlerId)}this.$().off("mouseenter");this.$().off("mouseleave")};d.prototype.onAfterRendering=function(){t._checkControlIsVisible(this,this._onControlIsVisible)};d.prototype._onControlIsVisible=function(){this._sChartResizeHandlerId=o.register(this,this._onResize.bind(this));this._onResize();this.$().on("mouseenter",this._addTitleAttribute.bind(this));this.$().on("mouseleave",this._removeTitleAttribute.bind(this))};d.prototype.exit=function(){o.deregister(this._sChartResizeHandlerId);l.detachApplied(this._handleThemeApplied.bind(this))};d.prototype._getLocalizedColorMeaning=function(t){return this._oRb.getText(("SEMANTIC_COLOR_"+t).toUpperCase())};d.prototype._calculateChartData=function(){var t=[];var e=this.getBars();var i=e.length;var r=12;var a=1;var o=this.getPrecision();var s=function(){if(r){if(a===r){a=1}return d.BAR_COLOR_PARAM_DEFAULT+a++}};var n=0;var l=this.getMaxValue();var p=0;for(p;p<i;p++){if(!isNaN(e[p].getValue())){n=n+e[p].getValue()}}var u=Math.max(l,n);var h=l>=n;var c=0;var _=0;var f;for(p=0;p<i;p++){f={oBarData:e[p]};f.color=e[p].getValueColor();if(!f.color){f.color=s()}var g=isNaN(e[p].getValue())?0:e[p].getValue();var y=u===0?0:g*100/u;f.value=this._roundFloat(y,o);f.width=this._roundFloat(y,2);c=c+f.value;_=_+f.width;if(h){f.displayValue=e[p].getDisplayValue()||String(g)}else{f.displayValue=e[p].getDisplayValue()||String(f.value+"%")}t.push(f)}c=this._roundFloat(c,o);_=this._roundFloat(_,2);var C;if(_>100&&t.length>0){C=t.slice(0).sort(function(t,e){return e.width-t.width})[0];C.width=this._roundFloat(C.width-_+100,2)}var A=function(t){return t.some(function(t){return t.width>0})};if(l>n){f={value:this._roundFloat(100-c,o),width:this._roundFloat(100-_,2)};t.push(f)}else if(t.length>0&&_<100&&(!this.getDisplayZeroValue()||A(t))){C=t.slice(0).sort(function(t,e){return e.width-t.width})[0];C.width=this._roundFloat(C.width-_+100,2)}return t};d.prototype._roundFloat=function(t,e){return parseFloat(t.toFixed(e))};d.prototype._onResize=function(){this._resizeVertically();this._resizeHorizontally()};d.prototype._resizeVertically=function(){var t=this.$();var e=parseFloat(t.height());if(e<=this.convertRemToPixels(d.THRESHOLD_SMALL_LOOK)){t.addClass("sapSuiteStackedMCSmallLook")}else{t.removeClass("sapSuiteStackedMCSmallLook")}};d.prototype._resizeHorizontally=function(){this._hideTruncatedLabels(d.BAR_LABEL_CSSCLASS)};d.prototype._hideTruncatedLabels=function(t){var e=this.$();var i=e.find(t);i.removeClass("sapSuiteStackedMCBarLabelHidden");for(var r=0;r<i.length;r++){if(this._isLabelTruncated(i[r])){e.find(i[r]).addClass("sapSuiteStackedMCBarLabelHidden")}}};d.prototype._getAltHeaderText=function(e){var i=this._calculateChartData(),r=this._oRb.getText("STACKEDBARMICROCHART");if(e){r+=" "+this._oRb.getText("IS_ACTIVE")}r+="\n";if(!this._hasData()){r+=this._oRb.getText("NO_DATA");return r}var a,o,s,n=false;for(var l=0;l<i.length;l++){a=i[l];o=a.oBarData;s=o&&o.getTooltip_AsString();if(t._isTooltipSuppressed(s)){continue}if(n){r+="\n"}n=true;if(s){r+=s}else if(a.displayValue){r+=a.displayValue;if(h[a.color]){r+=" "+this._getLocalizedColorMeaning(a.color)}}}return r};d.prototype._isTooltipSuppressed=function(){var t=this.getTooltip_AsString();return t&&t.trim().length===0};d.prototype._addTitleAttribute=function(){if(this.$().attr("title")){return}if(!this._title&&this._hasData()){this._title=this.getTooltip_AsString()}if(this._title){this.$().attr("title",this._title)}};d.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this._title=this.$().attr("title");this.$().removeAttr("title")}};d.prototype._hasData=function(){return this.getBars().length>0};d.prototype.firePress=function(){if(this._hasData()){e.prototype.fireEvent.call(this,"press",arguments)}};a.extendMicroChart(d);return d});
//# sourceMappingURL=StackedBarMicroChart.js.map