sap.ui.define(["sap/m/Dialog","sap/m/VBox","sap/m/HBox","sap/m/FlexItemData","sap/ui/layout/form/Form","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/ui/layout/form/FormLayout","sap/ui/layout/form/ResponsiveGridLayout","sap/m/Button","sap/m/MultiInput","sap/m/Input","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/TimePicker","sap/m/Select","sap/ui/core/ListItem","sap/m/Token","sap/m/Bar","sap/ui/core/Core","sap/m/Title","sap/ui/model/Filter"],function(e,t,a,i,s,r,l,n,o,p,u,h,d,m,f,c,g,F,w,y,T,b){"use strict";return class{operators={[sap.ui.model.FilterOperator.BT]:true,[sap.ui.model.FilterOperator.Contains]:true,[sap.ui.model.FilterOperator.EndsWith]:true,[sap.ui.model.FilterOperator.EQ]:true,[sap.ui.model.FilterOperator.GE]:true,[sap.ui.model.FilterOperator.GT]:true,[sap.ui.model.FilterOperator.LE]:true,[sap.ui.model.FilterOperator.LT]:true,[sap.ui.model.FilterOperator.StartsWith]:true,[sap.ui.model.FilterOperator.NB]:false,[sap.ui.model.FilterOperator.NE]:false,[sap.ui.model.FilterOperator.NotContains]:false,[sap.ui.model.FilterOperator.NotEndsWith]:false,[sap.ui.model.FilterOperator.NotStartsWith]:false};operatorHasDouble={[sap.ui.model.FilterOperator.BT]:true,[sap.ui.model.FilterOperator.NB]:true};data=null;i18n=null;container=null;applyFilterButton=null;innerContainer=null;mainPage=null;subPages={};multiInputs={};fields={};filterBarContainer={};constructor(a){this.data=a;this.i18n=a.i18n;this.fields={};for(let e of this.data.fields)this.fields[e.path]=e;this.applyFilterButton=new p({text:this.i18n.getText("apply",undefined,true)||"Apply",icon:"sap-icon://accept",type:sap.m.ButtonType.Emphasized,press:()=>{this.applyFilters()}});this.createLayout();this.container=null;if(a.dialog){this.container=new e({draggable:true,stretch:!sap.ui.Device.system.desktop,contentWidth:"40em",customHeader:new w({contentLeft:new T({text:a.title}),contentRight:new p({icon:"sap-icon://delete",tooltip:this.i18n.getText("clear_filters"),press:()=>{this.clearFilters();this.applyFilters()}})}),content:[this.innerContainer],beginButton:this.applyFilterButton,endButton:new p({text:this.i18n.getText("cancel",undefined,true)||"Cancel",type:sap.m.ButtonType.Transparent,press:()=>{this.restoreFilters();this.navigateInnerContainer(this.mainPage);this.container.close()}})})}else{this.container=new t({renderType:sap.m.FlexRendertype.Bare,items:[this.innerContainer,this.applyFilterButton]})}}createFilter(){let e=[];for(let t in this.savedFilters){let a=[];for(let e of this.savedFilters[t]){a.push(new b({path:t,operator:e.operator,value1:e.low,value2:this.operatorHasDouble[e.operator]?e.high:undefined}))}if(a.length>0)e.push(new b({filters:a,and:false}))}if(e.length>0)return new b({filters:e,and:true});else return null}applyFilters(){this.data.onFilter(this.createFilter());this.navigateInnerContainer(this.mainPage);if(this.data.dialog)this.container.close()}clearFilters(){this.savedFilters={};this.restoreFilters()}saveFilters(){this.savedFilters={};for(let e in this.multiInputs){let t=this.multiInputs[e];this.savedFilters[e]=[];for(let a of t.getTokens()){this.savedFilters[e].push({operator:a.data("operator"),low:a.data("low"),high:a.data("high")})}}}restoreFilters(){if(!this.savedFilters)this.savedFilters={};for(let e in this.multiInputs){let t=this.multiInputs[e];t.destroyTokens();t.removeAllTokens();let a=this.filterBarContainer[e];a.destroyItems();a.removeAllItems();if(this.savedFilters[e]&&this.savedFilters[e].length>0){for(let i of this.savedFilters[e]){let s=i.operator+":"+(i.low||"''")+(i.high==(null||undefined)?"":","+(i.high||"''"));let r=new F({text:s});r.data("operator",i.operator);r.data("low",i.low);r.data("high",i.high);t.addToken(r);a.addItem(this.createFilterBar(e,a,i))}}}}navigateInnerContainer(e){this.applyFilterButton.setEnabled(e==this.mainPage);this.innerContainer.getItems().forEach(e=>this.innerContainer.removeItem(e));this.innerContainer.addItem(e)}createLayout(){this.createSubPages();this.innerContainer=new t;let e=[];this.multiInputs={};for(let t of this.data.fields){let a=new u({showValueHelp:true,showSuggestion:false});a.attachValueHelpRequest(()=>{this.navigateInnerContainer(this.subPages[t.path])});a.attachTokenUpdate(e=>{let t=e.getParameter("removedTokens");if(t.length>0){for(let e of t)a.removeToken(e);this.saveFilters();this.restoreFilters()}});this.multiInputs[t.path]=a;e.push(new l({label:t.label,fields:a}))}this.mainPage=new s({editable:true,layout:new o({labelSpanXL:3,labelSpanL:3,labelSpanM:3,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:4,emptySpanL:4,emptySpanM:4,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false}),formContainers:[new r({formElements:e})]});this.innerContainer.addItem(this.mainPage)}createSubPages(){this.subPages={};this.filterBarContainer={};for(let e of this.data.fields){let a=new t({});this.filterBarContainer[e.path]=a;let i=new p({icon:"sap-icon://add",text:this.i18n.getText("add",undefined,true)||"Add",press:()=>{a.addItem(this.createFilterBar(e.path,a))}});a.addStyleClass("sapUiSmallMarginBeginEnd");i.addStyleClass("sapUiSmallMarginBeginEnd");this.subPages[e.path]=new t({renderType:sap.m.FlexRendertype.Bare,items:[new w({contentLeft:[new T({text:e.label})],contentRight:[new p({icon:"sap-icon://accept",text:this.i18n.getText("confirm",undefined,true)||"Confirm",press:()=>{let t=this.multiInputs[e.path];t.destroyTokens();t.removeAllTokens();for(let i of a.getItems()){let a=i.data("operator").getSelectedKey();let s=i.data("low").getValue();let r=i.data("high");r=r.getEditable()?r.getValue():null;if(!this.operators[a])continue;let l=a+":"+(s||"''")+(r==null?"":","+(r||"''"));let n=new F({text:l});if(e.type=="Datetime"){s=i.data("low").getDateValue();if(r!=null)r=i.data(r).getDateValue()}n.data("operator",a);n.data("low",s);n.data("high",r);t.addToken(n)}this.saveFilters();this.navigateInnerContainer(this.mainPage)}}),new p({text:this.i18n.getText("cancel",undefined,true)||"Cancel",press:()=>{this.restoreFilters();this.navigateInnerContainer(this.mainPage)}})]}),a,i]})}}createFilterBar(e,t,s={}){let r=this.fields[e];let l=new c({items:(r.operators||Object.keys(this.operators)).map(e=>{if(!this.operators[e])return null;return new g({key:e,text:this.i18n.getText(e)})}).filter(e=>e)});l.setSelectedKey(s.operator||l.getItemAt(0).getKey());let n=null,o=null;if(r.type=="Date"){n=new d;o=new d({editable:!!this.operatorHasDouble[l.getSelectedKey()]})}else if(r.type=="Datetime"){n=new m;o=new m({editable:!!this.operatorHasDouble[l.getSelectedKey()]})}else if(r.type=="Time"){n=new f;o=new f({editable:!!this.operatorHasDouble[l.getSelectedKey()]})}else{n=new h({type:r.type});o=new h({type:r.type,editable:!!this.operatorHasDouble[l.getSelectedKey()]});if(typeof r.onValueHelp=="function"){n.setShowValueHelp(true);o.setShowValueHelp(true);n.attachValueHelpRequest(()=>r.onValueHelp(n));o.attachValueHelpRequest(()=>r.onValueHelp(o))}}if(s.low)n.setValue(s.low);if(s.high)o.setValue(s.high);l.attachChange(()=>{o.setEditable(!!this.operatorHasDouble[l.getSelectedKey()])});let u=new p({icon:"sap-icon://delete",type:sap.m.ButtonType.Transparent,press:()=>{t.removeItem(F);F.destroy()}});let F=new a({alignItems:sap.m.FlexAlignItems.End,items:[new a({wrap:sap.m.FlexWrap.Wrap,items:[l,new a({wrap:sap.m.FlexWrap.Wrap,items:[n,o],layoutData:new i({growFactor:1})})],layoutData:new i({growFactor:1})}),new a({items:[u]})]});F.data("operator",l);F.data("low",n);F.data("high",o);return F}}});
//# sourceMappingURL=FilterDialog.js.map