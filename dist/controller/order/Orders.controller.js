sap.ui.define(["ui5pos/szdk/controller/BaseController","ui5pos/szdk/controller/util/Table","ui5pos/szdk/controller/util/F4Help","ui5pos/szdk/controller/util/FilterDialog","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/Text","sap/m/Input","sap/m/Button","sap/m/ToolbarSeparator","sap/m/Link"],function(e,t,r,a,l,o,i,n,s,p,d){"use strict";return e.extend("ui5pos.szdk.controller.order.Orders",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.comp.getRouter().getRoute("orders").attachPatternMatched(this.defaultPatternMatched.bind(this));this.comp.szdk_serviceCreated.then(e=>{let u=new n({type:sap.m.InputType.Number,placeholder:"{lang>order_id}",width:"9em"});let m=new s({type:sap.m.ButtonType.Transparent,text:"{lang>open}",press:()=>{const t=()=>{u.setValueStateText(this.i18n.getText("input_invalid_order_id"));u.setValueState(sap.ui.core.ValueState.Error)};let r=parseInt(u.getValue());if(!r){t();return}e.read(`/Orders(${r})`,{success:e=>{if(e&&e.OrderID){u.setValueState(sap.ui.core.ValueState.None);u.setValue("");this.comp.getRouter().navTo("view_order",{id:e.OrderID})}else{t()}},error:e=>{t()}})}});this.filterDialog=new a({i18n:this.i18n,dialog:true,title:"{lang>add_filters}",onFilter:e=>{g.applyFilter(e)},fields:[{path:"OrderID",label:"{lang>order_id}",type:sap.m.InputType.Number,operators:[sap.ui.model.FilterOperator.EQ,sap.ui.model.FilterOperator.BT,sap.ui.model.FilterOperator.LT,sap.ui.model.FilterOperator.GT,sap.ui.model.FilterOperator.LE,sap.ui.model.FilterOperator.GE]},{path:"CustomerID",label:"{lang>customer_id}",onValueHelp:t=>{r.f4Table({i18n:this.i18n,ODataModel:e,entitySetPath:"/Customers",filterFields:[{path:"CustomerID",label:this.i18n.getText("customer_id")},{path:"ContactName",label:this.i18n.getText("customer_name")},{path:"Phone",label:this.i18n.getText("customer_phone")}],showFields:[{path:"CustomerID",label:this.i18n.getText("customer_id")},{path:"ContactName",label:this.i18n.getText("customer_name")},{path:"Phone",label:this.i18n.getText("customer_phone")}],returnFields:["CustomerID"],title:this.i18n.getText("customer_select_single")}).then(e=>{if(!e||e.length==0)return;let r=e[0].CustomerID;if(r){t.setValue(r).setValueState(sap.ui.core.ValueState.None)}})}},{path:"Customer/ContactName",label:"{lang>customer_name}"},{path:"Customer/Phone",label:"{lang>customer_phone}"},{path:"OrderDate",label:"{lang>order_date}",type:"Datetime",operators:[sap.ui.model.FilterOperator.EQ,sap.ui.model.FilterOperator.BT,sap.ui.model.FilterOperator.LT,sap.ui.model.FilterOperator.GT,sap.ui.model.FilterOperator.LE,sap.ui.model.FilterOperator.GE]},{path:"Freight",label:"{lang>order_total}",type:sap.m.InputType.Number,operators:[sap.ui.model.FilterOperator.EQ,sap.ui.model.FilterOperator.BT,sap.ui.model.FilterOperator.LT,sap.ui.model.FilterOperator.GT,sap.ui.model.FilterOperator.LE,sap.ui.model.FilterOperator.GE]}]});this.filterDialog.container.setModel(this.comp.getModel("lang"),"lang");let h=new s({icon:"sap-icon://filter",type:sap.m.ButtonType.Transparent,tooltip:"{lang>filter}"});h.attachPress(()=>{this.filterDialog.container.open()});let c=[{id:"OrderID",label:"order_id",path:"OrderID",header:{}},{id:"ContactName",label:"customer_name",path:"Customer/ContactName",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"Phone",label:"customer_phone",path:"Customer/Phone",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"OrderDate",label:"order_date",path:"OrderDate",header:{minScreenWidth:"Tablet",demandPopin:true,popinDisplay:"Inline"}},{id:"OrderTime",label:"order_time",path:"OrderDate",header:{minScreenWidth:"Tablet",demandPopin:true,popinDisplay:"Inline"}},{id:"Freight",label:"order_total",path:"Freight",header:{hAlign:"End"}}].map(e=>({id:this.getView().createId(e.id),cell:{bindingPath:e.path},header:{header:`{lang>${e.label}}`,...e.header},p13n:{key:e.id,label:this.i18n.getText(e.label),path:e.path},excel:{label:this.i18n.getText(e.label),property:e.path}}));c[0].cell.control=new o({title:"{OrderID}"});c[1].cell.control=new d({text:"{Customer/ContactName}",wrapping:true});c[3].cell.control=new i({text:{path:"OrderDate",type:"sap.ui.model.odata.type.Date"}});delete c[3].excel;c[4].cell.control=new i({text:{path:"OrderDate",type:{formatValue:e=>new Date(e).toTimeString().split(" ")[0]}}});c[4].p13n.sortable=false;c[4].p13n.groupable=false;c[5].cell.control=new l({unit:"USD"});c[5].cell.control.bindProperty("number",{parts:[{path:"Freight"},{value:"USD"}],type:"sap.ui.model.type.Currency",formatOptions:{showMeasure:false}});let g=new t({id:this.getView().createId("orders_table"),i18n:this.i18n,model:e,columnListItem:{type:sap.m.ListType.Navigation},properties:{busyIndicatorDelay:0,mode:sap.m.ListMode.SingleSelectMaster,rememberSelections:true,growing:true,growingThreshold:50,sticky:["HeaderToolbar","ColumnHeaders"],popinLayout:sap.m.PopinLayout.Block,alternateRowColors:false},itemsBinding:{path:"/Orders",parameters:{expand:"Customer"}},customToolbar:{start:[h,new p,u,m]},toolbar:{p13n:{Columns:true,Sorter:true,Groups:true},excel:this.comp.getModel("settings").getProperty("/odata/useMock")?2:1,growSize:true,pin:true},columns:c});this.byId("table_container").addContent(g.getTable());g.getTable().attachItemPress(this.onSelectionChange.bind(this))})},onSelectionChange:function(e){let t=e.getParameters();if(!t.listItem||t.listItems&&t.listItems.length!=1)return;let r=t.listItem.getBindingContext();let a=r?r.getProperty("OrderID"):null;if(a!==null)this.comp.getRouter().navTo("view_order",{id:a})}})});
//# sourceMappingURL=Orders.controller.js.map