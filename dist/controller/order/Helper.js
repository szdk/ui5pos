sap.ui.define(["ui5pos/szdk/controller/customer/CustomerHelper"],function(e){"use strict";let t={create:function(r,o,s){let i=()=>{},n=()=>{};let u=new Promise((e,t)=>{i=e;n=t});if(!r.CustomerID){return e.create.bind(this)(s).then(e=>{if(!e||!e.CustomerID){throw new Error({message:"Customer creation failed",data:e})}else{r={...r};r.CustomerID=e.CustomerID;return t.create.bind(this)(r,o)}})}if(!r.OrderID&&(this.comp.getModel("settings").getProperty("/odata/useMock")||this.comp.getModel("settings").getProperty("/odata/generateID"))){return this.getMaxValue("/Orders","OrderID").then(e=>{if(parseInt(e)){r={...r};r.OrderID=parseInt(e)+1;return t.create.bind(this)(r,o)}else throw new Error("max order id fetch failed")});return u}let d={};for(let e of o){if(!d[e.ProductID]){d[e.ProductID]={...e}}else{d[e.ProductID].Quantity+=e.Quantity}}o=[];for(let e in d){o.push({...d[e]})}r.Freight=0;for(let e of o)r.Freight+=e.UnitPrice*e.Quantity*(1-e.Discount);let a=this.comp.getModel("service");a.create("/Orders",r,{success:e=>{if(!e||!parseInt(e.OrderID)){n({message:"order creation failed",dataReturned:e});return}let t=this.comp.getModel("settings").getProperty("/odata/useMock")||this.comp.getModel("settings").getProperty("/odata/updateQuantity");let r={};const s=()=>{for(let s of o){s={...s};s.OrderID=parseInt(e.OrderID);a.createEntry("/Order_Details",{properties:s});if(t&&r[s.ProductID]){a.setProperty(`/Products(${s.ProductID})/UnitsInStock`,Math.max(0,(parseInt(r[s.ProductID].UnitsInStock)||0)-s.Quantity))}}a.submitChanges({success:t=>{i(e)},error:n})};if(t){let e=[];for(let t of o)e.push(t.ProductID);this.fetchProducts(e).then(e=>{if(e&&e.length>0){for(let t of e){r[t.ProductID]=t}}s()}).catch(()=>s())}else s()},error:n});return u},update:function(r,o,s){let i=()=>{},n=()=>{};let u=new Promise((e,t)=>{i=e;n=t});if(!r.OrderID){n({message:"OrderID not provided",order:r});return u}if(!r.CustomerID){return e.create.bind(this)(s).then(e=>{if(!e||!e.CustomerID){throw new Error({message:"Customer creation failed",data:e})}else{r={...r};r.CustomerID=e.CustomerID;return t.update.bind(this)(r,o)}})}let d={};for(let e of o){if(!d[e.ProductID]){d[e.ProductID]={...e}}else{d[e.ProductID].Quantity+=e.Quantity}}o=[];for(let e in d){o.push({OrderID:r.OrderID,...d[e]})}r.Freight=0;for(let e of o)r.Freight+=e.UnitPrice*e.Quantity*(1-e.Discount);let a=this.comp.getModel("service");let c={};let l={};let f={create:[],update:[],delete:[]};let h={};this.fetchOrder(r.OrderID).then(e=>e.Order_Details&&e.Order_Details.results||[]).then(e=>{for(let t of e)c[t.ProductID]=t;for(let e of o)l[e.ProductID]=e;for(let e in c){if(!l[e])f.delete.push(e)}for(let e in l){if(!c[e])f.create.push(e);else f.update.push(e)}return this.fetchProducts([...f.create,...f.update,...f.delete]).then(e=>temp_data||[])}).then(e=>{for(let t of e)h[t.ProductID]=t;for(let e of f.delete){}})}};return t});
//# sourceMappingURL=Helper.js.map