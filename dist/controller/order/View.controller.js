sap.ui.define(["ui5pos/szdk/controller/BaseController","ui5pos/szdk/controller/util/Table","ui5pos/szdk/controller/order/Helper","sap/ui/model/json/JSONModel","sap/m/ObjectNumber","sap/m/Text","sap/m/Link","sap/m/Title","sap/ui/core/CustomData"],function(e,t,r,i,o,a,n,d,s){"use strict";return e.extend("ui5pos.szdk.controller.order.View",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.getView().setBusyIndicatorDelay(0);this.comp.szdk_serviceCreated.then(e=>e.attachRequestSent(()=>this.getView().setBusy(true)));this.comp.szdk_serviceCreated.then(e=>e.attachRequestCompleted(()=>this.getView().setBusy(false)));this.comp.getRouter().getRoute("view_order").attachPatternMatched(this.patternMatched.bind(this))},patternMatched:function(e){if(!this.defaultPatternMatched(e))return;this.comp.getModel("nav").setProperty("/sideNav/selectedKey",`nav_item_route_orders`);this.orderID=null;const t=()=>{this.comp.getRouter().getTarget("notFound").display()};let r=e.getParameter("arguments");let i=r&&r.id&&(""+r.id).length>0?r.id:null;if(i){this.comp.getModel("service").createBindingContext(`/Orders(${i})`,{expand:"Customer"},e=>{if(!e){t();return}this.orderID=parseInt(i);this.getView().setBindingContext(e,"service");document.title=this.i18n.getText("order_view_title",[this.orderID]);if(!this.order_details_table){this.createOrderDetailTable(i)}else if(this.order_details_table_id!=i){this.updateOrderDetailTable(i)}},true)}else{t()}},createOrderDetailTable:function(e){this.order_details_table_id=e;this.byId("order_view_page").setHeaderExpanded(true);let r=[{id:"ProductID",label:"product_id",path:"ProductID",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"ProductName",label:"product_name",path:"Product/ProductName",header:{}},{id:"UnitPrice",label:"product_unitPrice",path:"UnitPrice",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"Quantity",label:"order_quantity",path:"Quantity",header:{minScreenWidth:"Tablet",demandPopin:true,popinDisplay:"Inline"}},{id:"Discount",label:"order_discount",path:"Discount",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"NetPrice",label:"order_net_price",path:"UnitPrice",header:{hAlign:"End"}}].map(e=>({id:this.getView().createId(e.id),cell:{bindingPath:e.path},header:{header:`{lang>${e.label}}`,...e.header},p13n:{key:e.id,label:this.i18n.getText(e.label),path:e.path},excel:{label:this.i18n.getText(e.label),property:e.path}}));r[1].cell.control=new n({text:"{Product/ProductName}",customData:[new s({key:"id",value:"{ProductID}"})],wrapping:true,press:e=>{let t=e.getSource();if(!t)return;let r=t.data("id");if(r)this.comp.getRouter().navTo("view_product",{id:r})}});r[2].cell.control=new o({unit:"USD"});r[2].cell.control.bindProperty("number",{parts:[{path:"UnitPrice"},{value:"USD"}],type:"sap.ui.model.type.Currency",formatOptions:{showMeasure:false}});r[4].cell.control=new a({text:"{= ${Discount} === 0 ? 0 : ( (${Discount} * 100) + ' %' )}"});r[5].cell.control=new o({unit:"USD"});r[5].cell.control.bindProperty("number",{parts:[{path:"UnitPrice"},{path:"Quantity"},{path:"Discount"}],type:this.inputCheck.order.netPrice,formatOptions:{showMeasure:false}});delete r[5].excel;this.order_details_table=new t({id:this.getView().createId("order_details_table"),i18n:this.i18n,model:this.comp.getModel("service"),properties:{busyIndicatorDelay:0,mode:sap.m.ListMode.None,rememberSelections:true,growing:true,growingThreshold:1e3,sticky:["HeaderToolbar","ColumnHeaders"],popinLayout:sap.m.PopinLayout.Block,alternateRowColors:false},itemsBinding:{path:`/Orders(${e})/Order_Details`,parameters:{expand:"Product"}},customToolbar:{start:[new d({text:"{lang>order_view_items_header}"})]},toolbar:{p13n:{Columns:true,Sorter:true,Groups:true},excel:this.comp.getModel("settings").getProperty("/odata/useMock")?2:1,growSize:false,pin:true},columns:r});this.byId("table_container").removeAllContent();this.byId("table_container").addContent(this.order_details_table.getTable())},updateOrderDetailTable:function(e){this.order_details_table_id=e;this.byId("order_view_page").setHeaderExpanded(true);this.order_details_table.data.itemsBinding.path=`/Orders(${e})/Order_Details`;this.order_details_table.refreshBinding()},onOpenAction:function(e){this.byId("view_order_actionSheet").openBy(e.getSource())},onEdit:function(e){this.comp.getRouter().navTo("create_order",{edit:this.orderID})},onDelete:function(e){this.showErrorDialog({title:this.i18n.getText("confirm_delete"),message:this.i18n.getText("order_view_confirm_delete",[this.orderID]),onConfirm:()=>{r.delete({model:this.comp.getModel("service"),orderId:this.orderID}).then(()=>{this.goBack("orders")}).catch(()=>{this.showErrorDialog()})}})},onPrint:function(){r.print({model:this.comp.getModel("service"),order_id:this.orderID,i18n:this.i18n}).catch(()=>this.showErrorDialog())}})});
//# sourceMappingURL=View.controller.js.map