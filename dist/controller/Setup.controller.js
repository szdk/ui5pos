sap.ui.define(["ui5pos/szdk/controller/BaseController","sap/ui/model/json/JSONModel","ui5pos/szdk/models/models"],function(e,t,o){"use strict";return e.extend("ui5pos.szdk.controller.Setup",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.comp.getRouter().getRoute("setup").attachPatternMatched(e=>{if(this.comp.getModel("service")){this.goBack()}this.comp.getModel("nav").setProperty("/sideNav/visible",false)});let o=new t({odataType:"1",odataUrl:"",odataDelay:100,inputEnabled:true,ServiceCreated:false,generateID:false,updateMethod:"MERGE"});this.getView().setModel(o,"local")},onCreateService:function(e){let t=this.getView();let s=t.getModel("local");let a=this.byId("setup-loading");if(s.getProperty("/ServiceCreated")&&this.comp.getModel("service")){this.goBack("home");return}s.setProperty("/inputEnabled",false);a.setVisible(true);let r=this.comp.getModel("settings").getData();r.odata.useMock=s.getProperty("/odataType")==="1";r.odata.serviceUrl=r.odata.useMock?"/ui5pos/szdk/mockService.svc/":s.getProperty("/odataUrl");let i=parseInt(s.getProperty("/odataDelay"));if(!i)i=0;s.setProperty("/odataDelay",i);r.odata.delay=i;r.odata.generateID=r.odata.useMock?true:s.getProperty("/generateID");r.odata.updateMethod=s.getProperty("/updateMethod");this.comp.getModel("settings").setData(r);let l=null;setTimeout(()=>o.createService({...r}).then(e=>{l=e;return e.metadataLoaded(true)}).then(()=>{this.comp.setModel(l,"service");this.comp.szdk_resolve_serviceCreated(l);s.setProperty("/ServiceCreated",true);a.setVisible(false)}).catch(e=>{a.setVisible(false);let t=this.byId("setup-error-dialog").setVisible(true).open();this.byId("setup-error-dialog-text").setText(this.i18n.getText("setup_loadingError",[e.message]));this.byId("setup-error-dialog-close").attachPress(()=>{t.close().setVisible(false)});o.deleteService(r.odata.serviceUrl);s.setProperty("/inputEnabled",true)}),100)}})});
//# sourceMappingURL=Setup.controller.js.map