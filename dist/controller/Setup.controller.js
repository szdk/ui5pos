sap.ui.define(["ui5pos/szdk/controller/BaseController","sap/ui/model/json/JSONModel","ui5pos/szdk/models/models"],function(e,t,a){"use strict";return e.extend("ui5pos.szdk.controller.Setup",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.comp.getRouter().getRoute("setup").attachPatternMatched(e=>{if(this.comp.getModel("service")){this.goBack()}this.comp.getModel("nav").setProperty("/sideNav/visible",false)});const a={...this.comp.getModel("settings").getData()};let o=new t({odataType:a.odata.useMock?"1":"2",odataUrl:a.odata.serviceUrl,odataDelay:a.odata.delay,generateID:a.odata.generateID,updateQuantity:a.odata.updateQuantity,updateMethod:a.odata.updateMethod,inputEnabled:true,ServiceCreated:false});this.getView().setModel(o,"local")},onCreateService:function(e){let t=this.getView();let o=t.getModel("local");let s=this.byId("setup-loading");if(o.getProperty("/ServiceCreated")&&this.comp.getModel("service")){this.goBack("home");return}o.setProperty("/inputEnabled",false);s.setVisible(true);let r={...this.comp.getModel("settings").getData()};r.odata={...r.odata};r.odata.useMock=o.getProperty("/odataType")==="1";r.odata.serviceUrl=r.odata.useMock?"/ui5pos/szdk/mockService.svc/":o.getProperty("/odataUrl");let d=parseInt(o.getProperty("/odataDelay"));if(!d)d=0;o.setProperty("/odataDelay",d);r.odata.delay=d;r.odata.generateID=r.odata.useMock?true:o.getProperty("/generateID");r.odata.updateQuantity=r.odata.useMock?true:o.getProperty("/updateQuantity");r.odata.updateMethod=o.getProperty("/updateMethod");this.comp.getModel("settings").setData(r);let i=null;setTimeout(()=>a.createService({...r}).then(e=>{i=e;return e.metadataLoaded(true)}).then(()=>{this.comp.setModel(i,"service");this.comp.szdk_resolve_serviceCreated(i);o.setProperty("/ServiceCreated",true);s.setVisible(false)}).catch(e=>{s.setVisible(false);let t=this.byId("setup-error-dialog").setVisible(true).open();this.byId("setup-error-dialog-text").setText(this.i18n.getText("setup_loadingError",[e.message]));this.byId("setup-error-dialog-close").attachPress(()=>{t.close().setVisible(false)});a.deleteService(r.odata.serviceUrl);o.setProperty("/inputEnabled",true)}),100)}})});
//# sourceMappingURL=Setup.controller.js.map