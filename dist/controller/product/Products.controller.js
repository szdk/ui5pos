sap.ui.define(["ui5pos/szdk/controller/BaseController","ui5pos/szdk/controller/util/Table","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/ObjectIdentifier","sap/m/ObjectNumber","sap/m/Title","sap/m/Input","sap/m/ToolbarSeparator"],function(e,t,i,r,n,a,o,l,s,p,d,u,c,h){"use strict";let g={onSearchProduct:function(e){let t=e.getParameter("query").trim();let i=this._tableMain.getBinding("items");let r=t.length==0?[]:new l({filters:[new l({path:"ProductID",operator:s.EQ,value1:t}),new l({path:"ProductName",operator:s.Contains,value1:t}),new l({path:"QuantityPerUnit",operator:s.Contains,value1:t})],and:false});i.filter(r)},onRefreshItems:function(){this._tableMain.refreshItems()},onItemsPerPage:function(e){let t=e.getParameter("item");let i=parseInt(t.getKey());this.tableModel.setProperty("/grow/size",i);this.tableModel.setProperty("/grow/text",t.getText());if(i===0)this.onRefreshItems()},onPinHeader:function(e){let t=e.getParameter("item").getKey();let i=[...this.tableModel.getProperty("/sticky")];let r=i.indexOf(t);if(r===-1)i.push(t);else i.splice(r,1);this.tableModel.setProperty("/sticky",i)},onExportExcel:function(){let e=sap.ui.export.EdmType;let t=[{label:this.i18n.getText("id"),property:"ProductID",type:e.Number,scale:0},{label:this.i18n.getText("product"),property:"ProductName",type:e.String,width:20},{label:this.i18n.getText("category"),property:"Category/CategoryName",type:e.String},{label:this.i18n.getText("product_instock"),property:"UnitsInStock",type:e.Number,scale:0},{label:this.i18n.getText("product_quantityPerUnit"),property:"QuantityPerUnit",type:e.String},{label:this.i18n.getText("product_unitPrice")+" (USD)",property:"UnitPrice",type:e.Number,scale:2,delimiter:true}];const i=(e,i=false)=>{let n={workbook:{columns:t},dataSource:e,fileName:`${this.i18n.getText("products_title")}.xlsx`,worker:i};let a=new r(n);a.build().finally(function(){a.destroy()})};if(this.comp.getModel("settings").getProperty("/odata/useMock")){this.tableModel.setProperty("/canExport",false);let e=this._tableMain.getBindingInfo("items");this.comp.getModel("service").read(e.path,{urlParameters:{$expand:"Category"},sorters:e.sorter,filters:e.filters,success:e=>{i(e.results);this.tableModel.setProperty("/canExport",true)},error:e=>{let t=new n({type:sap.m.DialogType.Message,state:sap.ui.core.ValueState.Error,content:new o({text:this.i18n.getText("export_failed")}),beginButton:new a({type:ButtonType.Emphasized,text:this.i18n.getText("ok"),press:()=>{this.tableModel.setProperty("/canExport",true);t.close()}})}).open()}})}else{i(this._tableMain.getBinding("items"),true)}}};return e.extend("ui5pos.szdk.controller.product.Products",{...g,onInit:function(){e.prototype.onInit.apply(this,arguments);let i=new a({icon:"sap-icon://filter",type:sap.m.ButtonType.Transparent,tooltip:this.i18n.getText("filter")});let r=new c({type:sap.m.InputType.Number,showValueHelp:true,placeholder:this.i18n.getText("product_id"),width:"9em"});let n=new a({type:sap.m.ButtonType.Transparent,text:this.i18n.getText("open")});let o=[{id:"ProductID",label:this.i18n.getText("id"),path:"ProductID",header:{minScreenWidth:"XXLarge",width:"5em"}},{id:"ProductName",label:this.i18n.getText("product"),path:"ProductName",header:{}},{id:"CategoryName",label:this.i18n.getText("category"),path:"Category/CategoryName",header:{minScreenWidth:"Tablet",demandPopin:true,popinDisplay:"WithoutHeader"}},{id:"UnitsInStock",label:this.i18n.getText("product_instock"),path:"UnitsInStock",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"QuantityPerUnit",label:this.i18n.getText("product_quantityPerUnit"),path:"QuantityPerUnit",header:{minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"UnitPrice",label:this.i18n.getText("product_unitPrice"),path:"UnitPrice",header:{hAlign:"End"}},{id:"SupplierID",label:this.i18n.getText("supplier_id"),path:"SupplierID",header:{visible:false,minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"CategoryID",label:this.i18n.getText("category_id"),path:"CategoryID",header:{visible:false,minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"ReorderLevel",label:this.i18n.getText("product_reorder_level"),path:"ReorderLevel",header:{visible:false,minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}},{id:"Discontinued",label:this.i18n.getText("discontinued"),path:"Discontinued",header:{visible:false,minScreenWidth:"XXLarge",demandPopin:true,popinDisplay:"Inline"}}].map(e=>({id:this.getView().createId(e.id),cell:{bindingPath:e.path},header:{header:e.label,...e.header},p13n:{key:e.id,label:e.label,path:e.path},excel:{label:e.label,property:e.path}}));o[0].cell.control=new p({title:"{ProductID}"});o[1].cell.control=new u({titleStyle:"H6",wrapping:true,wrappingType:"Normal",text:"{ProductName}"});o[5].cell.control=new d({unit:"USD"});o[5].cell.control.bindProperty("number",{parts:[{path:"UnitPrice"},{value:"USD"}],type:"sap.ui.model.type.Currency",formatOptions:{showMeasure:false}});this.comp.szdk_serviceCreated.then(e=>{let a=new t({id:"products_table",i18n:this.i18n,model:e,columnListItem:{type:sap.m.ListType.Navigation},properties:{busyIndicatorDelay:0,mode:sap.m.ListMode.SingleSelectMaster,rememberSelections:true,growing:true,growingThreshold:50,sticky:["HeaderToolbar","ColumnHeaders"],popinLayout:sap.m.PopinLayout.Block,alternateRowColors:false},itemsBinding:{path:"/Products",parameters:{expand:"Category"}},customToolbar:{start:[i,new h,r,n]},toolbar:{p13n:{Columns:Boolean,Sorter:Boolean,Groups:Boolean},excel:this.comp.getModel("settings").getProperty("/odata/useMock")?2:1,growSize:true,pin:true},columns:o});this.byId("products_main_page").addContent(a.getTable());a.getTable().attachItemPress(this.onSelectionChange.bind(this))})},onSelectionChange:function(e){let t=e.getParameters();if(!t.listItem||t.listItems&&t.listItems.length!=1)return;let i=t.listItem.getBindingContext();let r=i?i.getProperty("ProductID"):null;if(r!==null)this.comp.getRouter().navTo("view_product",{id:r})},onPressCreateProduct:function(){this.comp.getRouter().navTo("create_product")}})});
//# sourceMappingURL=Products.controller.js.map