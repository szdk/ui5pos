sap.ui.define(["ui5pos/szdk/controller/BaseController","sap/ui/model/json/JSONModel","ui5pos/szdk/controller/util/F4Help","sap/ui/core/Core"],function(e,t,r,a){"use strict";return e.extend("ui5pos.szdk.controller.product.Create",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.comp.getRouter().getRoute("create_product").attachPatternMatched(this.defaultPatternMatched.bind(this));this.mainModel=new t({productData:{ProductName:"",SupplierID:"",CategoryID:"",QuantityPerUnit:"",UnitPrice:"",UnitsInStock:"",ReorderLevel:""}});this.getView().setModel(this.mainModel,"model");let r=a.getMessageManager();r.registerObject(this.byId("create_product_input_name"),true);r.registerObject(this.byId("create_product_input_category"),true);r.registerObject(this.byId("create_product_input_supplier"),true);r.registerObject(this.byId("create_product_input_qpu"),true);r.registerObject(this.byId("create_product_input_unit_price"),true);r.registerObject(this.byId("create_product_input_in_stock"),true);r.registerObject(this.byId("create_product_input_reorder_level"),true)},onClearInput:function(){let e={...this.mainModel.getProperty("/productData")};for(let t in e){this.mainModel.setProperty(`/productData/${t}`,"0");this.mainModel.setProperty(`/productData/${t}`,"")}this.byId("create_product_input_name").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_input_category").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_input_supplier").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_input_qpu").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_input_unit_price").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_input_in_stock").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_input_reorder_level").setValueState(sap.ui.core.ValueState.None);this.byId("create_product_category_name").setValue();this.byId("create_product_supplier_name").setValue()},onSave:function(){for(let e of["create_product_input_name","create_product_input_qpu","create_product_input_unit_price","create_product_input_in_stock","create_product_input_reorder_level"]){let t=this.byId(e);try{let e=t.getBinding("value");let r=e?e.getType():null;if(r)r.validateValue(t.getValue())}catch(e){t.setValueState(sap.ui.core.ValueState.Error);this.showErrorDialog({message:this.i18n.getText("input_submit_error")});return}}this.categoryIDCheck().then(()=>this.supplierIDCheck()).then(()=>{let e=e=>{let t={ProductName:this.mainModel.getProperty("/productData/ProductName"),SupplierID:parseInt(this.mainModel.getProperty("/productData/SupplierID")),CategoryID:parseInt(this.mainModel.getProperty("/productData/CategoryID")),QuantityPerUnit:this.mainModel.getProperty("/productData/QuantityPerUnit"),UnitPrice:parseFloat(this.mainModel.getProperty("/productData/UnitPrice")),UnitsInStock:parseInt(this.mainModel.getProperty("/productData/UnitsInStock")),ReorderLevel:parseInt(this.mainModel.getProperty("/productData/ReorderLevel")),Discontinued:false,UnitsOnOrder:0};if(e)t.ProductID=e;console.log({action:"create product",data:t});this.comp.getModel("service").create("/Products",t,{success:e=>{console.log({message:"production created",data:e});this.onClearInput();if(e&&e.ProductID){this.comp.getRouter().navTo("view_product",{id:e.ProductID})}else{this.showSuccessDialog({message:this.i18n.getText("create_product_creation_success")})}},error:()=>{this.showErrorDialog()}})};if(this.comp.getModel("settings").getProperty("/odata/useMock")||this.comp.getModel("settings").getProperty("/odata/generateID")){this.getMaxValue("/Products","ProductID").then(t=>{e(t+1)}).catch(()=>{this.showErrorDialog()})}else{e()}}).catch(()=>this.showErrorDialog({message:this.i18n.getText("input_submit_error")}))},onValueHelpCategory:function(){r.f4Table({i18n:this.i18n,ODataModel:this.comp.getModel("service"),entitySetPath:"/Categories",filterFields:[{path:"CategoryName",label:this.i18n.getText("category_name")}],showFields:[{path:"CategoryID",label:this.i18n.getText("category_id")},{path:"CategoryName",label:this.i18n.getText("name")}],returnFields:["CategoryID","CategoryName"],title:this.i18n.getText("category_select_single")}).then(e=>{if(!e||e.length==0)return;let t=parseInt(e[0].CategoryID);if(t){this.byId("create_product_input_category").setValue(t).setValueState(sap.ui.core.ValueState.None);this.byId("create_product_category_name").setValue(e[0].CategoryName)}})},onValueHelpSupplier:function(){r.f4Table({i18n:this.i18n,ODataModel:this.comp.getModel("service"),entitySetPath:"/Suppliers",filterFields:[{path:"CompanyName",label:this.i18n.getText("supplier_company_name")}],showFields:[{path:"SupplierID",label:this.i18n.getText("supplier_id")},{path:"CompanyName",label:this.i18n.getText("supplier_company_name")}],returnFields:["SupplierID","CompanyName"],title:this.i18n.getText("supplier_select_single")}).then(e=>{if(!e||e.length==0)return;let t=parseInt(e[0].SupplierID);if(t){this.byId("create_product_input_supplier").setValue(t).setValueState(sap.ui.core.ValueState.None);this.byId("create_product_supplier_name").setValue(e[0].CompanyName)}})},onCategoryChange:function(){this.categoryIDCheck().catch(()=>{})},onSupplierChange:function(){this.supplierIDCheck().catch(()=>{})},categoryIDCheck:function(){let e=()=>{},t=()=>{};let r=new Promise((r,a)=>{e=r;t=a});const a=()=>{s.setValueState(sap.ui.core.ValueState.None)};const i=(e,t)=>{s.setValueStateText(this.i18n.getText(e,t));s.setValueState(sap.ui.core.ValueState.Error)};let o=this.byId("create_product_category_name");o.setValue("");let s=this.byId("create_product_input_category");let u=parseInt(s.getValue());if(!u||u<=0){i("input_invalid_category_id");t(u);return r}this.comp.getModel("service").read(`/Categories(${u})`,{success:t=>{if(t&&t.CategoryName)o.setValue(t.CategoryName);e(t);a()},error:e=>{t(u);i("input_invalid_category_id")}});return r},supplierIDCheck:function(){let e=()=>{},t=()=>{};let r=new Promise((r,a)=>{e=r;t=a});const a=()=>{s.setValueState(sap.ui.core.ValueState.None)};const i=(e,t)=>{s.setValueStateText(this.i18n.getText(e,t));s.setValueState(sap.ui.core.ValueState.Error)};let o=this.byId("create_product_supplier_name");o.setValue("");let s=this.byId("create_product_input_supplier");let u=parseInt(s.getValue());if(!u||u<=0){i("input_invalid_supplier_id");t(u);return r}this.comp.getModel("service").read(`/Suppliers(${u})`,{success:t=>{if(t&&t.CompanyName)o.setValue(t.CompanyName);e(t);a()},error:e=>{t(u);i("input_invalid_supplier_id")}});return r}})});
//# sourceMappingURL=Create.controller.js.map